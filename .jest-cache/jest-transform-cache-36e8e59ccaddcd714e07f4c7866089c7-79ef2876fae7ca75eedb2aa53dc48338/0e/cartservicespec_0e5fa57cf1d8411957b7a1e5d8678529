dbcafd6297d4e1c75652d4f81a005be1
"use strict";
/**
 * TDD: Shopping Cart Service Tests
 *
 * Testing cart management for e-commerce
 */
Object.defineProperty(exports, "__esModule", { value: true });
const cart_service_1 = require("./cart.service");
const errors_1 = require("@libs/errors");
describe('CartService', () => {
    let cartService;
    let mockCartStorage;
    beforeEach(() => {
        mockCartStorage = new Map();
        cartService = new cart_service_1.CartService(mockCartStorage);
    });
    describe('getCart', () => {
        it('should get empty cart for new user', async () => {
            const cart = await cartService.getCart('user-123');
            expect(cart.userId).toBe('user-123');
            expect(cart.items).toEqual([]);
            expect(cart.subtotal).toBe(0);
            expect(cart.itemCount).toBe(0);
        });
        it('should get existing cart', async () => {
            const existingCart = {
                userId: 'user-123',
                items: [{
                        productId: 'prod-1',
                        productName: 'Product 1',
                        productSku: 'SKU-001',
                        unitPrice: 50.00,
                        quantity: 2,
                        subtotal: 100.00,
                    }],
                subtotal: 100.00,
                itemCount: 2,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            mockCartStorage.set('user-123', existingCart);
            const cart = await cartService.getCart('user-123');
            expect(cart).toEqual(existingCart);
        });
    });
    describe('addItem', () => {
        it('should add new item to cart', async () => {
            const item = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            };
            const cart = await cartService.addItem('user-123', item);
            expect(cart.items).toHaveLength(1);
            expect(cart.items[0].productId).toBe('prod-1');
            expect(cart.items[0].quantity).toBe(2);
            expect(cart.items[0].subtotal).toBe(100.00);
        });
        it('should increment quantity if item exists', async () => {
            const item = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            };
            await cartService.addItem('user-123', item);
            const cart = await cartService.addItem('user-123', { ...item, quantity: 3 });
            expect(cart.items).toHaveLength(1);
            expect(cart.items[0].quantity).toBe(5);
            expect(cart.items[0].subtotal).toBe(250.00);
        });
        it('should reject negative quantity', async () => {
            const item = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: -1,
            };
            await expect(cartService.addItem('user-123', item)).rejects.toThrow('Quantity must be positive');
        });
        it('should reject zero quantity', async () => {
            const item = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 0,
            };
            await expect(cartService.addItem('user-123', item)).rejects.toThrow('Quantity must be positive');
        });
        it('should update cart subtotal', async () => {
            const item1 = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            };
            const item2 = {
                productId: 'prod-2',
                productName: 'Product 2',
                productSku: 'SKU-002',
                unitPrice: 30.00,
                quantity: 3,
            };
            await cartService.addItem('user-123', item1);
            const cart = await cartService.addItem('user-123', item2);
            expect(cart.subtotal).toBe(190.00); // 100 + 90
        });
        it('should update item count', async () => {
            const item = {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 3,
            };
            const cart = await cartService.addItem('user-123', item);
            expect(cart.itemCount).toBe(3);
        });
    });
    describe('updateItemQuantity', () => {
        beforeEach(async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            });
        });
        it('should update item quantity', async () => {
            const cart = await cartService.updateItemQuantity('user-123', 'prod-1', 5);
            expect(cart.items[0].quantity).toBe(5);
            expect(cart.items[0].subtotal).toBe(250.00);
        });
        it('should throw error for non-existent item', async () => {
            await expect(cartService.updateItemQuantity('user-123', 'non-existent', 5)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject negative quantity', async () => {
            await expect(cartService.updateItemQuantity('user-123', 'prod-1', -1)).rejects.toThrow('Quantity must be positive');
        });
        it('should remove item if quantity is zero', async () => {
            const cart = await cartService.updateItemQuantity('user-123', 'prod-1', 0);
            expect(cart.items).toHaveLength(0);
            expect(cart.subtotal).toBe(0);
        });
    });
    describe('removeItem', () => {
        beforeEach(async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            });
        });
        it('should remove item from cart', async () => {
            const cart = await cartService.removeItem('user-123', 'prod-1');
            expect(cart.items).toHaveLength(0);
            expect(cart.subtotal).toBe(0);
            expect(cart.itemCount).toBe(0);
        });
        it('should throw error when removing non-existent item', async () => {
            await expect(cartService.removeItem('user-123', 'non-existent')).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should update subtotal after removal', async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-2',
                productName: 'Product 2',
                productSku: 'SKU-002',
                unitPrice: 30.00,
                quantity: 1,
            });
            const cart = await cartService.removeItem('user-123', 'prod-1');
            expect(cart.subtotal).toBe(30.00);
        });
    });
    describe('clearCart', () => {
        it('should clear all items from cart', async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            });
            const cart = await cartService.clearCart('user-123');
            expect(cart.items).toEqual([]);
            expect(cart.subtotal).toBe(0);
            expect(cart.itemCount).toBe(0);
        });
        it('should work on empty cart', async () => {
            const cart = await cartService.clearCart('user-123');
            expect(cart.items).toEqual([]);
        });
    });
    describe('getCartItemCount', () => {
        it('should return total item count', async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            });
            await cartService.addItem('user-123', {
                productId: 'prod-2',
                productName: 'Product 2',
                productSku: 'SKU-002',
                unitPrice: 30.00,
                quantity: 3,
            });
            const count = await cartService.getCartItemCount('user-123');
            expect(count).toBe(5); // 2 + 3
        });
        it('should return zero for empty cart', async () => {
            const count = await cartService.getCartItemCount('user-123');
            expect(count).toBe(0);
        });
    });
    describe('getCartSubtotal', () => {
        it('should calculate cart subtotal', async () => {
            await cartService.addItem('user-123', {
                productId: 'prod-1',
                productName: 'Product 1',
                productSku: 'SKU-001',
                unitPrice: 50.00,
                quantity: 2,
            });
            await cartService.addItem('user-123', {
                productId: 'prod-2',
                productName: 'Product 2',
                productSku: 'SKU-002',
                unitPrice: 30.00,
                quantity: 3,
            });
            const subtotal = await cartService.getCartSubtotal('user-123');
            expect(subtotal).toBe(190.00);
        });
        it('should return zero for empty cart', async () => {
            const subtotal = await cartService.getCartSubtotal('user-123');
            expect(subtotal).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxjYXJ0LnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFFSCxpREFBNkM7QUFDN0MseUNBQTZDO0FBb0I3QyxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLFdBQXdCLENBQUM7SUFDN0IsSUFBSSxlQUFrQyxDQUFDO0lBRXZDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxlQUFlLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUM1QixXQUFXLEdBQUcsSUFBSSwwQkFBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDdkIsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELE1BQU0sSUFBSSxHQUFHLE1BQU0sV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4QyxNQUFNLFlBQVksR0FBUztnQkFDekIsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLEtBQUssRUFBRSxDQUFDO3dCQUNOLFNBQVMs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QUssSUFBSSxFQUFFO1lBQzlDLE1BQU0sV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixXQUFXLEVBQUUsV0FBVztnQkFDeEIsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLFNBQVMsRUFBRSxLQUFLO2dCQUNoQixRQUFRLEVBQUUsQ0FBQzthQUNaLENBQUMsQ0FBQztZQUVILE1BQU0sV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixXQUFXLEVBQUUsV0FBVztnQkFDeEIsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLFNBQVMsRUFBRSxLQUFLO2dCQUNoQixRQUFRLEVBQUUsQ0FBQzthQUNaLENBQUMsQ0FBQztZQUVILE1BQU0sUUFBUSxHQUFHLE1BQU0sV0FBVyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELE1BQU0sUUFBUSxHQUFHLE1BQU0sV0FBVyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcQWRhcHRpdmVfVGVzdGluZ1xcc3JjXFxzZXJ2aWNlc1xcb3JkZXItcHJvY2Vzc2luZ1xcc2VydmljZXNcXGNhcnQuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVEREOiBTaG9wcGluZyBDYXJ0IFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIGNhcnQgbWFuYWdlbWVudCBmb3IgZS1jb21tZXJjZVxuICovXG5cbmltcG9ydCB7IENhcnRTZXJ2aWNlIH0gZnJvbSAnLi9jYXJ0LnNlcnZpY2UnO1xuaW1wb3J0IHsgTm90Rm91bmRFcnJvciB9IGZyb20gJ0BsaWJzL2Vycm9ycyc7XG5cbmludGVyZmFjZSBDYXJ0SXRlbSB7XG4gIHByb2R1Y3RJZDogc3RyaW5nO1xuICBwcm9kdWN0TmFtZTogc3RyaW5nO1xuICBwcm9kdWN0U2t1OiBzdHJpbmc7XG4gIHVuaXRQcmljZTogbnVtYmVyO1xuICBxdWFudGl0eTogbnVtYmVyO1xuICBzdWJ0b3RhbDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgQ2FydCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBpdGVtczogQ2FydEl0ZW1bXTtcbiAgc3VidG90YWw6IG51bWJlcjtcbiAgaXRlbUNvdW50OiBudW1iZXI7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgdXBkYXRlZEF0OiBEYXRlO1xufVxuXG5kZXNjcmliZSgnQ2FydFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBjYXJ0U2VydmljZTogQ2FydFNlcnZpY2U7XG4gIGxldCBtb2NrQ2FydFN0b3JhZ2U6IE1hcDxzdHJpbmcsIENhcnQ+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tDYXJ0U3RvcmFnZSA9IG5ldyBNYXAoKTtcbiAgICBjYXJ0U2VydmljZSA9IG5ldyBDYXJ0U2VydmljZShtb2NrQ2FydFN0b3JhZ2UpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Q2FydCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBlbXB0eSBjYXJ0IGZvciBuZXcgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS5nZXRDYXJ0KCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QoY2FydC51c2VySWQpLnRvQmUoJ3VzZXItMTIzJyk7XG4gICAgICBleHBlY3QoY2FydC5pdGVtcykudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QoY2FydC5zdWJ0b3RhbCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChjYXJ0Lml0ZW1Db3VudCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IGV4aXN0aW5nIGNhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ0NhcnQ6IENhcnQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDEnLFxuICAgICAgICAgIHVuaXRQcmljZTogNTAuMDAsXG4gICAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICAgICAgc3VidG90YWw6IDEwMC4wMCxcbiAgICAgICAgfV0sXG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgIGl0ZW1Db3VudDogMixcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrQ2FydFN0b3JhZ2Uuc2V0KCd1c2VyLTEyMycsIGV4aXN0aW5nQ2FydCk7XG5cbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS5nZXRDYXJ0KCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QoY2FydCkudG9FcXVhbChleGlzdGluZ0NhcnQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWRkSXRlbScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFkZCBuZXcgaXRlbSB0byBjYXJ0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXRlbSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDEnLFxuICAgICAgICBwcm9kdWN0U2t1OiAnU0tVLTAwMScsXG4gICAgICAgIHVuaXRQcmljZTogNTAuMDAsXG4gICAgICAgIHF1YW50aXR5OiAyLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY2FydCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmFkZEl0ZW0oJ3VzZXItMTIzJywgaXRlbSk7XG5cbiAgICAgIGV4cGVjdChjYXJ0Lml0ZW1zKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoY2FydC5pdGVtc1swXS5wcm9kdWN0SWQpLnRvQmUoJ3Byb2QtMScpO1xuICAgICAgZXhwZWN0KGNhcnQuaXRlbXNbMF0ucXVhbnRpdHkpLnRvQmUoMik7XG4gICAgICBleHBlY3QoY2FydC5pdGVtc1swXS5zdWJ0b3RhbCkudG9CZSgxMDAuMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNyZW1lbnQgcXVhbnRpdHkgaWYgaXRlbSBleGlzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIGl0ZW0pO1xuICAgICAgY29uc3QgY2FydCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmFkZEl0ZW0oJ3VzZXItMTIzJywgeyAuLi5pdGVtLCBxdWFudGl0eTogMyB9KTtcblxuICAgICAgZXhwZWN0KGNhcnQuaXRlbXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChjYXJ0Lml0ZW1zWzBdLnF1YW50aXR5KS50b0JlKDUpO1xuICAgICAgZXhwZWN0KGNhcnQuaXRlbXNbMF0uc3VidG90YWwpLnRvQmUoMjUwLjAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5lZ2F0aXZlIHF1YW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXRlbSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDEnLFxuICAgICAgICBwcm9kdWN0U2t1OiAnU0tVLTAwMScsXG4gICAgICAgIHVuaXRQcmljZTogNTAuMDAsXG4gICAgICAgIHF1YW50aXR5OiAtMSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIGl0ZW0pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdRdWFudGl0eSBtdXN0IGJlIHBvc2l0aXZlJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHplcm8gcXVhbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDAsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoY2FydFNlcnZpY2UuYWRkSXRlbSgndXNlci0xMjMnLCBpdGVtKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnUXVhbnRpdHkgbXVzdCBiZSBwb3NpdGl2ZSdcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBjYXJ0IHN1YnRvdGFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXRlbTEgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHByb2R1Y3ROYW1lOiAnUHJvZHVjdCAxJyxcbiAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDEnLFxuICAgICAgICB1bml0UHJpY2U6IDUwLjAwLFxuICAgICAgICBxdWFudGl0eTogMixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGl0ZW0yID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTInLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMicsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAyJyxcbiAgICAgICAgdW5pdFByaWNlOiAzMC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDMsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIGl0ZW0xKTtcbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIGl0ZW0yKTtcblxuICAgICAgZXhwZWN0KGNhcnQuc3VidG90YWwpLnRvQmUoMTkwLjAwKTsgLy8gMTAwICsgOTBcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGl0ZW0gY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDMsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjYXJ0ID0gYXdhaXQgY2FydFNlcnZpY2UuYWRkSXRlbSgndXNlci0xMjMnLCBpdGVtKTtcblxuICAgICAgZXhwZWN0KGNhcnQuaXRlbUNvdW50KS50b0JlKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlSXRlbVF1YW50aXR5JywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY2FydFNlcnZpY2UuYWRkSXRlbSgndXNlci0xMjMnLCB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHByb2R1Y3ROYW1lOiAnUHJvZHVjdCAxJyxcbiAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDEnLFxuICAgICAgICB1bml0UHJpY2U6IDUwLjAwLFxuICAgICAgICBxdWFudGl0eTogMixcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgaXRlbSBxdWFudGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS51cGRhdGVJdGVtUXVhbnRpdHkoJ3VzZXItMTIzJywgJ3Byb2QtMScsIDUpO1xuXG4gICAgICBleHBlY3QoY2FydC5pdGVtc1swXS5xdWFudGl0eSkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChjYXJ0Lml0ZW1zWzBdLnN1YnRvdGFsKS50b0JlKDI1MC4wMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBub24tZXhpc3RlbnQgaXRlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY2FydFNlcnZpY2UudXBkYXRlSXRlbVF1YW50aXR5KCd1c2VyLTEyMycsICdub24tZXhpc3RlbnQnLCA1KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBuZWdhdGl2ZSBxdWFudGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY2FydFNlcnZpY2UudXBkYXRlSXRlbVF1YW50aXR5KCd1c2VyLTEyMycsICdwcm9kLTEnLCAtMSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdRdWFudGl0eSBtdXN0IGJlIHBvc2l0aXZlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBpdGVtIGlmIHF1YW50aXR5IGlzIHplcm8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYXJ0ID0gYXdhaXQgY2FydFNlcnZpY2UudXBkYXRlSXRlbVF1YW50aXR5KCd1c2VyLTEyMycsICdwcm9kLTEnLCAwKTtcblxuICAgICAgZXhwZWN0KGNhcnQuaXRlbXMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChjYXJ0LnN1YnRvdGFsKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlSXRlbScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGNhcnRTZXJ2aWNlLmFkZEl0ZW0oJ3VzZXItMTIzJywge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGl0ZW0gZnJvbSBjYXJ0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FydCA9IGF3YWl0IGNhcnRTZXJ2aWNlLnJlbW92ZUl0ZW0oJ3VzZXItMTIzJywgJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QoY2FydC5pdGVtcykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KGNhcnQuc3VidG90YWwpLnRvQmUoMCk7XG4gICAgICBleHBlY3QoY2FydC5pdGVtQ291bnQpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gcmVtb3Zpbmcgbm9uLWV4aXN0ZW50IGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNhcnRTZXJ2aWNlLnJlbW92ZUl0ZW0oJ3VzZXItMTIzJywgJ25vbi1leGlzdGVudCcpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHN1YnRvdGFsIGFmdGVyIHJlbW92YWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0yJyxcbiAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDInLFxuICAgICAgICBwcm9kdWN0U2t1OiAnU0tVLTAwMicsXG4gICAgICAgIHVuaXRQcmljZTogMzAuMDAsXG4gICAgICAgIHF1YW50aXR5OiAxLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS5yZW1vdmVJdGVtKCd1c2VyLTEyMycsICdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KGNhcnQuc3VidG90YWwpLnRvQmUoMzAuMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYXJDYXJ0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2xlYXIgYWxsIGl0ZW1zIGZyb20gY2FydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGNhcnRTZXJ2aWNlLmFkZEl0ZW0oJ3VzZXItMTIzJywge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2FydCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmNsZWFyQ2FydCgndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KGNhcnQuaXRlbXMpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KGNhcnQuc3VidG90YWwpLnRvQmUoMCk7XG4gICAgICBleHBlY3QoY2FydC5pdGVtQ291bnQpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHdvcmsgb24gZW1wdHkgY2FydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBjYXJ0U2VydmljZS5jbGVhckNhcnQoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChjYXJ0Lml0ZW1zKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENhcnRJdGVtQ291bnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdG90YWwgaXRlbSBjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGNhcnRTZXJ2aWNlLmFkZEl0ZW0oJ3VzZXItMTIzJywge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBwcm9kdWN0TmFtZTogJ1Byb2R1Y3QgMScsXG4gICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgdW5pdFByaWNlOiA1MC4wMCxcbiAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgY2FydFNlcnZpY2UuYWRkSXRlbSgndXNlci0xMjMnLCB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMicsXG4gICAgICAgIHByb2R1Y3ROYW1lOiAnUHJvZHVjdCAyJyxcbiAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDInLFxuICAgICAgICB1bml0UHJpY2U6IDMwLjAwLFxuICAgICAgICBxdWFudGl0eTogMyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb3VudCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmdldENhcnRJdGVtQ291bnQoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChjb3VudCkudG9CZSg1KTsgLy8gMiArIDNcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHplcm8gZm9yIGVtcHR5IGNhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb3VudCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmdldENhcnRJdGVtQ291bnQoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChjb3VudCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENhcnRTdWJ0b3RhbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjYXJ0IHN1YnRvdGFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY2FydFNlcnZpY2UuYWRkSXRlbSgndXNlci0xMjMnLCB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHByb2R1Y3ROYW1lOiAnUHJvZHVjdCAxJyxcbiAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDEnLFxuICAgICAgICB1bml0UHJpY2U6IDUwLjAwLFxuICAgICAgICBxdWFudGl0eTogMixcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBjYXJ0U2VydmljZS5hZGRJdGVtKCd1c2VyLTEyMycsIHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0yJyxcbiAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDInLFxuICAgICAgICBwcm9kdWN0U2t1OiAnU0tVLTAwMicsXG4gICAgICAgIHVuaXRQcmljZTogMzAuMDAsXG4gICAgICAgIHF1YW50aXR5OiAzLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHN1YnRvdGFsID0gYXdhaXQgY2FydFNlcnZpY2UuZ2V0Q2FydFN1YnRvdGFsKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3Qoc3VidG90YWwpLnRvQmUoMTkwLjAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHplcm8gZm9yIGVtcHR5IGNhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdWJ0b3RhbCA9IGF3YWl0IGNhcnRTZXJ2aWNlLmdldENhcnRTdWJ0b3RhbCgndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHN1YnRvdGFsKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9