{"file":"C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\cart.service.spec.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\cart.service.spec.ts"],"sourcesContent":["/**\n * TDD: Shopping Cart Service Tests\n *\n * Testing cart management for e-commerce\n */\n\nimport { CartService } from './cart.service';\nimport { NotFoundError } from '@libs/errors';\n\ninterface CartItem {\n  productId: string;\n  productName: string;\n  productSku: string;\n  unitPrice: number;\n  quantity: number;\n  subtotal: number;\n}\n\ninterface Cart {\n  userId: string;\n  items: CartItem[];\n  subtotal: number;\n  itemCount: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\ndescribe('CartService', () => {\n  let cartService: CartService;\n  let mockCartStorage: Map<string, Cart>;\n\n  beforeEach(() => {\n    mockCartStorage = new Map();\n    cartService = new CartService(mockCartStorage);\n  });\n\n  describe('getCart', () => {\n    it('should get empty cart for new user', async () => {\n      const cart = await cartService.getCart('user-123');\n\n      expect(cart.userId).toBe('user-123');\n      expect(cart.items).toEqual([]);\n      expect(cart.subtotal).toBe(0);\n      expect(cart.itemCount).toBe(0);\n    });\n\n    it('should get existing cart', async () => {\n      const existingCart: Cart = {\n        userId: 'user-123',\n        items: [{\n          productId: 'prod-1',\n          productName: 'Product 1',\n          productSku: 'SKU-001',\n          unitPrice: 50.00,\n          quantity: 2,\n          subtotal: 100.00,\n        }],\n        subtotal: 100.00,\n        itemCount: 2,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      mockCartStorage.set('user-123', existingCart);\n\n      const cart = await cartService.getCart('user-123');\n\n      expect(cart).toEqual(existingCart);\n    });\n  });\n\n  describe('addItem', () => {\n    it('should add new item to cart', async () => {\n      const item = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      };\n\n      const cart = await cartService.addItem('user-123', item);\n\n      expect(cart.items).toHaveLength(1);\n      expect(cart.items[0].productId).toBe('prod-1');\n      expect(cart.items[0].quantity).toBe(2);\n      expect(cart.items[0].subtotal).toBe(100.00);\n    });\n\n    it('should increment quantity if item exists', async () => {\n      const item = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      };\n\n      await cartService.addItem('user-123', item);\n      const cart = await cartService.addItem('user-123', { ...item, quantity: 3 });\n\n      expect(cart.items).toHaveLength(1);\n      expect(cart.items[0].quantity).toBe(5);\n      expect(cart.items[0].subtotal).toBe(250.00);\n    });\n\n    it('should reject negative quantity', async () => {\n      const item = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: -1,\n      };\n\n      await expect(cartService.addItem('user-123', item)).rejects.toThrow(\n        'Quantity must be positive'\n      );\n    });\n\n    it('should reject zero quantity', async () => {\n      const item = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 0,\n      };\n\n      await expect(cartService.addItem('user-123', item)).rejects.toThrow(\n        'Quantity must be positive'\n      );\n    });\n\n    it('should update cart subtotal', async () => {\n      const item1 = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      };\n\n      const item2 = {\n        productId: 'prod-2',\n        productName: 'Product 2',\n        productSku: 'SKU-002',\n        unitPrice: 30.00,\n        quantity: 3,\n      };\n\n      await cartService.addItem('user-123', item1);\n      const cart = await cartService.addItem('user-123', item2);\n\n      expect(cart.subtotal).toBe(190.00); // 100 + 90\n    });\n\n    it('should update item count', async () => {\n      const item = {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 3,\n      };\n\n      const cart = await cartService.addItem('user-123', item);\n\n      expect(cart.itemCount).toBe(3);\n    });\n  });\n\n  describe('updateItemQuantity', () => {\n    beforeEach(async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      });\n    });\n\n    it('should update item quantity', async () => {\n      const cart = await cartService.updateItemQuantity('user-123', 'prod-1', 5);\n\n      expect(cart.items[0].quantity).toBe(5);\n      expect(cart.items[0].subtotal).toBe(250.00);\n    });\n\n    it('should throw error for non-existent item', async () => {\n      await expect(\n        cartService.updateItemQuantity('user-123', 'non-existent', 5)\n      ).rejects.toThrow(NotFoundError);\n    });\n\n    it('should reject negative quantity', async () => {\n      await expect(\n        cartService.updateItemQuantity('user-123', 'prod-1', -1)\n      ).rejects.toThrow('Quantity must be positive');\n    });\n\n    it('should remove item if quantity is zero', async () => {\n      const cart = await cartService.updateItemQuantity('user-123', 'prod-1', 0);\n\n      expect(cart.items).toHaveLength(0);\n      expect(cart.subtotal).toBe(0);\n    });\n  });\n\n  describe('removeItem', () => {\n    beforeEach(async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      });\n    });\n\n    it('should remove item from cart', async () => {\n      const cart = await cartService.removeItem('user-123', 'prod-1');\n\n      expect(cart.items).toHaveLength(0);\n      expect(cart.subtotal).toBe(0);\n      expect(cart.itemCount).toBe(0);\n    });\n\n    it('should throw error when removing non-existent item', async () => {\n      await expect(\n        cartService.removeItem('user-123', 'non-existent')\n      ).rejects.toThrow(NotFoundError);\n    });\n\n    it('should update subtotal after removal', async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-2',\n        productName: 'Product 2',\n        productSku: 'SKU-002',\n        unitPrice: 30.00,\n        quantity: 1,\n      });\n\n      const cart = await cartService.removeItem('user-123', 'prod-1');\n\n      expect(cart.subtotal).toBe(30.00);\n    });\n  });\n\n  describe('clearCart', () => {\n    it('should clear all items from cart', async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      });\n\n      const cart = await cartService.clearCart('user-123');\n\n      expect(cart.items).toEqual([]);\n      expect(cart.subtotal).toBe(0);\n      expect(cart.itemCount).toBe(0);\n    });\n\n    it('should work on empty cart', async () => {\n      const cart = await cartService.clearCart('user-123');\n\n      expect(cart.items).toEqual([]);\n    });\n  });\n\n  describe('getCartItemCount', () => {\n    it('should return total item count', async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      });\n\n      await cartService.addItem('user-123', {\n        productId: 'prod-2',\n        productName: 'Product 2',\n        productSku: 'SKU-002',\n        unitPrice: 30.00,\n        quantity: 3,\n      });\n\n      const count = await cartService.getCartItemCount('user-123');\n\n      expect(count).toBe(5); // 2 + 3\n    });\n\n    it('should return zero for empty cart', async () => {\n      const count = await cartService.getCartItemCount('user-123');\n\n      expect(count).toBe(0);\n    });\n  });\n\n  describe('getCartSubtotal', () => {\n    it('should calculate cart subtotal', async () => {\n      await cartService.addItem('user-123', {\n        productId: 'prod-1',\n        productName: 'Product 1',\n        productSku: 'SKU-001',\n        unitPrice: 50.00,\n        quantity: 2,\n      });\n\n      await cartService.addItem('user-123', {\n        productId: 'prod-2',\n        productName: 'Product 2',\n        productSku: 'SKU-002',\n        unitPrice: 30.00,\n        quantity: 3,\n      });\n\n      const subtotal = await cartService.getCartSubtotal('user-123');\n\n      expect(subtotal).toBe(190.00);\n    });\n\n    it('should return zero for empty cart', async () => {\n      const subtotal = await cartService.getCartSubtotal('user-123');\n\n      expect(subtotal).toBe(0);\n    });\n  });\n});\n"],"version":3}