5414280c129dceb09a52fa9f6243ace7
"use strict";
/**
 * Unit Tests: Validation Utilities
 *
 * Testing Zod-based validation helpers
 */
Object.defineProperty(exports, "__esModule", { value: true });
const zod_1 = require("zod");
const validator_1 = require("./validator");
const errors_1 = require("../errors");
describe('Validation Utilities', () => {
    describe('commonSchemas', () => {
        describe('email', () => {
            it('should validate correct email', () => {
                const result = validator_1.commonSchemas.email.safeParse('test@example.com');
                expect(result.success).toBe(true);
            });
            it('should reject invalid email', () => {
                const result = validator_1.commonSchemas.email.safeParse('invalid-email');
                expect(result.success).toBe(false);
            });
            it('should reject email without domain', () => {
                const result = validator_1.commonSchemas.email.safeParse('test@');
                expect(result.success).toBe(false);
            });
            it('should reject email without @', () => {
                const result = validator_1.commonSchemas.email.safeParse('testexample.com');
                expect(result.success).toBe(false);
            });
        });
        describe('uuid', () => {
            it('should validate correct UUID', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('123e4567-e89b-12d3-a456-426614174000');
                expect(result.success).toBe(true);
            });
            it('should reject invalid UUID', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('not-a-uuid');
                expect(result.success).toBe(false);
            });
            it('should reject UUID with wrong format', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('123-456-789');
                expect(result.success).toBe(false);
            });
        });
        describe('password', () => {
            it('should validate strong password', () => {
                const result = validator_1.commonSchemas.password.safeParse('StrongPass123!');
                expect(result.success).toBe(true);
            });
            it('should reject short password', () => {
                const result = validator_1.commonSchemas.password.safeParse('Short1!');
                expect(result.success).toBe(false);
            });
            it('should reject password without uppercase', () => {
                const result = validator_1.commonSchemas.password.safeParse('lowercase123!');
                expect(result.success).toBe(false);
            });
            it('should reject password without lowercase', () => {
                const result = validator_1.commonSchemas.password.safeParse('UPPERCASE123!');
                expect(result.success).toBe(false);
            });
            it('should reject password without number', () => {
                const result = validator_1.commonSchemas.password.safeParse('NoNumbers!');
                expect(result.success).toBe(false);
            });
            it('should reject password without special character', () => {
                const result = validator_1.commonSchemas.password.safeParse('NoSpecial123');
                expect(result.success).toBe(false);
            });
        });
        describe('pagination', () => {
            it('should parse valid pagination params', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '2', limit: '10' });
                expect(result.success).toBe(true);
                if (result.success) {
                    expect(result.data.page).toBe(2);
                    expect(result.data.limit).toBe(10);
                }
            });
            it('should use default values', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({});
                expect(result.success).toBe(true);
                if (result.success) {
                    expect(result.data.page).toBe(1);
                    expect(result.data.limit).toBe(20);
                }
            });
            it('should reject negative page', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '-1' });
                expect(result.success).toBe(false);
            });
            it('should reject zero page', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '0' });
                expect(result.success).toBe(false);
            });
            it('should reject limit over 100', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ limit: '101' });
                expect(result.success).toBe(false);
            });
        });
        describe('dateRange', () => {
            it('should parse valid date range', () => {
                const result = validator_1.commonSchemas.dateRange.safeParse({
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                });
                expect(result.success).toBe(true);
            });
            it('should reject invalid date format', () => {
                const result = validator_1.commonSchemas.dateRange.safeParse({
                    startDate: 'invalid-date',
                    endDate: '2024-12-31',
                });
                expect(result.success).toBe(false);
            });
        });
        describe('search', () => {
            it('should validate search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: 'search term' });
                expect(result.success).toBe(true);
            });
            it('should reject empty search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: '' });
                expect(result.success).toBe(false);
            });
            it('should reject too long search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: 'a'.repeat(101) });
                expect(result.success).toBe(false);
            });
        });
    });
    describe('validate middleware', () => {
        const testSchema = zod_1.z.object({
            name: zod_1.z.string().min(1),
            age: zod_1.z.number().positive(),
        });
        it('should validate request body and call next', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: 'John', age: 25 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
            expect(req.body).toEqual({ name: 'John', age: 25 });
        });
        it('should validate query params', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'query');
            const req = { query: { name: 'John', age: '25' } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
        });
        it('should validate route params', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'params');
            const req = { params: { name: 'John', age: '25' } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
        });
        it('should call next with ValidationError for invalid data', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: '', age: -1 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith(expect.any(errors_1.ValidationError));
        });
        it('should include error details in ValidationError', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: '', age: -1 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            const error = next.mock.calls[0][0];
            expect(error.errors).toBeDefined();
            expect(Object.keys(error.errors).length).toBeGreaterThan(0);
        });
    });
    describe('validateData', () => {
        const testSchema = zod_1.z.object({
            email: zod_1.z.string().email(),
            count: zod_1.z.number().int(),
        });
        it('should validate and return data', () => {
            const data = { email: 'test@example.com', count: 5 };
            const result = (0, validator_1.validateData)(testSchema, data);
            expect(result).toEqual(data);
        });
        it('should throw ValidationError for invalid data', () => {
            const data = { email: 'invalid', count: 'not-a-number' };
            expect(() => (0, validator_1.validateData)(testSchema, data)).toThrow(errors_1.ValidationError);
        });
        it('should include field errors', () => {
            const data = { email: 'invalid', count: 'not-a-number' };
            try {
                (0, validator_1.validateData)(testSchema, data);
            }
            catch (error) {
                expect(error).toBeInstanceOf(errors_1.ValidationError);
                const validationError = error;
                expect(validationError.errors).toBeDefined();
            }
        });
    });
    describe('safeParse', () => {
        const testSchema = zod_1.z.object({
            value: zod_1.z.string(),
        });
        it('should return success result for valid data', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 'test' });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.value).toBe('test');
            }
        });
        it('should return error result for invalid data', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 123 });
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.errors).toBeDefined();
            }
        });
        it('should include error details in failure result', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 123 });
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(Object.keys(result.errors).length).toBeGreaterThan(0);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcbGlic1xcdmFsaWRhdGlvblxcdmFsaWRhdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsNkJBQXdCO0FBQ3hCLDJDQUErRTtBQUUvRSxzQ0FBNEM7QUFFNUMsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtZQUNyQixFQUFFLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO2dCQUN2QyxNQUFNLE1BQU0sR0FBRyx5QkFBYSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDakUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO2dCQUNyQyxNQUFNLE1BQU0sR0FBRyx5QkFBYSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQzlELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtnQkFDNUMsTUFBTSxNQUFNLEdBQUcseUJBQWEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN0RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyQyxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7Z0JBQ3ZDLE1BQU0sTUFBTSxHQUFHLHlCQUFhLENBQUMs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QUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUNwQixNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3RDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDeEQsTUFBTSxNQUFNLEdBQUcsSUFBQSxxQkFBUyxFQUFDLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBRXJELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcQWRhcHRpdmVfVGVzdGluZ1xcc3JjXFxsaWJzXFx2YWxpZGF0aW9uXFx2YWxpZGF0b3Iuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgVGVzdHM6IFZhbGlkYXRpb24gVXRpbGl0aWVzXG4gKlxuICogVGVzdGluZyBab2QtYmFzZWQgdmFsaWRhdGlvbiBoZWxwZXJzXG4gKi9cblxuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyB2YWxpZGF0ZSwgdmFsaWRhdGVEYXRhLCBzYWZlUGFyc2UsIGNvbW1vblNjaGVtYXMgfSBmcm9tICcuL3ZhbGlkYXRvcic7XG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICcuLi9lcnJvcnMnO1xuXG5kZXNjcmliZSgnVmFsaWRhdGlvbiBVdGlsaXRpZXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdjb21tb25TY2hlbWFzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdlbWFpbCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBlbWFpbCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5lbWFpbC5zYWZlUGFyc2UoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgZW1haWwnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuZW1haWwuc2FmZVBhcnNlKCdpbnZhbGlkLWVtYWlsJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgZW1haWwgd2l0aG91dCBkb21haW4nLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuZW1haWwuc2FmZVBhcnNlKCd0ZXN0QCcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGVtYWlsIHdpdGhvdXQgQCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5lbWFpbC5zYWZlUGFyc2UoJ3Rlc3RleGFtcGxlLmNvbScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndXVpZCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBVVUlEJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnV1aWQuc2FmZVBhcnNlKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgVVVJRCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy51dWlkLnNhZmVQYXJzZSgnbm90LWEtdXVpZCcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IFVVSUQgd2l0aCB3cm9uZyBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMudXVpZC5zYWZlUGFyc2UoJzEyMy00NTYtNzg5Jyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdwYXNzd29yZCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgc3Ryb25nIHBhc3N3b3JkJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhc3N3b3JkLnNhZmVQYXJzZSgnU3Ryb25nUGFzczEyMyEnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHNob3J0IHBhc3N3b3JkJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhc3N3b3JkLnNhZmVQYXJzZSgnU2hvcnQxIScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkIHdpdGhvdXQgdXBwZXJjYXNlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhc3N3b3JkLnNhZmVQYXJzZSgnbG93ZXJjYXNlMTIzIScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkIHdpdGhvdXQgbG93ZXJjYXNlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhc3N3b3JkLnNhZmVQYXJzZSgnVVBQRVJDQVNFMTIzIScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkIHdpdGhvdXQgbnVtYmVyJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhc3N3b3JkLnNhZmVQYXJzZSgnTm9OdW1iZXJzIScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkIHdpdGhvdXQgc3BlY2lhbCBjaGFyYWN0ZXInLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdOb1NwZWNpYWwxMjMnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3BhZ2luYXRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHBhcnNlIHZhbGlkIHBhZ2luYXRpb24gcGFyYW1zJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhZ2luYXRpb24uc2FmZVBhcnNlKHsgcGFnZTogJzInLCBsaW1pdDogJzEwJyB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEucGFnZSkudG9CZSgyKTtcbiAgICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEubGltaXQpLnRvQmUoMTApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFnaW5hdGlvbi5zYWZlUGFyc2Uoe30pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5wYWdlKS50b0JlKDEpO1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5saW1pdCkudG9CZSgyMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBuZWdhdGl2ZSBwYWdlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnBhZ2luYXRpb24uc2FmZVBhcnNlKHsgcGFnZTogJy0xJyB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCB6ZXJvIHBhZ2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFnaW5hdGlvbi5zYWZlUGFyc2UoeyBwYWdlOiAnMCcgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgbGltaXQgb3ZlciAxMDAnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFnaW5hdGlvbi5zYWZlUGFyc2UoeyBsaW1pdDogJzEwMScgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdkYXRlUmFuZ2UnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHBhcnNlIHZhbGlkIGRhdGUgcmFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuZGF0ZVJhbmdlLnNhZmVQYXJzZSh7XG4gICAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgICAgZW5kRGF0ZTogJzIwMjQtMTItMzEnLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgZGF0ZSBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuZGF0ZVJhbmdlLnNhZmVQYXJzZSh7XG4gICAgICAgICAgc3RhcnREYXRlOiAnaW52YWxpZC1kYXRlJyxcbiAgICAgICAgICBlbmREYXRlOiAnMjAyNC0xMi0zMScsXG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnc2VhcmNoJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBzZWFyY2ggcXVlcnknLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuc2VhcmNoLnNhZmVQYXJzZSh7IHE6ICdzZWFyY2ggdGVybScgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBlbXB0eSBzZWFyY2ggcXVlcnknLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMuc2VhcmNoLnNhZmVQYXJzZSh7IHE6ICcnIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHRvbyBsb25nIHNlYXJjaCBxdWVyeScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5zZWFyY2guc2FmZVBhcnNlKHsgcTogJ2EnLnJlcGVhdCgxMDEpIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZSBtaWRkbGV3YXJlJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgIGFnZTogei5udW1iZXIoKS5wb3NpdGl2ZSgpLFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1ZXN0IGJvZHkgYW5kIGNhbGwgbmV4dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZSh0ZXN0U2NoZW1hLCAnYm9keScpO1xuICAgICAgY29uc3QgcmVxID0geyBib2R5OiB7IG5hbWU6ICdKb2huJywgYWdlOiAyNSB9IH0gYXMgUmVxdWVzdDtcbiAgICAgIGNvbnN0IHJlcyA9IHt9IGFzIFJlc3BvbnNlO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKSBhcyBOZXh0RnVuY3Rpb247XG5cbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcbiAgICAgIGV4cGVjdChyZXEuYm9keSkudG9FcXVhbCh7IG5hbWU6ICdKb2huJywgYWdlOiAyNSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcXVlcnkgcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHRlc3RTY2hlbWEsICdxdWVyeScpO1xuICAgICAgY29uc3QgcmVxID0geyBxdWVyeTogeyBuYW1lOiAnSm9obicsIGFnZTogJzI1JyB9IH0gYXMgdW5rbm93biBhcyBSZXF1ZXN0O1xuICAgICAgY29uc3QgcmVzID0ge30gYXMgUmVzcG9uc2U7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpIGFzIE5leHRGdW5jdGlvbjtcblxuICAgICAgbWlkZGxld2FyZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByb3V0ZSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUodGVzdFNjaGVtYSwgJ3BhcmFtcycpO1xuICAgICAgY29uc3QgcmVxID0geyBwYXJhbXM6IHsgbmFtZTogJ0pvaG4nLCBhZ2U6ICcyNScgfSB9IGFzIHVua25vd24gYXMgUmVxdWVzdDtcbiAgICAgIGNvbnN0IHJlcyA9IHt9IGFzIFJlc3BvbnNlO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKSBhcyBOZXh0RnVuY3Rpb247XG5cbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsbCBuZXh0IHdpdGggVmFsaWRhdGlvbkVycm9yIGZvciBpbnZhbGlkIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUodGVzdFNjaGVtYSwgJ2JvZHknKTtcbiAgICAgIGNvbnN0IHJlcSA9IHsgYm9keTogeyBuYW1lOiAnJywgYWdlOiAtMSB9IH0gYXMgUmVxdWVzdDtcbiAgICAgIGNvbnN0IHJlcyA9IHt9IGFzIFJlc3BvbnNlO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKSBhcyBOZXh0RnVuY3Rpb247XG5cbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShWYWxpZGF0aW9uRXJyb3IpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBlcnJvciBkZXRhaWxzIGluIFZhbGlkYXRpb25FcnJvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZSh0ZXN0U2NoZW1hLCAnYm9keScpO1xuICAgICAgY29uc3QgcmVxID0geyBib2R5OiB7IG5hbWU6ICcnLCBhZ2U6IC0xIH0gfSBhcyBSZXF1ZXN0O1xuICAgICAgY29uc3QgcmVzID0ge30gYXMgUmVzcG9uc2U7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuXG4gICAgICBtaWRkbGV3YXJlKHJlcSwgcmVzLCBuZXh0IGFzIE5leHRGdW5jdGlvbik7XG5cbiAgICAgIGNvbnN0IGVycm9yID0gKG5leHQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdIGFzIFZhbGlkYXRpb25FcnJvcjtcbiAgICAgIGV4cGVjdChlcnJvci5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoT2JqZWN0LmtleXMoZXJyb3IuZXJyb3JzKS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlRGF0YScsICgpID0+IHtcbiAgICBjb25zdCB0ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoKSxcbiAgICAgIGNvdW50OiB6Lm51bWJlcigpLmludCgpLFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgcmV0dXJuIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0geyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLCBjb3VudDogNSB9O1xuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVEYXRhKHRlc3RTY2hlbWEsIGRhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGRhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBWYWxpZGF0aW9uRXJyb3IgZm9yIGludmFsaWQgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSB7IGVtYWlsOiAnaW52YWxpZCcsIGNvdW50OiAnbm90LWEtbnVtYmVyJyB9O1xuXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVEYXRhKHRlc3RTY2hlbWEsIGRhdGEpKS50b1Rocm93KFZhbGlkYXRpb25FcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgZmllbGQgZXJyb3JzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHsgZW1haWw6ICdpbnZhbGlkJywgY291bnQ6ICdub3QtYS1udW1iZXInIH07XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhbGlkYXRlRGF0YSh0ZXN0U2NoZW1hLCBkYXRhKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoVmFsaWRhdGlvbkVycm9yKTtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbkVycm9yID0gZXJyb3IgYXMgVmFsaWRhdGlvbkVycm9yO1xuICAgICAgICBleHBlY3QodmFsaWRhdGlvbkVycm9yLmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NhZmVQYXJzZScsICgpID0+IHtcbiAgICBjb25zdCB0ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgdmFsdWU6IHouc3RyaW5nKCksXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdWNjZXNzIHJlc3VsdCBmb3IgdmFsaWQgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNhZmVQYXJzZSh0ZXN0U2NoZW1hLCB7IHZhbHVlOiAndGVzdCcgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEudmFsdWUpLnRvQmUoJ3Rlc3QnKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9yIHJlc3VsdCBmb3IgaW52YWxpZCBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FmZVBhcnNlKHRlc3RTY2hlbWEsIHsgdmFsdWU6IDEyMyB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgZXJyb3IgZGV0YWlscyBpbiBmYWlsdXJlIHJlc3VsdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNhZmVQYXJzZSh0ZXN0U2NoZW1hLCB7IHZhbHVlOiAxMjMgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChPYmplY3Qua2V5cyhyZXN1bHQuZXJyb3JzKS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==