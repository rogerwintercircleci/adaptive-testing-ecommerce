1f9293344106fb8205a50dcf568ba9c1
"use strict";
/**
 * TDD: Order Service Tests
 *
 * Testing order processing business logic
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../repositories/order.repository');
const order_service_1 = require("./order.service");
const order_entity_1 = require("../entities/order.entity");
const errors_1 = require("@libs/errors");
describe('OrderService', () => {
    let orderService;
    let mockOrderRepository;
    beforeEach(() => {
        mockOrderRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByOrderNumber: jest.fn(),
            findByUserId: jest.fn(),
            updateStatus: jest.fn(),
            updatePaymentStatus: jest.fn(),
            cancelOrder: jest.fn(),
            markAsShipped: jest.fn(),
            markAsDelivered: jest.fn(),
            getTotalRevenue: jest.fn(),
            getOrderStats: jest.fn(),
        };
        orderService = new order_service_1.OrderService(mockOrderRepository);
    });
    describe('createOrder', () => {
        const validOrderData = {
            userId: 'user-123',
            items: [
                {
                    productId: 'prod-1',
                    productName: 'Product 1',
                    productSku: 'SKU-001',
                    unitPrice: 50.00,
                    quantity: 2,
                    subtotal: 100.00,
                },
            ],
            shippingAddress: {
                street: '123 Main St',
                city: 'New York',
                state: 'NY',
                postalCode: '10001',
                country: 'USA',
            },
        };
        it('should create order successfully', async () => {
            const mockOrder = {
                id: 'order-123',
                orderNumber: 'ORD-2024-001',
                ...validOrderData,
                subtotal: 100.00,
                total: 110.00,
                status: order_entity_1.OrderStatus.PENDING,
            };
            mockOrderRepository.create.mockResolvedValue(mockOrder);
            const result = await orderService.createOrder(validOrderData);
            expect(result).toEqual(mockOrder);
            expect(result.orderNumber).toMatch(/^ORD-\d{4}-\d+$/);
        });
        it('should reject order with empty items', async () => {
            const invalidData = {
                ...validOrderData,
                items: [],
            };
            await expect(orderService.createOrder(invalidData)).rejects.toThrow('Order must contain at least one item');
        });
        it('should reject order with negative quantity', async () => {
            const invalidData = {
                ...validOrderData,
                items: [{
                        ...validOrderData.items[0],
                        quantity: -1,
                    }],
            };
            await expect(orderService.createOrder(invalidData)).rejects.toThrow('Item quantity must be positive');
        });
        it('should calculate subtotal correctly', async () => {
            const orderData = {
                ...validOrderData,
                items: [
                    {
                        productId: 'prod-1',
                        productName: 'Product 1',
                        productSku: 'SKU-001',
                        unitPrice: 50.00,
                        quantity: 2,
                        subtotal: 100.00,
                    },
                    {
                        productId: 'prod-2',
                        productName: 'Product 2',
                        productSku: 'SKU-002',
                        unitPrice: 30.00,
                        quantity: 3,
                        subtotal: 90.00,
                    },
                ],
            };
            mockOrderRepository.create.mockResolvedValue({
                subtotal: 190.00,
            });
            await orderService.createOrder(orderData);
            expect(mockOrderRepository.create).toHaveBeenCalledWith(expect.objectContaining({
                subtotal: 190.00,
            }));
        });
        it('should calculate tax at 10%', async () => {
            mockOrderRepository.create.mockResolvedValue({
                subtotal: 100.00,
                taxAmount: 10.00,
            });
            await orderService.createOrder(validOrderData);
            expect(mockOrderRepository.create).toHaveBeenCalledWith(expect.objectContaining({
                taxAmount: 10.00,
            }));
        });
        it('should add default shipping cost', async () => {
            mockOrderRepository.create.mockResolvedValue({
                shippingCost: 10.00,
            });
            await orderService.createOrder(validOrderData);
            expect(mockOrderRepository.create).toHaveBeenCalledWith(expect.objectContaining({
                shippingCost: 10.00,
            }));
        });
    });
    describe('getOrderById', () => {
        it('should return order by ID', async () => {
            const mockOrder = { id: 'order-123' };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await orderService.getOrderById('order-123');
            expect(result).toEqual(mockOrder);
        });
        it('should throw NotFoundError for non-existent order', async () => {
            mockOrderRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Order not found'));
            await expect(orderService.getOrderById('invalid')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    describe('getUserOrders', () => {
        it('should return all orders for user', async () => {
            const mockOrders = [
                { id: '1', userId: 'user-123' },
                { id: '2', userId: 'user-123' },
            ];
            mockOrderRepository.findByUserId.mockResolvedValue(mockOrders);
            const result = await orderService.getUserOrders('user-123');
            expect(result).toEqual(mockOrders);
        });
        it('should return empty array for user with no orders', async () => {
            mockOrderRepository.findByUserId.mockResolvedValue([]);
            const result = await orderService.getUserOrders('user-456');
            expect(result).toEqual([]);
        });
    });
    describe('confirmOrder', () => {
        it('should confirm pending order', async () => {
            const mockOrder = {
                id: 'order-123',
                status: order_entity_1.OrderStatus.CONFIRMED,
            };
            mockOrderRepository.updateStatus.mockResolvedValue(mockOrder);
            const result = await orderService.confirmOrder('order-123');
            expect(result.status).toBe(order_entity_1.OrderStatus.CONFIRMED);
            expect(mockOrderRepository.updateStatus).toHaveBeenCalledWith('order-123', order_entity_1.OrderStatus.CONFIRMED);
        });
    });
    describe('processPayment', () => {
        it('should mark payment as successful', async () => {
            const mockOrder = {
                id: 'order-123',
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                paidAt: expect.any(Date),
            };
            mockOrderRepository.updatePaymentStatus.mockResolvedValue(mockOrder);
            const result = await orderService.processPayment('order-123', 'payment-ref-123');
            expect(result.paymentStatus).toBe(order_entity_1.PaymentStatus.PAID);
        });
        it('should handle payment failure', async () => {
            const mockOrder = {
                id: 'order-123',
                paymentStatus: order_entity_1.PaymentStatus.FAILED,
            };
            mockOrderRepository.updatePaymentStatus.mockResolvedValue(mockOrder);
            const result = await orderService.processPayment('order-123', null);
            expect(result.paymentStatus).toBe(order_entity_1.PaymentStatus.FAILED);
        });
    });
    describe('shipOrder', () => {
        it('should ship confirmed paid order', async () => {
            const mockOrder = {
                id: 'order-123',
                status: order_entity_1.OrderStatus.SHIPPED,
                trackingNumber: 'TRACK-123',
            };
            mockOrderRepository.markAsShipped.mockResolvedValue(mockOrder);
            const result = await orderService.shipOrder('order-123', 'TRACK-123');
            expect(result.status).toBe(order_entity_1.OrderStatus.SHIPPED);
            expect(result.trackingNumber).toBe('TRACK-123');
        });
    });
    describe('deliverOrder', () => {
        it('should mark order as delivered', async () => {
            const mockOrder = {
                id: 'order-123',
                status: order_entity_1.OrderStatus.DELIVERED,
                deliveredAt: expect.any(Date),
            };
            mockOrderRepository.markAsDelivered.mockResolvedValue(mockOrder);
            const result = await orderService.deliverOrder('order-123');
            expect(result.status).toBe(order_entity_1.OrderStatus.DELIVERED);
            expect(result.deliveredAt).toBeDefined();
        });
    });
    describe('cancelOrder', () => {
        it('should cancel pending order', async () => {
            const mockOrder = {
                id: 'order-123',
                status: order_entity_1.OrderStatus.PENDING,
                canBeCancelled: () => true,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            mockOrderRepository.cancelOrder.mockResolvedValue({
                ...mockOrder,
                status: order_entity_1.OrderStatus.CANCELLED,
                canBeCancelled: () => false,
                calculateTotal: () => 0,
                calculateSubtotal: () => 0,
                isFulfilled: () => false,
                isPaid: () => false,
                getTotalItemsCount: () => 0,
            });
            const result = await orderService.cancelOrder('order-123');
            expect(result.status).toBe(order_entity_1.OrderStatus.CANCELLED);
        });
        it('should not cancel shipped order', async () => {
            const mockOrder = {
                id: 'order-123',
                status: order_entity_1.OrderStatus.SHIPPED,
                canBeCancelled: () => false,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(orderService.cancelOrder('order-123')).rejects.toThrow('Order cannot be cancelled in current status');
        });
    });
    describe('applyDiscount', () => {
        it('should apply valid discount code', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-123',
                subtotal: 100.00,
            });
            const result = await orderService.applyDiscount('order-123', 'SAVE20', 20.00);
            expect(result.discountCode).toBe('SAVE20');
            expect(result.discountAmount).toBe(20.00);
        });
        it('should reject discount greater than subtotal', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-123',
                subtotal: 50.00,
            });
            await expect(orderService.applyDiscount('order-123', 'INVALID', 100.00)).rejects.toThrow('Discount amount cannot exceed order subtotal');
        });
        it('should reject negative discount', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-123',
                subtotal: 100.00,
            });
            await expect(orderService.applyDiscount('order-123', 'INVALID', -10.00)).rejects.toThrow('Discount amount must be positive');
        });
    });
    describe('getOrderTotal', () => {
        it('should calculate total with tax and shipping', async () => {
            const mockOrder = {
                id: 'order-123',
                subtotal: 100.00,
                taxAmount: 10.00,
                shippingCost: 15.00,
                discountAmount: 0,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const total = await orderService.getOrderTotal('order-123');
            expect(total).toBe(125.00);
        });
        it('should subtract discount from total', async () => {
            const mockOrder = {
                id: 'order-123',
                subtotal: 100.00,
                taxAmount: 10.00,
                shippingCost: 15.00,
                discountAmount: 25.00,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const total = await orderService.getOrderTotal('order-123');
            expect(total).toBe(100.00);
        });
    });
    describe('getTotalRevenue', () => {
        it('should return total revenue from paid orders', async () => {
            mockOrderRepository.getTotalRevenue.mockResolvedValue(15000.00);
            const result = await orderService.getTotalRevenue();
            expect(result).toBe(15000.00);
        });
    });
    describe('getOrderStatistics', () => {
        it('should return order stats by status', async () => {
            const mockStats = [
                { status: order_entity_1.OrderStatus.PENDING, count: 10 },
                { status: order_entity_1.OrderStatus.DELIVERED, count: 45 },
            ];
            mockOrderRepository.getOrderStats.mockResolvedValue(mockStats);
            const result = await orderService.getOrderStatistics();
            expect(result).toEqual(mockStats);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxvcmRlci5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBT0gsSUFBSSxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0FBTDlDLG1EQUErQztBQUUvQywyREFBd0Y7QUFDeEYseUNBQTZDO0FBSTdDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLElBQUksWUFBMEIsQ0FBQztJQUMvQixJQUFJLG1CQUFpRCxDQUFDO0lBRXRELFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxtQkFBbUIsR0FBRztZQUNwQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzVCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDOUIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDa0IsQ0FBQztRQUU3QyxZQUFZLEdBQUcsSUFBSSw0QkFBWSxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixNQUFNLGNBQWMsR0FBRztZQUNyQixNQUFNLEVBQUUsVUFBVTtZQUNsQixLQUFLLEVB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QUFNLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsbUJBQW1CLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBRXBELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25ELE1BQU0sU0FBUyxHQUFHO2dCQUNoQixFQUFFLE1BQU0sRUFBRSwwQkFBVyxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO2dCQUMxQyxFQUFFLE1BQU0sRUFBRSwwQkFBVyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO2FBQzdDLENBQUM7WUFFRixtQkFBbUIsQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFL0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUV2RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcQWRhcHRpdmVfVGVzdGluZ1xcc3JjXFxzZXJ2aWNlc1xcb3JkZXItcHJvY2Vzc2luZ1xcc2VydmljZXNcXG9yZGVyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRERDogT3JkZXIgU2VydmljZSBUZXN0c1xuICpcbiAqIFRlc3Rpbmcgb3JkZXIgcHJvY2Vzc2luZyBidXNpbmVzcyBsb2dpY1xuICovXG5cbmltcG9ydCB7IE9yZGVyU2VydmljZSB9IGZyb20gJy4vb3JkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBPcmRlclJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBPcmRlciwgT3JkZXJTdGF0dXMsIFBheW1lbnRTdGF0dXMsIE9yZGVySXRlbSB9IGZyb20gJy4uL2VudGl0aWVzL29yZGVyLmVudGl0eSc7XG5pbXBvcnQgeyBOb3RGb3VuZEVycm9yIH0gZnJvbSAnQGxpYnMvZXJyb3JzJztcblxuamVzdC5tb2NrKCcuLi9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeScpO1xuXG5kZXNjcmliZSgnT3JkZXJTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgb3JkZXJTZXJ2aWNlOiBPcmRlclNlcnZpY2U7XG4gIGxldCBtb2NrT3JkZXJSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxPcmRlclJlcG9zaXRvcnk+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tPcmRlclJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlPcmRlck51bWJlcjogamVzdC5mbigpLFxuICAgICAgZmluZEJ5VXNlcklkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVTdGF0dXM6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVBheW1lbnRTdGF0dXM6IGplc3QuZm4oKSxcbiAgICAgIGNhbmNlbE9yZGVyOiBqZXN0LmZuKCksXG4gICAgICBtYXJrQXNTaGlwcGVkOiBqZXN0LmZuKCksXG4gICAgICBtYXJrQXNEZWxpdmVyZWQ6IGplc3QuZm4oKSxcbiAgICAgIGdldFRvdGFsUmV2ZW51ZTogamVzdC5mbigpLFxuICAgICAgZ2V0T3JkZXJTdGF0czogamVzdC5mbigpLFxuICAgIH0gYXMgdW5rbm93biBhcyBqZXN0Lk1vY2tlZDxPcmRlclJlcG9zaXRvcnk+O1xuXG4gICAgb3JkZXJTZXJ2aWNlID0gbmV3IE9yZGVyU2VydmljZShtb2NrT3JkZXJSZXBvc2l0b3J5KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZU9yZGVyJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkT3JkZXJEYXRhID0ge1xuICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgaXRlbXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDEnLFxuICAgICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgICB1bml0UHJpY2U6IDUwLjAwLFxuICAgICAgICAgIHF1YW50aXR5OiAyLFxuICAgICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgIH0sXG4gICAgICBdIGFzIE9yZGVySXRlbVtdLFxuICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgIHN0cmVldDogJzEyMyBNYWluIFN0JyxcbiAgICAgICAgY2l0eTogJ05ldyBZb3JrJyxcbiAgICAgICAgc3RhdGU6ICdOWScsXG4gICAgICAgIHBvc3RhbENvZGU6ICcxMDAwMScsXG4gICAgICAgIGNvdW50cnk6ICdVU0EnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgb3JkZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDAxJyxcbiAgICAgICAgLi4udmFsaWRPcmRlckRhdGEsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgIHRvdGFsOiAxMTAuMDAsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuUEVORElORyxcbiAgICAgIH0gYXMgT3JkZXI7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5jcmVhdGVPcmRlcih2YWxpZE9yZGVyRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja09yZGVyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3JkZXJOdW1iZXIpLnRvTWF0Y2goL15PUkQtXFxkezR9LVxcZCskLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBvcmRlciB3aXRoIGVtcHR5IGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XG4gICAgICAgIC4uLnZhbGlkT3JkZXJEYXRhLFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3Qob3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKGludmFsaWREYXRhKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnT3JkZXIgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSBpdGVtJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG9yZGVyIHdpdGggbmVnYXRpdmUgcXVhbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgLi4udmFsaWRPcmRlckRhdGEsXG4gICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgIC4uLnZhbGlkT3JkZXJEYXRhLml0ZW1zWzBdLFxuICAgICAgICAgIHF1YW50aXR5OiAtMSxcbiAgICAgICAgfV0gYXMgT3JkZXJJdGVtW10sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3Qob3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKGludmFsaWREYXRhKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnSXRlbSBxdWFudGl0eSBtdXN0IGJlIHBvc2l0aXZlJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHN1YnRvdGFsIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcbiAgICAgICAgLi4udmFsaWRPcmRlckRhdGEsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgICAgIHByb2R1Y3ROYW1lOiAnUHJvZHVjdCAxJyxcbiAgICAgICAgICAgIHByb2R1Y3RTa3U6ICdTS1UtMDAxJyxcbiAgICAgICAgICAgIHVuaXRQcmljZTogNTAuMDAsXG4gICAgICAgICAgICBxdWFudGl0eTogMixcbiAgICAgICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTInLFxuICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICdQcm9kdWN0IDInLFxuICAgICAgICAgICAgcHJvZHVjdFNrdTogJ1NLVS0wMDInLFxuICAgICAgICAgICAgdW5pdFByaWNlOiAzMC4wMCxcbiAgICAgICAgICAgIHF1YW50aXR5OiAzLFxuICAgICAgICAgICAgc3VidG90YWw6IDkwLjAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0gYXMgT3JkZXJJdGVtW10sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1YnRvdGFsOiAxOTAuMDAsXG4gICAgICB9IGFzIE9yZGVyKTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKG9yZGVyRGF0YSk7XG5cbiAgICAgIGV4cGVjdChtb2NrT3JkZXJSZXBvc2l0b3J5LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWJ0b3RhbDogMTkwLjAwLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHRheCBhdCAxMCUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgIHRheEFtb3VudDogMTAuMDAsXG4gICAgICB9IGFzIE9yZGVyKTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKHZhbGlkT3JkZXJEYXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tPcmRlclJlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHRheEFtb3VudDogMTAuMDAsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhZGQgZGVmYXVsdCBzaGlwcGluZyBjb3N0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzaGlwcGluZ0Nvc3Q6IDEwLjAwLFxuICAgICAgfSBhcyBPcmRlcik7XG5cbiAgICAgIGF3YWl0IG9yZGVyU2VydmljZS5jcmVhdGVPcmRlcih2YWxpZE9yZGVyRGF0YSk7XG5cbiAgICAgIGV4cGVjdChtb2NrT3JkZXJSZXBvc2l0b3J5LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzaGlwcGluZ0Nvc3Q6IDEwLjAwLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE9yZGVyQnlJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBvcmRlciBieSBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHsgaWQ6ICdvcmRlci0xMjMnIH0gYXMgT3JkZXI7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5nZXRPcmRlckJ5SWQoJ29yZGVyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tPcmRlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXJyb3IgZm9yIG5vbi1leGlzdGVudCBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBOb3RGb3VuZEVycm9yKCdPcmRlciBub3QgZm91bmQnKVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KG9yZGVyU2VydmljZS5nZXRPcmRlckJ5SWQoJ2ludmFsaWQnKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlck9yZGVycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgb3JkZXJzIGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVycyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCB1c2VySWQ6ICd1c2VyLTEyMycgfSxcbiAgICAgICAgeyBpZDogJzInLCB1c2VySWQ6ICd1c2VyLTEyMycgfSxcbiAgICAgIF0gYXMgT3JkZXJbXTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVycyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5nZXRVc2VyT3JkZXJzKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tPcmRlcnMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIHVzZXIgd2l0aCBubyBvcmRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5nZXRVc2VyT3JkZXJzKCd1c2VyLTQ1NicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbmZpcm1PcmRlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvbmZpcm0gcGVuZGluZyBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xMjMnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkNPTkZJUk1FRCxcbiAgICAgIH0gYXMgT3JkZXI7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkudXBkYXRlU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5jb25maXJtT3JkZXIoJ29yZGVyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShPcmRlclN0YXR1cy5DT05GSVJNRUQpO1xuICAgICAgZXhwZWN0KG1vY2tPcmRlclJlcG9zaXRvcnkudXBkYXRlU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ29yZGVyLTEyMycsXG4gICAgICAgIE9yZGVyU3RhdHVzLkNPTkZJUk1FRFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Byb2Nlc3NQYXltZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFyayBwYXltZW50IGFzIHN1Y2Nlc3NmdWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMTIzJyxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICBwYWlkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICB9IGFzIE9yZGVyO1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LnVwZGF0ZVBheW1lbnRTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3JkZXJTZXJ2aWNlLnByb2Nlc3NQYXltZW50KCdvcmRlci0xMjMnLCAncGF5bWVudC1yZWYtMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucGF5bWVudFN0YXR1cykudG9CZShQYXltZW50U3RhdHVzLlBBSUQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGF5bWVudCBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuRkFJTEVELFxuICAgICAgfSBhcyBPcmRlcjtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS51cGRhdGVQYXltZW50U3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5wcm9jZXNzUGF5bWVudCgnb3JkZXItMTIzJywgbnVsbCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucGF5bWVudFN0YXR1cykudG9CZShQYXltZW50U3RhdHVzLkZBSUxFRCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzaGlwT3JkZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzaGlwIGNvbmZpcm1lZCBwYWlkIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuU0hJUFBFRCxcbiAgICAgICAgdHJhY2tpbmdOdW1iZXI6ICdUUkFDSy0xMjMnLFxuICAgICAgfSBhcyBPcmRlcjtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5tYXJrQXNTaGlwcGVkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5zaGlwT3JkZXIoJ29yZGVyLTEyMycsICdUUkFDSy0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoT3JkZXJTdGF0dXMuU0hJUFBFRCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRyYWNraW5nTnVtYmVyKS50b0JlKCdUUkFDSy0xMjMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGl2ZXJPcmRlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgb3JkZXIgYXMgZGVsaXZlcmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELFxuICAgICAgICBkZWxpdmVyZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgIH0gYXMgT3JkZXI7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkubWFya0FzRGVsaXZlcmVkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5kZWxpdmVyT3JkZXIoJ29yZGVyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShPcmRlclN0YXR1cy5ERUxJVkVSRUQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZWxpdmVyZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbmNlbE9yZGVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FuY2VsIHBlbmRpbmcgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMTIzJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgICBjYW5CZUNhbmNlbGxlZDogKCkgPT4gdHJ1ZSxcbiAgICAgIH0gYXMgT3JkZXI7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyKTtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuY2FuY2VsT3JkZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrT3JkZXIsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuQ0FOQ0VMTEVELFxuICAgICAgICBjYW5CZUNhbmNlbGxlZDogKCkgPT4gZmFsc2UsXG4gICAgICAgIGNhbGN1bGF0ZVRvdGFsOiAoKSA9PiAwLFxuICAgICAgICBjYWxjdWxhdGVTdWJ0b3RhbDogKCkgPT4gMCxcbiAgICAgICAgaXNGdWxmaWxsZWQ6ICgpID0+IGZhbHNlLFxuICAgICAgICBpc1BhaWQ6ICgpID0+IGZhbHNlLFxuICAgICAgICBnZXRUb3RhbEl0ZW1zQ291bnQ6ICgpID0+IDAsXG4gICAgICB9IGFzIE9yZGVyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3JkZXJTZXJ2aWNlLmNhbmNlbE9yZGVyKCdvcmRlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoT3JkZXJTdGF0dXMuQ0FOQ0VMTEVEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGNhbmNlbCBzaGlwcGVkIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuU0hJUFBFRCxcbiAgICAgICAgY2FuQmVDYW5jZWxsZWQ6ICgpID0+IGZhbHNlLFxuICAgICAgfSBhcyBPcmRlcjtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qob3JkZXJTZXJ2aWNlLmNhbmNlbE9yZGVyKCdvcmRlci0xMjMnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnT3JkZXIgY2Fubm90IGJlIGNhbmNlbGxlZCBpbiBjdXJyZW50IHN0YXR1cydcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhcHBseURpc2NvdW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYXBwbHkgdmFsaWQgZGlzY291bnQgY29kZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICB9IGFzIE9yZGVyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3JkZXJTZXJ2aWNlLmFwcGx5RGlzY291bnQoJ29yZGVyLTEyMycsICdTQVZFMjAnLCAyMC4wMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzY291bnRDb2RlKS50b0JlKCdTQVZFMjAnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGlzY291bnRBbW91bnQpLnRvQmUoMjAuMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZGlzY291bnQgZ3JlYXRlciB0aGFuIHN1YnRvdGFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItMTIzJyxcbiAgICAgICAgc3VidG90YWw6IDUwLjAwLFxuICAgICAgfSBhcyBPcmRlcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgb3JkZXJTZXJ2aWNlLmFwcGx5RGlzY291bnQoJ29yZGVyLTEyMycsICdJTlZBTElEJywgMTAwLjAwKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0Rpc2NvdW50IGFtb3VudCBjYW5ub3QgZXhjZWVkIG9yZGVyIHN1YnRvdGFsJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBuZWdhdGl2ZSBkaXNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICB9IGFzIE9yZGVyKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBvcmRlclNlcnZpY2UuYXBwbHlEaXNjb3VudCgnb3JkZXItMTIzJywgJ0lOVkFMSUQnLCAtMTAuMDApXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnRGlzY291bnQgYW1vdW50IG11c3QgYmUgcG9zaXRpdmUnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE9yZGVyVG90YWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdG90YWwgd2l0aCB0YXggYW5kIHNoaXBwaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAuMDAsXG4gICAgICAgIHRheEFtb3VudDogMTAuMDAsXG4gICAgICAgIHNoaXBwaW5nQ29zdDogMTUuMDAsXG4gICAgICAgIGRpc2NvdW50QW1vdW50OiAwLFxuICAgICAgfSBhcyBPcmRlcjtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIpO1xuXG4gICAgICBjb25zdCB0b3RhbCA9IGF3YWl0IG9yZGVyU2VydmljZS5nZXRPcmRlclRvdGFsKCdvcmRlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHRvdGFsKS50b0JlKDEyNS4wMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1YnRyYWN0IGRpc2NvdW50IGZyb20gdG90YWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMTIzJyxcbiAgICAgICAgc3VidG90YWw6IDEwMC4wMCxcbiAgICAgICAgdGF4QW1vdW50OiAxMC4wMCxcbiAgICAgICAgc2hpcHBpbmdDb3N0OiAxNS4wMCxcbiAgICAgICAgZGlzY291bnRBbW91bnQ6IDI1LjAwLFxuICAgICAgfSBhcyBPcmRlcjtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIpO1xuXG4gICAgICBjb25zdCB0b3RhbCA9IGF3YWl0IG9yZGVyU2VydmljZS5nZXRPcmRlclRvdGFsKCdvcmRlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHRvdGFsKS50b0JlKDEwMC4wMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRUb3RhbFJldmVudWUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdG90YWwgcmV2ZW51ZSBmcm9tIHBhaWQgb3JkZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5nZXRUb3RhbFJldmVudWUubW9ja1Jlc29sdmVkVmFsdWUoMTUwMDAuMDApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2UuZ2V0VG90YWxSZXZlbnVlKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTUwMDAuMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0T3JkZXJTdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGVyIHN0YXRzIGJ5IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdGF0cyA9IFtcbiAgICAgICAgeyBzdGF0dXM6IE9yZGVyU3RhdHVzLlBFTkRJTkcsIGNvdW50OiAxMCB9LFxuICAgICAgICB7IHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELCBjb3VudDogNDUgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZ2V0T3JkZXJTdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3RhdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2UuZ2V0T3JkZXJTdGF0aXN0aWNzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1N0YXRzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==