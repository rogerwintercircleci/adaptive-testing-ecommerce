3217139dcab0afa5f2450fb392e150cf
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createChildLogger = exports.httpLogger = exports.logger = void 0;
const winston_1 = __importDefault(require("winston"));
const LOG_LEVEL = process.env.LOG_LEVEL || 'info';
const LOG_FORMAT = process.env.LOG_FORMAT || 'json';
/**
 * Custom log format for development
 */
const devFormat = winston_1.default.format.combine(winston_1.default.format.colorize(), winston_1.default.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }), winston_1.default.format.printf(({ timestamp, level, message, ...meta }) => {
    const metaStr = Object.keys(meta).length ? JSON.stringify(meta, null, 2) : '';
    return `${timestamp} [${level}]: ${message} ${metaStr}`;
}));
/**
 * Production log format (JSON)
 */
const prodFormat = winston_1.default.format.combine(winston_1.default.format.timestamp(), winston_1.default.format.errors({ stack: true }), winston_1.default.format.json());
/**
 * Winston logger configuration
 */
exports.logger = winston_1.default.createLogger({
    level: LOG_LEVEL,
    format: LOG_FORMAT === 'json' ? prodFormat : devFormat,
    defaultMeta: { service: 'ecommerce-api' },
    transports: [
        new winston_1.default.transports.Console({
            stderrLevels: ['error'],
        }),
    ],
});
/**
 * Log HTTP requests
 */
const httpLogger = (req, res, responseTime) => {
    const request = req;
    const response = res;
    exports.logger.info('HTTP Request', {
        method: request.method,
        url: request.url,
        statusCode: response.statusCode,
        responseTime: `${responseTime}ms`,
        ip: request.ip,
    });
};
exports.httpLogger = httpLogger;
/**
 * Create a child logger with additional context
 */
const createChildLogger = (context) => {
    return exports.logger.child(context);
};
exports.createChildLogger = createChildLogger;
// In test environment, reduce logging noise
if (process.env.NODE_ENV === 'test') {
    exports.logger.transports.forEach((transport) => (transport.silent = true));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SyxNQUFNLEVBQUUsQ0FBQztJQUNwQyxjQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDdEUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcQWRhcHRpdmVfVGVzdGluZ1xcc3JjXFxsaWJzXFxsb2dnZXJcXGxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgd2luc3RvbiBmcm9tICd3aW5zdG9uJztcblxuY29uc3QgTE9HX0xFVkVMID0gcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIHx8ICdpbmZvJztcbmNvbnN0IExPR19GT1JNQVQgPSBwcm9jZXNzLmVudi5MT0dfRk9STUFUIHx8ICdqc29uJztcblxuLyoqXG4gKiBDdXN0b20gbG9nIGZvcm1hdCBmb3IgZGV2ZWxvcG1lbnRcbiAqL1xuY29uc3QgZGV2Rm9ybWF0ID0gd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgd2luc3Rvbi5mb3JtYXQuY29sb3JpemUoKSxcbiAgd2luc3Rvbi5mb3JtYXQudGltZXN0YW1wKHsgZm9ybWF0OiAnWVlZWS1NTS1ERCBISDptbTpzcycgfSksXG4gIHdpbnN0b24uZm9ybWF0LnByaW50ZigoeyB0aW1lc3RhbXAsIGxldmVsLCBtZXNzYWdlLCAuLi5tZXRhIH0pID0+IHtcbiAgICBjb25zdCBtZXRhU3RyID0gT2JqZWN0LmtleXMobWV0YSkubGVuZ3RoID8gSlNPTi5zdHJpbmdpZnkobWV0YSwgbnVsbCwgMikgOiAnJztcbiAgICByZXR1cm4gYCR7dGltZXN0YW1wfSBbJHtsZXZlbH1dOiAke21lc3NhZ2V9ICR7bWV0YVN0cn1gO1xuICB9KVxuKTtcblxuLyoqXG4gKiBQcm9kdWN0aW9uIGxvZyBmb3JtYXQgKEpTT04pXG4gKi9cbmNvbnN0IHByb2RGb3JtYXQgPSB3aW5zdG9uLmZvcm1hdC5jb21iaW5lKFxuICB3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoKSxcbiAgd2luc3Rvbi5mb3JtYXQuZXJyb3JzKHsgc3RhY2s6IHRydWUgfSksXG4gIHdpbnN0b24uZm9ybWF0Lmpzb24oKVxuKTtcblxuLyoqXG4gKiBXaW5zdG9uIGxvZ2dlciBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBsb2dnZXIgPSB3aW5zdG9uLmNyZWF0ZUxvZ2dlcih7XG4gIGxldmVsOiBMT0dfTEVWRUwsXG4gIGZvcm1hdDogTE9HX0ZPUk1BVCA9PT0gJ2pzb24nID8gcHJvZEZvcm1hdCA6IGRldkZvcm1hdCxcbiAgZGVmYXVsdE1ldGE6IHsgc2VydmljZTogJ2Vjb21tZXJjZS1hcGknIH0sXG4gIHRyYW5zcG9ydHM6IFtcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgc3RkZXJyTGV2ZWxzOiBbJ2Vycm9yJ10sXG4gICAgfSksXG4gIF0sXG59KTtcblxuLyoqXG4gKiBMb2cgSFRUUCByZXF1ZXN0c1xuICovXG5leHBvcnQgY29uc3QgaHR0cExvZ2dlciA9IChyZXE6IHVua25vd24sIHJlczogdW5rbm93biwgcmVzcG9uc2VUaW1lOiBudW1iZXIpOiB2b2lkID0+IHtcbiAgY29uc3QgcmVxdWVzdCA9IHJlcSBhcyB7IG1ldGhvZDogc3RyaW5nOyB1cmw6IHN0cmluZzsgaXA6IHN0cmluZyB9O1xuICBjb25zdCByZXNwb25zZSA9IHJlcyBhcyB7IHN0YXR1c0NvZGU6IG51bWJlciB9O1xuXG4gIGxvZ2dlci5pbmZvKCdIVFRQIFJlcXVlc3QnLCB7XG4gICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCxcbiAgICB1cmw6IHJlcXVlc3QudXJsLFxuICAgIHN0YXR1c0NvZGU6IHJlc3BvbnNlLnN0YXR1c0NvZGUsXG4gICAgcmVzcG9uc2VUaW1lOiBgJHtyZXNwb25zZVRpbWV9bXNgLFxuICAgIGlwOiByZXF1ZXN0LmlwLFxuICB9KTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGEgY2hpbGQgbG9nZ2VyIHdpdGggYWRkaXRpb25hbCBjb250ZXh0XG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVDaGlsZExvZ2dlciA9IChjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHdpbnN0b24uTG9nZ2VyID0+IHtcbiAgcmV0dXJuIGxvZ2dlci5jaGlsZChjb250ZXh0KTtcbn07XG5cbi8vIEluIHRlc3QgZW52aXJvbm1lbnQsIHJlZHVjZSBsb2dnaW5nIG5vaXNlXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICBsb2dnZXIudHJhbnNwb3J0cy5mb3JFYWNoKCh0cmFuc3BvcnQpID0+ICh0cmFuc3BvcnQuc2lsZW50ID0gdHJ1ZSkpO1xufVxuIl0sInZlcnNpb24iOjN9