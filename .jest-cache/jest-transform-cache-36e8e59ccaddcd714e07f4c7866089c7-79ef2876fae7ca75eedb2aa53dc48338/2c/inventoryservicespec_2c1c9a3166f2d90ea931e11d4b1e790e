de8c6874d659b4a523f5ebfc258aaf4e
"use strict";
/**
 * TDD: Inventory Management Service Tests
 *
 * Testing stock tracking, reservations, and inventory control
 */
Object.defineProperty(exports, "__esModule", { value: true });
const inventory_service_1 = require("./inventory.service");
const errors_1 = require("@libs/errors");
describe('InventoryService', () => {
    let inventoryService;
    let mockInventoryRepository;
    let mockProductRepository;
    beforeEach(() => {
        mockInventoryRepository = {
            findByProductId: jest.fn(),
            update: jest.fn(),
            createReservation: jest.fn(),
            releaseReservation: jest.fn(),
            findReservation: jest.fn(),
            findExpiredReservations: jest.fn(),
            findLowStock: jest.fn(),
            findOutOfStock: jest.fn(),
            getInventoryHistory: jest.fn(),
            recordAdjustment: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            updateInventory: jest.fn(),
        };
        inventoryService = new inventory_service_1.InventoryService(mockInventoryRepository, mockProductRepository);
    });
    describe('getStock', () => {
        it('should get current stock level for a product', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
                available: 90,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            const result = await inventoryService.getStock('prod-1');
            expect(result.quantity).toBe(100);
            expect(result.available).toBe(90);
        });
        it('should calculate available stock (quantity - reserved)', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 50,
                reserved: 15,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            const result = await inventoryService.getStock('prod-1');
            expect(result.available).toBe(35);
        });
    });
    describe('adjustInventory', () => {
        it('should increase inventory quantity', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 150,
            });
            const result = await inventoryService.adjustInventory(adjustDto);
            expect(result.quantity).toBe(150);
        });
        it('should decrease inventory quantity', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: -20,
                reason: 'damage',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 80,
            });
            const result = await inventoryService.adjustInventory(adjustDto);
            expect(result.quantity).toBe(80);
        });
        it('should reject adjustment that would make quantity negative', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: -150,
                reason: 'adjustment',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            await expect(inventoryService.adjustInventory(adjustDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(inventoryService.adjustInventory(adjustDto)).rejects.toThrow('Insufficient inventory');
        });
        it('should record inventory adjustment in history', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
                userId: 'admin-1',
            };
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 100 });
            mockInventoryRepository.update.mockResolvedValue({ quantity: 150 });
            mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);
            await inventoryService.adjustInventory(adjustDto);
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledWith(expect.objectContaining({
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
            }));
        });
    });
    describe('reserveStock', () => {
        it('should reserve stock for an order', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
                available: 90,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.createReservation.mockResolvedValue({
                id: 'reservation-1',
                ...reservationDto,
                expiresAt: new Date(Date.now() + 15 * 60 * 1000),
            });
            const result = await inventoryService.reserveStock(reservationDto);
            expect(result.quantity).toBe(5);
            expect(result.expiresAt).toBeDefined();
        });
        it('should reject reservation if insufficient available stock', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 100,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 95,
                available: 5,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            await expect(inventoryService.reserveStock(reservationDto)).rejects.toThrow(errors_1.ConflictError);
            await expect(inventoryService.reserveStock(reservationDto)).rejects.toThrow('Insufficient stock available');
        });
        it('should set expiration time for reservation', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
                expirationMinutes: 30,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 100,
                available: 100,
            });
            mockInventoryRepository.createReservation.mockResolvedValue({
                id: 'reservation-1',
                expiresAt: new Date(Date.now() + 30 * 60 * 1000),
            });
            const result = await inventoryService.reserveStock(reservationDto);
            const expiresIn = result.expiresAt.getTime() - Date.now();
            expect(expiresIn).toBeGreaterThan(29 * 60 * 1000);
            expect(expiresIn).toBeLessThan(31 * 60 * 1000);
        });
    });
    describe('releaseReservation', () => {
        it('should release a stock reservation', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            await inventoryService.releaseReservation('reservation-1');
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalledWith('reservation-1');
        });
        it('should update available quantity after releasing reservation', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            await inventoryService.releaseReservation('reservation-1');
            // Verify that reserved quantity decreased
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalled();
        });
    });
    describe('confirmReservation', () => {
        it('should convert reservation to actual inventory deduction', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 95,
                reserved: 5,
            });
            const result = await inventoryService.confirmReservation('reservation-1');
            expect(result.quantity).toBe(95);
        });
    });
    describe('checkAvailability', () => {
        it('should check if quantity is available in stock', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 50,
                reserved: 0,
            });
            const result = await inventoryService.checkAvailability('prod-1', 30);
            expect(result).toBe(true);
        });
        it('should return false if requested quantity exceeds available stock', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                available: 50,
            });
            const result = await inventoryService.checkAvailability('prod-1', 60);
            expect(result).toBe(false);
        });
    });
    describe('getLowStockProducts', () => {
        it('should get products below minimum stock level', async () => {
            const mockLowStock = [
                { productId: 'prod-1', quantity: 5, minStockLevel: 10 },
                { productId: 'prod-2', quantity: 2, minStockLevel: 20 },
            ];
            mockInventoryRepository.findLowStock.mockResolvedValue(mockLowStock);
            const result = await inventoryService.getLowStockProducts();
            expect(result).toHaveLength(2);
            expect(result[0].quantity).toBeLessThan(result[0].minStockLevel);
        });
        it('should filter low stock by threshold percentage', async () => {
            const mockLowStock = [
                { productId: 'prod-1', quantity: 5, minStockLevel: 10 },
            ];
            mockInventoryRepository.findLowStock.mockResolvedValue(mockLowStock);
            const result = await inventoryService.getLowStockProducts({ threshold: 50 });
            expect(result[0].stockPercentage).toBeLessThanOrEqual(50);
        });
    });
    describe('getOutOfStockProducts', () => {
        it('should get products with zero stock', async () => {
            const mockOutOfStock = [
                { productId: 'prod-1', quantity: 0 },
                { productId: 'prod-2', quantity: 0 },
            ];
            mockInventoryRepository.findOutOfStock.mockResolvedValue(mockOutOfStock);
            const result = await inventoryService.getOutOfStockProducts();
            expect(result.every(p => p.quantity === 0)).toBe(true);
        });
    });
    describe('setMinStockLevel', () => {
        it('should set minimum stock level for a product', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                productId: 'prod-1',
                quantity: 50,
            });
            mockInventoryRepository.update.mockResolvedValue({
                productId: 'prod-1',
                minStockLevel: 20,
            });
            const result = await inventoryService.setMinStockLevel('prod-1', 20);
            expect(result.minStockLevel).toBe(20);
        });
        it('should reject negative minimum stock level', async () => {
            await expect(inventoryService.setMinStockLevel('prod-1', -10)).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('setReorderPoint', () => {
        it('should set reorder point for automatic restocking', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                productId: 'prod-1',
            });
            mockInventoryRepository.update.mockResolvedValue({
                productId: 'prod-1',
                reorderPoint: 25,
                reorderQuantity: 100,
            });
            const result = await inventoryService.setReorderPoint('prod-1', 25, 100);
            expect(result.reorderPoint).toBe(25);
            expect(result.reorderQuantity).toBe(100);
        });
    });
    describe('getInventoryHistory', () => {
        it('should get inventory adjustment history', async () => {
            const mockHistory = [
                { id: '1', productId: 'prod-1', quantity: 50, reason: 'restock', date: new Date() },
                { id: '2', productId: 'prod-1', quantity: -5, reason: 'sale', date: new Date() },
            ];
            mockInventoryRepository.getInventoryHistory.mockResolvedValue(mockHistory);
            const result = await inventoryService.getInventoryHistory('prod-1');
            expect(result).toHaveLength(2);
        });
        it('should filter history by date range', async () => {
            const startDate = new Date('2025-01-01');
            const endDate = new Date('2025-01-31');
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([]);
            await inventoryService.getInventoryHistory('prod-1', { startDate, endDate });
            expect(mockInventoryRepository.getInventoryHistory).toHaveBeenCalledWith('prod-1', expect.objectContaining({ startDate, endDate }));
        });
    });
    describe('releaseExpiredReservations', () => {
        it('should release all expired stock reservations', async () => {
            const mockExpired = [
                { id: 'res-1', productId: 'prod-1', quantity: 5 },
                { id: 'res-2', productId: 'prod-2', quantity: 3 },
            ];
            mockInventoryRepository.findExpiredReservations.mockResolvedValue(mockExpired);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            const result = await inventoryService.releaseExpiredReservations();
            expect(result.releasedCount).toBe(2);
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalledTimes(2);
        });
    });
    describe('getStockValue', () => {
        it('should calculate total value of inventory', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            const mockProduct = {
                id: 'prod-1',
                price: 50,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockProductRepository.findById.mockResolvedValue(mockProduct);
            const result = await inventoryService.getStockValue('prod-1');
            expect(result).toBe(5000); // 100 * 50
        });
    });
    describe('bulkUpdateInventory', () => {
        it('should update inventory for multiple products', async () => {
            const updates = [
                { productId: 'prod-1', quantity: 10 },
                { productId: 'prod-2', quantity: -5 },
            ];
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 100 });
            mockInventoryRepository.update.mockResolvedValue({});
            const result = await inventoryService.bulkUpdateInventory(updates);
            expect(result.updated).toBe(2);
            expect(result.failed).toBe(0);
        });
    });
    describe('getInventoryTurnover', () => {
        it('should calculate inventory turnover rate', async () => {
            const now = new Date();
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([
                { quantity: -10, date: new Date(now.getTime() - 5 * 24 * 60 * 60 * 1000) },
                { quantity: -20, date: new Date(now.getTime() - 10 * 24 * 60 * 60 * 1000) },
            ]);
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 50,
            });
            const result = await inventoryService.getInventoryTurnover('prod-1', 30);
            expect(result.totalSold).toBe(30);
            expect(result.turnoverRate).toBeGreaterThan(0);
        });
    });
    describe('predictRestockDate', () => {
        it('should predict when product will need restocking', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 50,
                reorderPoint: 10,
            });
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([
                { quantity: -2, date: new Date(Date.now() - 24 * 60 * 60 * 1000) },
                { quantity: -2, date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) },
                { quantity: -2, date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000) },
            ]);
            const result = await inventoryService.predictRestockDate('prod-1');
            expect(result.estimatedDays).toBeGreaterThan(0);
            expect(result.restockDate).toBeDefined();
        });
    });
    describe('transferStock', () => {
        it('should transfer stock between warehouses/locations', async () => {
            const transferDto = {
                productId: 'prod-1',
                fromLocation: 'warehouse-1',
                toLocation: 'warehouse-2',
                quantity: 20,
            };
            await inventoryService.transferStock(transferDto);
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXGludmVudG9yeVxcc2VydmljZXNcXGludmVudG9yeS5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsMkRBQTJGO0FBRzNGLHlDQUE4RDtBQUU5RCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLElBQUksZ0JBQWtDLENBQUM7SUFDdkMsSUFBSSx1QkFBeUQsQ0FBQztJQUM5RCxJQUFJLHFCQUFxRCxDQUFDO0lBRTFELFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCx1QkFBdUIsR0FBRztZQUN4QixlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMxQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzVCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDN0IsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN6QixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDckIsQ0FBQztRQUVULHFCQUFxQixHQUFHO1lBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ3BCLENBQUM7UUFFVCxnQkFBZ0IsR0FBRyxJQUFJLG9DQUFnQixDQUFDLHVCQUF1QixFQUFFLHFCQUFxQixDQUFDLENBQUM7SUFDMUYsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsTUFBTSxhQUFhLEdBQUc7Z0JBQ3BCLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsR0FBRztnQkFDYixRQUFRLEVBQUUsRUFBRTtnQkFDWixTQUFTLEVBQUUsRUFBRTthQUNkLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsYUFBb0IsQ0FBQyxDQUFDO1lBRWhGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXpELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RFLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osUUFBUSxFQUFFLEVBQUU7YUFDYixDQUFDO1lBRUYsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLGFBQW9CLENBQUMsQ0FBQztZQUVoRixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV6RCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxTQUFTLEdBQXVCO2dCQUNwQyxTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osTUFBTSxFQUFFLFNBQVM7YUFDbEIsQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLEdBQUc7YUFDZCxDQUFDO1lBRUYsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLGFBQW9CLENBQUMsQ0FBQztZQUNoRix1QkFBdUIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUM7Z0JBQy9DLEdBQUcsYUFBYTtnQkFDaEIsUUFBUSxFQUFFLEdBQUc7YUFDUCxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVqRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLFNBQVMsR0FBdUI7Z0JBQ3BDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsQ0FBQyxFQUFFO2dCQUNiLE1BQU0sRUFBRSxRQUFRO2FBQ2pCLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRztnQkFDcEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxHQUFHO2FBQ2QsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFvQixDQUFDLENBQUM7WUFDaEYsdUJBQXVCLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDO2dCQUMvQyxHQUFHLGFBQWE7Z0JBQ2hCLFFBQVEsRUFBRSxFQUFFO2FBQ04sQ0FBQyxDQUFDO1lBRVYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFakUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNERBQTRELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUUsTUFBTSxTQUFTLEdBQXVCO2dCQUNwQyxTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLENBQUMsR0FBRztnQkFDZCxNQUFNLEVBQUUsWUFBWTthQUNyQixDQUFDO1lBRUYsTUFBTSxhQUFhLEdBQUc7Z0JBQ3BCLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsR0FBRzthQUNkLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsYUFBb0IsQ0FBQyxDQUFDO1lBRWhGLE1BQU0sTUFBTSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsd0JBQWUsQ0FBQyxDQUFDO1lBQzNGLE1BQU0sTUFBTSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUN0RyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFNBQVMsR0FBdUI7Z0JBQ3BDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsRUFBRTtnQkFDWixNQUFNLEVBQUUsU0FBUztnQkFDakIsTUFBTSxFQUFFLFNBQVM7YUFDbEIsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQVMsQ0FBQyxDQUFDO1lBQ3BGLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQVMsQ0FBQyxDQUFDO1lBQzNFLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXRFLE1BQU0sZ0JBQWdCLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRWxELE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUNuRSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsRUFBRTtnQkFDWixNQUFNLEVBQUUsU0FBUzthQUNsQixDQUFDLENBQ0gsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUM1QixFQUFFLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakQsTUFBTSxjQUFjLEdBQW1CO2dCQUNyQyxTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxFQUFFLFNBQVM7YUFDbkIsQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLEdBQUc7Z0JBQ2IsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osU0FBUyxFQUFFLEVBQUU7YUFDZCxDQUFDO1lBRUYsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLGFBQW9CLENBQUMsQ0FBQztZQUNoRix1QkFBdUIsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDMUQsRUFBRSxFQUFFLGVBQWU7Z0JBQ25CLEdBQUcsY0FBYztnQkFDakIsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQzthQUMxQyxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVuRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLE1BQU0sY0FBYyxHQUFtQjtnQkFDckMsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxHQUFHO2dCQUNiLE9BQU8sRUFBRSxTQUFTO2FBQ25CLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRztnQkFDcEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxHQUFHO2dCQUNiLFFBQVEsRUFBRSxFQUFFO2dCQUNaLFNBQVMsRUFBRSxDQUFDO2FBQ2IsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFvQixDQUFDLENBQUM7WUFFaEYsTUFBTSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxzQkFBYSxDQUFDLENBQUM7WUFDM0YsTUFBTSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQzlHLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFELE1BQU0sY0FBYyxHQUFtQjtnQkFDckMsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxDQUFDO2dCQUNYLE9BQU8sRUFBRSxTQUFTO2dCQUNsQixpQkFBaUIsRUFBRSxFQUFFO2FBQ3RCLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3hELFFBQVEsRUFBRSxHQUFHO2dCQUNiLFNBQVMsRUFBRSxHQUFHO2FBQ1IsQ0FBQyxDQUFDO1lBRVYsdUJBQXVCLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUM7Z0JBQzFELEVBQUUsRUFBRSxlQUFlO2dCQUNuQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO2FBQzFDLENBQUMsQ0FBQztZQUVWLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzFELE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxlQUFlLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELE1BQU0sZUFBZSxHQUFHO2dCQUN0QixFQUFFLEVBQUUsZUFBZTtnQkFDbkIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxDQUFDO2FBQ1osQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxlQUFzQixDQUFDLENBQUM7WUFDbEYsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFeEUsTUFBTSxnQkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUMzRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4REFBOEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RSxNQUFNLGVBQWUsR0FBRztnQkFDdEIsRUFBRSxFQUFFLGVBQWU7Z0JBQ25CLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsQ0FBQzthQUNaLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsZUFBc0IsQ0FBQyxDQUFDO1lBQ2xGLHVCQUF1QixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXhFLE1BQU0sZ0JBQWdCLENBQUMsa0JBQWtCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFM0QsMENBQTBDO1lBQzFDLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLDBEQUEwRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hFLE1BQU0sZUFBZSxHQUFHO2dCQUN0QixFQUFFLEVBQUUsZUFBZTtnQkFDbkIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxDQUFDO2dCQUNYLE9BQU8sRUFBRSxTQUFTO2FBQ25CLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRztnQkFDcEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxHQUFHO2dCQUNiLFFBQVEsRUFBRSxFQUFFO2FBQ2IsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxlQUFzQixDQUFDLENBQUM7WUFDbEYsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLGFBQW9CLENBQUMsQ0FBQztZQUNoRix1QkFBdUIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUM7Z0JBQy9DLEdBQUcsYUFBYTtnQkFDaEIsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osUUFBUSxFQUFFLENBQUM7YUFDTCxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRTFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCx1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3hELFFBQVEsRUFBRSxFQUFFO2dCQUNaLFFBQVEsRUFBRSxDQUFDO2FBQ0wsQ0FBQyxDQUFDO1lBRVYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtRUFBbUUsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRix1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3hELFNBQVMsRUFBRSxFQUFFO2FBQ1AsQ0FBQyxDQUFDO1lBRVYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0QsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUU7Z0JBQ3ZELEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUU7YUFDeEQsQ0FBQztZQUVGLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFtQixDQUFDLENBQUM7WUFFNUUsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBRTVELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ25FLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELE1BQU0sWUFBWSxHQUFHO2dCQUNuQixFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFO2FBQ3hELENBQUM7WUFFRix1QkFBdUIsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsWUFBbUIsQ0FBQyxDQUFDO1lBRTVFLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUU3RSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ3JDLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxNQUFNLGNBQWMsR0FBRztnQkFDckIsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUU7Z0JBQ3BDLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFO2FBQ3JDLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsY0FBcUIsQ0FBQyxDQUFDO1lBRWhGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVELHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDeEQsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFFBQVEsRUFBRSxFQUFFO2FBQ04sQ0FBQyxDQUFDO1lBRVYsdUJBQXVCLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDO2dCQUMvQyxTQUFTLEVBQUUsUUFBUTtnQkFDbkIsYUFBYSxFQUFFLEVBQUU7YUFDWCxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRCxNQUFNLE1BQU0sQ0FDVixnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FDakQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHdCQUFlLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsbURBQW1ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakUsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDO2dCQUN4RCxTQUFTLEVBQUUsUUFBUTthQUNiLENBQUMsQ0FBQztZQUVWLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQztnQkFDL0MsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFlBQVksRUFBRSxFQUFFO2dCQUNoQixlQUFlLEVBQUUsR0FBRzthQUNkLENBQUMsQ0FBQztZQUVWLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFekUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLElBQUksSUFBSSxFQUFFLEVBQUU7Z0JBQ25GLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFO2FBQ2pGLENBQUM7WUFFRix1QkFBdUIsQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFrQixDQUFDLENBQUM7WUFFbEYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVwRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25ELE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXZDLHVCQUF1QixDQUFDLG1CQUFtQixDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBRXpFLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFFN0UsTUFBTSxDQUFDLHVCQUF1QixDQUFDLG1CQUFtQixDQUFDLENBQUMsb0JBQW9CLENBQ3RFLFFBQVEsRUFDUixNQUFNLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FDaEQsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFdBQVcsR0FBRztnQkFDbEIsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRTtnQkFDakQsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRTthQUNsRCxDQUFDO1lBRUYsdUJBQXVCLENBQUMsdUJBQXVCLENBQUMsaUJBQWlCLENBQUMsV0FBa0IsQ0FBQyxDQUFDO1lBQ3RGLHVCQUF1QixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXhFLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztZQUVuRSxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDN0IsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pELE1BQU0sYUFBYSxHQUFHO2dCQUNwQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsUUFBUSxFQUFFLEdBQUc7YUFDZCxDQUFDO1lBRUYsTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLEVBQUUsRUFBRSxRQUFRO2dCQUNaLEtBQUssRUFBRSxFQUFFO2FBQ1YsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFvQixDQUFDLENBQUM7WUFDaEYscUJBQXFCLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFdBQWtCLENBQUMsQ0FBQztZQUVyRSxNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVztRQUN4QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0QsTUFBTSxPQUFPLEdBQUc7Z0JBQ2QsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUU7Z0JBQ3JDLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUU7YUFDdEMsQ0FBQztZQUVGLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQVMsQ0FBQyxDQUFDO1lBQ3BGLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFTLENBQUMsQ0FBQztZQUU1RCxNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4RCxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3ZCLHVCQUF1QixDQUFDLG1CQUFtQixDQUFDLGlCQUFpQixDQUFDO2dCQUM1RCxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRTtnQkFDMUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUU7YUFDckUsQ0FBQyxDQUFDO1lBRVYsdUJBQXVCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDO2dCQUN4RCxRQUFRLEVBQUUsRUFBRTthQUNOLENBQUMsQ0FBQztZQUVWLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXpFLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2xDLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRSx1QkFBdUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3hELFFBQVEsRUFBRSxFQUFFO2dCQUNaLFlBQVksRUFBRSxFQUFFO2FBQ1YsQ0FBQyxDQUFDO1lBRVYsdUJBQXVCLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUM7Z0JBQzVELEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUU7Z0JBQ2xFLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFO2dCQUN0RSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRTthQUNoRSxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRSxNQUFNLFdBQVcsR0FBRztnQkFDbEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFlBQVksRUFBRSxhQUFhO2dCQUMzQixVQUFVLEVBQUUsYUFBYTtnQkFDekIsUUFBUSxFQUFFLEVBQUU7YUFDYixDQUFDO1lBRUYsTUFBTSxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFbEQsTUFBTSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFxpbnZlbnRvcnlcXHNlcnZpY2VzXFxpbnZlbnRvcnkuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVEREOiBJbnZlbnRvcnkgTWFuYWdlbWVudCBTZXJ2aWNlIFRlc3RzXG4gKlxuICogVGVzdGluZyBzdG9jayB0cmFja2luZywgcmVzZXJ2YXRpb25zLCBhbmQgaW52ZW50b3J5IGNvbnRyb2xcbiAqL1xuXG5pbXBvcnQgeyBJbnZlbnRvcnlTZXJ2aWNlLCBBZGp1c3RJbnZlbnRvcnlEdG8sIFJlc2VydmF0aW9uRHRvIH0gZnJvbSAnLi9pbnZlbnRvcnkuc2VydmljZSc7XG5pbXBvcnQgeyBJbnZlbnRvcnlSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL2ludmVudG9yeS5yZXBvc2l0b3J5JztcbmltcG9ydCB7IFByb2R1Y3RSZXBvc2l0b3J5IH0gZnJvbSAnLi4vLi4vcHJvZHVjdC1jYXRhbG9nL3JlcG9zaXRvcmllcy9wcm9kdWN0LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQmFkUmVxdWVzdEVycm9yLCBDb25mbGljdEVycm9yIH0gZnJvbSAnQGxpYnMvZXJyb3JzJztcblxuZGVzY3JpYmUoJ0ludmVudG9yeVNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBpbnZlbnRvcnlTZXJ2aWNlOiBJbnZlbnRvcnlTZXJ2aWNlO1xuICBsZXQgbW9ja0ludmVudG9yeVJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPEludmVudG9yeVJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxQcm9kdWN0UmVwb3NpdG9yeT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkgPSB7XG4gICAgICBmaW5kQnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgY3JlYXRlUmVzZXJ2YXRpb246IGplc3QuZm4oKSxcbiAgICAgIHJlbGVhc2VSZXNlcnZhdGlvbjogamVzdC5mbigpLFxuICAgICAgZmluZFJlc2VydmF0aW9uOiBqZXN0LmZuKCksXG4gICAgICBmaW5kRXhwaXJlZFJlc2VydmF0aW9uczogamVzdC5mbigpLFxuICAgICAgZmluZExvd1N0b2NrOiBqZXN0LmZuKCksXG4gICAgICBmaW5kT3V0T2ZTdG9jazogamVzdC5mbigpLFxuICAgICAgZ2V0SW52ZW50b3J5SGlzdG9yeTogamVzdC5mbigpLFxuICAgICAgcmVjb3JkQWRqdXN0bWVudDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZUludmVudG9yeTogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgaW52ZW50b3J5U2VydmljZSA9IG5ldyBJbnZlbnRvcnlTZXJ2aWNlKG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U3RvY2snLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgY3VycmVudCBzdG9jayBsZXZlbCBmb3IgYSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ludmVudG9yeSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDEwMCxcbiAgICAgICAgcmVzZXJ2ZWQ6IDEwLFxuICAgICAgICBhdmFpbGFibGU6IDkwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRTdG9jaygncHJvZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbnRpdHkpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYXZhaWxhYmxlKS50b0JlKDkwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGF2YWlsYWJsZSBzdG9jayAocXVhbnRpdHkgLSByZXNlcnZlZCknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICAgIHJlc2VydmVkOiAxNSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSW52ZW50b3J5IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuZ2V0U3RvY2soJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmF2YWlsYWJsZSkudG9CZSgzNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhZGp1c3RJbnZlbnRvcnknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbmNyZWFzZSBpbnZlbnRvcnkgcXVhbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZGp1c3REdG86IEFkanVzdEludmVudG9yeUR0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDUwLFxuICAgICAgICByZWFzb246ICdyZXN0b2NrJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tJbnZlbnRvcnkgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0ludmVudG9yeSxcbiAgICAgICAgcXVhbnRpdHk6IDE1MCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5hZGp1c3RJbnZlbnRvcnkoYWRqdXN0RHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFudGl0eSkudG9CZSgxNTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWNyZWFzZSBpbnZlbnRvcnkgcXVhbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZGp1c3REdG86IEFkanVzdEludmVudG9yeUR0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IC0yMCxcbiAgICAgICAgcmVhc29uOiAnZGFtYWdlJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tJbnZlbnRvcnkgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0ludmVudG9yeSxcbiAgICAgICAgcXVhbnRpdHk6IDgwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmFkanVzdEludmVudG9yeShhZGp1c3REdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnF1YW50aXR5KS50b0JlKDgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFkanVzdG1lbnQgdGhhdCB3b3VsZCBtYWtlIHF1YW50aXR5IG5lZ2F0aXZlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRqdXN0RHRvOiBBZGp1c3RJbnZlbnRvcnlEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAtMTUwLFxuICAgICAgICByZWFzb246ICdhZGp1c3RtZW50JyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tJbnZlbnRvcnkgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoaW52ZW50b3J5U2VydmljZS5hZGp1c3RJbnZlbnRvcnkoYWRqdXN0RHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QoaW52ZW50b3J5U2VydmljZS5hZGp1c3RJbnZlbnRvcnkoYWRqdXN0RHRvKSkucmVqZWN0cy50b1Rocm93KCdJbnN1ZmZpY2llbnQgaW52ZW50b3J5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlY29yZCBpbnZlbnRvcnkgYWRqdXN0bWVudCBpbiBoaXN0b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRqdXN0RHRvOiBBZGp1c3RJbnZlbnRvcnlEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgcmVhc29uOiAncmVzdG9jaycsXG4gICAgICAgIHVzZXJJZDogJ2FkbWluLTEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDEwMCB9IGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBxdWFudGl0eTogMTUwIH0gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlY29yZEFkanVzdG1lbnQubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgaW52ZW50b3J5U2VydmljZS5hZGp1c3RJbnZlbnRvcnkoYWRqdXN0RHRvKTtcblxuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlY29yZEFkanVzdG1lbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICAgICAgcmVhc29uOiAncmVzdG9jaycsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVzZXJ2ZVN0b2NrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVzZXJ2ZSBzdG9jayBmb3IgYW4gb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNlcnZhdGlvbkR0bzogUmVzZXJ2YXRpb25EdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICByZXNlcnZlZDogMTAsXG4gICAgICAgIGF2YWlsYWJsZTogOTAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuY3JlYXRlUmVzZXJ2YXRpb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Jlc2VydmF0aW9uLTEnLFxuICAgICAgICAuLi5yZXNlcnZhdGlvbkR0byxcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTUgKiA2MCAqIDEwMDApLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnJlc2VydmVTdG9jayhyZXNlcnZhdGlvbkR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbnRpdHkpLnRvQmUoNSk7XG4gICAgICBleHBlY3QocmVzdWx0LmV4cGlyZXNBdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlc2VydmF0aW9uIGlmIGluc3VmZmljaWVudCBhdmFpbGFibGUgc3RvY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNlcnZhdGlvbkR0bzogUmVzZXJ2YXRpb25EdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tJbnZlbnRvcnkgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICAgIHJlc2VydmVkOiA5NSxcbiAgICAgICAgYXZhaWxhYmxlOiA1LFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGludmVudG9yeVNlcnZpY2UucmVzZXJ2ZVN0b2NrKHJlc2VydmF0aW9uRHRvKSkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KGludmVudG9yeVNlcnZpY2UucmVzZXJ2ZVN0b2NrKHJlc2VydmF0aW9uRHRvKSkucmVqZWN0cy50b1Rocm93KCdJbnN1ZmZpY2llbnQgc3RvY2sgYXZhaWxhYmxlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCBleHBpcmF0aW9uIHRpbWUgZm9yIHJlc2VydmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZXJ2YXRpb25EdG86IFJlc2VydmF0aW9uRHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNSxcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBleHBpcmF0aW9uTWludXRlczogMzAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICBhdmFpbGFibGU6IDEwMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuY3JlYXRlUmVzZXJ2YXRpb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Jlc2VydmF0aW9uLTEnLFxuICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzMCAqIDYwICogMTAwMCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UucmVzZXJ2ZVN0b2NrKHJlc2VydmF0aW9uRHRvKTtcblxuICAgICAgY29uc3QgZXhwaXJlc0luID0gcmVzdWx0LmV4cGlyZXNBdC5nZXRUaW1lKCkgLSBEYXRlLm5vdygpO1xuICAgICAgZXhwZWN0KGV4cGlyZXNJbikudG9CZUdyZWF0ZXJUaGFuKDI5ICogNjAgKiAxMDAwKTtcbiAgICAgIGV4cGVjdChleHBpcmVzSW4pLnRvQmVMZXNzVGhhbigzMSAqIDYwICogMTAwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWxlYXNlUmVzZXJ2YXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWxlYXNlIGEgc3RvY2sgcmVzZXJ2YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzZXJ2YXRpb24gPSB7XG4gICAgICAgIGlkOiAncmVzZXJ2YXRpb24tMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZFJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNlcnZhdGlvbiBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVsZWFzZVJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IGludmVudG9yeVNlcnZpY2UucmVsZWFzZVJlc2VydmF0aW9uKCdyZXNlcnZhdGlvbi0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWxlYXNlUmVzZXJ2YXRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdyZXNlcnZhdGlvbi0xJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhdmFpbGFibGUgcXVhbnRpdHkgYWZ0ZXIgcmVsZWFzaW5nIHJlc2VydmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc2VydmF0aW9uID0ge1xuICAgICAgICBpZDogJ3Jlc2VydmF0aW9uLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRSZXNlcnZhdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzZXJ2YXRpb24gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlbGVhc2VSZXNlcnZhdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnJlbGVhc2VSZXNlcnZhdGlvbigncmVzZXJ2YXRpb24tMScpO1xuXG4gICAgICAvLyBWZXJpZnkgdGhhdCByZXNlcnZlZCBxdWFudGl0eSBkZWNyZWFzZWRcbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWxlYXNlUmVzZXJ2YXRpb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbmZpcm1SZXNlcnZhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvbnZlcnQgcmVzZXJ2YXRpb24gdG8gYWN0dWFsIGludmVudG9yeSBkZWR1Y3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzZXJ2YXRpb24gPSB7XG4gICAgICAgIGlkOiAncmVzZXJ2YXRpb24tMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICByZXNlcnZlZDogMTAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kUmVzZXJ2YXRpb24ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc2VydmF0aW9uIGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0ludmVudG9yeSxcbiAgICAgICAgcXVhbnRpdHk6IDk1LFxuICAgICAgICByZXNlcnZlZDogNSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5jb25maXJtUmVzZXJ2YXRpb24oJ3Jlc2VydmF0aW9uLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFudGl0eSkudG9CZSg5NSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja0F2YWlsYWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNoZWNrIGlmIHF1YW50aXR5IGlzIGF2YWlsYWJsZSBpbiBzdG9jaycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgcmVzZXJ2ZWQ6IDAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuY2hlY2tBdmFpbGFiaWxpdHkoJ3Byb2QtMScsIDMwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGlmIHJlcXVlc3RlZCBxdWFudGl0eSBleGNlZWRzIGF2YWlsYWJsZSBzdG9jaycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGF2YWlsYWJsZTogNTAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuY2hlY2tBdmFpbGFiaWxpdHkoJ3Byb2QtMScsIDYwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRMb3dTdG9ja1Byb2R1Y3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHByb2R1Y3RzIGJlbG93IG1pbmltdW0gc3RvY2sgbGV2ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTG93U3RvY2sgPSBbXG4gICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDUsIG1pblN0b2NrTGV2ZWw6IDEwIH0sXG4gICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDIsIG1pblN0b2NrTGV2ZWw6IDIwIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kTG93U3RvY2subW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvd1N0b2NrIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuZ2V0TG93U3RvY2tQcm9kdWN0cygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnF1YW50aXR5KS50b0JlTGVzc1RoYW4ocmVzdWx0WzBdLm1pblN0b2NrTGV2ZWwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgbG93IHN0b2NrIGJ5IHRocmVzaG9sZCBwZXJjZW50YWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0xvd1N0b2NrID0gW1xuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiA1LCBtaW5TdG9ja0xldmVsOiAxMCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZExvd1N0b2NrLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb3dTdG9jayBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldExvd1N0b2NrUHJvZHVjdHMoeyB0aHJlc2hvbGQ6IDUwIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0b2NrUGVyY2VudGFnZSkudG9CZUxlc3NUaGFuT3JFcXVhbCg1MCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRPdXRPZlN0b2NrUHJvZHVjdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgcHJvZHVjdHMgd2l0aCB6ZXJvIHN0b2NrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja091dE9mU3RvY2sgPSBbXG4gICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDAgfSxcbiAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZE91dE9mU3RvY2subW9ja1Jlc29sdmVkVmFsdWUobW9ja091dE9mU3RvY2sgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRPdXRPZlN0b2NrUHJvZHVjdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ldmVyeShwID0+IHAucXVhbnRpdHkgPT09IDApKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0TWluU3RvY2tMZXZlbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBtaW5pbXVtIHN0b2NrIGxldmVsIGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIG1pblN0b2NrTGV2ZWw6IDIwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnNldE1pblN0b2NrTGV2ZWwoJ3Byb2QtMScsIDIwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5taW5TdG9ja0xldmVsKS50b0JlKDIwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5lZ2F0aXZlIG1pbmltdW0gc3RvY2sgbGV2ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGludmVudG9yeVNlcnZpY2Uuc2V0TWluU3RvY2tMZXZlbCgncHJvZC0xJywgLTEwKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NldFJlb3JkZXJQb2ludCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCByZW9yZGVyIHBvaW50IGZvciBhdXRvbWF0aWMgcmVzdG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHJlb3JkZXJQb2ludDogMjUsXG4gICAgICAgIHJlb3JkZXJRdWFudGl0eTogMTAwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnNldFJlb3JkZXJQb2ludCgncHJvZC0xJywgMjUsIDEwMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVvcmRlclBvaW50KS50b0JlKDI1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVvcmRlclF1YW50aXR5KS50b0JlKDEwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRJbnZlbnRvcnlIaXN0b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGludmVudG9yeSBhZGp1c3RtZW50IGhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSGlzdG9yeSA9IFtcbiAgICAgICAgeyBpZDogJzEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogNTAsIHJlYXNvbjogJ3Jlc3RvY2snLCBkYXRlOiBuZXcgRGF0ZSgpIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IC01LCByZWFzb246ICdzYWxlJywgZGF0ZTogbmV3IERhdGUoKSB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5SGlzdG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSGlzdG9yeSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldEludmVudG9yeUhpc3RvcnkoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBoaXN0b3J5IGJ5IGRhdGUgcmFuZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgnMjAyNS0wMS0wMScpO1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKCcyMDI1LTAxLTMxJyk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmdldEludmVudG9yeUhpc3RvcnkubW9ja1Jlc29sdmVkVmFsdWUoW10gYXMgYW55KTtcblxuICAgICAgYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRJbnZlbnRvcnlIaXN0b3J5KCdwcm9kLTEnLCB7IHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmdldEludmVudG9yeUhpc3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAncHJvZC0xJyxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGFydERhdGUsIGVuZERhdGUgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWxlYXNlRXhwaXJlZFJlc2VydmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbGVhc2UgYWxsIGV4cGlyZWQgc3RvY2sgcmVzZXJ2YXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0V4cGlyZWQgPSBbXG4gICAgICAgIHsgaWQ6ICdyZXMtMScsIHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiA1IH0sXG4gICAgICAgIHsgaWQ6ICdyZXMtMicsIHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAzIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kRXhwaXJlZFJlc2VydmF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRXhwaXJlZCBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVsZWFzZVJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UucmVsZWFzZUV4cGlyZWRSZXNlcnZhdGlvbnMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWxlYXNlZENvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlbGVhc2VSZXNlcnZhdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U3RvY2tWYWx1ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSB0b3RhbCB2YWx1ZSBvZiBpbnZlbnRvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1Byb2R1Y3QgPSB7XG4gICAgICAgIGlkOiAncHJvZC0xJyxcbiAgICAgICAgcHJpY2U6IDUwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldFN0b2NrVmFsdWUoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDUwMDApOyAvLyAxMDAgKiA1MFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYnVsa1VwZGF0ZUludmVudG9yeScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBpbnZlbnRvcnkgZm9yIG11bHRpcGxlIHByb2R1Y3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlcyA9IFtcbiAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMTAgfSxcbiAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogLTUgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHF1YW50aXR5OiAxMDAgfSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuYnVsa1VwZGF0ZUludmVudG9yeSh1cGRhdGVzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC51cGRhdGVkKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWQpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRJbnZlbnRvcnlUdXJub3ZlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBpbnZlbnRvcnkgdHVybm92ZXIgcmF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5nZXRJbnZlbnRvcnlIaXN0b3J5Lm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBxdWFudGl0eTogLTEwLCBkYXRlOiBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gNSAqIDI0ICogNjAgKiA2MCAqIDEwMDApIH0sXG4gICAgICAgIHsgcXVhbnRpdHk6IC0yMCwgZGF0ZTogbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDEwICogMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgcXVhbnRpdHk6IDUwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldEludmVudG9yeVR1cm5vdmVyKCdwcm9kLTEnLCAzMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxTb2xkKS50b0JlKDMwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHVybm92ZXJSYXRlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmVkaWN0UmVzdG9ja0RhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcmVkaWN0IHdoZW4gcHJvZHVjdCB3aWxsIG5lZWQgcmVzdG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgcmVvcmRlclBvaW50OiAxMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5SGlzdG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgcXVhbnRpdHk6IC0yLCBkYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgICAgeyBxdWFudGl0eTogLTIsIGRhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSAyICogMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgICAgeyBxdWFudGl0eTogLTIsIGRhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzICogMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5wcmVkaWN0UmVzdG9ja0RhdGUoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmVzdGltYXRlZERheXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdG9ja0RhdGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd0cmFuc2ZlclN0b2NrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhbnNmZXIgc3RvY2sgYmV0d2VlbiB3YXJlaG91c2VzL2xvY2F0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRyYW5zZmVyRHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBmcm9tTG9jYXRpb246ICd3YXJlaG91c2UtMScsXG4gICAgICAgIHRvTG9jYXRpb246ICd3YXJlaG91c2UtMicsXG4gICAgICAgIHF1YW50aXR5OiAyMCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGludmVudG9yeVNlcnZpY2UudHJhbnNmZXJTdG9jayh0cmFuc2ZlckR0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWNvcmRBZGp1c3RtZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=