6edcc2b6950d7d3c0e408f15b1bbe4b5
"use strict";
/**
 * TDD: Product Review Service Tests
 *
 * Testing product review and rating functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const review_service_1 = require("./review.service");
const errors_1 = require("@libs/errors");
describe('ReviewService', () => {
    let reviewService;
    let mockReviewRepository;
    let mockProductRepository;
    let mockOrderRepository;
    beforeEach(() => {
        mockReviewRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByProductId: jest.fn(),
            findByUserId: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
            countByProductId: jest.fn(),
            getAverageRating: jest.fn(),
            findVerifiedPurchases: jest.fn(),
            findHelpful: jest.fn(),
            markAsHelpful: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            updateRating: jest.fn(),
        };
        mockOrderRepository = {
            findByUserId: jest.fn(),
            hasUserPurchasedProduct: jest.fn(),
        };
        reviewService = new review_service_1.ReviewService(mockReviewRepository, mockProductRepository, mockOrderRepository);
    });
    describe('createReview', () => {
        it('should create a review for a product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Excellent product!',
                comment: 'This product exceeded my expectations.',
            };
            const mockProduct = { id: 'prod-1', name: 'Test Product' };
            mockProductRepository.findById.mockResolvedValue(mockProduct);
            const mockReview = {
                id: 'review-1',
                ...reviewDto,
                isVerifiedPurchase: false,
                helpfulCount: 0,
                createdAt: new Date(),
            };
            mockReviewRepository.create.mockResolvedValue(mockReview);
            const result = await reviewService.createReview(reviewDto);
            expect(result).toEqual(mockReview);
            expect(mockReviewRepository.create).toHaveBeenCalledWith(expect.objectContaining({
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
            }));
        });
        it('should mark review as verified purchase if user bought the product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great!',
                comment: 'Love it!',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockOrderRepository.hasUserPurchasedProduct.mockResolvedValue(true);
            const mockReview = {
                id: 'review-1',
                ...reviewDto,
                isVerifiedPurchase: true,
            };
            mockReviewRepository.create.mockResolvedValue(mockReview);
            const result = await reviewService.createReview(reviewDto);
            expect(result.isVerifiedPurchase).toBe(true);
        });
        it('should reject review with rating below 1', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 0,
                title: 'Bad',
                comment: 'Terrible',
            };
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow('Rating must be between 1 and 5');
        });
        it('should reject review with rating above 5', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 6,
                title: 'Amazing',
                comment: 'Best ever',
            };
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
        });
        it('should reject review for non-existent product', async () => {
            const reviewDto = {
                productId: 'invalid',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Excellent',
            };
            mockProductRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Product not found'));
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject duplicate review from same user for same product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Love it',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.findByProductId.mockResolvedValue([
                { id: 'existing', userId: 'user-1', productId: 'prod-1' },
            ]);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow('already reviewed');
        });
        it('should update product average rating after review creation', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Excellent',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.create.mockResolvedValue({ id: 'review-1', ...reviewDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            await reviewService.createReview(reviewDto);
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.5);
        });
        it('should allow review with only rating (no comment)', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 4,
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.create.mockResolvedValue({ id: 'review-1', ...reviewDto });
            const result = await reviewService.createReview(reviewDto);
            expect(result.rating).toBe(4);
            expect(result.comment).toBeUndefined();
        });
    });
    describe('getProductReviews', () => {
        it('should get all reviews for a product', async () => {
            const mockReviews = [
                { id: '1', productId: 'prod-1', rating: 5, comment: 'Great' },
                { id: '2', productId: 'prod-1', rating: 4, comment: 'Good' },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1');
            expect(result).toHaveLength(2);
            expect(result[0].rating).toBe(5);
        });
        it('should get reviews with pagination', async () => {
            const mockReviews = Array.from({ length: 10 }, (_, i) => ({
                id: `review-${i}`,
                productId: 'prod-1',
                rating: 5,
            }));
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { page: 1, limit: 5 });
            expect(result).toHaveLength(5);
        });
        it('should filter reviews by minimum rating', async () => {
            const mockReviews = [
                { id: '1', rating: 5 },
                { id: '2', rating: 4 },
                { id: '3', rating: 3 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { minRating: 4 });
            expect(result.every(r => r.rating >= 4)).toBe(true);
        });
        it('should sort reviews by most helpful', async () => {
            const mockReviews = [
                { id: '1', helpfulCount: 10 },
                { id: '2', helpfulCount: 50 },
                { id: '3', helpfulCount: 5 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { sortBy: 'helpful' });
            expect(result[0].helpfulCount).toBeGreaterThan(result[1].helpfulCount);
        });
        it('should get only verified purchase reviews', async () => {
            const mockReviews = [
                { id: '1', isVerifiedPurchase: true },
                { id: '2', isVerifiedPurchase: false },
            ];
            mockReviewRepository.findVerifiedPurchases.mockResolvedValue([mockReviews[0]]);
            const result = await reviewService.getProductReviews('prod-1', { verifiedOnly: true });
            expect(result.every(r => r.isVerifiedPurchase)).toBe(true);
        });
    });
    describe('getUserReviews', () => {
        it('should get all reviews by a user', async () => {
            const mockReviews = [
                { id: '1', userId: 'user-1', productId: 'prod-1' },
                { id: '2', userId: 'user-1', productId: 'prod-2' },
            ];
            mockReviewRepository.findByUserId.mockResolvedValue(mockReviews);
            const result = await reviewService.getUserReviews('user-1');
            expect(result).toHaveLength(2);
        });
    });
    describe('updateReview', () => {
        it('should update a review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
                rating: 4,
                comment: 'Good',
            };
            const updateDto = {
                rating: 5,
                comment: 'Actually, it\'s excellent!',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.update.mockResolvedValue({ ...existingReview, ...updateDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            mockReviewRepository.findByProductId.mockResolvedValue([existingReview]);
            mockProductRepository.updateRating.mockResolvedValue({});
            const result = await reviewService.updateReview('review-1', 'user-1', updateDto);
            expect(result.rating).toBe(5);
            expect(result.comment).toContain('excellent');
        });
        it('should only allow user to update their own review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                rating: 4,
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            const updateDto = {
                rating: 5,
            };
            await expect(reviewService.updateReview('review-1', 'user-2', updateDto)).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should update product rating after review update', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
                rating: 3,
            };
            const updateDto = {
                rating: 5,
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.update.mockResolvedValue({ ...existingReview, ...updateDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.7);
            mockReviewRepository.findByProductId.mockResolvedValue([existingReview]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.updateReview('review-1', 'user-1', updateDto);
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.7, 1);
        });
    });
    describe('deleteReview', () => {
        it('should delete a review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.delete.mockResolvedValue(undefined);
            mockReviewRepository.getAverageRating.mockResolvedValue(4.0);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.deleteReview('review-1', 'user-1');
            expect(mockReviewRepository.delete).toHaveBeenCalledWith('review-1');
        });
        it('should only allow user to delete their own review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            await expect(reviewService.deleteReview('review-1', 'user-2')).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should update product rating after review deletion', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.delete.mockResolvedValue(undefined);
            mockReviewRepository.getAverageRating.mockResolvedValue(4.2);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.deleteReview('review-1', 'user-1');
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.2, 0);
        });
    });
    describe('markReviewAsHelpful', () => {
        it('should mark a review as helpful', async () => {
            const mockReview = {
                id: 'review-1',
                helpfulCount: 5,
            };
            mockReviewRepository.findById.mockResolvedValue(mockReview);
            mockReviewRepository.markAsHelpful.mockResolvedValue(undefined);
            await reviewService.markReviewAsHelpful('review-1', 'user-2');
            expect(mockReviewRepository.markAsHelpful).toHaveBeenCalledWith('review-1', 'user-2');
        });
        it('should prevent user from marking their own review as helpful', async () => {
            const mockReview = {
                id: 'review-1',
                userId: 'user-1',
            };
            mockReviewRepository.findById.mockResolvedValue(mockReview);
            await expect(reviewService.markReviewAsHelpful('review-1', 'user-1')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('getProductRatingDistribution', () => {
        it('should get rating distribution for a product', async () => {
            const mockReviews = [
                { rating: 5 },
                { rating: 5 },
                { rating: 4 },
                { rating: 3 },
                { rating: 1 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductRatingDistribution('prod-1');
            expect(result.fiveStars).toBe(2);
            expect(result.fourStars).toBe(1);
            expect(result.threeStars).toBe(1);
            expect(result.twoStars).toBe(0);
            expect(result.oneStars).toBe(1);
        });
    });
    describe('getAverageRating', () => {
        it('should calculate average rating for a product', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(4.3);
            const result = await reviewService.getAverageRating('prod-1');
            expect(result).toBe(4.3);
        });
        it('should return 0 for product with no reviews', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(0);
            const result = await reviewService.getAverageRating('prod-1');
            expect(result).toBe(0);
        });
    });
    describe('getReviewCount', () => {
        it('should get total review count for a product', async () => {
            mockReviewRepository.countByProductId.mockResolvedValue(42);
            const result = await reviewService.getReviewCount('prod-1');
            expect(result).toBe(42);
        });
    });
    describe('getReviewSummary', () => {
        it('should get complete review summary for a product', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            mockReviewRepository.countByProductId.mockResolvedValue(100);
            mockReviewRepository.findByProductId.mockResolvedValue(Array(100).fill({ rating: 4.5 }));
            const result = await reviewService.getReviewSummary('prod-1');
            expect(result.averageRating).toBe(4.5);
            expect(result.totalReviews).toBe(100);
            expect(result.distribution).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHByb2R1Y3QtY2F0YWxvZ1xcc2VydmljZXNcXHJldmlldy5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgscURBQW1GO0FBSW5GLHlDQUFpRjtBQUVqRixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLGFBQTRCLENBQUM7SUFDakMsSUFBSSxvQkFBbUQsQ0FBQztJQUN4RCxJQUFJLHFCQUFxRCxDQUFDO0lBQzFELElBQUksbUJBQWlELENBQUM7SUFFdEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG9CQUFvQixHQUFHO1lBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hDLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCLENBQUM7UUFFVCxxQkFBcUIsR0FBRztZQUN0QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNqQixDQUFDO1FBRVQsbUJBQW1CLEdBQUc7WUFDcEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdkIsdUJBQXVCLEVB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RSxHQUFHLEVBQUUsQ0FBUSxDQUN4QyxDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFOUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHByb2R1Y3QtY2F0YWxvZ1xcc2VydmljZXNcXHJldmlldy5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUREQ6IFByb2R1Y3QgUmV2aWV3IFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIHByb2R1Y3QgcmV2aWV3IGFuZCByYXRpbmcgZnVuY3Rpb25hbGl0eVxuICovXG5cbmltcG9ydCB7IFJldmlld1NlcnZpY2UsIENyZWF0ZVJldmlld0R0bywgVXBkYXRlUmV2aWV3RHRvIH0gZnJvbSAnLi9yZXZpZXcuc2VydmljZSc7XG5pbXBvcnQgeyBSZXZpZXdSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3Jldmlldy5yZXBvc2l0b3J5JztcbmltcG9ydCB7IFByb2R1Y3RSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBPcmRlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9vcmRlci1wcm9jZXNzaW5nL3JlcG9zaXRvcmllcy9vcmRlci5yZXBvc2l0b3J5JztcbmltcG9ydCB7IEJhZFJlcXVlc3RFcnJvciwgVW5hdXRob3JpemVkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuXG5kZXNjcmliZSgnUmV2aWV3U2VydmljZScsICgpID0+IHtcbiAgbGV0IHJldmlld1NlcnZpY2U6IFJldmlld1NlcnZpY2U7XG4gIGxldCBtb2NrUmV2aWV3UmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8UmV2aWV3UmVwb3NpdG9yeT47XG4gIGxldCBtb2NrUHJvZHVjdFJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tPcmRlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1Jldmlld1JlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeVVzZXJJZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICAgIGNvdW50QnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIGdldEF2ZXJhZ2VSYXRpbmc6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRWZXJpZmllZFB1cmNoYXNlczogamVzdC5mbigpLFxuICAgICAgZmluZEhlbHBmdWw6IGplc3QuZm4oKSxcbiAgICAgIG1hcmtBc0hlbHBmdWw6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVSYXRpbmc6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tPcmRlclJlcG9zaXRvcnkgPSB7XG4gICAgICBmaW5kQnlVc2VySWQ6IGplc3QuZm4oKSxcbiAgICAgIGhhc1VzZXJQdXJjaGFzZWRQcm9kdWN0OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICByZXZpZXdTZXJ2aWNlID0gbmV3IFJldmlld1NlcnZpY2UoXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnlcbiAgICApO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUmV2aWV3JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgcmV2aWV3IGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA1LFxuICAgICAgICB0aXRsZTogJ0V4Y2VsbGVudCBwcm9kdWN0IScsXG4gICAgICAgIGNvbW1lbnQ6ICdUaGlzIHByb2R1Y3QgZXhjZWVkZWQgbXkgZXhwZWN0YXRpb25zLicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUHJvZHVjdCA9IHsgaWQ6ICdwcm9kLTEnLCBuYW1lOiAnVGVzdCBQcm9kdWN0JyB9O1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICAuLi5yZXZpZXdEdG8sXG4gICAgICAgIGlzVmVyaWZpZWRQdXJjaGFzZTogZmFsc2UsXG4gICAgICAgIGhlbHBmdWxDb3VudDogMCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmV2aWV3KTtcbiAgICAgIGV4cGVjdChtb2NrUmV2aWV3UmVwb3NpdG9yeS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICAgIHJhdGluZzogNSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1hcmsgcmV2aWV3IGFzIHZlcmlmaWVkIHB1cmNoYXNlIGlmIHVzZXIgYm91Z2h0IHRoZSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmV2aWV3RHRvOiBDcmVhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNSxcbiAgICAgICAgdGl0bGU6ICdHcmVhdCEnLFxuICAgICAgICBjb21tZW50OiAnTG92ZSBpdCEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdwcm9kLTEnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuaGFzVXNlclB1cmNoYXNlZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICAuLi5yZXZpZXdEdG8sXG4gICAgICAgIGlzVmVyaWZpZWRQdXJjaGFzZTogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWZXJpZmllZFB1cmNoYXNlKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmV2aWV3IHdpdGggcmF0aW5nIGJlbG93IDEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiAwLFxuICAgICAgICB0aXRsZTogJ0JhZCcsXG4gICAgICAgIGNvbW1lbnQ6ICdUZXJyaWJsZScsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QocmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QocmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKSkucmVqZWN0cy50b1Rocm93KCdSYXRpbmcgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJldmlldyB3aXRoIHJhdGluZyBhYm92ZSA1JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmV2aWV3RHRvOiBDcmVhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNixcbiAgICAgICAgdGl0bGU6ICdBbWF6aW5nJyxcbiAgICAgICAgY29tbWVudDogJ0Jlc3QgZXZlcicsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QocmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZXZpZXcgZm9yIG5vbi1leGlzdGVudCBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmV2aWV3RHRvOiBDcmVhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ2ludmFsaWQnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIHRpdGxlOiAnR3JlYXQnLFxuICAgICAgICBjb21tZW50OiAnRXhjZWxsZW50JyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgTm90Rm91bmRFcnJvcignUHJvZHVjdCBub3QgZm91bmQnKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZXZpZXdTZXJ2aWNlLmNyZWF0ZVJldmlldyhyZXZpZXdEdG8pKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBkdXBsaWNhdGUgcmV2aWV3IGZyb20gc2FtZSB1c2VyIGZvciBzYW1lIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA1LFxuICAgICAgICB0aXRsZTogJ0dyZWF0JyxcbiAgICAgICAgY29tbWVudDogJ0xvdmUgaXQnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdwcm9kLTEnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgaWQ6ICdleGlzdGluZycsIHVzZXJJZDogJ3VzZXItMScsIHByb2R1Y3RJZDogJ3Byb2QtMScgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0bykpLnJlamVjdHMudG9UaHJvdygnYWxyZWFkeSByZXZpZXdlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgcHJvZHVjdCBhdmVyYWdlIHJhdGluZyBhZnRlciByZXZpZXcgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA1LFxuICAgICAgICB0aXRsZTogJ0dyZWF0JyxcbiAgICAgICAgY29tbWVudDogJ0V4Y2VsbGVudCcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3Byb2QtMScgfSBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdyZXZpZXctMScsIC4uLnJldmlld0R0byB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuNSk7XG5cbiAgICAgIGF3YWl0IHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJvZC0xJywgNC41KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgcmV2aWV3IHdpdGggb25seSByYXRpbmcgKG5vIGNvbW1lbnQpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmV2aWV3RHRvOiBDcmVhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncHJvZC0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3Jldmlldy0xJywgLi4ucmV2aWV3RHRvIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yYXRpbmcpLnRvQmUoNCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbW1lbnQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2R1Y3RSZXZpZXdzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFsbCByZXZpZXdzIGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmV2aWV3cyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnLCByYXRpbmc6IDUsIGNvbW1lbnQ6ICdHcmVhdCcgfSxcbiAgICAgICAgeyBpZDogJzInLCBwcm9kdWN0SWQ6ICdwcm9kLTEnLCByYXRpbmc6IDQsIGNvbW1lbnQ6ICdHb29kJyB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXdzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0UHJvZHVjdFJldmlld3MoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnJhdGluZykudG9CZSg1KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHJldmlld3Mgd2l0aCBwYWdpbmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGByZXZpZXctJHtpfWAsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHJhdGluZzogNSxcbiAgICAgIH0pKTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXdzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0UHJvZHVjdFJldmlld3MoJ3Byb2QtMScsIHsgcGFnZTogMSwgbGltaXQ6IDUgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCg1KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIHJldmlld3MgYnkgbWluaW11bSByYXRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmV2aWV3cyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCByYXRpbmc6IDUgfSxcbiAgICAgICAgeyBpZDogJzInLCByYXRpbmc6IDQgfSxcbiAgICAgICAgeyBpZDogJzMnLCByYXRpbmc6IDMgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFByb2R1Y3RSZXZpZXdzKCdwcm9kLTEnLCB7IG1pblJhdGluZzogNCB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ldmVyeShyID0+IHIucmF0aW5nID49IDQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzb3J0IHJldmlld3MgYnkgbW9zdCBoZWxwZnVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgaGVscGZ1bENvdW50OiAxMCB9LFxuICAgICAgICB7IGlkOiAnMicsIGhlbHBmdWxDb3VudDogNTAgfSxcbiAgICAgICAgeyBpZDogJzMnLCBoZWxwZnVsQ291bnQ6IDUgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFByb2R1Y3RSZXZpZXdzKCdwcm9kLTEnLCB7IHNvcnRCeTogJ2hlbHBmdWwnIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmhlbHBmdWxDb3VudCkudG9CZUdyZWF0ZXJUaGFuKHJlc3VsdFsxXS5oZWxwZnVsQ291bnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgb25seSB2ZXJpZmllZCBwdXJjaGFzZSByZXZpZXdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgaXNWZXJpZmllZFB1cmNoYXNlOiB0cnVlIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgaXNWZXJpZmllZFB1cmNoYXNlOiBmYWxzZSB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZFZlcmlmaWVkUHVyY2hhc2VzLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrUmV2aWV3c1swXV0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRQcm9kdWN0UmV2aWV3cygncHJvZC0xJywgeyB2ZXJpZmllZE9ubHk6IHRydWUgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZXZlcnkociA9PiByLmlzVmVyaWZpZWRQdXJjaGFzZSkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRVc2VyUmV2aWV3cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgcmV2aWV3cyBieSBhIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmV2aWV3cyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCB1c2VySWQ6ICd1c2VyLTEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgdXNlcklkOiAndXNlci0xJywgcHJvZHVjdElkOiAncHJvZC0yJyB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXdzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0VXNlclJldmlld3MoJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVSZXZpZXcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgYSByZXZpZXcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHJhdGluZzogNCxcbiAgICAgICAgY29tbWVudDogJ0dvb2QnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdXBkYXRlRHRvOiBVcGRhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHJhdGluZzogNSxcbiAgICAgICAgY29tbWVudDogJ0FjdHVhbGx5LCBpdFxcJ3MgZXhjZWxsZW50IScsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1JldmlldyBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4uZXhpc3RpbmdSZXZpZXcsIC4uLnVwZGF0ZUR0byB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuNSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW2V4aXN0aW5nUmV2aWV3XSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLnVwZGF0ZVJldmlldygncmV2aWV3LTEnLCAndXNlci0xJywgdXBkYXRlRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yYXRpbmcpLnRvQmUoNSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbW1lbnQpLnRvQ29udGFpbignZXhjZWxsZW50Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG9ubHkgYWxsb3cgdXNlciB0byB1cGRhdGUgdGhlaXIgb3duIHJldmlldycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmV2aWV3ID0ge1xuICAgICAgICBpZDogJ3Jldmlldy0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA0LFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdSZXZpZXcgYXMgYW55KTtcblxuICAgICAgY29uc3QgdXBkYXRlRHRvOiBVcGRhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHJhdGluZzogNSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcmV2aWV3U2VydmljZS51cGRhdGVSZXZpZXcoJ3Jldmlldy0xJywgJ3VzZXItMicsIHVwZGF0ZUR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHByb2R1Y3QgcmF0aW5nIGFmdGVyIHJldmlldyB1cGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHJhdGluZzogMyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICByYXRpbmc6IDUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1JldmlldyBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4uZXhpc3RpbmdSZXZpZXcsIC4uLnVwZGF0ZUR0byB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuNyk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW2V4aXN0aW5nUmV2aWV3XSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCByZXZpZXdTZXJ2aWNlLnVwZGF0ZVJldmlldygncmV2aWV3LTEnLCAndXNlci0xJywgdXBkYXRlRHRvKTtcblxuICAgICAgZXhwZWN0KG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcm9kLTEnLCA0LjcsIDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVsZXRlUmV2aWV3JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGVsZXRlIGEgcmV2aWV3JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXhpc3RpbmdSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdSZXZpZXcgYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmRlbGV0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjApO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtdIGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IHJldmlld1NlcnZpY2UuZGVsZXRlUmV2aWV3KCdyZXZpZXctMScsICd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXZpZXdSZXBvc2l0b3J5LmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Jldmlldy0xJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG9ubHkgYWxsb3cgdXNlciB0byBkZWxldGUgdGhlaXIgb3duIHJldmlldycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmV2aWV3ID0ge1xuICAgICAgICBpZDogJ3Jldmlldy0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKGV4aXN0aW5nUmV2aWV3IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcmV2aWV3U2VydmljZS5kZWxldGVSZXZpZXcoJ3Jldmlldy0xJywgJ3VzZXItMicpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwcm9kdWN0IHJhdGluZyBhZnRlciByZXZpZXcgZGVsZXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1JldmlldyBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuMik7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW10gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgYXdhaXQgcmV2aWV3U2VydmljZS5kZWxldGVSZXZpZXcoJ3Jldmlldy0xJywgJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QobW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Byb2QtMScsIDQuMiwgMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrUmV2aWV3QXNIZWxwZnVsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFyayBhIHJldmlldyBhcyBoZWxwZnVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIGhlbHBmdWxDb3VudDogNSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXcgYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5Lm1hcmtBc0hlbHBmdWwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgcmV2aWV3U2VydmljZS5tYXJrUmV2aWV3QXNIZWxwZnVsKCdyZXZpZXctMScsICd1c2VyLTInKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXZpZXdSZXBvc2l0b3J5Lm1hcmtBc0hlbHBmdWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdyZXZpZXctMScsICd1c2VyLTInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCB1c2VyIGZyb20gbWFya2luZyB0aGVpciBvd24gcmV2aWV3IGFzIGhlbHBmdWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmV2aWV3ID0ge1xuICAgICAgICBpZDogJ3Jldmlldy0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXcgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICByZXZpZXdTZXJ2aWNlLm1hcmtSZXZpZXdBc0hlbHBmdWwoJ3Jldmlldy0xJywgJ3VzZXItMScpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvZHVjdFJhdGluZ0Rpc3RyaWJ1dGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCByYXRpbmcgZGlzdHJpYnV0aW9uIGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmV2aWV3cyA9IFtcbiAgICAgICAgeyByYXRpbmc6IDUgfSxcbiAgICAgICAgeyByYXRpbmc6IDUgfSxcbiAgICAgICAgeyByYXRpbmc6IDQgfSxcbiAgICAgICAgeyByYXRpbmc6IDMgfSxcbiAgICAgICAgeyByYXRpbmc6IDEgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFByb2R1Y3RSYXRpbmdEaXN0cmlidXRpb24oJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmZpdmVTdGFycykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZm91clN0YXJzKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50aHJlZVN0YXJzKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50d29TdGFycykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub25lU3RhcnMpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBdmVyYWdlUmF0aW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGF2ZXJhZ2UgcmF0aW5nIGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuMyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0QXZlcmFnZVJhdGluZygncHJvZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoNC4zKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDAgZm9yIHByb2R1Y3Qgd2l0aCBubyByZXZpZXdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSgwKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRBdmVyYWdlUmF0aW5nKCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJldmlld0NvdW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHRvdGFsIHJldmlldyBjb3VudCBmb3IgYSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY291bnRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSg0Mik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0UmV2aWV3Q291bnQoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDQyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJldmlld1N1bW1hcnknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgY29tcGxldGUgcmV2aWV3IHN1bW1hcnkgZm9yIGEgcHJvZHVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmdldEF2ZXJhZ2VSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoNC41KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmNvdW50QnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoMTAwKTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgQXJyYXkoMTAwKS5maWxsKHsgcmF0aW5nOiA0LjUgfSkgYXMgYW55XG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFJldmlld1N1bW1hcnkoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmF2ZXJhZ2VSYXRpbmcpLnRvQmUoNC41KTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxSZXZpZXdzKS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmRpc3RyaWJ1dGlvbikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==