ab8319e1813504ddeb2b02238f6c4552
"use strict";
/**
 * Integration Tests: Product Catalog with Analytics
 *
 * Testing how product operations affect analytics and reporting
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../../src/services/product-catalog/repositories/product.repository');
jest.mock('../../../src/services/order-processing/repositories/order.repository');
jest.mock('../../../src/services/user-management/repositories/user.repository');
const product_service_1 = require("../../../src/services/product-catalog/services/product.service");
const analytics_service_1 = require("../../../src/services/analytics/services/analytics.service");
const product_entity_1 = require("../../../src/services/product-catalog/entities/product.entity");
describe('Product and Analytics Integration Tests', () => {
    let productService;
    let analyticsService;
    let mockProductRepository;
    let mockOrderRepository;
    let mockUserRepository;
    beforeEach(() => {
        mockProductRepository = {
            createProduct: jest.fn(),
            findById: jest.fn(),
            updateInventory: jest.fn(),
            incrementSoldCount: jest.fn(),
            findTopSelling: jest.fn(),
            findTopRated: jest.fn(),
            findLowStock: jest.fn(),
            updateRating: jest.fn(),
            count: jest.fn(),
        };
        mockOrderRepository = {
            getTotalRevenue: jest.fn(),
            findOrdersByDateRange: jest.fn(),
            count: jest.fn(),
        };
        mockUserRepository = {
            count: jest.fn(),
            findByStatus: jest.fn(),
        };
        productService = new product_service_1.ProductService(mockProductRepository);
        analyticsService = new analytics_service_1.AnalyticsService(mockOrderRepository, mockProductRepository, mockUserRepository);
    });
    describe('Product Sales Tracking', () => {
        it('should track product views in analytics', async () => {
            const productId = 'prod-track-1';
            const userId = 'user-viewer-1';
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                name: 'Tracked Product',
                sku: 'TRACK-001',
                price: 99.99,
                inventory: 10,
                status: product_entity_1.ProductStatus.ACTIVE,
            });
            // User views product
            await productService.getProductById(productId);
            // Track view event in analytics
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_view',
                productId,
                timestamp: new Date(),
            });
            // Get product performance metrics
            const metrics = await analyticsService.getProductPerformance(productId);
            expect(metrics.views).toBe(1);
        });
        it('should update top selling products when sales occur', async () => {
            const products = [
                { id: 'prod-1', name: 'Bestseller 1', soldCount: 1000, price: 50 },
                { id: 'prod-2', name: 'Bestseller 2', soldCount: 800, price: 60 },
                { id: 'prod-3', name: 'Bestseller 3', soldCount: 600, price: 70 },
            ];
            mockProductRepository.findTopSelling.mockResolvedValue(products);
            const topSelling = await analyticsService.getTopSellingProducts(10);
            expect(topSelling.length).toBe(3);
            expect(topSelling[0].soldCount).toBeGreaterThan(topSelling[1].soldCount);
        });
        it('should track product purchases and update sold count', async () => {
            const productId = 'prod-purchase-1';
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                name: 'Purchase Product',
                soldCount: 50,
            });
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: productId,
                soldCount: 53,
            });
            // Simulate 3 products sold
            await mockProductRepository.incrementSoldCount(productId, 3);
            const updated = await mockProductRepository.findById(productId);
            expect(updated.soldCount).toBeGreaterThan(50);
        });
    });
    describe('Inventory Analytics', () => {
        it('should identify low stock products', async () => {
            const lowStockProducts = [
                { id: 'prod-low-1', name: 'Low Stock 1', inventory: 3 },
                { id: 'prod-low-2', name: 'Low Stock 2', inventory: 5 },
                { id: 'prod-low-3', name: 'Low Stock 3', inventory: 8 },
            ];
            mockProductRepository.findLowStock.mockResolvedValue(lowStockProducts);
            const alerts = await analyticsService.getLowStockAlert(10);
            expect(alerts.length).toBe(3);
            expect(alerts.every(p => p.inventory <= 10)).toBe(true);
        });
        it('should track inventory changes', async () => {
            const productId = 'prod-inventory-1';
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                inventory: 100,
            });
            // Track inventory before order
            const before = await mockProductRepository.findById(productId);
            const initialInventory = before.inventory;
            // Simulate order decreasing inventory
            mockProductRepository.updateInventory.mockResolvedValue({
                id: productId,
                inventory: 95,
            });
            await mockProductRepository.updateInventory(productId, 95);
            // Track inventory after order
            const after = await mockProductRepository.findById(productId);
            expect(after.inventory).toBeLessThan(initialInventory);
        });
    });
    describe('Product Performance Metrics', () => {
        it('should calculate conversion rate for products', async () => {
            const productId = 'prod-conversion-1';
            const views = 1000;
            const purchases = 50;
            // Track views
            for (let i = 0; i < 5; i++) {
                await analyticsService.trackEvent({
                    userId: `user-${i}`,
                    eventType: 'product_view',
                    productId,
                    timestamp: new Date(),
                });
            }
            // Calculate conversion rate
            const conversionRate = await analyticsService.getConversionRate(views, purchases);
            expect(conversionRate).toBe(5); // 50/1000 * 100
        });
        it('should track product revenue', async () => {
            const productId = 'prod-revenue-1';
            // Track product sales events
            await analyticsService.trackEvent({
                userId: 'user-buyer-1',
                eventType: 'product_purchase',
                productId,
                timestamp: new Date(),
                metadata: {
                    quantity: 2,
                    unitPrice: 75.00,
                    revenue: 150.00,
                },
            });
            const metrics = await analyticsService.getProductPerformance(productId);
            expect(metrics).toBeDefined();
        });
    });
    describe('Product Ratings and Reviews', () => {
        it('should update top rated products list', async () => {
            const topRatedProducts = [
                { id: 'prod-rated-1', name: 'Excellent Product', rating: 4.9, reviewCount: 500 },
                { id: 'prod-rated-2', name: 'Great Product', rating: 4.7, reviewCount: 300 },
                { id: 'prod-rated-3', name: 'Good Product', rating: 4.5, reviewCount: 200 },
            ];
            mockProductRepository.findTopRated.mockResolvedValue(topRatedProducts);
            const topRated = await analyticsService.getTopRatedProducts(10);
            expect(topRated.length).toBe(3);
            expect(topRated[0].rating).toBeGreaterThanOrEqual(topRated[1].rating);
        });
        it('should track rating changes', async () => {
            const productId = 'prod-rating-1';
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                rating: 4.0,
                reviewCount: 10,
            });
            // Add new rating
            mockProductRepository.updateRating.mockResolvedValue({
                id: productId,
                rating: 4.2,
                reviewCount: 11,
            });
            await mockProductRepository.updateRating(productId, 4.2, 11);
            const updated = await mockProductRepository.findById(productId);
            expect(updated.rating).toBeGreaterThan(4.0);
            expect(updated.reviewCount).toBe(11);
        });
    });
    describe('Dashboard Metrics Integration', () => {
        it('should aggregate product metrics for dashboard', async () => {
            mockOrderRepository.getTotalRevenue.mockResolvedValue(100000);
            mockOrderRepository.count.mockResolvedValue(500);
            mockUserRepository.count.mockResolvedValue(2000);
            mockProductRepository.count.mockResolvedValue(150);
            const dashboard = await analyticsService.getDashboardMetrics();
            expect(dashboard.totalProducts).toBe(150);
            expect(dashboard.totalRevenue).toBe(100000);
            expect(dashboard.totalOrders).toBe(500);
            expect(dashboard.averageOrderValue).toBe(200);
        });
        it('should include product-specific metrics in reports', async () => {
            mockProductRepository.count.mockResolvedValue(150);
            mockProductRepository.findTopSelling.mockResolvedValue([
                { id: '1', soldCount: 1000 },
                { id: '2', soldCount: 800 },
            ]);
            mockProductRepository.findTopRated.mockResolvedValue([
                { id: '3', rating: 4.9 },
                { id: '4', rating: 4.8 },
            ]);
            mockProductRepository.findLowStock.mockResolvedValue([
                { id: '5', inventory: 3 },
            ]);
            const report = await analyticsService.exportReport('products');
            expect(report.type).toBe('products');
            expect(report.data).toHaveProperty('totalProducts');
            expect(report.data).toHaveProperty('topSelling');
            expect(report.data).toHaveProperty('topRated');
            expect(report.data).toHaveProperty('lowStock');
        });
    });
    describe('Sales Period Analytics', () => {
        it('should track product sales by time period', async () => {
            const mockOrders = [
                {
                    createdAt: new Date('2024-01-15'),
                    total: 100,
                    items: [{ productId: 'prod-1', quantity: 2 }],
                },
                {
                    createdAt: new Date('2024-01-20'),
                    total: 200,
                    items: [{ productId: 'prod-1', quantity: 1 }],
                },
                {
                    createdAt: new Date('2024-02-05'),
                    total: 150,
                    items: [{ productId: 'prod-2', quantity: 3 }],
                },
            ];
            mockOrderRepository.findOrdersByDateRange.mockResolvedValue(mockOrders);
            const metrics = await analyticsService.getSalesMetricsByPeriod('month');
            expect(metrics.length).toBeGreaterThan(0);
            expect(metrics[0]).toHaveProperty('period');
            expect(metrics[0]).toHaveProperty('revenue');
            expect(metrics[0]).toHaveProperty('orderCount');
        });
    });
    describe('Product Lifecycle Analytics', () => {
        it('should track product from creation to first sale', async () => {
            // 1. Create product
            const createDto = {
                name: 'New Product',
                description: 'A brand new product',
                sku: 'NEW-001',
                price: 49.99,
                inventory: 100,
            };
            mockProductRepository.createProduct.mockResolvedValue({
                id: 'prod-new-1',
                ...createDto,
                soldCount: 0,
                status: product_entity_1.ProductStatus.ACTIVE,
                createdAt: new Date(),
            });
            const newProduct = await productService.createProduct(createDto);
            expect(newProduct.soldCount).toBe(0);
            // 2. Track product view
            await analyticsService.trackEvent({
                userId: 'user-1',
                eventType: 'product_view',
                productId: newProduct.id,
                timestamp: new Date(),
            });
            // 3. Simulate first sale
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: 'prod-new-1',
                soldCount: 1,
            });
            await mockProductRepository.incrementSoldCount(newProduct.id, 1);
            // 4. Verify analytics reflect the sale
            const performance = await analyticsService.getProductPerformance(newProduct.id);
            expect(performance.views).toBeGreaterThan(0);
        });
        it('should track product status changes in analytics', async () => {
            const productId = 'prod-status-1';
            // Product starts as DRAFT
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                status: product_entity_1.ProductStatus.DRAFT,
                soldCount: 0,
            });
            let product = await productService.getProductById(productId);
            expect(product.status).toBe(product_entity_1.ProductStatus.DRAFT);
            // Activate product
            mockProductRepository.update = jest.fn().mockResolvedValue({
                id: productId,
                status: product_entity_1.ProductStatus.ACTIVE,
                soldCount: 0,
            });
            await mockProductRepository.update(productId, {
                status: product_entity_1.ProductStatus.ACTIVE,
            });
            // After activation, product should appear in analytics
            mockProductRepository.count.mockResolvedValue(1);
            const totalProducts = await analyticsService.getDashboardMetrics();
            expect(totalProducts.totalProducts).toBeGreaterThan(0);
        });
    });
    describe('Cross-Service Event Tracking', () => {
        it('should track complete purchase funnel', async () => {
            const productId = 'prod-funnel-1';
            const userId = 'user-funnel-1';
            // 1. Product view
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_view',
                productId,
                timestamp: new Date(),
            });
            // 2. Add to cart
            await analyticsService.trackEvent({
                userId,
                eventType: 'add_to_cart',
                productId,
                timestamp: new Date(),
            });
            // 3. Checkout
            await analyticsService.trackEvent({
                userId,
                eventType: 'checkout',
                productId,
                timestamp: new Date(),
            });
            // 4. Purchase
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_purchase',
                productId,
                timestamp: new Date(),
            });
            // Verify all events tracked
            const events = await analyticsService.getEventsByUser(userId);
            expect(events.length).toBe(4);
            expect(events.map(e => e.eventType)).toContain('product_view');
            expect(events.map(e => e.eventType)).toContain('add_to_cart');
            expect(events.map(e => e.eventType)).toContain('checkout');
            expect(events.map(e => e.eventType)).toContain('product_purchase');
        });
        it('should calculate customer lifetime value with product purchases', async () => {
            mockOrderRepository.getTotalRevenue.mockResolvedValue(50000);
            mockUserRepository.count.mockResolvedValue(250);
            const clv = await analyticsService.getCustomerLifetimeValue();
            expect(clv).toBe(200); // 50000 / 250
        });
    });
    describe('Promotional Analytics', () => {
        it('should track sales for discounted products', async () => {
            const saleProducts = [
                {
                    id: 'prod-sale-1',
                    price: 79.99,
                    compareAtPrice: 99.99,
                    soldCount: 100,
                },
                {
                    id: 'prod-sale-2',
                    price: 49.99,
                    compareAtPrice: 69.99,
                    soldCount: 150,
                },
            ];
            mockProductRepository.findOnSale = jest.fn().mockResolvedValue(saleProducts);
            const onSale = await mockProductRepository.findOnSale();
            expect(onSale.length).toBe(2);
            expect(onSale.every(p => p.compareAtPrice > p.price)).toBe(true);
        });
        it('should measure promotion effectiveness', async () => {
            const productId = 'prod-promo-1';
            // Sales before promotion
            const beforeSales = 10;
            // Apply discount
            mockProductRepository.update = jest.fn().mockResolvedValue({
                id: productId,
                price: 59.99,
                compareAtPrice: 79.99,
            });
            // Sales after promotion
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: productId,
                soldCount: 50, // 40 additional sales during promotion
            });
            await mockProductRepository.incrementSoldCount(productId, 40);
            // Promotion increased sales by 400%
            const salesIncrease = ((50 - beforeSales) / beforeSales) * 100;
            expect(salesIncrease).toBe(400);
        });
    });
    describe('Inventory Optimization', () => {
        it('should identify fast-moving products for restocking', async () => {
            const topSelling = [
                { id: 'prod-fast-1', soldCount: 500, inventory: 5 },
                { id: 'prod-fast-2', soldCount: 450, inventory: 8 },
                { id: 'prod-fast-3', soldCount: 400, inventory: 3 },
            ];
            mockProductRepository.findTopSelling.mockResolvedValue(topSelling);
            const fastMoving = await analyticsService.getTopSellingProducts(10);
            // Identify products with high sales but low inventory
            const needRestock = fastMoving.filter(p => p.soldCount > 100 && p.inventory < 10);
            expect(needRestock.length).toBe(3);
        });
        it('should identify slow-moving products', async () => {
            mockProductRepository.findAll = jest.fn().mockResolvedValue([
                { id: 'prod-slow-1', soldCount: 2, inventory: 50, createdAt: new Date('2023-01-01') },
                { id: 'prod-slow-2', soldCount: 1, inventory: 100, createdAt: new Date('2023-01-01') },
            ]);
            const allProducts = await mockProductRepository.findAll();
            // Products with low sales after 1 year
            const slowMoving = allProducts.filter(p => p.soldCount < 5);
            expect(slowMoving.length).toBe(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcc2VydmljZXNcXHByb2R1Y3QtYW5hbHl0aWNzLWludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBU0gsSUFBSSxDQUFDLElBQUksQ0FBQyx1RUFBdUUsQ0FBQyxDQUFDO0FBQ25GLElBQUksQ0FBQyxJQUFJLENBQUMsc0VBQXNFLENBQUMsQ0FBQztBQUNsRixJQUFJLENBQUMsSUFBSSxDQUFDLG9FQUFvRSxDQUFDLENBQUM7QUFUaEYsb0dBQWdHO0FBRWhHLGtHQUE4RjtBQUc5RixrR0FBOEY7QUFNOUYsUUFBUSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtJQUN2RCxJQUFJLGNBQThCLENBQUM7SUFDbkMsSUFBSSxnQkFBa0MsQ0FBQztJQUN2QyxJQUFJLHFCQUFxRCxDQUFDO0lBQzFELElBQUksbUJBQWlELENBQUM7SUFDdEQsSUFBSSxrQkFBK0MsQ0FBQztJQUVwRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QscUJBQXFCLEdBQUc7WUFDdEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN6QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUM0QixDQUFDO1FBRS9DLG1CQUFtQixHQUFHO1lBQ3BCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLHFCQUFxQixFQUFFLElB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O1lBRTFELHVDQUF1QztZQUN2QyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUU1RCxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcc2VydmljZXNcXHByb2R1Y3QtYW5hbHl0aWNzLWludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiBUZXN0czogUHJvZHVjdCBDYXRhbG9nIHdpdGggQW5hbHl0aWNzXG4gKlxuICogVGVzdGluZyBob3cgcHJvZHVjdCBvcGVyYXRpb25zIGFmZmVjdCBhbmFseXRpY3MgYW5kIHJlcG9ydGluZ1xuICovXG5cbmltcG9ydCB7IFByb2R1Y3RTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL3Byb2R1Y3QtY2F0YWxvZy9zZXJ2aWNlcy9wcm9kdWN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJvZHVjdFJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvcHJvZHVjdC1jYXRhbG9nL3JlcG9zaXRvcmllcy9wcm9kdWN0LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQW5hbHl0aWNzU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9hbmFseXRpY3Mvc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3JkZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL29yZGVyLXByb2Nlc3NpbmcvcmVwb3NpdG9yaWVzL29yZGVyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgVXNlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvdXNlci1tYW5hZ2VtZW50L3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUHJvZHVjdFN0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvZW50aXRpZXMvcHJvZHVjdC5lbnRpdHknO1xuXG5qZXN0Lm1vY2soJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeScpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvc2VydmljZXMvb3JkZXItcHJvY2Vzc2luZy9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeScpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvc2VydmljZXMvdXNlci1tYW5hZ2VtZW50L3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknKTtcblxuZGVzY3JpYmUoJ1Byb2R1Y3QgYW5kIEFuYWx5dGljcyBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHByb2R1Y3RTZXJ2aWNlOiBQcm9kdWN0U2VydmljZTtcbiAgbGV0IGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2U7XG4gIGxldCBtb2NrUHJvZHVjdFJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tPcmRlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrVXNlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGVQcm9kdWN0OiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlSW52ZW50b3J5OiBqZXN0LmZuKCksXG4gICAgICBpbmNyZW1lbnRTb2xkQ291bnQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRUb3BTZWxsaW5nOiBqZXN0LmZuKCksXG4gICAgICBmaW5kVG9wUmF0ZWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRMb3dTdG9jazogamVzdC5mbigpLFxuICAgICAgdXBkYXRlUmF0aW5nOiBqZXN0LmZuKCksXG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgIH0gYXMgdW5rbm93biBhcyBqZXN0Lk1vY2tlZDxQcm9kdWN0UmVwb3NpdG9yeT47XG5cbiAgICBtb2NrT3JkZXJSZXBvc2l0b3J5ID0ge1xuICAgICAgZ2V0VG90YWxSZXZlbnVlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kT3JkZXJzQnlEYXRlUmFuZ2U6IGplc3QuZm4oKSxcbiAgICAgIGNvdW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG5cbiAgICBtb2NrVXNlclJlcG9zaXRvcnkgPSB7XG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5U3RhdHVzOiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICAgIHByb2R1Y3RTZXJ2aWNlID0gbmV3IFByb2R1Y3RTZXJ2aWNlKG1vY2tQcm9kdWN0UmVwb3NpdG9yeSk7XG4gICAgYW5hbHl0aWNzU2VydmljZSA9IG5ldyBBbmFseXRpY3NTZXJ2aWNlKFxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeVxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm9kdWN0IFNhbGVzIFRyYWNraW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCB2aWV3cyBpbiBhbmFseXRpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC10cmFjay0xJztcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLXZpZXdlci0xJztcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgbmFtZTogJ1RyYWNrZWQgUHJvZHVjdCcsXG4gICAgICAgIHNrdTogJ1RSQUNLLTAwMScsXG4gICAgICAgIHByaWNlOiA5OS45OSxcbiAgICAgICAgaW52ZW50b3J5OiAxMCxcbiAgICAgICAgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFDVElWRSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gVXNlciB2aWV3cyBwcm9kdWN0XG4gICAgICBhd2FpdCBwcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlJZChwcm9kdWN0SWQpO1xuXG4gICAgICAvLyBUcmFjayB2aWV3IGV2ZW50IGluIGFuYWx5dGljc1xuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3ZpZXcnLFxuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBHZXQgcHJvZHVjdCBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRQcm9kdWN0UGVyZm9ybWFuY2UocHJvZHVjdElkKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3Mudmlld3MpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB0b3Agc2VsbGluZyBwcm9kdWN0cyB3aGVuIHNhbGVzIG9jY3VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdHMgPSBbXG4gICAgICAgIHsgaWQ6ICdwcm9kLTEnLCBuYW1lOiAnQmVzdHNlbGxlciAxJywgc29sZENvdW50OiAxMDAwLCBwcmljZTogNTAgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtMicsIG5hbWU6ICdCZXN0c2VsbGVyIDInLCBzb2xkQ291bnQ6IDgwMCwgcHJpY2U6IDYwIH0sXG4gICAgICAgIHsgaWQ6ICdwcm9kLTMnLCBuYW1lOiAnQmVzdHNlbGxlciAzJywgc29sZENvdW50OiA2MDAsIHByaWNlOiA3MCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRUb3BTZWxsaW5nLm1vY2tSZXNvbHZlZFZhbHVlKHByb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHRvcFNlbGxpbmcgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFRvcFNlbGxpbmdQcm9kdWN0cygxMCk7XG5cbiAgICAgIGV4cGVjdCh0b3BTZWxsaW5nLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdCh0b3BTZWxsaW5nWzBdLnNvbGRDb3VudCkudG9CZUdyZWF0ZXJUaGFuKHRvcFNlbGxpbmdbMV0uc29sZENvdW50KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCBwdXJjaGFzZXMgYW5kIHVwZGF0ZSBzb2xkIGNvdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gJ3Byb2QtcHVyY2hhc2UtMSc7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiBwcm9kdWN0SWQsXG4gICAgICAgIG5hbWU6ICdQdXJjaGFzZSBQcm9kdWN0JyxcbiAgICAgICAgc29sZENvdW50OiA1MCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmluY3JlbWVudFNvbGRDb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiBwcm9kdWN0SWQsXG4gICAgICAgIHNvbGRDb3VudDogNTMsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIDMgcHJvZHVjdHMgc29sZFxuICAgICAgYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmluY3JlbWVudFNvbGRDb3VudChwcm9kdWN0SWQsIDMpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkKHByb2R1Y3RJZCk7XG4gICAgICBleHBlY3QodXBkYXRlZC5zb2xkQ291bnQpLnRvQmVHcmVhdGVyVGhhbig1MCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnZlbnRvcnkgQW5hbHl0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgbG93IHN0b2NrIHByb2R1Y3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG93U3RvY2tQcm9kdWN0cyA9IFtcbiAgICAgICAgeyBpZDogJ3Byb2QtbG93LTEnLCBuYW1lOiAnTG93IFN0b2NrIDEnLCBpbnZlbnRvcnk6IDMgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtbG93LTInLCBuYW1lOiAnTG93IFN0b2NrIDInLCBpbnZlbnRvcnk6IDUgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtbG93LTMnLCBuYW1lOiAnTG93IFN0b2NrIDMnLCBpbnZlbnRvcnk6IDggfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kTG93U3RvY2subW9ja1Jlc29sdmVkVmFsdWUobG93U3RvY2tQcm9kdWN0cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBhbGVydHMgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldExvd1N0b2NrQWxlcnQoMTApO1xuXG4gICAgICBleHBlY3QoYWxlcnRzLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChhbGVydHMuZXZlcnkocCA9PiBwLmludmVudG9yeSA8PSAxMCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYWNrIGludmVudG9yeSBjaGFuZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gJ3Byb2QtaW52ZW50b3J5LTEnO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICBpbnZlbnRvcnk6IDEwMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gVHJhY2sgaW52ZW50b3J5IGJlZm9yZSBvcmRlclxuICAgICAgY29uc3QgYmVmb3JlID0gYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkKHByb2R1Y3RJZCk7XG4gICAgICBjb25zdCBpbml0aWFsSW52ZW50b3J5ID0gYmVmb3JlLmludmVudG9yeTtcblxuICAgICAgLy8gU2ltdWxhdGUgb3JkZXIgZGVjcmVhc2luZyBpbnZlbnRvcnlcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVJbnZlbnRvcnkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICBpbnZlbnRvcnk6IDk1LFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlSW52ZW50b3J5KHByb2R1Y3RJZCwgOTUpO1xuXG4gICAgICAvLyBUcmFjayBpbnZlbnRvcnkgYWZ0ZXIgb3JkZXJcbiAgICAgIGNvbnN0IGFmdGVyID0gYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkKHByb2R1Y3RJZCk7XG5cbiAgICAgIGV4cGVjdChhZnRlci5pbnZlbnRvcnkpLnRvQmVMZXNzVGhhbihpbml0aWFsSW52ZW50b3J5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Byb2R1Y3QgUGVyZm9ybWFuY2UgTWV0cmljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb252ZXJzaW9uIHJhdGUgZm9yIHByb2R1Y3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gJ3Byb2QtY29udmVyc2lvbi0xJztcbiAgICAgIGNvbnN0IHZpZXdzID0gMTAwMDtcbiAgICAgIGNvbnN0IHB1cmNoYXNlcyA9IDUwO1xuXG4gICAgICAvLyBUcmFjayB2aWV3c1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgICB1c2VySWQ6IGB1c2VyLSR7aX1gLFxuICAgICAgICAgIGV2ZW50VHlwZTogJ3Byb2R1Y3RfdmlldycsXG4gICAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBjb252ZXJzaW9uIHJhdGVcbiAgICAgIGNvbnN0IGNvbnZlcnNpb25SYXRlID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRDb252ZXJzaW9uUmF0ZSh2aWV3cywgcHVyY2hhc2VzKTtcblxuICAgICAgZXhwZWN0KGNvbnZlcnNpb25SYXRlKS50b0JlKDUpOyAvLyA1MC8xMDAwICogMTAwXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYWNrIHByb2R1Y3QgcmV2ZW51ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9ICdwcm9kLXJldmVudWUtMSc7XG5cbiAgICAgIC8vIFRyYWNrIHByb2R1Y3Qgc2FsZXMgZXZlbnRzXG4gICAgICBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLnRyYWNrRXZlbnQoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLWJ1eWVyLTEnLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3B1cmNoYXNlJyxcbiAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgcXVhbnRpdHk6IDIsXG4gICAgICAgICAgdW5pdFByaWNlOiA3NS4wMCxcbiAgICAgICAgICByZXZlbnVlOiAxNTAuMDAsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0UHJvZHVjdFBlcmZvcm1hbmNlKHByb2R1Y3RJZCk7XG4gICAgICBleHBlY3QobWV0cmljcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Byb2R1Y3QgUmF0aW5ncyBhbmQgUmV2aWV3cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB0b3AgcmF0ZWQgcHJvZHVjdHMgbGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRvcFJhdGVkUHJvZHVjdHMgPSBbXG4gICAgICAgIHsgaWQ6ICdwcm9kLXJhdGVkLTEnLCBuYW1lOiAnRXhjZWxsZW50IFByb2R1Y3QnLCByYXRpbmc6IDQuOSwgcmV2aWV3Q291bnQ6IDUwMCB9LFxuICAgICAgICB7IGlkOiAncHJvZC1yYXRlZC0yJywgbmFtZTogJ0dyZWF0IFByb2R1Y3QnLCByYXRpbmc6IDQuNywgcmV2aWV3Q291bnQ6IDMwMCB9LFxuICAgICAgICB7IGlkOiAncHJvZC1yYXRlZC0zJywgbmFtZTogJ0dvb2QgUHJvZHVjdCcsIHJhdGluZzogNC41LCByZXZpZXdDb3VudDogMjAwIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZFRvcFJhdGVkLm1vY2tSZXNvbHZlZFZhbHVlKHRvcFJhdGVkUHJvZHVjdHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgdG9wUmF0ZWQgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFRvcFJhdGVkUHJvZHVjdHMoMTApO1xuXG4gICAgICBleHBlY3QodG9wUmF0ZWQubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHRvcFJhdGVkWzBdLnJhdGluZykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCh0b3BSYXRlZFsxXS5yYXRpbmcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFjayByYXRpbmcgY2hhbmdlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9ICdwcm9kLXJhdGluZy0xJztcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgcmF0aW5nOiA0LjAsXG4gICAgICAgIHJldmlld0NvdW50OiAxMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gQWRkIG5ldyByYXRpbmdcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICByYXRpbmc6IDQuMixcbiAgICAgICAgcmV2aWV3Q291bnQ6IDExLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nKHByb2R1Y3RJZCwgNC4yLCAxMSk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQocHJvZHVjdElkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkLnJhdGluZykudG9CZUdyZWF0ZXJUaGFuKDQuMCk7XG4gICAgICBleHBlY3QodXBkYXRlZC5yZXZpZXdDb3VudCkudG9CZSgxMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEYXNoYm9hcmQgTWV0cmljcyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFnZ3JlZ2F0ZSBwcm9kdWN0IG1ldHJpY3MgZm9yIGRhc2hib2FyZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZ2V0VG90YWxSZXZlbnVlLm1vY2tSZXNvbHZlZFZhbHVlKDEwMDAwMCk7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDUwMCk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMjAwMCk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMTUwKTtcblxuICAgICAgY29uc3QgZGFzaGJvYXJkID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXREYXNoYm9hcmRNZXRyaWNzKCk7XG5cbiAgICAgIGV4cGVjdChkYXNoYm9hcmQudG90YWxQcm9kdWN0cykudG9CZSgxNTApO1xuICAgICAgZXhwZWN0KGRhc2hib2FyZC50b3RhbFJldmVudWUpLnRvQmUoMTAwMDAwKTtcbiAgICAgIGV4cGVjdChkYXNoYm9hcmQudG90YWxPcmRlcnMpLnRvQmUoNTAwKTtcbiAgICAgIGV4cGVjdChkYXNoYm9hcmQuYXZlcmFnZU9yZGVyVmFsdWUpLnRvQmUoMjAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBwcm9kdWN0LXNwZWNpZmljIG1ldHJpY3MgaW4gcmVwb3J0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxNTApO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRUb3BTZWxsaW5nLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBpZDogJzEnLCBzb2xkQ291bnQ6IDEwMDAgfSxcbiAgICAgICAgeyBpZDogJzInLCBzb2xkQ291bnQ6IDgwMCB9LFxuICAgICAgXSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRUb3BSYXRlZC5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgaWQ6ICczJywgcmF0aW5nOiA0LjkgfSxcbiAgICAgICAgeyBpZDogJzQnLCByYXRpbmc6IDQuOCB9LFxuICAgICAgXSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRMb3dTdG9jay5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgaWQ6ICc1JywgaW52ZW50b3J5OiAzIH0sXG4gICAgICBdIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZXhwb3J0UmVwb3J0KCdwcm9kdWN0cycpO1xuXG4gICAgICBleHBlY3QocmVwb3J0LnR5cGUpLnRvQmUoJ3Byb2R1Y3RzJyk7XG4gICAgICBleHBlY3QocmVwb3J0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbFByb2R1Y3RzJyk7XG4gICAgICBleHBlY3QocmVwb3J0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd0b3BTZWxsaW5nJyk7XG4gICAgICBleHBlY3QocmVwb3J0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd0b3BSYXRlZCcpO1xuICAgICAgZXhwZWN0KHJlcG9ydC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgnbG93U3RvY2snKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NhbGVzIFBlcmlvZCBBbmFseXRpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBwcm9kdWN0IHNhbGVzIGJ5IHRpbWUgcGVyaW9kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVycyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgICB0b3RhbDogMTAwLFxuICAgICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMiB9XSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMjAnKSxcbiAgICAgICAgICB0b3RhbDogMjAwLFxuICAgICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDItMDUnKSxcbiAgICAgICAgICB0b3RhbDogMTUwLFxuICAgICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMyB9XSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZE9yZGVyc0J5RGF0ZVJhbmdlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcnMgYXMgYW55KTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0U2FsZXNNZXRyaWNzQnlQZXJpb2QoJ21vbnRoJyk7XG5cbiAgICAgIGV4cGVjdChtZXRyaWNzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0pLnRvSGF2ZVByb3BlcnR5KCdwZXJpb2QnKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzWzBdKS50b0hhdmVQcm9wZXJ0eSgncmV2ZW51ZScpO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0pLnRvSGF2ZVByb3BlcnR5KCdvcmRlckNvdW50Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm9kdWN0IExpZmVjeWNsZSBBbmFseXRpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBwcm9kdWN0IGZyb20gY3JlYXRpb24gdG8gZmlyc3Qgc2FsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIDEuIENyZWF0ZSBwcm9kdWN0XG4gICAgICBjb25zdCBjcmVhdGVEdG8gPSB7XG4gICAgICAgIG5hbWU6ICdOZXcgUHJvZHVjdCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQSBicmFuZCBuZXcgcHJvZHVjdCcsXG4gICAgICAgIHNrdTogJ05FVy0wMDEnLFxuICAgICAgICBwcmljZTogNDkuOTksXG4gICAgICAgIGludmVudG9yeTogMTAwLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmNyZWF0ZVByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Byb2QtbmV3LTEnLFxuICAgICAgICAuLi5jcmVhdGVEdG8sXG4gICAgICAgIHNvbGRDb3VudDogMCxcbiAgICAgICAgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFDVElWRSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBuZXdQcm9kdWN0ID0gYXdhaXQgcHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdChjcmVhdGVEdG8pO1xuICAgICAgZXhwZWN0KG5ld1Byb2R1Y3Quc29sZENvdW50KS50b0JlKDApO1xuXG4gICAgICAvLyAyLiBUcmFjayBwcm9kdWN0IHZpZXdcbiAgICAgIGF3YWl0IGFuYWx5dGljc1NlcnZpY2UudHJhY2tFdmVudCh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIGV2ZW50VHlwZTogJ3Byb2R1Y3RfdmlldycsXG4gICAgICAgIHByb2R1Y3RJZDogbmV3UHJvZHVjdC5pZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDMuIFNpbXVsYXRlIGZpcnN0IHNhbGVcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5pbmNyZW1lbnRTb2xkQ291bnQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Byb2QtbmV3LTEnLFxuICAgICAgICBzb2xkQ291bnQ6IDEsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5pbmNyZW1lbnRTb2xkQ291bnQobmV3UHJvZHVjdC5pZCwgMSk7XG5cbiAgICAgIC8vIDQuIFZlcmlmeSBhbmFseXRpY3MgcmVmbGVjdCB0aGUgc2FsZVxuICAgICAgY29uc3QgcGVyZm9ybWFuY2UgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFByb2R1Y3RQZXJmb3JtYW5jZShuZXdQcm9kdWN0LmlkKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS52aWV3cykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBwcm9kdWN0IHN0YXR1cyBjaGFuZ2VzIGluIGFuYWx5dGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9ICdwcm9kLXN0YXR1cy0xJztcblxuICAgICAgLy8gUHJvZHVjdCBzdGFydHMgYXMgRFJBRlRcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiBwcm9kdWN0SWQsXG4gICAgICAgIHN0YXR1czogUHJvZHVjdFN0YXR1cy5EUkFGVCxcbiAgICAgICAgc29sZENvdW50OiAwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBsZXQgcHJvZHVjdCA9IGF3YWl0IHByb2R1Y3RTZXJ2aWNlLmdldFByb2R1Y3RCeUlkKHByb2R1Y3RJZCk7XG4gICAgICBleHBlY3QocHJvZHVjdC5zdGF0dXMpLnRvQmUoUHJvZHVjdFN0YXR1cy5EUkFGVCk7XG5cbiAgICAgIC8vIEFjdGl2YXRlIHByb2R1Y3RcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICBzdGF0dXM6IFByb2R1Y3RTdGF0dXMuQUNUSVZFLFxuICAgICAgICBzb2xkQ291bnQ6IDAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGUocHJvZHVjdElkLCB7XG4gICAgICAgIHN0YXR1czogUHJvZHVjdFN0YXR1cy5BQ1RJVkUsXG4gICAgICB9KTtcblxuICAgICAgLy8gQWZ0ZXIgYWN0aXZhdGlvbiwgcHJvZHVjdCBzaG91bGQgYXBwZWFyIGluIGFuYWx5dGljc1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDEpO1xuICAgICAgY29uc3QgdG90YWxQcm9kdWN0cyA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0RGFzaGJvYXJkTWV0cmljcygpO1xuICAgICAgZXhwZWN0KHRvdGFsUHJvZHVjdHMudG90YWxQcm9kdWN0cykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ3Jvc3MtU2VydmljZSBFdmVudCBUcmFja2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIGNvbXBsZXRlIHB1cmNoYXNlIGZ1bm5lbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9ICdwcm9kLWZ1bm5lbC0xJztcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLWZ1bm5lbC0xJztcblxuICAgICAgLy8gMS4gUHJvZHVjdCB2aWV3XG4gICAgICBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLnRyYWNrRXZlbnQoe1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGV2ZW50VHlwZTogJ3Byb2R1Y3RfdmlldycsXG4gICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDIuIEFkZCB0byBjYXJ0XG4gICAgICBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLnRyYWNrRXZlbnQoe1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGV2ZW50VHlwZTogJ2FkZF90b19jYXJ0JyxcbiAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgLy8gMy4gQ2hlY2tvdXRcbiAgICAgIGF3YWl0IGFuYWx5dGljc1NlcnZpY2UudHJhY2tFdmVudCh7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgZXZlbnRUeXBlOiAnY2hlY2tvdXQnLFxuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyA0LiBQdXJjaGFzZVxuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3B1cmNoYXNlJyxcbiAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZ5IGFsbCBldmVudHMgdHJhY2tlZFxuICAgICAgY29uc3QgZXZlbnRzID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRFdmVudHNCeVVzZXIodXNlcklkKTtcbiAgICAgIGV4cGVjdChldmVudHMubGVuZ3RoKS50b0JlKDQpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5tYXAoZSA9PiBlLmV2ZW50VHlwZSkpLnRvQ29udGFpbigncHJvZHVjdF92aWV3Jyk7XG4gICAgICBleHBlY3QoZXZlbnRzLm1hcChlID0+IGUuZXZlbnRUeXBlKSkudG9Db250YWluKCdhZGRfdG9fY2FydCcpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5tYXAoZSA9PiBlLmV2ZW50VHlwZSkpLnRvQ29udGFpbignY2hlY2tvdXQnKTtcbiAgICAgIGV4cGVjdChldmVudHMubWFwKGUgPT4gZS5ldmVudFR5cGUpKS50b0NvbnRhaW4oJ3Byb2R1Y3RfcHVyY2hhc2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGN1c3RvbWVyIGxpZmV0aW1lIHZhbHVlIHdpdGggcHJvZHVjdCBwdXJjaGFzZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmdldFRvdGFsUmV2ZW51ZS5tb2NrUmVzb2x2ZWRWYWx1ZSg1MDAwMCk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMjUwKTtcblxuICAgICAgY29uc3QgY2x2ID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRDdXN0b21lckxpZmV0aW1lVmFsdWUoKTtcblxuICAgICAgZXhwZWN0KGNsdikudG9CZSgyMDApOyAvLyA1MDAwMCAvIDI1MFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUHJvbW90aW9uYWwgQW5hbHl0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgc2FsZXMgZm9yIGRpc2NvdW50ZWQgcHJvZHVjdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzYWxlUHJvZHVjdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ3Byb2Qtc2FsZS0xJyxcbiAgICAgICAgICBwcmljZTogNzkuOTksXG4gICAgICAgICAgY29tcGFyZUF0UHJpY2U6IDk5Ljk5LFxuICAgICAgICAgIHNvbGRDb3VudDogMTAwLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwcm9kLXNhbGUtMicsXG4gICAgICAgICAgcHJpY2U6IDQ5Ljk5LFxuICAgICAgICAgIGNvbXBhcmVBdFByaWNlOiA2OS45OSxcbiAgICAgICAgICBzb2xkQ291bnQ6IDE1MCxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kT25TYWxlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHNhbGVQcm9kdWN0cyk7XG5cbiAgICAgIGNvbnN0IG9uU2FsZSA9IGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kT25TYWxlKCk7XG5cbiAgICAgIGV4cGVjdChvblNhbGUubGVuZ3RoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KG9uU2FsZS5ldmVyeShwID0+IHAuY29tcGFyZUF0UHJpY2UhID4gcC5wcmljZSkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1lYXN1cmUgcHJvbW90aW9uIGVmZmVjdGl2ZW5lc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1wcm9tby0xJztcblxuICAgICAgLy8gU2FsZXMgYmVmb3JlIHByb21vdGlvblxuICAgICAgY29uc3QgYmVmb3JlU2FsZXMgPSAxMDtcblxuICAgICAgLy8gQXBwbHkgZGlzY291bnRcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICBwcmljZTogNTkuOTksXG4gICAgICAgIGNvbXBhcmVBdFByaWNlOiA3OS45OSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gU2FsZXMgYWZ0ZXIgcHJvbW90aW9uXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgc29sZENvdW50OiA1MCwgLy8gNDAgYWRkaXRpb25hbCBzYWxlcyBkdXJpbmcgcHJvbW90aW9uXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5pbmNyZW1lbnRTb2xkQ291bnQocHJvZHVjdElkLCA0MCk7XG5cbiAgICAgIC8vIFByb21vdGlvbiBpbmNyZWFzZWQgc2FsZXMgYnkgNDAwJVxuICAgICAgY29uc3Qgc2FsZXNJbmNyZWFzZSA9ICgoNTAgLSBiZWZvcmVTYWxlcykgLyBiZWZvcmVTYWxlcykgKiAxMDA7XG4gICAgICBleHBlY3Qoc2FsZXNJbmNyZWFzZSkudG9CZSg0MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW52ZW50b3J5IE9wdGltaXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGlkZW50aWZ5IGZhc3QtbW92aW5nIHByb2R1Y3RzIGZvciByZXN0b2NraW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9wU2VsbGluZyA9IFtcbiAgICAgICAgeyBpZDogJ3Byb2QtZmFzdC0xJywgc29sZENvdW50OiA1MDAsIGludmVudG9yeTogNSB9LFxuICAgICAgICB7IGlkOiAncHJvZC1mYXN0LTInLCBzb2xkQ291bnQ6IDQ1MCwgaW52ZW50b3J5OiA4IH0sXG4gICAgICAgIHsgaWQ6ICdwcm9kLWZhc3QtMycsIHNvbGRDb3VudDogNDAwLCBpbnZlbnRvcnk6IDMgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kVG9wU2VsbGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh0b3BTZWxsaW5nIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGZhc3RNb3ZpbmcgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFRvcFNlbGxpbmdQcm9kdWN0cygxMCk7XG5cbiAgICAgIC8vIElkZW50aWZ5IHByb2R1Y3RzIHdpdGggaGlnaCBzYWxlcyBidXQgbG93IGludmVudG9yeVxuICAgICAgY29uc3QgbmVlZFJlc3RvY2sgPSBmYXN0TW92aW5nLmZpbHRlcihcbiAgICAgICAgcCA9PiBwLnNvbGRDb3VudCA+IDEwMCAmJiBwLmludmVudG9yeSA8IDEwXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobmVlZFJlc3RvY2subGVuZ3RoKS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpZGVudGlmeSBzbG93LW1vdmluZyBwcm9kdWN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQWxsID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBpZDogJ3Byb2Qtc2xvdy0xJywgc29sZENvdW50OiAyLCBpbnZlbnRvcnk6IDUwLCBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDIzLTAxLTAxJykgfSxcbiAgICAgICAgeyBpZDogJ3Byb2Qtc2xvdy0yJywgc29sZENvdW50OiAxLCBpbnZlbnRvcnk6IDEwMCwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyMy0wMS0wMScpIH0sXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgYWxsUHJvZHVjdHMgPSBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEFsbCgpO1xuXG4gICAgICAvLyBQcm9kdWN0cyB3aXRoIGxvdyBzYWxlcyBhZnRlciAxIHllYXJcbiAgICAgIGNvbnN0IHNsb3dNb3ZpbmcgPSBhbGxQcm9kdWN0cy5maWx0ZXIocCA9PiBwLnNvbGRDb3VudCA8IDUpO1xuXG4gICAgICBleHBlY3Qoc2xvd01vdmluZy5sZW5ndGgpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=