57ff5cf56ee6d77eeb72c158eb0953d8
"use strict";
/**
 * TDD: Wishlist Service Tests
 *
 * Testing wishlist/favorites functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const wishlist_service_1 = require("./wishlist.service");
const errors_1 = require("@libs/errors");
describe('WishlistService', () => {
    let wishlistService;
    let mockWishlistRepository;
    let mockProductRepository;
    beforeEach(() => {
        mockWishlistRepository = {
            create: jest.fn(),
            findByUserId: jest.fn(),
            findByUserAndProduct: jest.fn(),
            delete: jest.fn(),
            deleteAllByUserId: jest.fn(),
            countByUserId: jest.fn(),
            moveToCart: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            findByIds: jest.fn(),
        };
        wishlistService = new wishlist_service_1.WishlistService(mockWishlistRepository, mockProductRepository);
    });
    describe('addToWishlist', () => {
        it('should add a product to user wishlist', async () => {
            const addDto = {
                userId: 'user-1',
                productId: 'prod-1',
            };
            const mockProduct = {
                id: 'prod-1',
                name: 'Test Product',
                price: 99.99,
            };
            mockProductRepository.findById.mockResolvedValue(mockProduct);
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(null);
            const mockWishlistItem = {
                id: 'wishlist-1',
                ...addDto,
                createdAt: new Date(),
            };
            mockWishlistRepository.create.mockResolvedValue(mockWishlistItem);
            const result = await wishlistService.addToWishlist(addDto);
            expect(result).toEqual(mockWishlistItem);
            expect(mockWishlistRepository.create).toHaveBeenCalled();
        });
        it('should reject adding non-existent product to wishlist', async () => {
            const addDto = {
                userId: 'user-1',
                productId: 'invalid',
            };
            mockProductRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Product not found'));
            await expect(wishlistService.addToWishlist(addDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject adding duplicate product to wishlist', async () => {
            const addDto = {
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue({
                id: 'existing',
                userId: 'user-1',
                productId: 'prod-1',
            });
            await expect(wishlistService.addToWishlist(addDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(wishlistService.addToWishlist(addDto)).rejects.toThrow('already in wishlist');
        });
        it('should add product with note', async () => {
            const addDto = {
                userId: 'user-1',
                productId: 'prod-1',
                note: 'Gift for birthday',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(null);
            mockWishlistRepository.create.mockResolvedValue({
                id: 'wishlist-1',
                ...addDto,
            });
            const result = await wishlistService.addToWishlist(addDto);
            expect(result.note).toBe('Gift for birthday');
        });
    });
    describe('getWishlist', () => {
        it('should get user wishlist with product details', async () => {
            const mockWishlistItems = [
                { id: '1', userId: 'user-1', productId: 'prod-1', createdAt: new Date() },
                { id: '2', userId: 'user-1', productId: 'prod-2', createdAt: new Date() },
            ];
            const mockProducts = [
                { id: 'prod-1', name: 'Product 1', price: 50 },
                { id: 'prod-2', name: 'Product 2', price: 100 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getWishlist('user-1');
            expect(result).toHaveLength(2);
            expect(result[0].product).toBeDefined();
            expect(result[0].product.name).toBe('Product 1');
        });
        it('should return empty array for user with no wishlist items', async () => {
            mockWishlistRepository.findByUserId.mockResolvedValue([]);
            const result = await wishlistService.getWishlist('user-1');
            expect(result).toEqual([]);
        });
        it('should sort wishlist by most recently added', async () => {
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            const mockWishlistItems = [
                { id: '1', productId: 'prod-1', createdAt: yesterday },
                { id: '2', productId: 'prod-2', createdAt: now },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue([
                { id: 'prod-1' },
                { id: 'prod-2' },
            ]);
            const result = await wishlistService.getWishlist('user-1', { sortBy: 'recent' });
            expect(result[0].createdAt.getTime()).toBeGreaterThan(result[1].createdAt.getTime());
        });
        it('should filter wishlist by price range', async () => {
            const mockWishlistItems = [
                { id: '1', productId: 'prod-1' },
                { id: '2', productId: 'prod-2' },
            ];
            const mockProducts = [
                { id: 'prod-1', price: 50 },
                { id: 'prod-2', price: 150 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getWishlist('user-1', {
                minPrice: 0,
                maxPrice: 100,
            });
            expect(result.every(item => item.product.price <= 100)).toBe(true);
        });
    });
    describe('removeFromWishlist', () => {
        it('should remove a product from wishlist', async () => {
            const mockWishlistItem = {
                id: 'wishlist-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(mockWishlistItem);
            mockWishlistRepository.delete.mockResolvedValue(undefined);
            await wishlistService.removeFromWishlist('user-1', 'prod-1');
            expect(mockWishlistRepository.delete).toHaveBeenCalledWith('wishlist-1');
        });
        it('should throw error when removing non-existent wishlist item', async () => {
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(null);
            await expect(wishlistService.removeFromWishlist('user-1', 'prod-1')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    describe('clearWishlist', () => {
        it('should remove all items from user wishlist', async () => {
            mockWishlistRepository.deleteAllByUserId.mockResolvedValue(undefined);
            await wishlistService.clearWishlist('user-1');
            expect(mockWishlistRepository.deleteAllByUserId).toHaveBeenCalledWith('user-1');
        });
    });
    describe('getWishlistCount', () => {
        it('should get total items in user wishlist', async () => {
            mockWishlistRepository.countByUserId.mockResolvedValue(5);
            const result = await wishlistService.getWishlistCount('user-1');
            expect(result).toBe(5);
        });
    });
    describe('isInWishlist', () => {
        it('should return true if product is in wishlist', async () => {
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue({
                id: 'wishlist-1',
            });
            const result = await wishlistService.isInWishlist('user-1', 'prod-1');
            expect(result).toBe(true);
        });
        it('should return false if product is not in wishlist', async () => {
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(null);
            const result = await wishlistService.isInWishlist('user-1', 'prod-1');
            expect(result).toBe(false);
        });
    });
    describe('moveToCart', () => {
        it('should move wishlist item to shopping cart', async () => {
            const mockWishlistItem = {
                id: 'wishlist-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(mockWishlistItem);
            mockWishlistRepository.moveToCart.mockResolvedValue({
                cartItemId: 'cart-1',
                success: true,
            });
            const result = await wishlistService.moveToCart('user-1', 'prod-1');
            expect(result.success).toBe(true);
            expect(mockWishlistRepository.delete).toHaveBeenCalledWith('wishlist-1');
        });
    });
    describe('shareWishlist', () => {
        it('should generate shareable link for wishlist', async () => {
            const result = await wishlistService.shareWishlist('user-1');
            expect(result.shareUrl).toBeDefined();
            expect(result.shareUrl).toContain('user-1');
        });
        it('should generate unique share token', async () => {
            const result1 = await wishlistService.shareWishlist('user-1');
            const result2 = await wishlistService.shareWishlist('user-1');
            expect(result1.shareToken).not.toBe(result2.shareToken);
        });
    });
    describe('getSharedWishlist', () => {
        it('should get wishlist by share token', async () => {
            const mockWishlistItems = [
                { id: '1', userId: 'user-1', productId: 'prod-1' },
            ];
            const mockProducts = [
                { id: 'prod-1', name: 'Product 1', price: 50 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getSharedWishlist('valid-token');
            expect(result).toHaveLength(1);
        });
    });
    describe('getWishlistTotalValue', () => {
        it('should calculate total value of wishlist items', async () => {
            const mockWishlistItems = [
                { id: '1', productId: 'prod-1' },
                { id: '2', productId: 'prod-2' },
            ];
            const mockProducts = [
                { id: 'prod-1', price: 50 },
                { id: 'prod-2', price: 150 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getWishlistTotalValue('user-1');
            expect(result).toBe(200);
        });
    });
    describe('getPriceDropAlerts', () => {
        it('should get items with price drops', async () => {
            const mockWishlistItems = [
                {
                    id: '1',
                    productId: 'prod-1',
                    priceWhenAdded: 100,
                },
            ];
            const mockProducts = [
                { id: 'prod-1', price: 80 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getPriceDropAlerts('user-1');
            expect(result).toHaveLength(1);
            expect(result[0].priceDrop).toBe(20);
        });
    });
    describe('getOutOfStockItems', () => {
        it('should get wishlist items that are out of stock', async () => {
            const mockWishlistItems = [
                { id: '1', productId: 'prod-1' },
                { id: '2', productId: 'prod-2' },
            ];
            const mockProducts = [
                { id: 'prod-1', inventory: 0 },
                { id: 'prod-2', inventory: 5 },
            ];
            mockWishlistRepository.findByUserId.mockResolvedValue(mockWishlistItems);
            mockProductRepository.findByIds.mockResolvedValue(mockProducts);
            const result = await wishlistService.getOutOfStockItems('user-1');
            expect(result).toHaveLength(1);
            expect(result[0].product.inventory).toBe(0);
        });
    });
    describe('addMultipleToWishlist', () => {
        it('should add multiple products to wishlist at once', async () => {
            const productIds = ['prod-1', 'prod-2', 'prod-3'];
            mockProductRepository.findByIds.mockResolvedValue([
                { id: 'prod-1' },
                { id: 'prod-2' },
                { id: 'prod-3' },
            ]);
            mockWishlistRepository.findByUserAndProduct.mockResolvedValue(null);
            mockWishlistRepository.create.mockResolvedValue({});
            const result = await wishlistService.addMultipleToWishlist('user-1', productIds);
            expect(result.added).toBe(3);
            expect(result.failed).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHdpc2hsaXN0XFxzZXJ2aWNlc1xcd2lzaGxpc3Quc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILHlEQUF1RTtBQUd2RSx5Q0FBOEQ7QUFFOUQsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLGVBQWdDLENBQUM7SUFDckMsSUFBSSxzQkFBdUQsQ0FBQztJQUM1RCxJQUFJLHFCQUFxRCxDQUFDO0lBRTFELFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxzQkFBc0IsR0FBRztZQUN2QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixvQkFBb0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQy9CLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDNUIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDZixDQUFDO1FBRVQscUJBQXFCLEdBQUc7WUFDdEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDZCxDQUFDO1FBRVQsZUFBZSxHQUFHLElBQUksa0NBQWUsQ0FBQyxzQkFBc0IsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO0lBQ3ZGLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDN0IsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3JELE1BQU0sTUFBTSxHQUFxQjtnQkFDL0IsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLFNBQVMsRUFBRSxRQUFRO2FBQ3BCLENBQUM7WUFFRixN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b3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFx3aXNobGlzdFxcc2VydmljZXNcXHdpc2hsaXN0LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRERDogV2lzaGxpc3QgU2VydmljZSBUZXN0c1xuICpcbiAqIFRlc3Rpbmcgd2lzaGxpc3QvZmF2b3JpdGVzIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBXaXNobGlzdFNlcnZpY2UsIEFkZFRvV2lzaGxpc3REdG8gfSBmcm9tICcuL3dpc2hsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgV2lzaGxpc3RSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3dpc2hsaXN0LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUHJvZHVjdFJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXJyb3IsIE5vdEZvdW5kRXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuXG5kZXNjcmliZSgnV2lzaGxpc3RTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgd2lzaGxpc3RTZXJ2aWNlOiBXaXNobGlzdFNlcnZpY2U7XG4gIGxldCBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxXaXNobGlzdFJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxQcm9kdWN0UmVwb3NpdG9yeT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgZmluZEJ5VXNlcklkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlVc2VyQW5kUHJvZHVjdDogamVzdC5mbigpLFxuICAgICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGVBbGxCeVVzZXJJZDogamVzdC5mbigpLFxuICAgICAgY291bnRCeVVzZXJJZDogamVzdC5mbigpLFxuICAgICAgbW92ZVRvQ2FydDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkczogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgd2lzaGxpc3RTZXJ2aWNlID0gbmV3IFdpc2hsaXN0U2VydmljZShtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkpO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWRkVG9XaXNobGlzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFkZCBhIHByb2R1Y3QgdG8gdXNlciB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFkZER0bzogQWRkVG9XaXNobGlzdER0byA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0ID0ge1xuICAgICAgICBpZDogJ3Byb2QtMScsXG4gICAgICAgIG5hbWU6ICdUZXN0IFByb2R1Y3QnLFxuICAgICAgICBwcmljZTogOTkuOTksXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlckFuZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IG1vY2tXaXNobGlzdEl0ZW0gPSB7XG4gICAgICAgIGlkOiAnd2lzaGxpc3QtMScsXG4gICAgICAgIC4uLmFkZER0byxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1dpc2hsaXN0SXRlbSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aXNobGlzdFNlcnZpY2UuYWRkVG9XaXNobGlzdChhZGREdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tXaXNobGlzdEl0ZW0pO1xuICAgICAgZXhwZWN0KG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhZGRpbmcgbm9uLWV4aXN0ZW50IHByb2R1Y3QgdG8gd2lzaGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZGREdG86IEFkZFRvV2lzaGxpc3REdG8gPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ2ludmFsaWQnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBOb3RGb3VuZEVycm9yKCdQcm9kdWN0IG5vdCBmb3VuZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHdpc2hsaXN0U2VydmljZS5hZGRUb1dpc2hsaXN0KGFkZER0bykpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFkZGluZyBkdXBsaWNhdGUgcHJvZHVjdCB0byB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFkZER0bzogQWRkVG9XaXNobGlzdER0byA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncHJvZC0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmZpbmRCeVVzZXJBbmRQcm9kdWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdleGlzdGluZycsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh3aXNobGlzdFNlcnZpY2UuYWRkVG9XaXNobGlzdChhZGREdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh3aXNobGlzdFNlcnZpY2UuYWRkVG9XaXNobGlzdChhZGREdG8pKS5yZWplY3RzLnRvVGhyb3coJ2FscmVhZHkgaW4gd2lzaGxpc3QnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWRkIHByb2R1Y3Qgd2l0aCBub3RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRkRHRvOiBBZGRUb1dpc2hsaXN0RHRvID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBub3RlOiAnR2lmdCBmb3IgYmlydGhkYXknLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdwcm9kLTEnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlckFuZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnd2lzaGxpc3QtMScsXG4gICAgICAgIC4uLmFkZER0byxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmFkZFRvV2lzaGxpc3QoYWRkRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ub3RlKS50b0JlKCdHaWZ0IGZvciBiaXJ0aGRheScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0V2lzaGxpc3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdXNlciB3aXNobGlzdCB3aXRoIHByb2R1Y3QgZGV0YWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tXaXNobGlzdEl0ZW1zID0gW1xuICAgICAgICB7IGlkOiAnMScsIHVzZXJJZDogJ3VzZXItMScsIHByb2R1Y3RJZDogJ3Byb2QtMScsIGNyZWF0ZWRBdDogbmV3IERhdGUoKSB9LFxuICAgICAgICB7IGlkOiAnMicsIHVzZXJJZDogJ3VzZXItMScsIHByb2R1Y3RJZDogJ3Byb2QtMicsIGNyZWF0ZWRBdDogbmV3IERhdGUoKSB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja1Byb2R1Y3RzID0gW1xuICAgICAgICB7IGlkOiAncHJvZC0xJywgbmFtZTogJ1Byb2R1Y3QgMScsIHByaWNlOiA1MCB9LFxuICAgICAgICB7IGlkOiAncHJvZC0yJywgbmFtZTogJ1Byb2R1Y3QgMicsIHByaWNlOiAxMDAgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tXaXNobGlzdEl0ZW1zIGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWRzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aXNobGlzdFNlcnZpY2UuZ2V0V2lzaGxpc3QoJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnByb2R1Y3QpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnByb2R1Y3QhLm5hbWUpLnRvQmUoJ1Byb2R1Y3QgMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIHVzZXIgd2l0aCBubyB3aXNobGlzdCBpdGVtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldFdpc2hsaXN0KCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNvcnQgd2lzaGxpc3QgYnkgbW9zdCByZWNlbnRseSBhZGRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICAgIGNvbnN0IG1vY2tXaXNobGlzdEl0ZW1zID0gW1xuICAgICAgICB7IGlkOiAnMScsIHByb2R1Y3RJZDogJ3Byb2QtMScsIGNyZWF0ZWRBdDogeWVzdGVyZGF5IH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcHJvZHVjdElkOiAncHJvZC0yJywgY3JlYXRlZEF0OiBub3cgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tXaXNobGlzdEl0ZW1zIGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWRzLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBpZDogJ3Byb2QtMScgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtMicgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldFdpc2hsaXN0KCd1c2VyLTEnLCB7IHNvcnRCeTogJ3JlY2VudCcgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uY3JlYXRlZEF0LmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuKHJlc3VsdFsxXS5jcmVhdGVkQXQuZ2V0VGltZSgpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIHdpc2hsaXN0IGJ5IHByaWNlIHJhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1dpc2hsaXN0SXRlbXMgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgcHJvZHVjdElkOiAncHJvZC0xJyB9LFxuICAgICAgICB7IGlkOiAnMicsIHByb2R1Y3RJZDogJ3Byb2QtMicgfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0cyA9IFtcbiAgICAgICAgeyBpZDogJ3Byb2QtMScsIHByaWNlOiA1MCB9LFxuICAgICAgICB7IGlkOiAncHJvZC0yJywgcHJpY2U6IDE1MCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1dpc2hsaXN0SXRlbXMgYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpc2hsaXN0U2VydmljZS5nZXRXaXNobGlzdCgndXNlci0xJywge1xuICAgICAgICBtaW5QcmljZTogMCxcbiAgICAgICAgbWF4UHJpY2U6IDEwMCxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmV2ZXJ5KGl0ZW0gPT4gaXRlbS5wcm9kdWN0IS5wcmljZSA8PSAxMDApKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlRnJvbVdpc2hsaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGEgcHJvZHVjdCBmcm9tIHdpc2hsaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1dpc2hsaXN0SXRlbSA9IHtcbiAgICAgICAgaWQ6ICd3aXNobGlzdC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlckFuZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUobW9ja1dpc2hsaXN0SXRlbSBhcyBhbnkpO1xuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLnJlbW92ZUZyb21XaXNobGlzdCgndXNlci0xJywgJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QobW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3aXNobGlzdC0xJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gcmVtb3Zpbmcgbm9uLWV4aXN0ZW50IHdpc2hsaXN0IGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmZpbmRCeVVzZXJBbmRQcm9kdWN0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHdpc2hsaXN0U2VydmljZS5yZW1vdmVGcm9tV2lzaGxpc3QoJ3VzZXItMScsICdwcm9kLTEnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjbGVhcldpc2hsaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGFsbCBpdGVtcyBmcm9tIHVzZXIgd2lzaGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmRlbGV0ZUFsbEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IHdpc2hsaXN0U2VydmljZS5jbGVhcldpc2hsaXN0KCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZGVsZXRlQWxsQnlVc2VySWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyLTEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFdpc2hsaXN0Q291bnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdG90YWwgaXRlbXMgaW4gdXNlciB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuY291bnRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZSg1KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldFdpc2hsaXN0Q291bnQoJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNJbldpc2hsaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgaWYgcHJvZHVjdCBpcyBpbiB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlckFuZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3dpc2hsaXN0LTEnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aXNobGlzdFNlcnZpY2UuaXNJbldpc2hsaXN0KCd1c2VyLTEnLCAncHJvZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiBwcm9kdWN0IGlzIG5vdCBpbiB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZmluZEJ5VXNlckFuZFByb2R1Y3QubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpc2hsaXN0U2VydmljZS5pc0luV2lzaGxpc3QoJ3VzZXItMScsICdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtb3ZlVG9DYXJ0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbW92ZSB3aXNobGlzdCBpdGVtIHRvIHNob3BwaW5nIGNhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrV2lzaGxpc3RJdGVtID0ge1xuICAgICAgICBpZDogJ3dpc2hsaXN0LTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5maW5kQnlVc2VyQW5kUHJvZHVjdC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrV2lzaGxpc3RJdGVtIGFzIGFueSk7XG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5Lm1vdmVUb0NhcnQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBjYXJ0SXRlbUlkOiAnY2FydC0xJyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLm1vdmVUb0NhcnQoJ3VzZXItMScsICdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnd2lzaGxpc3QtMScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2hhcmVXaXNobGlzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHNoYXJlYWJsZSBsaW5rIGZvciB3aXNobGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpc2hsaXN0U2VydmljZS5zaGFyZVdpc2hsaXN0KCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zaGFyZVVybCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2hhcmVVcmwpLnRvQ29udGFpbigndXNlci0xJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHVuaXF1ZSBzaGFyZSB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBhd2FpdCB3aXNobGlzdFNlcnZpY2Uuc2hhcmVXaXNobGlzdCgndXNlci0xJyk7XG4gICAgICBjb25zdCByZXN1bHQyID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLnNoYXJlV2lzaGxpc3QoJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0MS5zaGFyZVRva2VuKS5ub3QudG9CZShyZXN1bHQyLnNoYXJlVG9rZW4pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2hhcmVkV2lzaGxpc3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgd2lzaGxpc3QgYnkgc2hhcmUgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrV2lzaGxpc3RJdGVtcyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCB1c2VySWQ6ICd1c2VyLTEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBtb2NrUHJvZHVjdHMgPSBbXG4gICAgICAgIHsgaWQ6ICdwcm9kLTEnLCBuYW1lOiAnUHJvZHVjdCAxJywgcHJpY2U6IDUwIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrV2lzaGxpc3RJdGVtcyBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldFNoYXJlZFdpc2hsaXN0KCd2YWxpZC10b2tlbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRXaXNobGlzdFRvdGFsVmFsdWUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdG90YWwgdmFsdWUgb2Ygd2lzaGxpc3QgaXRlbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrV2lzaGxpc3RJdGVtcyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcHJvZHVjdElkOiAncHJvZC0yJyB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja1Byb2R1Y3RzID0gW1xuICAgICAgICB7IGlkOiAncHJvZC0xJywgcHJpY2U6IDUwIH0sXG4gICAgICAgIHsgaWQ6ICdwcm9kLTInLCBwcmljZTogMTUwIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrV2lzaGxpc3RJdGVtcyBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldFdpc2hsaXN0VG90YWxWYWx1ZSgndXNlci0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMjAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByaWNlRHJvcEFsZXJ0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBpdGVtcyB3aXRoIHByaWNlIGRyb3BzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1dpc2hsaXN0SXRlbXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJzEnLFxuICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgICAgcHJpY2VXaGVuQWRkZWQ6IDEwMCxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0cyA9IFtcbiAgICAgICAgeyBpZDogJ3Byb2QtMScsIHByaWNlOiA4MCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1dpc2hsaXN0SXRlbXMgYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpc2hsaXN0U2VydmljZS5nZXRQcmljZURyb3BBbGVydHMoJ3VzZXItMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnByaWNlRHJvcCkudG9CZSgyMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRPdXRPZlN0b2NrSXRlbXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgd2lzaGxpc3QgaXRlbXMgdGhhdCBhcmUgb3V0IG9mIHN0b2NrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1dpc2hsaXN0SXRlbXMgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgcHJvZHVjdElkOiAncHJvZC0xJyB9LFxuICAgICAgICB7IGlkOiAnMicsIHByb2R1Y3RJZDogJ3Byb2QtMicgfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0cyA9IFtcbiAgICAgICAgeyBpZDogJ3Byb2QtMScsIGludmVudG9yeTogMCB9LFxuICAgICAgICB7IGlkOiAncHJvZC0yJywgaW52ZW50b3J5OiA1IH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrV2lzaGxpc3RSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrV2lzaGxpc3RJdGVtcyBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2lzaGxpc3RTZXJ2aWNlLmdldE91dE9mU3RvY2tJdGVtcygndXNlci0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucHJvZHVjdCEuaW52ZW50b3J5KS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWRkTXVsdGlwbGVUb1dpc2hsaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWRkIG11bHRpcGxlIHByb2R1Y3RzIHRvIHdpc2hsaXN0IGF0IG9uY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWRzID0gWydwcm9kLTEnLCAncHJvZC0yJywgJ3Byb2QtMyddO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWRzLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBpZDogJ3Byb2QtMScgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtMicgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtMycgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgbW9ja1dpc2hsaXN0UmVwb3NpdG9yeS5maW5kQnlVc2VyQW5kUHJvZHVjdC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIG1vY2tXaXNobGlzdFJlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdpc2hsaXN0U2VydmljZS5hZGRNdWx0aXBsZVRvV2lzaGxpc3QoJ3VzZXItMScsIHByb2R1Y3RJZHMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmFkZGVkKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWQpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=