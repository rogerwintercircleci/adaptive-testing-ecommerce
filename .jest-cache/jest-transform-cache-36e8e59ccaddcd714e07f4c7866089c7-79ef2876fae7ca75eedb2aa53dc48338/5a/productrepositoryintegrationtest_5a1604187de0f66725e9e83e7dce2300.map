{"file":"C:\\Adaptive_Testing\\tests\\integration\\database\\product-repository.integration.test.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\tests\\integration\\database\\product-repository.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Product Repository with Real Database\n */\n\nimport { DataSource } from 'typeorm';\nimport { ProductRepository } from '../../../src/services/product-catalog/repositories/product.repository';\nimport { Product, ProductStatus } from '../../../src/services/product-catalog/entities/product.entity';\nimport { ConflictError } from '../../../src/libs/errors';\n\ndescribe('ProductRepository Integration Tests', () => {\n  let dataSource: DataSource;\n  let productRepository: ProductRepository;\n\n  beforeAll(async () => {\n    dataSource = {\n      isInitialized: true,\n      getRepository: jest.fn(),\n    } as unknown as DataSource;\n  });\n\n  afterAll(async () => {\n    if (dataSource?.isInitialized) {\n      await dataSource.destroy();\n    }\n  });\n\n  beforeEach(async () => {\n    const repository = dataSource.getRepository(Product);\n    productRepository = new ProductRepository(repository);\n  });\n\n  describe('CRUD Operations', () => {\n    it('should create and retrieve product', async () => {\n      const productData = {\n        name: 'Test Product',\n        description: 'Test Description',\n        sku: 'TEST-SKU-001',\n        price: 99.99,\n        inventory: 10,\n      };\n\n      const created = await productRepository.createProduct(productData);\n\n      expect(created.id).toBeDefined();\n      expect(created.sku).toBe('TEST-SKU-001');\n\n      const retrieved = await productRepository.findById(created.id);\n      expect(retrieved.name).toBe('Test Product');\n    });\n\n    it('should enforce unique SKU constraint', async () => {\n      const productData = {\n        name: 'Product',\n        description: 'Description',\n        sku: 'DUPLICATE-SKU',\n        price: 50.00,\n        inventory: 5,\n      };\n\n      await productRepository.createProduct(productData);\n\n      await expect(\n        productRepository.createProduct(productData)\n      ).rejects.toThrow(ConflictError);\n    });\n\n    it('should update product inventory', async () => {\n      const product = await productRepository.createProduct({\n        name: 'Inventory Test',\n        description: 'Test',\n        sku: 'INV-001',\n        price: 25.00,\n        inventory: 100,\n      });\n\n      const updated = await productRepository.updateInventory(product.id, 150);\n\n      expect(updated.inventory).toBe(150);\n    });\n  });\n\n  describe('Inventory Management', () => {\n    it('should decrement inventory correctly', async () => {\n      const product = await productRepository.createProduct({\n        name: 'Decrement Test',\n        description: 'Test',\n        sku: 'DEC-001',\n        price: 30.00,\n        inventory: 100,\n      });\n\n      const updated = await productRepository.decrementInventory(product.id, 25);\n\n      expect(updated.inventory).toBe(75);\n    });\n\n    it('should increment inventory correctly', async () => {\n      const product = await productRepository.createProduct({\n        name: 'Increment Test',\n        description: 'Test',\n        sku: 'INC-001',\n        price: 40.00,\n        inventory: 50,\n      });\n\n      const updated = await productRepository.incrementInventory(product.id, 30);\n\n      expect(updated.inventory).toBe(80);\n    });\n\n    it('should find low stock products', async () => {\n      await productRepository.createProduct({\n        name: 'Low Stock 1',\n        description: 'Test',\n        sku: 'LOW-001',\n        price: 20.00,\n        inventory: 3,\n        status: ProductStatus.ACTIVE,\n      });\n\n      await productRepository.createProduct({\n        name: 'Low Stock 2',\n        description: 'Test',\n        sku: 'LOW-002',\n        price: 20.00,\n        inventory: 5,\n        status: ProductStatus.ACTIVE,\n      });\n\n      const lowStock = await productRepository.findLowStock(10);\n\n      expect(lowStock.length).toBeGreaterThanOrEqual(2);\n      expect(lowStock.every(p => p.inventory <= 10)).toBe(true);\n    });\n  });\n\n  describe('Search and Filter', () => {\n    beforeEach(async () => {\n      await productRepository.createProduct({\n        name: 'Laptop Computer',\n        description: 'High performance laptop',\n        sku: 'LAPTOP-001',\n        price: 999.99,\n        inventory: 10,\n        status: ProductStatus.ACTIVE,\n      });\n\n      await productRepository.createProduct({\n        name: 'Mouse',\n        description: 'Wireless mouse',\n        sku: 'MOUSE-001',\n        price: 29.99,\n        inventory: 50,\n        status: ProductStatus.ACTIVE,\n      });\n    });\n\n    it('should search products by name', async () => {\n      const results = await productRepository.searchProducts('laptop', {});\n\n      expect(results.items.length).toBeGreaterThanOrEqual(1);\n      expect(results.items[0].name).toContain('Laptop');\n    });\n\n    it('should filter by price range', async () => {\n      const results = await productRepository.searchProducts('', {\n        minPrice: 20,\n        maxPrice: 50,\n      });\n\n      expect(results.items.every(p => p.price >= 20 && p.price <= 50)).toBe(true);\n    });\n\n    it('should support pagination', async () => {\n      const page1 = await productRepository.searchProducts('', {\n        page: 1,\n        limit: 1,\n      });\n\n      expect(page1.items.length).toBeLessThanOrEqual(1);\n      expect(page1.page).toBe(1);\n      expect(page1.totalPages).toBeGreaterThanOrEqual(1);\n    });\n  });\n\n  describe('Product Status and Sales', () => {\n    it('should find products by status', async () => {\n      await productRepository.createProduct({\n        name: 'Active Product',\n        description: 'Test',\n        sku: 'ACTIVE-001',\n        price: 50.00,\n        inventory: 10,\n        status: ProductStatus.ACTIVE,\n      });\n\n      const activeProducts = await productRepository.findByStatus(ProductStatus.ACTIVE);\n\n      expect(activeProducts.length).toBeGreaterThanOrEqual(1);\n      expect(activeProducts.every(p => p.status === ProductStatus.ACTIVE)).toBe(true);\n    });\n\n    it('should track sold count', async () => {\n      const product = await productRepository.createProduct({\n        name: 'Sales Test',\n        description: 'Test',\n        sku: 'SALES-001',\n        price: 60.00,\n        inventory: 100,\n      });\n\n      const updated = await productRepository.incrementSoldCount(product.id, 15);\n\n      expect(updated.soldCount).toBe(15);\n    });\n\n    it('should find top selling products', async () => {\n      const topSelling = await productRepository.findTopSelling(5);\n\n      expect(Array.isArray(topSelling)).toBe(true);\n      expect(topSelling.length).toBeLessThanOrEqual(5);\n    });\n  });\n\n  describe('Ratings and Reviews', () => {\n    it('should update product rating', async () => {\n      const product = await productRepository.createProduct({\n        name: 'Rating Test',\n        description: 'Test',\n        sku: 'RATING-001',\n        price: 45.00,\n        inventory: 20,\n      });\n\n      const updated = await productRepository.updateRating(product.id, 4.5, 10);\n\n      expect(updated.rating).toBe(4.5);\n      expect(updated.reviewCount).toBe(10);\n    });\n\n    it('should find top rated products', async () => {\n      const topRated = await productRepository.findTopRated(10, 5);\n\n      expect(Array.isArray(topRated)).toBe(true);\n    });\n  });\n\n  describe('Sale Products', () => {\n    it('should find products on sale', async () => {\n      await productRepository.createProduct({\n        name: 'Sale Product',\n        description: 'On sale',\n        sku: 'SALE-001',\n        price: 79.99,\n        compareAtPrice: 99.99,\n        inventory: 15,\n        status: ProductStatus.ACTIVE,\n      });\n\n      const onSale = await productRepository.findOnSale();\n\n      expect(onSale.length).toBeGreaterThanOrEqual(1);\n      expect(onSale.every(p => p.compareAtPrice! > p.price)).toBe(true);\n    });\n  });\n});\n"],"version":3}