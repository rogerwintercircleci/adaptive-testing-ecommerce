1b3d2ec6e098166c6b15a31694aa14fa
"use strict";
/**
 * TDD: User Repository Tests
 *
 * This file demonstrates strict Test-Driven Development:
 * 1. Write failing tests first
 * 2. Implement minimal code to pass
 * 3. Refactor if needed
 *
 * Testing Strategy:
 * - Test CRUD operations
 * - Test query methods
 * - Test edge cases (duplicates, not found, etc.)
 * - Test business logic methods
 */
Object.defineProperty(exports, "__esModule", { value: true });
const user_repository_1 = require("./user.repository");
const user_entity_1 = require("../entities/user.entity");
const errors_1 = require("@libs/errors");
// Mock TypeORM Repository
const mockRepository = {
    find: jest.fn(),
    findOne: jest.fn(),
    create: jest.fn(),
    save: jest.fn(),
    remove: jest.fn(),
    softDelete: jest.fn(),
    count: jest.fn(),
    merge: jest.fn(),
    metadata: { name: 'User' },
};
describe('UserRepository', () => {
    let userRepository;
    beforeEach(() => {
        jest.clearAllMocks();
        userRepository = new user_repository_1.UserRepository(mockRepository);
    });
    /**
     * TDD Cycle 1: Test findByEmail
     * RED: Write failing test
     */
    describe('findByEmail', () => {
        it('should find user by email', async () => {
            // Arrange
            const mockUser = {
                id: '123',
                email: 'test@example.com',
                firstName: 'Test',
                lastName: 'User',
            };
            mockRepository.findOne.mockResolvedValue(mockUser);
            // Act
            const result = await userRepository.findByEmail('test@example.com');
            // Assert
            expect(result).toEqual(mockUser);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { email: 'test@example.com' },
            });
        });
        it('should return null if user not found', async () => {
            mockRepository.findOne.mockResolvedValue(null);
            const result = await userRepository.findByEmail('nonexistent@example.com');
            expect(result).toBeNull();
        });
        it('should be case-insensitive', async () => {
            const mockUser = {
                id: '123',
                email: 'test@example.com',
            };
            mockRepository.findOne.mockResolvedValue(mockUser);
            const result = await userRepository.findByEmail('TEST@EXAMPLE.COM');
            expect(result).toEqual(mockUser);
        });
    });
    /**
     * TDD Cycle 2: Test emailExists
     */
    describe('emailExists', () => {
        it('should return true if email exists', async () => {
            mockRepository.count.mockResolvedValue(1);
            const result = await userRepository.emailExists('existing@example.com');
            expect(result).toBe(true);
        });
        it('should return false if email does not exist', async () => {
            mockRepository.count.mockResolvedValue(0);
            const result = await userRepository.emailExists('new@example.com');
            expect(result).toBe(false);
        });
        it('should be case-insensitive', async () => {
            mockRepository.count.mockResolvedValue(1);
            await userRepository.emailExists('EXISTING@EXAMPLE.COM');
            expect(mockRepository.count).toHaveBeenCalled();
        });
    });
    /**
     * TDD Cycle 3: Test createUser (with duplicate check)
     */
    describe('createUser', () => {
        it('should create a new user', async () => {
            const userData = {
                email: 'new@example.com',
                password: 'hashedpassword',
                firstName: 'New',
                lastName: 'User',
            };
            const mockUser = { id: '456', ...userData };
            mockRepository.count.mockResolvedValue(0);
            mockRepository.create.mockReturnValue(mockUser);
            mockRepository.save.mockResolvedValue(mockUser);
            const result = await userRepository.createUser(userData);
            expect(result).toEqual(mockUser);
            expect(mockRepository.create).toHaveBeenCalledWith(userData);
            expect(mockRepository.save).toHaveBeenCalledWith(mockUser);
        });
        it('should throw ConflictError if email already exists', async () => {
            const userData = {
                email: 'existing@example.com',
                password: 'hashedpassword',
                firstName: 'Test',
                lastName: 'User',
            };
            mockRepository.count.mockResolvedValue(1);
            await expect(userRepository.createUser(userData)).rejects.toThrow(errors_1.ConflictError);
            await expect(userRepository.createUser(userData)).rejects.toThrow('User with this email already exists');
        });
        it('should normalize email to lowercase', async () => {
            const userData = {
                email: 'NEW@EXAMPLE.COM',
                password: 'hashedpassword',
                firstName: 'New',
                lastName: 'User',
            };
            mockRepository.count.mockResolvedValue(0);
            mockRepository.create.mockReturnValue(userData);
            mockRepository.save.mockResolvedValue(userData);
            await userRepository.createUser(userData);
            expect(mockRepository.create).toHaveBeenCalledWith({
                ...userData,
                email: 'new@example.com',
            });
        });
    });
    /**
     * TDD Cycle 4: Test findByRole
     */
    describe('findByRole', () => {
        it('should find all users with specified role', async () => {
            const mockUsers = [
                { id: '1', role: user_entity_1.UserRole.ADMIN },
                { id: '2', role: user_entity_1.UserRole.ADMIN },
            ];
            mockRepository.find.mockResolvedValue(mockUsers);
            const result = await userRepository.findByRole(user_entity_1.UserRole.ADMIN);
            expect(result).toEqual(mockUsers);
            expect(mockRepository.find).toHaveBeenCalledWith({
                where: { role: user_entity_1.UserRole.ADMIN },
            });
        });
        it('should return empty array if no users with role', async () => {
            mockRepository.find.mockResolvedValue([]);
            const result = await userRepository.findByRole(user_entity_1.UserRole.VENDOR);
            expect(result).toEqual([]);
        });
    });
    /**
     * TDD Cycle 5: Test findByStatus
     */
    describe('findByStatus', () => {
        it('should find all users with specified status', async () => {
            const mockUsers = [
                { id: '1', status: user_entity_1.UserStatus.ACTIVE },
                { id: '2', status: user_entity_1.UserStatus.ACTIVE },
            ];
            mockRepository.find.mockResolvedValue(mockUsers);
            const result = await userRepository.findByStatus(user_entity_1.UserStatus.ACTIVE);
            expect(result).toEqual(mockUsers);
        });
    });
    /**
     * TDD Cycle 6: Test updateLastLogin
     */
    describe('updateLastLogin', () => {
        it('should update last login timestamp', async () => {
            const userId = '123';
            const mockUser = { id: userId, lastLoginAt: null };
            const updatedUser = { ...mockUser, lastLoginAt: expect.any(Date) };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue(updatedUser);
            mockRepository.save.mockResolvedValue(updatedUser);
            const result = await userRepository.updateLastLogin(userId);
            expect(result.lastLoginAt).toBeInstanceOf(Date);
            expect(mockRepository.save).toHaveBeenCalled();
        });
        it('should throw NotFoundError if user not found', async () => {
            mockRepository.findOne.mockResolvedValue(null);
            await expect(userRepository.updateLastLogin('nonexistent')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    /**
     * TDD Cycle 7: Test incrementLoginAttempts
     */
    describe('incrementLoginAttempts', () => {
        it('should increment login attempts', async () => {
            const userId = '123';
            const mockUser = { id: userId, loginAttempts: 0 };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                loginAttempts: 1,
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                loginAttempts: 1,
            });
            const result = await userRepository.incrementLoginAttempts(userId);
            expect(result.loginAttempts).toBe(1);
        });
        it('should lock account after 5 failed attempts', async () => {
            const userId = '123';
            const mockUser = { id: userId, loginAttempts: 4 };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                loginAttempts: 5,
                lockedUntil: expect.any(Date),
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                loginAttempts: 5,
                lockedUntil: new Date(Date.now() + 30 * 60 * 1000),
            });
            const result = await userRepository.incrementLoginAttempts(userId);
            expect(result.loginAttempts).toBe(5);
            expect(result.lockedUntil).toBeDefined();
        });
    });
    /**
     * TDD Cycle 8: Test resetLoginAttempts
     */
    describe('resetLoginAttempts', () => {
        it('should reset login attempts to zero', async () => {
            const userId = '123';
            const mockUser = { id: userId, loginAttempts: 3, lockedUntil: new Date() };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                loginAttempts: 0,
                lockedUntil: null,
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                loginAttempts: 0,
                lockedUntil: null,
            });
            const result = await userRepository.resetLoginAttempts(userId);
            expect(result.loginAttempts).toBe(0);
            expect(result.lockedUntil).toBeNull();
        });
    });
    /**
     * TDD Cycle 9: Test setEmailVerificationToken
     */
    describe('setEmailVerificationToken', () => {
        it('should set email verification token', async () => {
            const userId = '123';
            const token = 'verification-token';
            const mockUser = { id: userId };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                emailVerificationToken: token,
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                emailVerificationToken: token,
            });
            const result = await userRepository.setEmailVerificationToken(userId, token);
            expect(result.emailVerificationToken).toBe(token);
        });
    });
    /**
     * TDD Cycle 10: Test verifyEmail
     */
    describe('verifyEmail', () => {
        it('should verify email and clear token', async () => {
            const token = 'valid-token';
            const mockUser = { id: '123', emailVerificationToken: token };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                emailVerificationToken: null,
                emailVerifiedAt: expect.any(Date),
                status: user_entity_1.UserStatus.ACTIVE,
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                emailVerificationToken: null,
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
            });
            const result = await userRepository.verifyEmail(token);
            expect(result.emailVerifiedAt).toBeDefined();
            expect(result.emailVerificationToken).toBeNull();
            expect(result.status).toBe(user_entity_1.UserStatus.ACTIVE);
        });
        it('should throw NotFoundError for invalid token', async () => {
            mockRepository.findOne.mockResolvedValue(null);
            await expect(userRepository.verifyEmail('invalid-token')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    /**
     * TDD Cycle 11: Test setPasswordResetToken
     */
    describe('setPasswordResetToken', () => {
        it('should set password reset token with expiry', async () => {
            const userId = '123';
            const token = 'reset-token';
            const mockUser = { id: userId };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                passwordResetToken: token,
                passwordResetExpires: expect.any(Date),
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                passwordResetToken: token,
                passwordResetExpires: new Date(Date.now() + 3600000),
            });
            const result = await userRepository.setPasswordResetToken(userId, token);
            expect(result.passwordResetToken).toBe(token);
            expect(result.passwordResetExpires).toBeDefined();
        });
    });
    /**
     * TDD Cycle 12: Test resetPassword
     */
    describe('resetPassword', () => {
        it('should reset password and clear token', async () => {
            const token = 'valid-reset-token';
            const newPassword = 'newhashedpassword';
            const mockUser = {
                id: '123',
                passwordResetToken: token,
                passwordResetExpires: new Date(Date.now() + 3600000),
            };
            mockRepository.findOne.mockResolvedValue(mockUser);
            mockRepository.merge.mockReturnValue({
                ...mockUser,
                password: newPassword,
                passwordResetToken: null,
                passwordResetExpires: null,
            });
            mockRepository.save.mockResolvedValue({
                ...mockUser,
                password: newPassword,
                passwordResetToken: null,
                passwordResetExpires: null,
            });
            const result = await userRepository.resetPassword(token, newPassword);
            expect(result.password).toBe(newPassword);
            expect(result.passwordResetToken).toBeNull();
        });
        it('should throw NotFoundError for invalid token', async () => {
            mockRepository.findOne.mockResolvedValue(null);
            await expect(userRepository.resetPassword('invalid-token', 'newpassword')).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should throw error for expired token', async () => {
            const token = 'expired-token';
            const mockUser = {
                id: '123',
                passwordResetToken: token,
                passwordResetExpires: new Date(Date.now() - 1000),
            };
            mockRepository.findOne.mockResolvedValue(mockUser);
            await expect(userRepository.resetPassword(token, 'newpassword')).rejects.toThrow('Password reset token has expired');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHVzZXItbWFuYWdlbWVudFxccmVwb3NpdG9yaWVzXFx1c2VyLnJlcG9zaXRvcnkuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRzs7QUFHSCx1REFBbUQ7QUFDbkQseURBQXFFO0FBQ3JFLHlDQUE0RDtBQUU1RCwwQkFBMEI7QUFDMUIsTUFBTSxjQUFjLEdBQUc7SUFDckIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNsQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2pCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3JCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2hCLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUU7Q0FDSSxDQUFDO0FBRWpDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7SUFDOUIsSUFBSSxjQUE4QixDQUFDO0lBRW5DLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsY0FBYyxHQUFHLElBQUksZ0NBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUN0RCxDQUFDLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QyxVQUFVO1lBQ1YsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsRUFBRSxFQUFFLEtBQUs7Z0JBQ1QsS0FBSyxFQUFFLGtCQUFrQjtnQkFD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V0FBVyxDQUFDLENBQUM7WUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELGNBQWMsQ0FBQyxPQUFxQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTlELE1BQU0sTUFBTSxDQUNWLGNBQWMsQ0FBQyxhQUFhLENBQUMsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUM3RCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsc0JBQWEsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQztZQUM5QixNQUFNLFFBQVEsR0FBRztnQkFDZixFQUFFLEVBQUUsS0FBSztnQkFDVCxrQkFBa0IsRUFBRSxLQUFLO2dCQUN6QixvQkFBb0IsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO2FBQzFDLENBQUM7WUFFVCxjQUFjLENBQUMsT0FBcUIsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVsRSxNQUFNLE1BQU0sQ0FDVixjQUFjLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsQ0FDbkQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFx1c2VyLW1hbmFnZW1lbnRcXHJlcG9zaXRvcmllc1xcdXNlci5yZXBvc2l0b3J5LnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUREQ6IFVzZXIgUmVwb3NpdG9yeSBUZXN0c1xuICpcbiAqIFRoaXMgZmlsZSBkZW1vbnN0cmF0ZXMgc3RyaWN0IFRlc3QtRHJpdmVuIERldmVsb3BtZW50OlxuICogMS4gV3JpdGUgZmFpbGluZyB0ZXN0cyBmaXJzdFxuICogMi4gSW1wbGVtZW50IG1pbmltYWwgY29kZSB0byBwYXNzXG4gKiAzLiBSZWZhY3RvciBpZiBuZWVkZWRcbiAqXG4gKiBUZXN0aW5nIFN0cmF0ZWd5OlxuICogLSBUZXN0IENSVUQgb3BlcmF0aW9uc1xuICogLSBUZXN0IHF1ZXJ5IG1ldGhvZHNcbiAqIC0gVGVzdCBlZGdlIGNhc2VzIChkdXBsaWNhdGVzLCBub3QgZm91bmQsIGV0Yy4pXG4gKiAtIFRlc3QgYnVzaW5lc3MgbG9naWMgbWV0aG9kc1xuICovXG5cbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IFVzZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi91c2VyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgVXNlciwgVXNlclJvbGUsIFVzZXJTdGF0dXMgfSBmcm9tICcuLi9lbnRpdGllcy91c2VyLmVudGl0eSc7XG5pbXBvcnQgeyBOb3RGb3VuZEVycm9yLCBDb25mbGljdEVycm9yIH0gZnJvbSAnQGxpYnMvZXJyb3JzJztcblxuLy8gTW9jayBUeXBlT1JNIFJlcG9zaXRvcnlcbmNvbnN0IG1vY2tSZXBvc2l0b3J5ID0ge1xuICBmaW5kOiBqZXN0LmZuKCksXG4gIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgY3JlYXRlOiBqZXN0LmZuKCksXG4gIHNhdmU6IGplc3QuZm4oKSxcbiAgcmVtb3ZlOiBqZXN0LmZuKCksXG4gIHNvZnREZWxldGU6IGplc3QuZm4oKSxcbiAgY291bnQ6IGplc3QuZm4oKSxcbiAgbWVyZ2U6IGplc3QuZm4oKSxcbiAgbWV0YWRhdGE6IHsgbmFtZTogJ1VzZXInIH0sXG59IGFzIHVua25vd24gYXMgUmVwb3NpdG9yeTxVc2VyPjtcblxuZGVzY3JpYmUoJ1VzZXJSZXBvc2l0b3J5JywgKCkgPT4ge1xuICBsZXQgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIHVzZXJSZXBvc2l0b3J5ID0gbmV3IFVzZXJSZXBvc2l0b3J5KG1vY2tSZXBvc2l0b3J5KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSAxOiBUZXN0IGZpbmRCeUVtYWlsXG4gICAqIFJFRDogV3JpdGUgZmFpbGluZyB0ZXN0XG4gICAqL1xuICBkZXNjcmliZSgnZmluZEJ5RW1haWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIHVzZXIgYnkgZW1haWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBmaXJzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2VyKTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBpZiB1c2VyIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsKCdub25leGlzdGVudEBleGFtcGxlLmNvbScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBjYXNlLWluc2Vuc2l0aXZlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnMTIzJyxcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsKCdURVNUQEVYQU1QTEUuQ09NJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDI6IFRlc3QgZW1haWxFeGlzdHNcbiAgICovXG4gIGRlc2NyaWJlKCdlbWFpbEV4aXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGlmIGVtYWlsIGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5jb3VudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKDEpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5lbWFpbEV4aXN0cygnZXhpc3RpbmdAZXhhbXBsZS5jb20nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGlmIGVtYWlsIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LmNvdW50IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmVtYWlsRXhpc3RzKCduZXdAZXhhbXBsZS5jb20nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGNhc2UtaW5zZW5zaXRpdmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuY291bnQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSgxKTtcblxuICAgICAgYXdhaXQgdXNlclJlcG9zaXRvcnkuZW1haWxFeGlzdHMoJ0VYSVNUSU5HQEVYQU1QTEUuQ09NJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5jb3VudCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDM6IFRlc3QgY3JlYXRlVXNlciAod2l0aCBkdXBsaWNhdGUgY2hlY2spXG4gICAqL1xuICBkZXNjcmliZSgnY3JlYXRlVXNlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAnbmV3QGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZCcsXG4gICAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgaWQ6ICc0NTYnLCAuLi51c2VyRGF0YSB9IGFzIFVzZXI7XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5jb3VudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShtb2NrVXNlcik7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuc2F2ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclJlcG9zaXRvcnkuY3JlYXRlVXNlcih1c2VyRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlckRhdGEpO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tVc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQ29uZmxpY3RFcnJvciBpZiBlbWFpbCBhbHJlYWR5IGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xuICAgICAgICBlbWFpbDogJ2V4aXN0aW5nQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZCcsXG4gICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgfTtcblxuICAgICAgKG1vY2tSZXBvc2l0b3J5LmNvdW50IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoMSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyUmVwb3NpdG9yeS5jcmVhdGVVc2VyKHVzZXJEYXRhKSkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KHVzZXJSZXBvc2l0b3J5LmNyZWF0ZVVzZXIodXNlckRhdGEpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cydcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vcm1hbGl6ZSBlbWFpbCB0byBsb3dlcmNhc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICdORVdARVhBTVBMRS5DT00nLFxuICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgIH07XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5jb3VudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh1c2VyRGF0YSBhcyBVc2VyKTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5zYXZlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodXNlckRhdGEgYXMgVXNlcik7XG5cbiAgICAgIGF3YWl0IHVzZXJSZXBvc2l0b3J5LmNyZWF0ZVVzZXIodXNlckRhdGEpO1xuXG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIC4uLnVzZXJEYXRhLFxuICAgICAgICBlbWFpbDogJ25ld0BleGFtcGxlLmNvbScsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA0OiBUZXN0IGZpbmRCeVJvbGVcbiAgICovXG4gIGRlc2NyaWJlKCdmaW5kQnlSb2xlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmluZCBhbGwgdXNlcnMgd2l0aCBzcGVjaWZpZWQgcm9sZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VycyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCByb2xlOiBVc2VyUm9sZS5BRE1JTiB9LFxuICAgICAgICB7IGlkOiAnMicsIHJvbGU6IFVzZXJSb2xlLkFETUlOIH0sXG4gICAgICBdIGFzIFVzZXJbXTtcblxuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcnMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5maW5kQnlSb2xlKFVzZXJSb2xlLkFETUlOKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXNlcnMpO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgcm9sZTogVXNlclJvbGUuQURNSU4gfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgaWYgbm8gdXNlcnMgd2l0aCByb2xlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmZpbmRCeVJvbGUoVXNlclJvbGUuVkVORE9SKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBUREQgQ3ljbGUgNTogVGVzdCBmaW5kQnlTdGF0dXNcbiAgICovXG4gIGRlc2NyaWJlKCdmaW5kQnlTdGF0dXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIGFsbCB1c2VycyB3aXRoIHNwZWNpZmllZCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlcnMgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSB9LFxuICAgICAgICB7IGlkOiAnMicsIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUgfSxcbiAgICAgIF0gYXMgVXNlcltdO1xuXG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2Vycyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmZpbmRCeVN0YXR1cyhVc2VyU3RhdHVzLkFDVElWRSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXJzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA2OiBUZXN0IHVwZGF0ZUxhc3RMb2dpblxuICAgKi9cbiAgZGVzY3JpYmUoJ3VwZGF0ZUxhc3RMb2dpbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBsYXN0IGxvZ2luIHRpbWVzdGFtcCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiB1c2VySWQsIGxhc3RMb2dpbkF0OiBudWxsIH0gYXMgdW5rbm93biBhcyBVc2VyO1xuICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSB7IC4uLm1vY2tVc2VyLCBsYXN0TG9naW5BdDogZXhwZWN0LmFueShEYXRlKSB9O1xuXG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZE9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5tZXJnZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh1cGRhdGVkVXNlcik7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuc2F2ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclJlcG9zaXRvcnkudXBkYXRlTGFzdExvZ2luKHVzZXJJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubGFzdExvZ2luQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFcnJvciBpZiB1c2VyIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyUmVwb3NpdG9yeS51cGRhdGVMYXN0TG9naW4oJ25vbmV4aXN0ZW50JykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFcnJvclxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA3OiBUZXN0IGluY3JlbWVudExvZ2luQXR0ZW1wdHNcbiAgICovXG4gIGRlc2NyaWJlKCdpbmNyZW1lbnRMb2dpbkF0dGVtcHRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5jcmVtZW50IGxvZ2luIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJzEyMyc7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgaWQ6IHVzZXJJZCwgbG9naW5BdHRlbXB0czogMCB9IGFzIFVzZXI7XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5Lm1lcmdlIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDEsXG4gICAgICB9KTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5zYXZlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrVXNlcixcbiAgICAgICAgbG9naW5BdHRlbXB0czogMSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5pbmNyZW1lbnRMb2dpbkF0dGVtcHRzKHVzZXJJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubG9naW5BdHRlbXB0cykudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9jayBhY2NvdW50IGFmdGVyIDUgZmFpbGVkIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJzEyMyc7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgaWQ6IHVzZXJJZCwgbG9naW5BdHRlbXB0czogNCB9IGFzIFVzZXI7XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5Lm1lcmdlIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDUsXG4gICAgICAgIGxvY2tlZFVudGlsOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgfSk7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuc2F2ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDUsXG4gICAgICAgIGxvY2tlZFVudGlsOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiA2MCAqIDEwMDApLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmluY3JlbWVudExvZ2luQXR0ZW1wdHModXNlcklkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5sb2dpbkF0dGVtcHRzKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5sb2NrZWRVbnRpbCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA4OiBUZXN0IHJlc2V0TG9naW5BdHRlbXB0c1xuICAgKi9cbiAgZGVzY3JpYmUoJ3Jlc2V0TG9naW5BdHRlbXB0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2V0IGxvZ2luIGF0dGVtcHRzIHRvIHplcm8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAnMTIzJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0geyBpZDogdXNlcklkLCBsb2dpbkF0dGVtcHRzOiAzLCBsb2NrZWRVbnRpbDogbmV3IERhdGUoKSB9IGFzIFVzZXI7XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5Lm1lcmdlIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgIGxvY2tlZFVudGlsOiBudWxsLFxuICAgICAgfSk7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuc2F2ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgIGxvY2tlZFVudGlsOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LnJlc2V0TG9naW5BdHRlbXB0cyh1c2VySWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmxvZ2luQXR0ZW1wdHMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmxvY2tlZFVudGlsKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDk6IFRlc3Qgc2V0RW1haWxWZXJpZmljYXRpb25Ub2tlblxuICAgKi9cbiAgZGVzY3JpYmUoJ3NldEVtYWlsVmVyaWZpY2F0aW9uVG9rZW4nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgZW1haWwgdmVyaWZpY2F0aW9uIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJzEyMyc7XG4gICAgICBjb25zdCB0b2tlbiA9ICd2ZXJpZmljYXRpb24tdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiB1c2VySWQgfSBhcyBVc2VyO1xuXG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZE9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5tZXJnZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBlbWFpbFZlcmlmaWNhdGlvblRva2VuOiB0b2tlbixcbiAgICAgIH0pO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LnNhdmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBlbWFpbFZlcmlmaWNhdGlvblRva2VuOiB0b2tlbixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5zZXRFbWFpbFZlcmlmaWNhdGlvblRva2VuKHVzZXJJZCwgdG9rZW4pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmVtYWlsVmVyaWZpY2F0aW9uVG9rZW4pLnRvQmUodG9rZW4pO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDEwOiBUZXN0IHZlcmlmeUVtYWlsXG4gICAqL1xuICBkZXNjcmliZSgndmVyaWZ5RW1haWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgZW1haWwgYW5kIGNsZWFyIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9rZW4gPSAndmFsaWQtdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiAnMTIzJywgZW1haWxWZXJpZmljYXRpb25Ub2tlbjogdG9rZW4gfSBhcyBVc2VyO1xuXG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZE9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5tZXJnZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBlbWFpbFZlcmlmaWNhdGlvblRva2VuOiBudWxsLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUsXG4gICAgICB9KTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5zYXZlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrVXNlcixcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb25Ub2tlbjogbnVsbCxcbiAgICAgICAgZW1haWxWZXJpZmllZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LnZlcmlmeUVtYWlsKHRva2VuKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbWFpbFZlcmlmaWVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmVtYWlsVmVyaWZpY2F0aW9uVG9rZW4pLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShVc2VyU3RhdHVzLkFDVElWRSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXJyb3IgZm9yIGludmFsaWQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZE9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclJlcG9zaXRvcnkudmVyaWZ5RW1haWwoJ2ludmFsaWQtdG9rZW4nKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEVycm9yXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDExOiBUZXN0IHNldFBhc3N3b3JkUmVzZXRUb2tlblxuICAgKi9cbiAgZGVzY3JpYmUoJ3NldFBhc3N3b3JkUmVzZXRUb2tlbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBwYXNzd29yZCByZXNldCB0b2tlbiB3aXRoIGV4cGlyeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgdG9rZW4gPSAncmVzZXQtdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiB1c2VySWQgfSBhcyBVc2VyO1xuXG4gICAgICAobW9ja1JlcG9zaXRvcnkuZmluZE9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIChtb2NrUmVwb3NpdG9yeS5tZXJnZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBwYXNzd29yZFJlc2V0VG9rZW46IHRva2VuLFxuICAgICAgICBwYXNzd29yZFJlc2V0RXhwaXJlczogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgIH0pO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LnNhdmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBwYXNzd29yZFJlc2V0VG9rZW46IHRva2VuLFxuICAgICAgICBwYXNzd29yZFJlc2V0RXhwaXJlczogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LnNldFBhc3N3b3JkUmVzZXRUb2tlbih1c2VySWQsIHRva2VuKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXNzd29yZFJlc2V0VG9rZW4pLnRvQmUodG9rZW4pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXNzd29yZFJlc2V0RXhwaXJlcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSAxMjogVGVzdCByZXNldFBhc3N3b3JkXG4gICAqL1xuICBkZXNjcmliZSgncmVzZXRQYXNzd29yZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2V0IHBhc3N3b3JkIGFuZCBjbGVhciB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3ZhbGlkLXJlc2V0LXRva2VuJztcbiAgICAgIGNvbnN0IG5ld1Bhc3N3b3JkID0gJ25ld2hhc2hlZHBhc3N3b3JkJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIHBhc3N3b3JkUmVzZXRUb2tlbjogdG9rZW4sXG4gICAgICAgIHBhc3N3b3JkUmVzZXRFeHBpcmVzOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzYwMDAwMCksXG4gICAgICB9IGFzIFVzZXI7XG5cbiAgICAgIChtb2NrUmVwb3NpdG9yeS5maW5kT25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5Lm1lcmdlIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIHBhc3N3b3JkOiBuZXdQYXNzd29yZCxcbiAgICAgICAgcGFzc3dvcmRSZXNldFRva2VuOiBudWxsLFxuICAgICAgICBwYXNzd29yZFJlc2V0RXhwaXJlczogbnVsbCxcbiAgICAgIH0pO1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LnNhdmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBwYXNzd29yZDogbmV3UGFzc3dvcmQsXG4gICAgICAgIHBhc3N3b3JkUmVzZXRUb2tlbjogbnVsbCxcbiAgICAgICAgcGFzc3dvcmRSZXNldEV4cGlyZXM6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclJlcG9zaXRvcnkucmVzZXRQYXNzd29yZCh0b2tlbiwgbmV3UGFzc3dvcmQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnBhc3N3b3JkKS50b0JlKG5ld1Bhc3N3b3JkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGFzc3dvcmRSZXNldFRva2VuKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEVycm9yIGZvciBpbnZhbGlkIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICB1c2VyUmVwb3NpdG9yeS5yZXNldFBhc3N3b3JkKCdpbnZhbGlkLXRva2VuJywgJ25ld3Bhc3N3b3JkJylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgZXhwaXJlZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ2V4cGlyZWQtdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnMTIzJyxcbiAgICAgICAgcGFzc3dvcmRSZXNldFRva2VuOiB0b2tlbixcbiAgICAgICAgcGFzc3dvcmRSZXNldEV4cGlyZXM6IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwKSxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgKG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgdXNlclJlcG9zaXRvcnkucmVzZXRQYXNzd29yZCh0b2tlbiwgJ25ld3Bhc3N3b3JkJylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdQYXNzd29yZCByZXNldCB0b2tlbiBoYXMgZXhwaXJlZCcpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9