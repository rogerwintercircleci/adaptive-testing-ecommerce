cebc4cdcc95552c4d9e41d9a568ce39d
"use strict";
/**
 * TDD: User Service Tests
 *
 * Testing business logic layer:
 * - User registration flow
 * - Authentication
 * - Password management
 * - Email verification
 * - User profile updates
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('../repositories/user.repository');
jest.mock('@libs/auth/password.utils');
jest.mock('@libs/auth/jwt.utils');
const user_service_1 = require("./user.service");
const user_entity_1 = require("../entities/user.entity");
const errors_1 = require("@libs/errors");
const passwordUtils = __importStar(require("@libs/auth/password.utils"));
const jwtUtils = __importStar(require("@libs/auth/jwt.utils"));
describe('UserService', () => {
    let userService;
    let mockUserRepository;
    beforeEach(() => {
        mockUserRepository = {
            createUser: jest.fn(),
            findByEmail: jest.fn(),
            findById: jest.fn(),
            emailExists: jest.fn(),
            updateLastLogin: jest.fn(),
            incrementLoginAttempts: jest.fn(),
            resetLoginAttempts: jest.fn(),
            setEmailVerificationToken: jest.fn(),
            verifyEmail: jest.fn(),
            setPasswordResetToken: jest.fn(),
            resetPassword: jest.fn(),
            update: jest.fn(),
            findByRole: jest.fn(),
            findByStatus: jest.fn(),
        };
        userService = new user_service_1.UserService(mockUserRepository);
    });
    /**
     * TDD Cycle 1: User Registration
     */
    describe('register', () => {
        const validRegistrationData = {
            email: 'newuser@example.com',
            password: 'SecurePass123!',
            firstName: 'John',
            lastName: 'Doe',
        };
        it('should register a new user successfully', async () => {
            const hashedPassword = 'hashed_password';
            const verificationToken = 'verification_token';
            const mockUser = {
                id: '123',
                ...validRegistrationData,
                password: hashedPassword,
                emailVerificationToken: verificationToken,
                role: user_entity_1.UserRole.CUSTOMER,
                status: user_entity_1.UserStatus.PENDING,
            };
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: true,
                errors: [],
            });
            passwordUtils.hashPassword.mockResolvedValue(hashedPassword);
            mockUserRepository.createUser.mockResolvedValue(mockUser);
            const result = await userService.register(validRegistrationData);
            expect(result).toEqual(mockUser);
            expect(passwordUtils.validatePasswordStrength).toHaveBeenCalledWith(validRegistrationData.password);
            expect(passwordUtils.hashPassword).toHaveBeenCalledWith(validRegistrationData.password);
            expect(mockUserRepository.createUser).toHaveBeenCalledWith(expect.objectContaining({
                email: validRegistrationData.email,
                password: hashedPassword,
                firstName: validRegistrationData.firstName,
                lastName: validRegistrationData.lastName,
                emailVerificationToken: expect.any(String),
            }));
        });
        it('should reject weak passwords', async () => {
            const weakPasswordData = {
                ...validRegistrationData,
                password: 'weak',
            };
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: false,
                errors: ['Password must be at least 8 characters'],
            });
            await expect(userService.register(weakPasswordData)).rejects.toThrow(errors_1.BadRequestError);
        });
        it('should reject duplicate email', async () => {
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: true,
                errors: [],
            });
            mockUserRepository.createUser.mockRejectedValue(new errors_1.ConflictError('User with this email already exists'));
            await expect(userService.register(validRegistrationData)).rejects.toThrow(errors_1.ConflictError);
        });
        it('should generate verification token', async () => {
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: true,
                errors: [],
            });
            passwordUtils.hashPassword.mockResolvedValue('hashed');
            mockUserRepository.createUser.mockResolvedValue({});
            await userService.register(validRegistrationData);
            expect(mockUserRepository.createUser).toHaveBeenCalledWith(expect.objectContaining({
                emailVerificationToken: expect.any(String),
            }));
        });
    });
    /**
     * TDD Cycle 2: User Login
     */
    describe('login', () => {
        const loginCredentials = {
            email: 'user@example.com',
            password: 'CorrectPassword123!',
        };
        it('should login successfully with correct credentials', async () => {
            const mockUser = {
                id: '123',
                email: loginCredentials.email,
                password: 'hashed_password',
                status: user_entity_1.UserStatus.ACTIVE,
                emailVerifiedAt: new Date(),
                loginAttempts: 0,
                lockedUntil: null,
                role: user_entity_1.UserRole.CUSTOMER,
            };
            const accessToken = 'access_token';
            const refreshToken = 'refresh_token';
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            passwordUtils.comparePassword.mockResolvedValue(true);
            jwtUtils.generateAccessToken.mockReturnValue(accessToken);
            jwtUtils.generateRefreshToken.mockReturnValue(refreshToken);
            mockUserRepository.resetLoginAttempts.mockResolvedValue(mockUser);
            mockUserRepository.updateLastLogin.mockResolvedValue(mockUser);
            const result = await userService.login(loginCredentials);
            expect(result).toEqual({
                user: mockUser,
                accessToken,
                refreshToken,
            });
            expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalledWith(mockUser.id);
            expect(mockUserRepository.updateLastLogin).toHaveBeenCalledWith(mockUser.id);
        });
        it('should reject login for non-existent user', async () => {
            mockUserRepository.findByEmail.mockResolvedValue(null);
            await expect(userService.login(loginCredentials)).rejects.toThrow(errors_1.UnauthorizedError);
            await expect(userService.login(loginCredentials)).rejects.toThrow('Invalid credentials');
        });
        it('should reject login with incorrect password', async () => {
            const mockUser = {
                id: '123',
                email: loginCredentials.email,
                password: 'hashed_password',
                status: user_entity_1.UserStatus.ACTIVE,
                emailVerifiedAt: new Date(),
            };
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            passwordUtils.comparePassword.mockResolvedValue(false);
            mockUserRepository.incrementLoginAttempts.mockResolvedValue(mockUser);
            await expect(userService.login(loginCredentials)).rejects.toThrow(errors_1.UnauthorizedError);
            expect(mockUserRepository.incrementLoginAttempts).toHaveBeenCalledWith(mockUser.id);
        });
        it('should reject login for locked accounts', async () => {
            const mockUser = {
                id: '123',
                email: loginCredentials.email,
                status: user_entity_1.UserStatus.ACTIVE,
                lockedUntil: new Date(Date.now() + 1000000),
            };
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            await expect(userService.login(loginCredentials)).rejects.toThrow(errors_1.UnauthorizedError);
            await expect(userService.login(loginCredentials)).rejects.toThrow('Account is locked');
        });
        it('should reject login for unverified emails', async () => {
            const mockUser = {
                id: '123',
                email: loginCredentials.email,
                password: 'hashed_password',
                status: user_entity_1.UserStatus.PENDING,
                emailVerifiedAt: null,
            };
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            passwordUtils.comparePassword.mockResolvedValue(true);
            await expect(userService.login(loginCredentials)).rejects.toThrow(errors_1.UnauthorizedError);
            await expect(userService.login(loginCredentials)).rejects.toThrow('Please verify your email before logging in');
        });
        it('should reject login for suspended accounts', async () => {
            const mockUser = {
                id: '123',
                email: loginCredentials.email,
                status: user_entity_1.UserStatus.SUSPENDED,
            };
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            await expect(userService.login(loginCredentials)).rejects.toThrow(errors_1.UnauthorizedError);
            await expect(userService.login(loginCredentials)).rejects.toThrow('Account is suspended');
        });
    });
    /**
     * TDD Cycle 3: Email Verification
     */
    describe('verifyEmail', () => {
        it('should verify email successfully', async () => {
            const token = 'valid_token';
            const mockUser = {
                id: '123',
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
            };
            mockUserRepository.verifyEmail.mockResolvedValue(mockUser);
            const result = await userService.verifyEmail(token);
            expect(result).toEqual(mockUser);
            expect(mockUserRepository.verifyEmail).toHaveBeenCalledWith(token);
        });
        it('should reject invalid verification token', async () => {
            mockUserRepository.verifyEmail.mockRejectedValue(new errors_1.NotFoundError('Invalid verification token'));
            await expect(userService.verifyEmail('invalid_token')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    /**
     * TDD Cycle 4: Request Password Reset
     */
    describe('requestPasswordReset', () => {
        it('should generate password reset token', async () => {
            const email = 'user@example.com';
            const mockUser = {
                id: '123',
                email,
                passwordResetToken: 'reset_token',
            };
            mockUserRepository.findByEmail.mockResolvedValue(mockUser);
            mockUserRepository.setPasswordResetToken.mockResolvedValue(mockUser);
            const result = await userService.requestPasswordReset(email);
            expect(result).toEqual(mockUser);
            expect(mockUserRepository.setPasswordResetToken).toHaveBeenCalledWith(mockUser.id, expect.any(String));
        });
        it('should not reveal if email does not exist', async () => {
            // Security: Don't reveal whether email exists
            mockUserRepository.findByEmail.mockResolvedValue(null);
            const result = await userService.requestPasswordReset('nonexistent@example.com');
            expect(result).toBeNull();
            expect(mockUserRepository.setPasswordResetToken).not.toHaveBeenCalled();
        });
    });
    /**
     * TDD Cycle 5: Reset Password
     */
    describe('resetPassword', () => {
        it('should reset password successfully', async () => {
            const token = 'valid_reset_token';
            const newPassword = 'NewSecurePass123!';
            const hashedPassword = 'hashed_new_password';
            const mockUser = { id: '123' };
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: true,
                errors: [],
            });
            passwordUtils.hashPassword.mockResolvedValue(hashedPassword);
            mockUserRepository.resetPassword.mockResolvedValue(mockUser);
            const result = await userService.resetPassword(token, newPassword);
            expect(result).toEqual(mockUser);
            expect(passwordUtils.validatePasswordStrength).toHaveBeenCalledWith(newPassword);
            expect(passwordUtils.hashPassword).toHaveBeenCalledWith(newPassword);
            expect(mockUserRepository.resetPassword).toHaveBeenCalledWith(token, hashedPassword);
        });
        it('should reject weak new password', async () => {
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: false,
                errors: ['Password too weak'],
            });
            await expect(userService.resetPassword('token', 'weak')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    /**
     * TDD Cycle 6: Get User Profile
     */
    describe('getUserById', () => {
        it('should return user profile', async () => {
            const userId = '123';
            const mockUser = {
                id: userId,
                email: 'user@example.com',
                firstName: 'John',
                lastName: 'Doe',
            };
            mockUserRepository.findById.mockResolvedValue(mockUser);
            const result = await userService.getUserById(userId);
            expect(result).toEqual(mockUser);
        });
        it('should throw NotFoundError for non-existent user', async () => {
            mockUserRepository.findById.mockRejectedValue(new errors_1.NotFoundError('User not found'));
            await expect(userService.getUserById('nonexistent')).rejects.toThrow(errors_1.NotFoundError);
        });
    });
    /**
     * TDD Cycle 7: Update User Profile
     */
    describe('updateProfile', () => {
        it('should update user profile', async () => {
            const userId = '123';
            const updateData = {
                firstName: 'Jane',
                lastName: 'Smith',
                phoneNumber: '+1234567890',
            };
            const updatedUser = {
                id: userId,
                ...updateData,
            };
            mockUserRepository.update.mockResolvedValue(updatedUser);
            const result = await userService.updateProfile(userId, updateData);
            expect(result).toEqual(updatedUser);
            expect(mockUserRepository.update).toHaveBeenCalledWith(userId, updateData);
        });
        it('should not allow updating email', async () => {
            const userId = '123';
            const updateData = {
                email: 'newemail@example.com', // Should be rejected
                firstName: 'Jane',
            };
            await userService.updateProfile(userId, updateData);
            expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {
                firstName: 'Jane',
                // email should not be included
            });
        });
        it('should not allow updating password directly', async () => {
            const userId = '123';
            const updateData = {
                password: 'newpassword', // Should be rejected
                firstName: 'Jane',
            };
            await userService.updateProfile(userId, updateData);
            expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {
                firstName: 'Jane',
                // password should not be included
            });
        });
    });
    /**
     * TDD Cycle 8: Change Password
     */
    describe('changePassword', () => {
        it('should change password with correct old password', async () => {
            const userId = '123';
            const oldPassword = 'OldPassword123!';
            const newPassword = 'NewPassword123!';
            const hashedNewPassword = 'hashed_new_password';
            const mockUser = {
                id: userId,
                password: 'hashed_old_password',
            };
            mockUserRepository.findById.mockResolvedValue(mockUser);
            passwordUtils.comparePassword.mockResolvedValue(true);
            passwordUtils.validatePasswordStrength.mockReturnValue({
                valid: true,
                errors: [],
            });
            passwordUtils.hashPassword.mockResolvedValue(hashedNewPassword);
            mockUserRepository.update.mockResolvedValue(mockUser);
            await userService.changePassword(userId, oldPassword, newPassword);
            expect(passwordUtils.comparePassword).toHaveBeenCalledWith(oldPassword, mockUser.password);
            expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {
                password: hashedNewPassword,
            });
        });
        it('should reject with incorrect old password', async () => {
            const userId = '123';
            const mockUser = {
                id: userId,
                password: 'hashed_old_password',
            };
            mockUserRepository.findById.mockResolvedValue(mockUser);
            passwordUtils.comparePassword.mockResolvedValue(false);
            await expect(userService.changePassword(userId, 'wrong_password', 'NewPassword123!')).rejects.toThrow(errors_1.UnauthorizedError);
        });
    });
    /**
     * TDD Cycle 9: Refresh Token
     */
    describe('refreshToken', () => {
        it('should generate new access token with valid refresh token', async () => {
            const refreshToken = 'valid_refresh_token';
            const payload = {
                userId: '123',
                email: 'user@example.com',
                role: 'customer',
            };
            const newAccessToken = 'new_access_token';
            const mockUser = { id: '123', status: user_entity_1.UserStatus.ACTIVE };
            jwtUtils.verifyRefreshToken.mockReturnValue(payload);
            mockUserRepository.findById.mockResolvedValue(mockUser);
            jwtUtils.generateAccessToken.mockReturnValue(newAccessToken);
            const result = await userService.refreshToken(refreshToken);
            expect(result).toEqual({ accessToken: newAccessToken });
        });
        it('should reject invalid refresh token', async () => {
            jwtUtils.verifyRefreshToken.mockImplementation(() => {
                throw new errors_1.UnauthorizedError('Invalid refresh token');
            });
            await expect(userService.refreshToken('invalid_token')).rejects.toThrow(errors_1.UnauthorizedError);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHVzZXItbWFuYWdlbWVudFxcc2VydmljZXNcXHVzZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBY0gsb0JBQW9CO0FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7QUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBZmxDLGlEQUE2QztBQUU3Qyx5REFBcUU7QUFDckUseUNBS3NCO0FBQ3RCLHlFQUEyRDtBQUMzRCwrREFBaUQ7QUFPakQsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxXQUF3QixDQUFDO0lBQzdCLElBQUksa0JBQStDLENBQUM7SUFFcEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGtCQUFrQixHQUFHO1lBQ25CLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3JCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLHNCQUFzQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3Qix5QkFBeUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3BDLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEMsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIs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QztZQUNwRSxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkQsUUFBUSxDQUFDLG1CQUFpQyxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUU1RSxNQUFNLE1BQU0sR0FBRyxNQUFNLFdBQVcsQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQzFELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELFFBQVEsQ0FBQyxrQkFBZ0MsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2pFLE1BQU0sSUFBSSwwQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQ3ZELENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQ3JFLDBCQUFpQixDQUNsQixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFx1c2VyLW1hbmFnZW1lbnRcXHNlcnZpY2VzXFx1c2VyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRERDogVXNlciBTZXJ2aWNlIFRlc3RzXG4gKlxuICogVGVzdGluZyBidXNpbmVzcyBsb2dpYyBsYXllcjpcbiAqIC0gVXNlciByZWdpc3RyYXRpb24gZmxvd1xuICogLSBBdXRoZW50aWNhdGlvblxuICogLSBQYXNzd29yZCBtYW5hZ2VtZW50XG4gKiAtIEVtYWlsIHZlcmlmaWNhdGlvblxuICogLSBVc2VyIHByb2ZpbGUgdXBkYXRlc1xuICovXG5cbmltcG9ydCB7IFVzZXJTZXJ2aWNlIH0gZnJvbSAnLi91c2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvdXNlci5yZXBvc2l0b3J5JztcbmltcG9ydCB7IFVzZXIsIFVzZXJSb2xlLCBVc2VyU3RhdHVzIH0gZnJvbSAnLi4vZW50aXRpZXMvdXNlci5lbnRpdHknO1xuaW1wb3J0IHtcbiAgQ29uZmxpY3RFcnJvcixcbiAgVW5hdXRob3JpemVkRXJyb3IsXG4gIEJhZFJlcXVlc3RFcnJvcixcbiAgTm90Rm91bmRFcnJvcixcbn0gZnJvbSAnQGxpYnMvZXJyb3JzJztcbmltcG9ydCAqIGFzIHBhc3N3b3JkVXRpbHMgZnJvbSAnQGxpYnMvYXV0aC9wYXNzd29yZC51dGlscyc7XG5pbXBvcnQgKiBhcyBqd3RVdGlscyBmcm9tICdAbGlicy9hdXRoL2p3dC51dGlscyc7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJy4uL3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknKTtcbmplc3QubW9jaygnQGxpYnMvYXV0aC9wYXNzd29yZC51dGlscycpO1xuamVzdC5tb2NrKCdAbGlicy9hdXRoL2p3dC51dGlscycpO1xuXG5kZXNjcmliZSgnVXNlclNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCB1c2VyU2VydmljZTogVXNlclNlcnZpY2U7XG4gIGxldCBtb2NrVXNlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrVXNlclJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGVVc2VyOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlFbWFpbDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIGVtYWlsRXhpc3RzOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVMYXN0TG9naW46IGplc3QuZm4oKSxcbiAgICAgIGluY3JlbWVudExvZ2luQXR0ZW1wdHM6IGplc3QuZm4oKSxcbiAgICAgIHJlc2V0TG9naW5BdHRlbXB0czogamVzdC5mbigpLFxuICAgICAgc2V0RW1haWxWZXJpZmljYXRpb25Ub2tlbjogamVzdC5mbigpLFxuICAgICAgdmVyaWZ5RW1haWw6IGplc3QuZm4oKSxcbiAgICAgIHNldFBhc3N3b3JkUmVzZXRUb2tlbjogamVzdC5mbigpLFxuICAgICAgcmVzZXRQYXNzd29yZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlSb2xlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlTdGF0dXM6IGplc3QuZm4oKSxcbiAgICB9IGFzIHVua25vd24gYXMgamVzdC5Nb2NrZWQ8VXNlclJlcG9zaXRvcnk+O1xuXG4gICAgdXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UobW9ja1VzZXJSZXBvc2l0b3J5KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSAxOiBVc2VyIFJlZ2lzdHJhdGlvblxuICAgKi9cbiAgZGVzY3JpYmUoJ3JlZ2lzdGVyJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkUmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgIGVtYWlsOiAnbmV3dXNlckBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGEgbmV3IHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSAnaGFzaGVkX3Bhc3N3b3JkJztcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuID0gJ3ZlcmlmaWNhdGlvbl90b2tlbic7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICAuLi52YWxpZFJlZ2lzdHJhdGlvbkRhdGEsXG4gICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb25Ub2tlbjogdmVyaWZpY2F0aW9uVG9rZW4sXG4gICAgICAgIHJvbGU6IFVzZXJSb2xlLkNVU1RPTUVSLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuUEVORElORyxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgKHBhc3N3b3JkVXRpbHMudmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIGVycm9yczogW10sXG4gICAgICB9KTtcbiAgICAgIChwYXNzd29yZFV0aWxzLmhhc2hQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKGhhc2hlZFBhc3N3b3JkKTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5jcmVhdGVVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UucmVnaXN0ZXIodmFsaWRSZWdpc3RyYXRpb25EYXRhKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXNlcik7XG4gICAgICBleHBlY3QocGFzc3dvcmRVdGlscy52YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGgpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZFJlZ2lzdHJhdGlvbkRhdGEucGFzc3dvcmRcbiAgICAgICk7XG4gICAgICBleHBlY3QocGFzc3dvcmRVdGlscy5oYXNoUGFzc3dvcmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbGlkUmVnaXN0cmF0aW9uRGF0YS5wYXNzd29yZCk7XG4gICAgICBleHBlY3QobW9ja1VzZXJSZXBvc2l0b3J5LmNyZWF0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZW1haWw6IHZhbGlkUmVnaXN0cmF0aW9uRGF0YS5lbWFpbCxcbiAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgZmlyc3ROYW1lOiB2YWxpZFJlZ2lzdHJhdGlvbkRhdGEuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiB2YWxpZFJlZ2lzdHJhdGlvbkRhdGEubGFzdE5hbWUsXG4gICAgICAgICAgZW1haWxWZXJpZmljYXRpb25Ub2tlbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdlYWsgcGFzc3dvcmRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2Vha1Bhc3N3b3JkRGF0YSA9IHtcbiAgICAgICAgLi4udmFsaWRSZWdpc3RyYXRpb25EYXRhLFxuICAgICAgICBwYXNzd29yZDogJ3dlYWsnLFxuICAgICAgfTtcblxuICAgICAgKHBhc3N3b3JkVXRpbHMudmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcnM6IFsnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnXSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UucmVnaXN0ZXIod2Vha1Bhc3N3b3JkRGF0YSkpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZHVwbGljYXRlIGVtYWlsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHBhc3N3b3JkVXRpbHMudmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIGVycm9yczogW10sXG4gICAgICB9KTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5jcmVhdGVVc2VyLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQ29uZmxpY3RFcnJvcignVXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMnKVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLnJlZ2lzdGVyKHZhbGlkUmVnaXN0cmF0aW9uRGF0YSkpLnJlamVjdHMudG9UaHJvdyhDb25mbGljdEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgdmVyaWZpY2F0aW9uIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHBhc3N3b3JkVXRpbHMudmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIGVycm9yczogW10sXG4gICAgICB9KTtcbiAgICAgIChwYXNzd29yZFV0aWxzLmhhc2hQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKCdoYXNoZWQnKTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5jcmVhdGVVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIFVzZXIpO1xuXG4gICAgICBhd2FpdCB1c2VyU2VydmljZS5yZWdpc3Rlcih2YWxpZFJlZ2lzdHJhdGlvbkRhdGEpO1xuXG4gICAgICBleHBlY3QobW9ja1VzZXJSZXBvc2l0b3J5LmNyZWF0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZW1haWxWZXJpZmljYXRpb25Ub2tlbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSAyOiBVc2VyIExvZ2luXG4gICAqL1xuICBkZXNjcmliZSgnbG9naW4nLCAoKSA9PiB7XG4gICAgY29uc3QgbG9naW5DcmVkZW50aWFscyA9IHtcbiAgICAgIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ0NvcnJlY3RQYXNzd29yZDEyMyEnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGxvZ2luIHN1Y2Nlc3NmdWxseSB3aXRoIGNvcnJlY3QgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICBlbWFpbDogbG9naW5DcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRfcGFzc3dvcmQnLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgIGxvY2tlZFVudGlsOiBudWxsLFxuICAgICAgICByb2xlOiBVc2VyUm9sZS5DVVNUT01FUixcbiAgICAgIH0gYXMgdW5rbm93biBhcyBVc2VyO1xuXG4gICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9ICdhY2Nlc3NfdG9rZW4nO1xuICAgICAgY29uc3QgcmVmcmVzaFRva2VuID0gJ3JlZnJlc2hfdG9rZW4nO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKHBhc3N3b3JkVXRpbHMuY29tcGFyZVBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICAoand0VXRpbHMuZ2VuZXJhdGVBY2Nlc3NUb2tlbiBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShhY2Nlc3NUb2tlbik7XG4gICAgICAoand0VXRpbHMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUocmVmcmVzaFRva2VuKTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldExvZ2luQXR0ZW1wdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZUxhc3RMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJTZXJ2aWNlLmxvZ2luKGxvZ2luQ3JlZGVudGlhbHMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjogbW9ja1VzZXIsXG4gICAgICAgIGFjY2Vzc1Rva2VuLFxuICAgICAgICByZWZyZXNoVG9rZW4sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRMb2dpbkF0dGVtcHRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlci5pZCk7XG4gICAgICBleHBlY3QobW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZUxhc3RMb2dpbikudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja1VzZXIuaWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbG9naW4gZm9yIG5vbi1leGlzdGVudCB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbG9naW4gd2l0aCBpbmNvcnJlY3QgcGFzc3dvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICBlbWFpbDogbG9naW5DcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRfcGFzc3dvcmQnLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIFVzZXI7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICAocGFzc3dvcmRVdGlscy5jb21wYXJlUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuaW5jcmVtZW50TG9naW5BdHRlbXB0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyU2VydmljZS5sb2dpbihsb2dpbkNyZWRlbnRpYWxzKSkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEVycm9yKTtcbiAgICAgIGV4cGVjdChtb2NrVXNlclJlcG9zaXRvcnkuaW5jcmVtZW50TG9naW5BdHRlbXB0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja1VzZXIuaWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbG9naW4gZm9yIGxvY2tlZCBhY2NvdW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIGVtYWlsOiBsb2dpbkNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgICBsb2NrZWRVbnRpbDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDEwMDAwMDApLFxuICAgICAgfSBhcyBVc2VyO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdygnQWNjb3VudCBpcyBsb2NrZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGxvZ2luIGZvciB1bnZlcmlmaWVkIGVtYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIGVtYWlsOiBsb2dpbkNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICBwYXNzd29yZDogJ2hhc2hlZF9wYXNzd29yZCcsXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG51bGwsXG4gICAgICB9IGFzIHVua25vd24gYXMgVXNlcjtcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIChwYXNzd29yZFV0aWxzLmNvbXBhcmVQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4obG9naW5DcmVkZW50aWFscykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ1BsZWFzZSB2ZXJpZnkgeW91ciBlbWFpbCBiZWZvcmUgbG9nZ2luZyBpbidcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBsb2dpbiBmb3Igc3VzcGVuZGVkIGFjY291bnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnMTIzJyxcbiAgICAgICAgZW1haWw6IGxvZ2luQ3JlZGVudGlhbHMuZW1haWwsXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5TVVNQRU5ERUQsXG4gICAgICB9IGFzIFVzZXI7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyU2VydmljZS5sb2dpbihsb2dpbkNyZWRlbnRpYWxzKSkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyU2VydmljZS5sb2dpbihsb2dpbkNyZWRlbnRpYWxzKSkucmVqZWN0cy50b1Rocm93KCdBY2NvdW50IGlzIHN1c3BlbmRlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDM6IEVtYWlsIFZlcmlmaWNhdGlvblxuICAgKi9cbiAgZGVzY3JpYmUoJ3ZlcmlmeUVtYWlsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmVyaWZ5IGVtYWlsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3ZhbGlkX3Rva2VuJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnZlcmlmeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UudmVyaWZ5RW1haWwodG9rZW4pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2VyKTtcbiAgICAgIGV4cGVjdChtb2NrVXNlclJlcG9zaXRvcnkudmVyaWZ5RW1haWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgdmVyaWZpY2F0aW9uIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnZlcmlmeUVtYWlsLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFcnJvcignSW52YWxpZCB2ZXJpZmljYXRpb24gdG9rZW4nKVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLnZlcmlmeUVtYWlsKCdpbnZhbGlkX3Rva2VuJykpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA0OiBSZXF1ZXN0IFBhc3N3b3JkIFJlc2V0XG4gICAqL1xuICBkZXNjcmliZSgncmVxdWVzdFBhc3N3b3JkUmVzZXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBwYXNzd29yZCByZXNldCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3VzZXJAZXhhbXBsZS5jb20nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAnMTIzJyxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkUmVzZXRUb2tlbjogJ3Jlc2V0X3Rva2VuJyxcbiAgICAgIH0gYXMgVXNlcjtcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRQYXNzd29yZFJlc2V0VG9rZW4ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5yZXF1ZXN0UGFzc3dvcmRSZXNldChlbWFpbCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRQYXNzd29yZFJlc2V0VG9rZW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBtb2NrVXNlci5pZCxcbiAgICAgICAgZXhwZWN0LmFueShTdHJpbmcpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmV2ZWFsIGlmIGVtYWlsIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2VjdXJpdHk6IERvbid0IHJldmVhbCB3aGV0aGVyIGVtYWlsIGV4aXN0c1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5yZXF1ZXN0UGFzc3dvcmRSZXNldCgnbm9uZXhpc3RlbnRAZXhhbXBsZS5jb20nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChtb2NrVXNlclJlcG9zaXRvcnkuc2V0UGFzc3dvcmRSZXNldFRva2VuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDU6IFJlc2V0IFBhc3N3b3JkXG4gICAqL1xuICBkZXNjcmliZSgncmVzZXRQYXNzd29yZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2V0IHBhc3N3b3JkIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3ZhbGlkX3Jlc2V0X3Rva2VuJztcbiAgICAgIGNvbnN0IG5ld1Bhc3N3b3JkID0gJ05ld1NlY3VyZVBhc3MxMjMhJztcbiAgICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gJ2hhc2hlZF9uZXdfcGFzc3dvcmQnO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiAnMTIzJyB9IGFzIFVzZXI7XG5cbiAgICAgIChwYXNzd29yZFV0aWxzLnZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgfSk7XG4gICAgICAocGFzc3dvcmRVdGlscy5oYXNoUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShoYXNoZWRQYXNzd29yZCk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRQYXNzd29yZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJTZXJ2aWNlLnJlc2V0UGFzc3dvcmQodG9rZW4sIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXNlcik7XG4gICAgICBleHBlY3QocGFzc3dvcmRVdGlscy52YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGgpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG5ld1Bhc3N3b3JkKTtcbiAgICAgIGV4cGVjdChwYXNzd29yZFV0aWxzLmhhc2hQYXNzd29yZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgobmV3UGFzc3dvcmQpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldFBhc3N3b3JkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0b2tlbiwgaGFzaGVkUGFzc3dvcmQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3Qgd2VhayBuZXcgcGFzc3dvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocGFzc3dvcmRVdGlscy52YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGggYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yczogWydQYXNzd29yZCB0b28gd2VhayddLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyU2VydmljZS5yZXNldFBhc3N3b3JkKCd0b2tlbicsICd3ZWFrJykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogVEREIEN5Y2xlIDY6IEdldCBVc2VyIFByb2ZpbGVcbiAgICovXG4gIGRlc2NyaWJlKCdnZXRVc2VyQnlJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHByb2ZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAnMTIzJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBlbWFpbDogJ3VzZXJAZXhhbXBsZS5jb20nLFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgfSBhcyBVc2VyO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRVc2VyQnlJZCh1c2VySWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFcnJvciBmb3Igbm9uLWV4aXN0ZW50IHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1JlamVjdGVkVmFsdWUobmV3IE5vdEZvdW5kRXJyb3IoJ1VzZXIgbm90IGZvdW5kJykpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UuZ2V0VXNlckJ5SWQoJ25vbmV4aXN0ZW50JykpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA3OiBVcGRhdGUgVXNlciBQcm9maWxlXG4gICAqL1xuICBkZXNjcmliZSgndXBkYXRlUHJvZmlsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB1c2VyIHByb2ZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAnMTIzJztcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICAgIGZpcnN0TmFtZTogJ0phbmUnLFxuICAgICAgICBsYXN0TmFtZTogJ1NtaXRoJyxcbiAgICAgICAgcGhvbmVOdW1iZXI6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICB9O1xuICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSB7XG4gICAgICAgIGlkOiB1c2VySWQsXG4gICAgICAgIC4uLnVwZGF0ZURhdGEsXG4gICAgICB9IGFzIFVzZXI7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZFVzZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS51cGRhdGVQcm9maWxlKHVzZXJJZCwgdXBkYXRlRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZFVzZXIpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZCwgdXBkYXRlRGF0YSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyB1cGRhdGluZyBlbWFpbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICduZXdlbWFpbEBleGFtcGxlLmNvbScsIC8vIFNob3VsZCBiZSByZWplY3RlZFxuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUodXNlcklkLCB1cGRhdGVEYXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZCwge1xuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgICAgLy8gZW1haWwgc2hvdWxkIG5vdCBiZSBpbmNsdWRlZFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyB1cGRhdGluZyBwYXNzd29yZCBkaXJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgcGFzc3dvcmQ6ICduZXdwYXNzd29yZCcsIC8vIFNob3VsZCBiZSByZWplY3RlZFxuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUodXNlcklkLCB1cGRhdGVEYXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZCwge1xuICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgICAgLy8gcGFzc3dvcmQgc2hvdWxkIG5vdCBiZSBpbmNsdWRlZFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBUREQgQ3ljbGUgODogQ2hhbmdlIFBhc3N3b3JkXG4gICAqL1xuICBkZXNjcmliZSgnY2hhbmdlUGFzc3dvcmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjaGFuZ2UgcGFzc3dvcmQgd2l0aCBjb3JyZWN0IG9sZCBwYXNzd29yZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3Qgb2xkUGFzc3dvcmQgPSAnT2xkUGFzc3dvcmQxMjMhJztcbiAgICAgIGNvbnN0IG5ld1Bhc3N3b3JkID0gJ05ld1Bhc3N3b3JkMTIzISc7XG4gICAgICBjb25zdCBoYXNoZWROZXdQYXNzd29yZCA9ICdoYXNoZWRfbmV3X3Bhc3N3b3JkJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBwYXNzd29yZDogJ2hhc2hlZF9vbGRfcGFzc3dvcmQnLFxuICAgICAgfSBhcyBVc2VyO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKHBhc3N3b3JkVXRpbHMuY29tcGFyZVBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICAocGFzc3dvcmRVdGlscy52YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGggYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIH0pO1xuICAgICAgKHBhc3N3b3JkVXRpbHMuaGFzaFBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoaGFzaGVkTmV3UGFzc3dvcmQpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLmNoYW5nZVBhc3N3b3JkKHVzZXJJZCwgb2xkUGFzc3dvcmQsIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KHBhc3N3b3JkVXRpbHMuY29tcGFyZVBhc3N3b3JkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgb2xkUGFzc3dvcmQsXG4gICAgICAgIG1vY2tVc2VyLnBhc3N3b3JkXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZCwge1xuICAgICAgICBwYXNzd29yZDogaGFzaGVkTmV3UGFzc3dvcmQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggaW5jb3JyZWN0IG9sZCBwYXNzd29yZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiB1c2VySWQsXG4gICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkX29sZF9wYXNzd29yZCcsXG4gICAgICB9IGFzIFVzZXI7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICAocGFzc3dvcmRVdGlscy5jb21wYXJlUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgdXNlclNlcnZpY2UuY2hhbmdlUGFzc3dvcmQodXNlcklkLCAnd3JvbmdfcGFzc3dvcmQnLCAnTmV3UGFzc3dvcmQxMjMhJylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFRERCBDeWNsZSA5OiBSZWZyZXNoIFRva2VuXG4gICAqL1xuICBkZXNjcmliZSgncmVmcmVzaFRva2VuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgbmV3IGFjY2VzcyB0b2tlbiB3aXRoIHZhbGlkIHJlZnJlc2ggdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZyZXNoVG9rZW4gPSAndmFsaWRfcmVmcmVzaF90b2tlbic7XG4gICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICB1c2VySWQ6ICcxMjMnLFxuICAgICAgICBlbWFpbDogJ3VzZXJAZXhhbXBsZS5jb20nLFxuICAgICAgICByb2xlOiAnY3VzdG9tZXInLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IG5ld0FjY2Vzc1Rva2VuID0gJ25ld19hY2Nlc3NfdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiAnMTIzJywgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSB9IGFzIFVzZXI7XG5cbiAgICAgIChqd3RVdGlscy52ZXJpZnlSZWZyZXNoVG9rZW4gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUocGF5bG9hZCk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgKGp3dFV0aWxzLmdlbmVyYXRlQWNjZXNzVG9rZW4gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUobmV3QWNjZXNzVG9rZW4pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGFjY2Vzc1Rva2VuOiBuZXdBY2Nlc3NUb2tlbiB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgcmVmcmVzaCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIChqd3RVdGlscy52ZXJpZnlSZWZyZXNoVG9rZW4gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ0ludmFsaWQgcmVmcmVzaCB0b2tlbicpO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh1c2VyU2VydmljZS5yZWZyZXNoVG9rZW4oJ2ludmFsaWRfdG9rZW4nKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBVbmF1dGhvcml6ZWRFcnJvclxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==