{"file":"C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\cart.service.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\cart.service.ts"],"sourcesContent":["/**\n * TDD Implementation: Cart Service\n *\n * Shopping cart management\n */\n\nimport { BadRequestError, NotFoundError } from '@libs/errors';\n\nexport interface CartItem {\n  productId: string;\n  productName: string;\n  productSku: string;\n  unitPrice: number;\n  quantity: number;\n  subtotal: number;\n}\n\nexport interface Cart {\n  userId: string;\n  items: CartItem[];\n  subtotal: number;\n  itemCount: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport interface AddItemDto {\n  productId: string;\n  productName: string;\n  productSku: string;\n  unitPrice: number;\n  quantity: number;\n}\n\nexport class CartService {\n  constructor(private cartStorage: Map<string, Cart>) {}\n\n  /**\n   * Get cart for user (create if doesn't exist)\n   */\n  async getCart(userId: string): Promise<Cart> {\n    let cart = this.cartStorage.get(userId);\n\n    if (!cart) {\n      cart = {\n        userId,\n        items: [],\n        subtotal: 0,\n        itemCount: 0,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n      this.cartStorage.set(userId, cart);\n    }\n\n    return cart;\n  }\n\n  /**\n   * Add item to cart\n   */\n  async addItem(userId: string, item: AddItemDto): Promise<Cart> {\n    if (item.quantity <= 0) {\n      throw new BadRequestError('Quantity must be positive');\n    }\n\n    const cart = await this.getCart(userId);\n\n    // Check if item already exists\n    const existingItem = cart.items.find(i => i.productId === item.productId);\n\n    if (existingItem) {\n      // Update quantity\n      existingItem.quantity += item.quantity;\n      existingItem.subtotal = existingItem.unitPrice * existingItem.quantity;\n    } else {\n      // Add new item\n      cart.items.push({\n        ...item,\n        subtotal: item.unitPrice * item.quantity,\n      });\n    }\n\n    // Recalculate cart totals\n    this.recalculateCart(cart);\n    cart.updatedAt = new Date();\n\n    this.cartStorage.set(userId, cart);\n    return cart;\n  }\n\n  /**\n   * Update item quantity\n   */\n  async updateItemQuantity(userId: string, productId: string, quantity: number): Promise<Cart> {\n    if (quantity < 0) {\n      throw new BadRequestError('Quantity must be positive');\n    }\n\n    const cart = await this.getCart(userId);\n    const item = cart.items.find(i => i.productId === productId);\n\n    if (!item) {\n      throw new NotFoundError('Item not found in cart');\n    }\n\n    if (quantity === 0) {\n      // Remove item if quantity is zero\n      return this.removeItem(userId, productId);\n    }\n\n    item.quantity = quantity;\n    item.subtotal = item.unitPrice * item.quantity;\n\n    this.recalculateCart(cart);\n    cart.updatedAt = new Date();\n\n    this.cartStorage.set(userId, cart);\n    return cart;\n  }\n\n  /**\n   * Remove item from cart\n   */\n  async removeItem(userId: string, productId: string): Promise<Cart> {\n    const cart = await this.getCart(userId);\n    const itemIndex = cart.items.findIndex(i => i.productId === productId);\n\n    if (itemIndex === -1) {\n      throw new NotFoundError('Item not found in cart');\n    }\n\n    cart.items.splice(itemIndex, 1);\n\n    this.recalculateCart(cart);\n    cart.updatedAt = new Date();\n\n    this.cartStorage.set(userId, cart);\n    return cart;\n  }\n\n  /**\n   * Clear cart\n   */\n  async clearCart(userId: string): Promise<Cart> {\n    const cart = await this.getCart(userId);\n\n    cart.items = [];\n    cart.subtotal = 0;\n    cart.itemCount = 0;\n    cart.updatedAt = new Date();\n\n    this.cartStorage.set(userId, cart);\n    return cart;\n  }\n\n  /**\n   * Get cart item count\n   */\n  async getCartItemCount(userId: string): Promise<number> {\n    const cart = await this.getCart(userId);\n    return cart.itemCount;\n  }\n\n  /**\n   * Get cart subtotal\n   */\n  async getCartSubtotal(userId: string): Promise<number> {\n    const cart = await this.getCart(userId);\n    return cart.subtotal;\n  }\n\n  /**\n   * Recalculate cart totals\n   */\n  private recalculateCart(cart: Cart): void {\n    cart.subtotal = cart.items.reduce((sum, item) => sum + item.subtotal, 0);\n    cart.itemCount = cart.items.reduce((sum, item) => sum + item.quantity, 0);\n  }\n}\n"],"version":3}