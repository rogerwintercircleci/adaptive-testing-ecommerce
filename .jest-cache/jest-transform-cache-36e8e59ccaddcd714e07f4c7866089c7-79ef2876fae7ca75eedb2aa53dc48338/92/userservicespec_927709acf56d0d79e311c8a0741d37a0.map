{"file":"C:\\Adaptive_Testing\\src\\services\\user-management\\services\\user.service.spec.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\src\\services\\user-management\\services\\user.service.spec.ts"],"sourcesContent":["/**\n * TDD: User Service Tests\n *\n * Testing business logic layer:\n * - User registration flow\n * - Authentication\n * - Password management\n * - Email verification\n * - User profile updates\n */\n\nimport { UserService } from './user.service';\nimport { UserRepository } from '../repositories/user.repository';\nimport { User, UserRole, UserStatus } from '../entities/user.entity';\nimport {\n  ConflictError,\n  UnauthorizedError,\n  BadRequestError,\n  NotFoundError,\n} from '@libs/errors';\nimport * as passwordUtils from '@libs/auth/password.utils';\nimport * as jwtUtils from '@libs/auth/jwt.utils';\n\n// Mock dependencies\njest.mock('../repositories/user.repository');\njest.mock('@libs/auth/password.utils');\njest.mock('@libs/auth/jwt.utils');\n\ndescribe('UserService', () => {\n  let userService: UserService;\n  let mockUserRepository: jest.Mocked<UserRepository>;\n\n  beforeEach(() => {\n    mockUserRepository = {\n      createUser: jest.fn(),\n      findByEmail: jest.fn(),\n      findById: jest.fn(),\n      emailExists: jest.fn(),\n      updateLastLogin: jest.fn(),\n      incrementLoginAttempts: jest.fn(),\n      resetLoginAttempts: jest.fn(),\n      setEmailVerificationToken: jest.fn(),\n      verifyEmail: jest.fn(),\n      setPasswordResetToken: jest.fn(),\n      resetPassword: jest.fn(),\n      update: jest.fn(),\n      findByRole: jest.fn(),\n      findByStatus: jest.fn(),\n    } as unknown as jest.Mocked<UserRepository>;\n\n    userService = new UserService(mockUserRepository);\n  });\n\n  /**\n   * TDD Cycle 1: User Registration\n   */\n  describe('register', () => {\n    const validRegistrationData = {\n      email: 'newuser@example.com',\n      password: 'SecurePass123!',\n      firstName: 'John',\n      lastName: 'Doe',\n    };\n\n    it('should register a new user successfully', async () => {\n      const hashedPassword = 'hashed_password';\n      const verificationToken = 'verification_token';\n      const mockUser = {\n        id: '123',\n        ...validRegistrationData,\n        password: hashedPassword,\n        emailVerificationToken: verificationToken,\n        role: UserRole.CUSTOMER,\n        status: UserStatus.PENDING,\n      } as User;\n\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: true,\n        errors: [],\n      });\n      (passwordUtils.hashPassword as jest.Mock).mockResolvedValue(hashedPassword);\n      mockUserRepository.createUser.mockResolvedValue(mockUser);\n\n      const result = await userService.register(validRegistrationData);\n\n      expect(result).toEqual({ user: mockUser });\n      expect(passwordUtils.validatePasswordStrength).toHaveBeenCalledWith(\n        validRegistrationData.password\n      );\n      expect(passwordUtils.hashPassword).toHaveBeenCalledWith(validRegistrationData.password);\n      expect(mockUserRepository.createUser).toHaveBeenCalledWith(\n        expect.objectContaining({\n          email: validRegistrationData.email,\n          password: hashedPassword,\n          firstName: validRegistrationData.firstName,\n          lastName: validRegistrationData.lastName,\n          emailVerificationToken: expect.any(String),\n        })\n      );\n    });\n\n    it('should reject weak passwords', async () => {\n      const weakPasswordData = {\n        ...validRegistrationData,\n        password: 'weak',\n      };\n\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: false,\n        errors: ['Password must be at least 8 characters'],\n      });\n\n      await expect(userService.register(weakPasswordData)).rejects.toThrow(BadRequestError);\n    });\n\n    it('should reject duplicate email', async () => {\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: true,\n        errors: [],\n      });\n      mockUserRepository.createUser.mockRejectedValue(\n        new ConflictError('User with this email already exists')\n      );\n\n      await expect(userService.register(validRegistrationData)).rejects.toThrow(ConflictError);\n    });\n\n    it('should generate verification token', async () => {\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: true,\n        errors: [],\n      });\n      (passwordUtils.hashPassword as jest.Mock).mockResolvedValue('hashed');\n      mockUserRepository.createUser.mockResolvedValue({} as User);\n\n      await userService.register(validRegistrationData);\n\n      expect(mockUserRepository.createUser).toHaveBeenCalledWith(\n        expect.objectContaining({\n          emailVerificationToken: expect.any(String),\n        })\n      );\n    });\n  });\n\n  /**\n   * TDD Cycle 2: User Login\n   */\n  describe('login', () => {\n    const loginCredentials = {\n      email: 'user@example.com',\n      password: 'CorrectPassword123!',\n    };\n\n    it('should login successfully with correct credentials', async () => {\n      const mockUser = {\n        id: '123',\n        email: loginCredentials.email,\n        password: 'hashed_password',\n        status: UserStatus.ACTIVE,\n        emailVerifiedAt: new Date(),\n        loginAttempts: 0,\n        lockedUntil: null,\n        role: UserRole.CUSTOMER,\n      } as unknown as User;\n\n      const accessToken = 'access_token';\n      const refreshToken = 'refresh_token';\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n      (passwordUtils.comparePassword as jest.Mock).mockResolvedValue(true);\n      (jwtUtils.generateAccessToken as jest.Mock).mockReturnValue(accessToken);\n      (jwtUtils.generateRefreshToken as jest.Mock).mockReturnValue(refreshToken);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue(mockUser);\n      mockUserRepository.updateLastLogin.mockResolvedValue(mockUser);\n\n      const result = await userService.login(loginCredentials);\n\n      expect(result).toEqual({\n        user: mockUser,\n        accessToken,\n        refreshToken,\n        token: accessToken, // Alias for backward compatibility\n      });\n      expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalledWith(mockUser.id);\n      expect(mockUserRepository.updateLastLogin).toHaveBeenCalledWith(mockUser.id);\n    });\n\n    it('should reject login for non-existent user', async () => {\n      mockUserRepository.findByEmail.mockResolvedValue(null);\n\n      await expect(userService.login(loginCredentials)).rejects.toThrow(UnauthorizedError);\n      await expect(userService.login(loginCredentials)).rejects.toThrow('Invalid credentials');\n    });\n\n    it('should reject login with incorrect password', async () => {\n      const mockUser = {\n        id: '123',\n        email: loginCredentials.email,\n        password: 'hashed_password',\n        status: UserStatus.ACTIVE,\n        emailVerifiedAt: new Date(),\n      } as User;\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n      (passwordUtils.comparePassword as jest.Mock).mockResolvedValue(false);\n      mockUserRepository.incrementLoginAttempts.mockResolvedValue(mockUser);\n\n      await expect(userService.login(loginCredentials)).rejects.toThrow(UnauthorizedError);\n      expect(mockUserRepository.incrementLoginAttempts).toHaveBeenCalledWith(mockUser.id);\n    });\n\n    it('should reject login for locked accounts', async () => {\n      const mockUser = {\n        id: '123',\n        email: loginCredentials.email,\n        status: UserStatus.ACTIVE,\n        lockedUntil: new Date(Date.now() + 1000000),\n      } as User;\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n\n      await expect(userService.login(loginCredentials)).rejects.toThrow(UnauthorizedError);\n      await expect(userService.login(loginCredentials)).rejects.toThrow('Account is locked');\n    });\n\n    it('should reject login for unverified emails', async () => {\n      const mockUser = {\n        id: '123',\n        email: loginCredentials.email,\n        password: 'hashed_password',\n        status: UserStatus.PENDING,\n        emailVerifiedAt: null,\n      } as unknown as User;\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n      (passwordUtils.comparePassword as jest.Mock).mockResolvedValue(true);\n\n      await expect(userService.login(loginCredentials)).rejects.toThrow(UnauthorizedError);\n      await expect(userService.login(loginCredentials)).rejects.toThrow(\n        'Please verify your email before logging in'\n      );\n    });\n\n    it('should reject login for suspended accounts', async () => {\n      const mockUser = {\n        id: '123',\n        email: loginCredentials.email,\n        status: UserStatus.SUSPENDED,\n      } as User;\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n\n      await expect(userService.login(loginCredentials)).rejects.toThrow(UnauthorizedError);\n      await expect(userService.login(loginCredentials)).rejects.toThrow('Account is suspended');\n    });\n  });\n\n  /**\n   * TDD Cycle 3: Email Verification\n   */\n  describe('verifyEmail', () => {\n    it('should verify email successfully', async () => {\n      const token = 'valid_token';\n      const mockUser = {\n        id: '123',\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n      } as User;\n\n      mockUserRepository.verifyEmail.mockResolvedValue(mockUser);\n\n      const result = await userService.verifyEmail(token);\n\n      expect(result).toEqual(mockUser);\n      expect(mockUserRepository.verifyEmail).toHaveBeenCalledWith(token);\n    });\n\n    it('should reject invalid verification token', async () => {\n      mockUserRepository.verifyEmail.mockRejectedValue(\n        new NotFoundError('Invalid verification token')\n      );\n\n      await expect(userService.verifyEmail('invalid_token')).rejects.toThrow(NotFoundError);\n    });\n  });\n\n  /**\n   * TDD Cycle 4: Request Password Reset\n   */\n  describe('requestPasswordReset', () => {\n    it('should generate password reset token', async () => {\n      const email = 'user@example.com';\n      const mockUser = {\n        id: '123',\n        email,\n        passwordResetToken: 'reset_token',\n      } as User;\n\n      mockUserRepository.findByEmail.mockResolvedValue(mockUser);\n      mockUserRepository.setPasswordResetToken.mockResolvedValue(mockUser);\n\n      const result = await userService.requestPasswordReset(email);\n\n      expect(result).toEqual(mockUser);\n      expect(mockUserRepository.setPasswordResetToken).toHaveBeenCalledWith(\n        mockUser.id,\n        expect.any(String)\n      );\n    });\n\n    it('should not reveal if email does not exist', async () => {\n      // Security: Don't reveal whether email exists\n      mockUserRepository.findByEmail.mockResolvedValue(null);\n\n      const result = await userService.requestPasswordReset('nonexistent@example.com');\n\n      expect(result).toBeNull();\n      expect(mockUserRepository.setPasswordResetToken).not.toHaveBeenCalled();\n    });\n  });\n\n  /**\n   * TDD Cycle 5: Reset Password\n   */\n  describe('resetPassword', () => {\n    it('should reset password successfully', async () => {\n      const token = 'valid_reset_token';\n      const newPassword = 'NewSecurePass123!';\n      const hashedPassword = 'hashed_new_password';\n      const mockUser = { id: '123' } as User;\n\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: true,\n        errors: [],\n      });\n      (passwordUtils.hashPassword as jest.Mock).mockResolvedValue(hashedPassword);\n      mockUserRepository.resetPassword.mockResolvedValue(mockUser);\n\n      const result = await userService.resetPassword(token, newPassword);\n\n      expect(result).toEqual(mockUser);\n      expect(passwordUtils.validatePasswordStrength).toHaveBeenCalledWith(newPassword);\n      expect(passwordUtils.hashPassword).toHaveBeenCalledWith(newPassword);\n      expect(mockUserRepository.resetPassword).toHaveBeenCalledWith(token, hashedPassword);\n    });\n\n    it('should reject weak new password', async () => {\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: false,\n        errors: ['Password too weak'],\n      });\n\n      await expect(userService.resetPassword('token', 'weak')).rejects.toThrow(BadRequestError);\n    });\n  });\n\n  /**\n   * TDD Cycle 6: Get User Profile\n   */\n  describe('getUserById', () => {\n    it('should return user profile', async () => {\n      const userId = '123';\n      const mockUser = {\n        id: userId,\n        email: 'user@example.com',\n        firstName: 'John',\n        lastName: 'Doe',\n      } as User;\n\n      mockUserRepository.findById.mockResolvedValue(mockUser);\n\n      const result = await userService.getUserById(userId);\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should throw NotFoundError for non-existent user', async () => {\n      mockUserRepository.findById.mockRejectedValue(new NotFoundError('User not found'));\n\n      await expect(userService.getUserById('nonexistent')).rejects.toThrow(NotFoundError);\n    });\n  });\n\n  /**\n   * TDD Cycle 7: Update User Profile\n   */\n  describe('updateProfile', () => {\n    it('should update user profile', async () => {\n      const userId = '123';\n      const updateData = {\n        firstName: 'Jane',\n        lastName: 'Smith',\n        phoneNumber: '+1234567890',\n      };\n      const updatedUser = {\n        id: userId,\n        ...updateData,\n      } as User;\n\n      mockUserRepository.update.mockResolvedValue(updatedUser);\n\n      const result = await userService.updateProfile(userId, updateData);\n\n      expect(result).toEqual(updatedUser);\n      expect(mockUserRepository.update).toHaveBeenCalledWith(userId, updateData);\n    });\n\n    it('should not allow updating email', async () => {\n      const userId = '123';\n      const updateData = {\n        email: 'newemail@example.com', // Should be rejected\n        firstName: 'Jane',\n      };\n\n      await userService.updateProfile(userId, updateData);\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {\n        firstName: 'Jane',\n        // email should not be included\n      });\n    });\n\n    it('should not allow updating password directly', async () => {\n      const userId = '123';\n      const updateData = {\n        password: 'newpassword', // Should be rejected\n        firstName: 'Jane',\n      };\n\n      await userService.updateProfile(userId, updateData);\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {\n        firstName: 'Jane',\n        // password should not be included\n      });\n    });\n  });\n\n  /**\n   * TDD Cycle 8: Change Password\n   */\n  describe('changePassword', () => {\n    it('should change password with correct old password', async () => {\n      const userId = '123';\n      const oldPassword = 'OldPassword123!';\n      const newPassword = 'NewPassword123!';\n      const hashedNewPassword = 'hashed_new_password';\n      const mockUser = {\n        id: userId,\n        password: 'hashed_old_password',\n      } as User;\n\n      mockUserRepository.findById.mockResolvedValue(mockUser);\n      (passwordUtils.comparePassword as jest.Mock).mockResolvedValue(true);\n      (passwordUtils.validatePasswordStrength as jest.Mock).mockReturnValue({\n        valid: true,\n        errors: [],\n      });\n      (passwordUtils.hashPassword as jest.Mock).mockResolvedValue(hashedNewPassword);\n      mockUserRepository.update.mockResolvedValue(mockUser);\n\n      await userService.changePassword(userId, oldPassword, newPassword);\n\n      expect(passwordUtils.comparePassword).toHaveBeenCalledWith(\n        oldPassword,\n        mockUser.password\n      );\n      expect(mockUserRepository.update).toHaveBeenCalledWith(userId, {\n        password: hashedNewPassword,\n      });\n    });\n\n    it('should reject with incorrect old password', async () => {\n      const userId = '123';\n      const mockUser = {\n        id: userId,\n        password: 'hashed_old_password',\n      } as User;\n\n      mockUserRepository.findById.mockResolvedValue(mockUser);\n      (passwordUtils.comparePassword as jest.Mock).mockResolvedValue(false);\n\n      await expect(\n        userService.changePassword(userId, 'wrong_password', 'NewPassword123!')\n      ).rejects.toThrow(UnauthorizedError);\n    });\n  });\n\n  /**\n   * TDD Cycle 9: Refresh Token\n   */\n  describe('refreshToken', () => {\n    it('should generate new access token with valid refresh token', async () => {\n      const refreshToken = 'valid_refresh_token';\n      const payload = {\n        userId: '123',\n        email: 'user@example.com',\n        role: 'customer',\n      };\n      const newAccessToken = 'new_access_token';\n      const mockUser = { id: '123', status: UserStatus.ACTIVE } as User;\n\n      (jwtUtils.verifyRefreshToken as jest.Mock).mockReturnValue(payload);\n      mockUserRepository.findById.mockResolvedValue(mockUser);\n      (jwtUtils.generateAccessToken as jest.Mock).mockReturnValue(newAccessToken);\n\n      const result = await userService.refreshToken(refreshToken);\n\n      expect(result).toEqual({ accessToken: newAccessToken });\n    });\n\n    it('should reject invalid refresh token', async () => {\n      (jwtUtils.verifyRefreshToken as jest.Mock).mockImplementation(() => {\n        throw new UnauthorizedError('Invalid refresh token');\n      });\n\n      await expect(userService.refreshToken('invalid_token')).rejects.toThrow(\n        UnauthorizedError\n      );\n    });\n  });\n});\n"],"version":3}