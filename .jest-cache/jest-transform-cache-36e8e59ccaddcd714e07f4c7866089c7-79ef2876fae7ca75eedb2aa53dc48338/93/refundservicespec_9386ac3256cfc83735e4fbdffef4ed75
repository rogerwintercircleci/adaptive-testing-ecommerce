e8ab7ee171027ed41da8a5a1d28c2265
"use strict";
/**
 * TDD: Refund & Return Service Tests
 *
 * Testing refund requests, return processing, and restock logic
 */
Object.defineProperty(exports, "__esModule", { value: true });
const refund_service_1 = require("./refund.service");
const errors_1 = require("@libs/errors");
const order_entity_1 = require("../entities/order.entity");
describe('RefundService', () => {
    let refundService;
    let mockRefundRepository;
    let mockOrderRepository;
    let mockInventoryRepository;
    let mockPaymentGatewayService;
    let mockShippingProviderService;
    beforeEach(() => {
        mockRefundRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByOrderId: jest.fn(),
            findByUserId: jest.fn(),
            update: jest.fn(),
            updateStatus: jest.fn(),
            updateReturnStatus: jest.fn(),
            countByStatus: jest.fn(),
            getTotalRefundedAmount: jest.fn(),
        };
        mockOrderRepository = {
            findById: jest.fn(),
            update: jest.fn(),
        };
        mockInventoryRepository = {
            findByProductId: jest.fn(),
            update: jest.fn(),
            recordAdjustment: jest.fn(),
        };
        mockPaymentGatewayService = {
            refundPayment: jest.fn(),
        };
        mockShippingProviderService = {
            generateReturnLabel: jest.fn(),
            trackShipment: jest.fn(),
        };
        refundService = new refund_service_1.RefundService(mockRefundRepository, mockOrderRepository, mockInventoryRepository, mockPaymentGatewayService, mockShippingProviderService);
    });
    describe('createRefundRequest', () => {
        it('should create a refund request', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                description: 'Product was damaged',
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
            };
            const mockOrder = {
                id: 'order-1',
                userId: 'user-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 100,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, subtotal: 100 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                ...refundDto,
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.status).toBe(refund_service_1.RefundStatus.PENDING);
            expect(result.refundAmount).toBe(100);
        });
        it('should reject refund request for non-existent order', async () => {
            const refundDto = {
                orderId: 'invalid',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [],
            };
            mockOrderRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Order not found'));
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject refund request for unpaid order', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const mockOrder = {
                id: 'order-1',
                paymentStatus: order_entity_1.PaymentStatus.PENDING,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('not been paid');
        });
        it('should reject refund request after return window expired', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const sixtyDaysAgo = new Date();
            sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: sixtyDaysAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('return window');
        });
        it('should calculate partial refund amount for partial return', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
            };
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 200,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, subtotal: 50 },
                    { productId: 'prod-2', quantity: 1, subtotal: 150 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                refundAmount: 50,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.refundAmount).toBe(50);
        });
        it('should require photos for defective items', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [{ productId: 'prod-1', quantity: 1 }],
                photos: [],
            };
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('photo evidence');
        });
    });
    describe('approveRefund', () => {
        it('should approve a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
                items: [{ productId: 'prod-1', quantity: 1 }],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
        });
        it('should approve partial refund with adjusted amount', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 75,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
            expect(result.refundAmount).toBe(75);
        });
    });
    describe('rejectRefund', () => {
        it('should reject a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.update.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.REJECTED,
                rejectionReason: 'Outside return window',
            });
            const result = await refundService.rejectRefund('refund-1', 'Outside return window');
            expect(result.status).toBe(refund_service_1.RefundStatus.REJECTED);
            expect(result.rejectionReason).toBe('Outside return window');
        });
    });
    describe('processRefund', () => {
        it('should process approved refund and issue payment', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                refundAmount: 100,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.PROCESSING,
            });
            mockOrderRepository.findById.mockResolvedValue({ id: 'order-1' });
            mockPaymentGatewayService.refundPayment.mockResolvedValue({ success: true, refundId: 'ref-123' });
            mockRefundRepository.update.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.COMPLETED,
                processedAt: new Date(),
            });
            const result = await refundService.processRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.COMPLETED);
            expect(result.processedAt).toBeDefined();
        });
        it('should not process refund that is not approved', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await expect(refundService.processRefund('refund-1')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('restockItems', () => {
        it('should restock returned items to inventory', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                restockItems: true,
                items: [
                    { productId: 'prod-1', quantity: 2 },
                    { productId: 'prod-2', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 10 });
            mockInventoryRepository.update.mockResolvedValue({});
            mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).toHaveBeenCalledTimes(2);
            expect(mockInventoryRepository.update).toHaveBeenCalledWith('prod-1', {
                quantity: 12,
            });
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);
        });
        it('should not restock defective items', async () => {
            const mockRefund = {
                id: 'refund-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                restockItems: false,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).not.toHaveBeenCalled();
        });
    });
    describe('getUserRefunds', () => {
        it('should get all refund requests for a user', async () => {
            const mockRefunds = [
                { id: '1', userId: 'user-1', status: refund_service_1.RefundStatus.COMPLETED },
                { id: '2', userId: 'user-1', status: refund_service_1.RefundStatus.PENDING },
            ];
            mockRefundRepository.findByUserId.mockResolvedValue(mockRefunds);
            const result = await refundService.getUserRefunds('user-1');
            expect(result).toHaveLength(2);
        });
    });
    describe('calculateRefundAmount', () => {
        it('should calculate full refund amount', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                taxAmount: 15,
                shippingCost: 10,
                subtotal: 125,
                items: [
                    { productId: 'prod-1', quantity: 1, price: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBeGreaterThan(0);
        });
        it('should calculate partial refund for subset of items', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 250,
                subtotal: 225,
                items: [
                    { productId: 'prod-1', quantity: 1, price: 100 },
                    { productId: 'prod-2', quantity: 1, price: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(100);
            expect(result.refundAmount).toBeLessThan(mockOrder.total);
        });
        it('should not include shipping in partial refund', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                subtotal: 100,
                shippingCost: 10,
                items: [
                    { productId: 'prod-1', quantity: 1, price: 50 },
                    { productId: 'prod-2', quantity: 1, price: 50 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(50);
        });
    });
    describe('generateReturnLabel', () => {
        it('should generate return shipping label', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            const result = await refundService.generateReturnLabel('refund-1');
            expect(result.labelUrl).toBeDefined();
            expect(result.trackingNumber).toBeDefined();
        });
    });
    describe('trackReturn', () => {
        it('should track return shipment status', async () => {
            const trackingNumber = '1Z999AA10123456784';
            const result = await refundService.trackReturn(trackingNumber);
            expect(result.status).toBeDefined();
            expect(result.events).toBeDefined();
        });
    });
    describe('markReturnAsReceived', () => {
        it('should mark return as received', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateReturnStatus.mockResolvedValue({
                ...mockRefund,
                returnStatus: 'received',
            });
            await refundService.markReturnAsReceived('refund-1');
            expect(mockRefundRepository.updateReturnStatus).toHaveBeenCalled();
        });
    });
    describe('getRefundStatistics', () => {
        it('should get refund statistics', async () => {
            const mockRefunds = [
                { status: refund_service_1.RefundStatus.COMPLETED, refundAmount: 100 },
                { status: refund_service_1.RefundStatus.COMPLETED, refundAmount: 50 },
                { status: refund_service_1.RefundStatus.PENDING, refundAmount: 75 },
            ];
            mockRefundRepository.findByUserId.mockResolvedValue(mockRefunds);
            const result = await refundService.getRefundStatistics();
            expect(result.totalRefunded).toBeGreaterThan(0);
            expect(result.pending).toBeDefined();
            expect(result.completed).toBeDefined();
        });
    });
    describe('checkEligibility', () => {
        it('should check if order is eligible for refund', async () => {
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(true);
        });
        it('should return false for order outside return window', async () => {
            const longAgo = new Date();
            longAgo.setDate(longAgo.getDate() - 100);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: longAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(false);
            expect(result.issues.length).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxyZWZ1bmQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILHFEQUFxRztBQU1yRyx5Q0FBOEQ7QUFDOUQsMkRBQXNFO0FBRXRFLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksYUFBNEIsQ0FBQztJQUNqQyxJQUFJLG9CQUFtRCxDQUFDO0lBQ3hELElBQUksbUJBQWlELENBQUM7SUFDdEQsSUFBSSx1QkFBeUQsQ0FBQztJQUM5RCxJQUFJLHlCQUE2RCxDQUFDO0lBQ2xFLElBQUksMkJBQWlFLENBQUM7SUFFdEUsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG9CQUFvQixHQUFHO1lBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3hCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDN0IsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUMzQixDQUFDO1FBRVQsbUJBQW1CLEdBQUc7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDWCxDQUFDO1FBRVQsdUJBQXVCLEdBQUc7WUFDeEIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFF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QUNuRSxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQzNCLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBRXpDLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixFQUFFLEVBQUUsU0FBUztnQkFDYixNQUFNLEVBQUUsMEJBQVcsQ0FBQyxTQUFTO2dCQUM3QixhQUFhLEVBQUUsNEJBQWEsQ0FBQyxJQUFJO2dCQUNqQyxXQUFXLEVBQUUsT0FBTzthQUNyQixDQUFDO1lBRUYsbUJBQW1CLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFNBQWdCLENBQUMsQ0FBQztZQUVqRSxNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFxvcmRlci1wcm9jZXNzaW5nXFxzZXJ2aWNlc1xccmVmdW5kLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRERDogUmVmdW5kICYgUmV0dXJuIFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIHJlZnVuZCByZXF1ZXN0cywgcmV0dXJuIHByb2Nlc3NpbmcsIGFuZCByZXN0b2NrIGxvZ2ljXG4gKi9cblxuaW1wb3J0IHsgUmVmdW5kU2VydmljZSwgQ3JlYXRlUmVmdW5kUmVxdWVzdER0bywgUmVmdW5kU3RhdHVzLCBSZXR1cm5SZWFzb24gfSBmcm9tICcuL3JlZnVuZC5zZXJ2aWNlJztcbmltcG9ydCB7IFJlZnVuZFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvcmVmdW5kLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgT3JkZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL29yZGVyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgSW52ZW50b3J5UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL2ludmVudG9yeS9yZXBvc2l0b3JpZXMvaW52ZW50b3J5LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUGF5bWVudEdhdGV3YXlTZXJ2aWNlIH0gZnJvbSAnLi9wYXltZW50LWdhdGV3YXkuc2VydmljZSc7XG5pbXBvcnQgeyBTaGlwcGluZ1Byb3ZpZGVyU2VydmljZSB9IGZyb20gJy4vc2hpcHBpbmctcHJvdmlkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXJyb3IsIE5vdEZvdW5kRXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuaW1wb3J0IHsgT3JkZXJTdGF0dXMsIFBheW1lbnRTdGF0dXMgfSBmcm9tICcuLi9lbnRpdGllcy9vcmRlci5lbnRpdHknO1xuXG5kZXNjcmliZSgnUmVmdW5kU2VydmljZScsICgpID0+IHtcbiAgbGV0IHJlZnVuZFNlcnZpY2U6IFJlZnVuZFNlcnZpY2U7XG4gIGxldCBtb2NrUmVmdW5kUmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8UmVmdW5kUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrT3JkZXJSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxPcmRlclJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja0ludmVudG9yeVJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPEludmVudG9yeVJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja1BheW1lbnRHYXRld2F5U2VydmljZTogamVzdC5Nb2NrZWQ8UGF5bWVudEdhdGV3YXlTZXJ2aWNlPjtcbiAgbGV0IG1vY2tTaGlwcGluZ1Byb3ZpZGVyU2VydmljZTogamVzdC5Nb2NrZWQ8U2hpcHBpbmdQcm92aWRlclNlcnZpY2U+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5ID0ge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5T3JkZXJJZDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5VXNlcklkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVN0YXR1czogamVzdC5mbigpLFxuICAgICAgdXBkYXRlUmV0dXJuU3RhdHVzOiBqZXN0LmZuKCksXG4gICAgICBjb3VudEJ5U3RhdHVzOiBqZXN0LmZuKCksXG4gICAgICBnZXRUb3RhbFJlZnVuZGVkQW1vdW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBtb2NrT3JkZXJSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkgPSB7XG4gICAgICBmaW5kQnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgcmVjb3JkQWRqdXN0bWVudDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja1BheW1lbnRHYXRld2F5U2VydmljZSA9IHtcbiAgICAgIHJlZnVuZFBheW1lbnQ6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tTaGlwcGluZ1Byb3ZpZGVyU2VydmljZSA9IHtcbiAgICAgIGdlbmVyYXRlUmV0dXJuTGFiZWw6IGplc3QuZm4oKSxcbiAgICAgIHRyYWNrU2hpcG1lbnQ6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIHJlZnVuZFNlcnZpY2UgPSBuZXcgUmVmdW5kU2VydmljZShcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LFxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeSxcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LFxuICAgICAgbW9ja1BheW1lbnRHYXRld2F5U2VydmljZSxcbiAgICAgIG1vY2tTaGlwcGluZ1Byb3ZpZGVyU2VydmljZVxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVSZWZ1bmRSZXF1ZXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgcmVmdW5kIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Byb2R1Y3Qgd2FzIGRhbWFnZWQnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgdG90YWw6IDEwMCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSwgc3VidG90YWw6IDEwMCB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIC4uLnJlZnVuZER0byxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLlBFTkRJTkcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlZnVuZCByZXF1ZXN0IGZvciBub24tZXhpc3RlbnQgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdpbnZhbGlkJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBOb3RGb3VuZEVycm9yKCdPcmRlciBub3QgZm91bmQnKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVmdW5kIHJlcXVlc3QgZm9yIHVucGFpZCBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5DSEFOR0VEX01JTkQsXG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KCdub3QgYmVlbiBwYWlkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZWZ1bmQgcmVxdWVzdCBhZnRlciByZXR1cm4gd2luZG93IGV4cGlyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uQ0hBTkdFRF9NSU5ELFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzaXh0eURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgICAgc2l4dHlEYXlzQWdvLnNldERhdGUoc2l4dHlEYXlzQWdvLmdldERhdGUoKSAtIDYwKTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkRFTElWRVJFRCxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICBkZWxpdmVyZWRBdDogc2l4dHlEYXlzQWdvLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KCdyZXR1cm4gd2luZG93Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBwYXJ0aWFsIHJlZnVuZCBhbW91bnQgZm9yIHBhcnRpYWwgcmV0dXJuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVmdW5kRHRvOiBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvID0ge1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkRFRkVDVElWRSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELFxuICAgICAgICBwYXltZW50U3RhdHVzOiBQYXltZW50U3RhdHVzLlBBSUQsXG4gICAgICAgIHRvdGFsOiAyMDAsXG4gICAgICAgIGRlbGl2ZXJlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHN1YnRvdGFsOiA1MCB9LFxuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDEsIHN1YnRvdGFsOiAxNTAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDUwLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlKDUwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBwaG90b3MgZm9yIGRlZmVjdGl2ZSBpdGVtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5ERUZFQ1RJVkUsXG4gICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgICAgcGhvdG9zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coJ3Bob3RvIGV2aWRlbmNlJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhcHByb3ZlUmVmdW5kJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYXBwcm92ZSBhIHJlZnVuZCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiAxMDAsXG4gICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmFwcHJvdmVSZWZ1bmQoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFJlZnVuZFN0YXR1cy5BUFBST1ZFRCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFwcHJvdmUgcGFydGlhbCByZWZ1bmQgd2l0aCBhZGp1c3RlZCBhbW91bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiA3NSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmFwcHJvdmVSZWZ1bmQoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFJlZnVuZFN0YXR1cy5BUFBST1ZFRCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnVuZEFtb3VudCkudG9CZSg3NSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWplY3RSZWZ1bmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYSByZWZ1bmQgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUkVKRUNURUQsXG4gICAgICAgIHJlamVjdGlvblJlYXNvbjogJ091dHNpZGUgcmV0dXJuIHdpbmRvdycsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UucmVqZWN0UmVmdW5kKCdyZWZ1bmQtMScsICdPdXRzaWRlIHJldHVybiB3aW5kb3cnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLlJFSkVDVEVEKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVqZWN0aW9uUmVhc29uKS50b0JlKCdPdXRzaWRlIHJldHVybiB3aW5kb3cnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Byb2Nlc3NSZWZ1bmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIGFwcHJvdmVkIHJlZnVuZCBhbmQgaXNzdWUgcGF5bWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDEwMCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLlBST0NFU1NJTkcsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdvcmRlci0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrUGF5bWVudEdhdGV3YXlTZXJ2aWNlLnJlZnVuZFBheW1lbnQubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlLCByZWZ1bmRJZDogJ3JlZi0xMjMnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkNPTVBMRVRFRCxcbiAgICAgICAgcHJvY2Vzc2VkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UucHJvY2Vzc1JlZnVuZCgncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLkNPTVBMRVRFRCk7XG4gICAgICBleHBlY3QocmVzdWx0LnByb2Nlc3NlZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcHJvY2VzcyByZWZ1bmQgdGhhdCBpcyBub3QgYXBwcm92ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UucHJvY2Vzc1JlZnVuZCgncmVmdW5kLTEnKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZXN0b2NrSXRlbXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXN0b2NrIHJldHVybmVkIGl0ZW1zIHRvIGludmVudG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgICByZXN0b2NrSXRlbXM6IHRydWUsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMiB9LFxuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDEgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHF1YW50aXR5OiAxMCB9IGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlY29yZEFkanVzdG1lbnQubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgcmVmdW5kU2VydmljZS5yZXN0b2NrSXRlbXMoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcm9kLTEnLCB7XG4gICAgICAgIHF1YW50aXR5OiAxMixcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlY29yZEFkanVzdG1lbnQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHJlc3RvY2sgZGVmZWN0aXZlIGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkRFRkVDVElWRSxcbiAgICAgICAgcmVzdG9ja0l0ZW1zOiBmYWxzZSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kIGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IHJlZnVuZFNlcnZpY2UucmVzdG9ja0l0ZW1zKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QobW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuXG4gIGRlc2NyaWJlKCdnZXRVc2VyUmVmdW5kcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgcmVmdW5kIHJlcXVlc3RzIGZvciBhIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kcyA9IFtcbiAgICAgICAgeyBpZDogJzEnLCB1c2VySWQ6ICd1c2VyLTEnLCBzdGF0dXM6IFJlZnVuZFN0YXR1cy5DT01QTEVURUQgfSxcbiAgICAgICAgeyBpZDogJzInLCB1c2VySWQ6ICd1c2VyLTEnLCBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5nZXRVc2VyUmVmdW5kcygndXNlci0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICB9KTtcbiAgfSk7XG5cblxuICBkZXNjcmliZSgnY2FsY3VsYXRlUmVmdW5kQW1vdW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGZ1bGwgcmVmdW5kIGFtb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgdG90YWw6IDE1MCxcbiAgICAgICAgdGF4QW1vdW50OiAxNSxcbiAgICAgICAgc2hpcHBpbmdDb3N0OiAxMCxcbiAgICAgICAgc3VidG90YWw6IDEyNSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxLCBwcmljZTogMTI1IH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNhbGN1bGF0ZVJlZnVuZEFtb3VudCh7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBwYXJ0aWFsIHJlZnVuZCBmb3Igc3Vic2V0IG9mIGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMjUwLFxuICAgICAgICBzdWJ0b3RhbDogMjI1LFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHByaWNlOiAxMDAgfSxcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAxLCBwcmljZTogMTI1IH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNhbGN1bGF0ZVJlZnVuZEFtb3VudCh7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnVuZEFtb3VudCkudG9CZUxlc3NUaGFuKG1vY2tPcmRlci50b3RhbCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBpbmNsdWRlIHNoaXBwaW5nIGluIHBhcnRpYWwgcmVmdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMTUwLFxuICAgICAgICBzdWJ0b3RhbDogMTAwLFxuICAgICAgICBzaGlwcGluZ0Nvc3Q6IDEwLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHByaWNlOiA1MCB9LFxuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDEsIHByaWNlOiA1MCB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5jYWxjdWxhdGVSZWZ1bmRBbW91bnQoe1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlZnVuZEFtb3VudCkudG9CZSg1MCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZW5lcmF0ZVJldHVybkxhYmVsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgcmV0dXJuIHNoaXBwaW5nIGxhYmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuZ2VuZXJhdGVSZXR1cm5MYWJlbCgncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5sYWJlbFVybCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHJhY2tpbmdOdW1iZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd0cmFja1JldHVybicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIHJldHVybiBzaGlwbWVudCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0cmFja2luZ051bWJlciA9ICcxWjk5OUFBMTAxMjM0NTY3ODQnO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLnRyYWNrUmV0dXJuKHRyYWNraW5nTnVtYmVyKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmV2ZW50cykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21hcmtSZXR1cm5Bc1JlY2VpdmVkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFyayByZXR1cm4gYXMgcmVjZWl2ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kIGFzIGFueSk7XG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS51cGRhdGVSZXR1cm5TdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrUmVmdW5kLFxuICAgICAgICByZXR1cm5TdGF0dXM6ICdyZWNlaXZlZCcsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IHJlZnVuZFNlcnZpY2UubWFya1JldHVybkFzUmVjZWl2ZWQoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmVmdW5kUmVwb3NpdG9yeS51cGRhdGVSZXR1cm5TdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJlZnVuZFN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgcmVmdW5kIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kcyA9IFtcbiAgICAgICAgeyBzdGF0dXM6IFJlZnVuZFN0YXR1cy5DT01QTEVURUQsIHJlZnVuZEFtb3VudDogMTAwIH0sXG4gICAgICAgIHsgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQ09NUExFVEVELCByZWZ1bmRBbW91bnQ6IDUwIH0sXG4gICAgICAgIHsgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORywgcmVmdW5kQW1vdW50OiA3NSB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5VXNlcklkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmRzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuZ2V0UmVmdW5kU3RhdGlzdGljcygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUmVmdW5kZWQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGVuZGluZykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tcGxldGVkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2hlY2tFbGlnaWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNoZWNrIGlmIG9yZGVyIGlzIGVsaWdpYmxlIGZvciByZWZ1bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELFxuICAgICAgICBwYXltZW50U3RhdHVzOiBQYXltZW50U3RhdHVzLlBBSUQsXG4gICAgICAgIGRlbGl2ZXJlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5jaGVja0VsaWdpYmlsaXR5KCdvcmRlci0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZWxpZ2libGUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3Igb3JkZXIgb3V0c2lkZSByZXR1cm4gd2luZG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9uZ0FnbyA9IG5ldyBEYXRlKCk7XG4gICAgICBsb25nQWdvLnNldERhdGUobG9uZ0Fnby5nZXREYXRlKCkgLSAxMDApO1xuXG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELFxuICAgICAgICBwYXltZW50U3RhdHVzOiBQYXltZW50U3RhdHVzLlBBSUQsXG4gICAgICAgIGRlbGl2ZXJlZEF0OiBsb25nQWdvLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5jaGVja0VsaWdpYmlsaXR5KCdvcmRlci0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZWxpZ2libGUpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5pc3N1ZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=