b3d98e072a6dd38d2b5f29228b523ae5
"use strict";
/**
 * Integration Tests: Complete Authentication Flows
 *
 * Testing end-to-end authentication and authorization workflows
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../../src/services/user-management/repositories/user.repository');
jest.mock('../../../src/services/notifications/services/notification.service');
const user_service_1 = require("../../../src/services/user-management/services/user.service");
const jwt_utils_1 = require("../../../src/libs/auth/jwt.utils");
const password_utils_1 = require("../../../src/libs/auth/password.utils");
const errors_1 = require("../../../src/libs/errors");
const user_entity_1 = require("../../../src/services/user-management/entities/user.entity");
describe('Complete Authentication Flow Integration Tests', () => {
    let userService;
    let mockUserRepository;
    let mockNotificationService;
    beforeEach(() => {
        mockUserRepository = {
            findByEmail: jest.fn(),
            createUser: jest.fn(),
            findById: jest.fn(),
            update: jest.fn(),
            setEmailVerificationToken: jest.fn(),
            verifyEmail: jest.fn(),
            setPasswordResetToken: jest.fn(),
            resetPassword: jest.fn(),
            updateLastLogin: jest.fn(),
            incrementLoginAttempts: jest.fn(),
            resetLoginAttempts: jest.fn(),
        };
        mockNotificationService = {
            sendWelcomeEmail: jest.fn(),
            sendVerificationEmail: jest.fn(),
            sendPasswordResetEmail: jest.fn(),
        };
        userService = new user_service_1.UserService(mockUserRepository, mockNotificationService);
    });
    describe('New User Registration and Verification Flow', () => {
        it('should complete full registration to first login', async () => {
            const email = 'newuser@test.com';
            const password = 'SecurePass123!';
            const verificationToken = 'verify_token_123';
            // Step 1: User registration
            mockUserRepository.findByEmail.mockResolvedValue(null);
            mockUserRepository.createUser.mockResolvedValue({
                id: 'user-new-1',
                email,
                firstName: 'New',
                lastName: 'User',
                emailVerificationToken: verificationToken,
                emailVerifiedAt: null,
                status: user_entity_1.UserStatus.PENDING,
            });
            mockNotificationService.sendWelcomeEmail.mockResolvedValue({ success: true });
            mockNotificationService.sendVerificationEmail.mockResolvedValue({
                success: true,
            });
            const registered = await userService.register({
                email,
                password,
                firstName: 'New',
                lastName: 'User',
            });
            expect(registered.user.status).toBe(user_entity_1.UserStatus.PENDING);
            expect(mockNotificationService.sendWelcomeEmail).toHaveBeenCalled();
            expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalled();
            // Step 2: User clicks verification link
            mockUserRepository.verifyEmail.mockResolvedValue({
                id: 'user-new-1',
                email,
                emailVerifiedAt: new Date(),
                emailVerificationToken: null,
                status: user_entity_1.UserStatus.ACTIVE,
                password: await (0, password_utils_1.hashPassword)(password),
                loginAttempts: 0,
            });
            const verified = await userService.verifyEmail(verificationToken);
            expect(verified.status).toBe(user_entity_1.UserStatus.ACTIVE);
            expect(verified.emailVerifiedAt).toBeDefined();
            // Step 3: User logs in for first time
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-new-1',
                email,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            const loggedIn = await userService.login(email, password);
            expect(loggedIn.token).toBeDefined();
            expect(loggedIn.user.email).toBe(email);
            expect(mockUserRepository.updateLastLogin).toHaveBeenCalled();
            // Step 4: Verify token works
            const decoded = (0, jwt_utils_1.verifyToken)(loggedIn.token);
            expect(decoded.userId).toBe('user-new-1');
            expect(decoded.email).toBe(email);
        });
        it('should block login before email verification', async () => {
            const email = 'unverified@test.com';
            const password = 'SecurePass123!';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-unverified',
                email,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: null,
                status: user_entity_1.UserStatus.PENDING,
            });
            await expect(userService.login(email, password)).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should resend verification email if requested', async () => {
            const email = 'needsverification@test.com';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-resend',
                email,
                emailVerifiedAt: null,
                status: user_entity_1.UserStatus.PENDING,
            });
            mockUserRepository.setEmailVerificationToken.mockResolvedValue({});
            mockNotificationService.sendVerificationEmail.mockResolvedValue({
                success: true,
            });
            await userService.resendVerificationEmail(email);
            expect(mockUserRepository.setEmailVerificationToken).toHaveBeenCalled();
            expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalledTimes(1);
        });
    });
    describe('Password Reset Flow', () => {
        it('should complete full password reset workflow', async () => {
            const email = 'forgotpass@test.com';
            const newPassword = 'NewSecurePass456!';
            const resetToken = 'reset_token_xyz';
            // Step 1: User requests password reset
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-forgot',
                email,
            });
            mockUserRepository.setPasswordResetToken.mockResolvedValue({});
            mockNotificationService.sendPasswordResetEmail.mockResolvedValue({
                success: true,
            });
            await userService.requestPasswordReset(email);
            expect(mockUserRepository.setPasswordResetToken).toHaveBeenCalled();
            expect(mockNotificationService.sendPasswordResetEmail).toHaveBeenCalledWith(email, expect.any(String));
            // Step 2: User clicks reset link and enters new password
            mockUserRepository.resetPassword.mockResolvedValue({
                id: 'user-forgot',
                email,
                passwordResetToken: null,
                passwordResetExpires: null,
                password: await (0, password_utils_1.hashPassword)(newPassword),
            });
            const reset = await userService.resetPassword(resetToken, newPassword);
            expect(reset.passwordResetToken).toBeNull();
            // Step 3: User logs in with new password
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-forgot',
                email,
                password: await (0, password_utils_1.hashPassword)(newPassword),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            const loggedIn = await userService.login(email, newPassword);
            expect(loggedIn.token).toBeDefined();
        });
        it('should expire reset token after time limit', async () => {
            const expiredToken = 'expired_token_123';
            mockUserRepository.resetPassword.mockRejectedValue(new errors_1.UnauthorizedError('Reset token has expired'));
            await expect(userService.resetPassword(expiredToken, 'NewPass123!')).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should invalidate reset token after use', async () => {
            const resetToken = 'onetime_token_456';
            const newPassword = 'OneTimeUse123!';
            mockUserRepository.resetPassword.mockResolvedValueOnce({
                id: 'user-onetime',
                passwordResetToken: null,
            });
            await userService.resetPassword(resetToken, newPassword);
            // Trying to use same token again should fail
            mockUserRepository.resetPassword.mockRejectedValue(new errors_1.UnauthorizedError('Invalid or expired reset token'));
            await expect(userService.resetPassword(resetToken, 'AnotherPass123!')).rejects.toThrow(errors_1.UnauthorizedError);
        });
    });
    describe('Account Lockout and Recovery', () => {
        it('should lock account after 5 failed login attempts', async () => {
            const email = 'lockeduser@test.com';
            const hashedPassword = await (0, password_utils_1.hashPassword)('CorrectPass123!');
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-lockout',
                email,
                password: hashedPassword,
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 0,
                lockedUntil: null,
            });
            // Attempt 5 failed logins
            for (let i = 1; i <= 5; i++) {
                const lockedUntil = i === 5 ? new Date(Date.now() + 30 * 60 * 1000) : null;
                mockUserRepository.incrementLoginAttempts.mockResolvedValue({
                    loginAttempts: i,
                    lockedUntil,
                });
                try {
                    await userService.login(email, 'WrongPassword');
                }
                catch (error) {
                    // Expected to fail
                }
            }
            expect(mockUserRepository.incrementLoginAttempts).toHaveBeenCalledTimes(5);
            // Verify account is locked
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-lockout',
                email,
                password: hashedPassword,
                loginAttempts: 5,
                lockedUntil: new Date(Date.now() + 30 * 60 * 1000),
                status: user_entity_1.UserStatus.ACTIVE,
            });
            await expect(userService.login(email, 'CorrectPass123!')).rejects.toThrow('Account is temporarily locked');
        });
        it('should unlock account after lockout period', async () => {
            const email = 'unlocking@test.com';
            const password = 'CorrectPass123!';
            const hashedPassword = await (0, password_utils_1.hashPassword)(password);
            // Account was locked but lockout expired
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-unlock',
                email,
                password: hashedPassword,
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 5,
                lockedUntil: new Date(Date.now() - 1000), // Expired 1 second ago
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({
                loginAttempts: 0,
                lockedUntil: null,
            });
            const result = await userService.login(email, password);
            expect(result.token).toBeDefined();
            expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalled();
        });
        it('should reset failed attempts after successful login', async () => {
            const email = 'resetattempts@test.com';
            const password = 'CorrectPass123!';
            const hashedPassword = await (0, password_utils_1.hashPassword)(password);
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-reset-attempts',
                email,
                password: hashedPassword,
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 3, // Had some failed attempts
                lockedUntil: null,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({
                loginAttempts: 0,
            });
            await userService.login(email, password);
            expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalled();
        });
    });
    describe('Role-Based Access Control', () => {
        it('should include role in JWT token', async () => {
            const adminEmail = 'admin@test.com';
            const password = 'AdminPass123!';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'admin-1',
                email: adminEmail,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                role: user_entity_1.UserRole.ADMIN,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            const result = await userService.login(adminEmail, password);
            const decoded = (0, jwt_utils_1.verifyToken)(result.token);
            expect(decoded.role).toBe(user_entity_1.UserRole.ADMIN);
        });
        it('should differentiate between customer and admin roles', async () => {
            const customerEmail = 'customer@test.com';
            const password = 'CustomerPass123!';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'customer-1',
                email: customerEmail,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                role: user_entity_1.UserRole.CUSTOMER,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            const result = await userService.login(customerEmail, password);
            const decoded = (0, jwt_utils_1.verifyToken)(result.token);
            expect(decoded.role).toBe(user_entity_1.UserRole.CUSTOMER);
        });
    });
    describe('Token Expiration and Refresh', () => {
        it('should generate token with expiration', async () => {
            const email = 'tokenexp@test.com';
            const password = 'TokenPass123!';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-token-exp',
                email,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            const result = await userService.login(email, password);
            const decoded = (0, jwt_utils_1.verifyToken)(result.token);
            expect(decoded.exp).toBeDefined();
            expect(decoded.exp).toBeGreaterThan(Math.floor(Date.now() / 1000));
        });
        it('should reject expired token', () => {
            const expiredToken = (0, jwt_utils_1.generateToken)({
                userId: 'user-123',
                email: 'test@test.com',
                role: 'customer',
            }, '-1h' // Expired 1 hour ago
            );
            expect(() => (0, jwt_utils_1.verifyToken)(expiredToken)).toThrow();
        });
    });
    describe('Account Status Workflows', () => {
        it('should prevent login for suspended account', async () => {
            const email = 'suspended@test.com';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-suspended',
                email,
                password: await (0, password_utils_1.hashPassword)('Pass123!'),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.SUSPENDED,
            });
            await expect(userService.login(email, 'Pass123!')).rejects.toThrow('Account has been suspended');
        });
        it('should activate pending account after verification', async () => {
            const verificationToken = 'activate_token_123';
            mockUserRepository.verifyEmail.mockResolvedValue({
                id: 'user-activate',
                status: user_entity_1.UserStatus.ACTIVE,
                emailVerifiedAt: new Date(),
            });
            const result = await userService.verifyEmail(verificationToken);
            expect(result.status).toBe(user_entity_1.UserStatus.ACTIVE);
        });
    });
    describe('Change Password While Authenticated', () => {
        it('should change password for authenticated user', async () => {
            const userId = 'user-change-pass';
            const currentPassword = 'OldPass123!';
            const newPassword = 'NewPass456!';
            mockUserRepository.findById.mockResolvedValue({
                id: userId,
                email: 'changepass@test.com',
                password: await (0, password_utils_1.hashPassword)(currentPassword),
            });
            mockUserRepository.update.mockResolvedValue({
                id: userId,
                password: await (0, password_utils_1.hashPassword)(newPassword),
            });
            await userService.changePassword(userId, currentPassword, newPassword);
            expect(mockUserRepository.update).toHaveBeenCalledWith(userId, expect.objectContaining({
                password: expect.any(String),
            }));
        });
        it('should reject password change with wrong current password', async () => {
            const userId = 'user-wrong-current';
            mockUserRepository.findById.mockResolvedValue({
                id: userId,
                password: await (0, password_utils_1.hashPassword)('CorrectPass123!'),
            });
            await expect(userService.changePassword(userId, 'WrongPass123!', 'NewPass456!')).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should validate new password strength', async () => {
            const userId = 'user-weak-new-pass';
            mockUserRepository.findById.mockResolvedValue({
                id: userId,
                password: await (0, password_utils_1.hashPassword)('OldPass123!'),
            });
            await expect(userService.changePassword(userId, 'OldPass123!', 'weak')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('Multi-Device Sessions', () => {
        it('should allow login from multiple devices', async () => {
            const email = 'multidevice@test.com';
            const password = 'MultiDevice123!';
            mockUserRepository.findByEmail.mockResolvedValue({
                id: 'user-multi-device',
                email,
                password: await (0, password_utils_1.hashPassword)(password),
                emailVerifiedAt: new Date(),
                status: user_entity_1.UserStatus.ACTIVE,
                loginAttempts: 0,
            });
            mockUserRepository.updateLastLogin.mockResolvedValue({});
            mockUserRepository.resetLoginAttempts.mockResolvedValue({});
            // Login from device 1
            const device1Token = await userService.login(email, password);
            // Login from device 2
            const device2Token = await userService.login(email, password);
            // Both tokens should be valid
            expect(device1Token.token).toBeDefined();
            expect(device2Token.token).toBeDefined();
            expect(device1Token.token).not.toBe(device2Token.token);
            // Both tokens should verify successfully
            const decoded1 = (0, jwt_utils_1.verifyToken)(device1Token.token);
            const decoded2 = (0, jwt_utils_1.verifyToken)(device2Token.token);
            expect(decoded1.userId).toBe('user-multi-device');
            expect(decoded2.userId).toBe('user-multi-device');
        });
    });
    describe('Email Change Workflow', () => {
        it('should verify new email before updating', async () => {
            const userId = 'user-change-email';
            const currentEmail = 'old@test.com';
            const newEmail = 'new@test.com';
            const verificationToken = 'email_change_token_123';
            mockUserRepository.findById.mockResolvedValue({
                id: userId,
                email: currentEmail,
            });
            // Request email change
            mockUserRepository.update.mockResolvedValue({
                id: userId,
                newEmail,
                newEmailVerificationToken: verificationToken,
            });
            mockNotificationService.sendVerificationEmail.mockResolvedValue({
                success: true,
            });
            await userService.requestEmailChange(userId, newEmail);
            expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalledWith(newEmail, expect.any(String));
            // Verify new email
            mockUserRepository.update.mockResolvedValue({
                id: userId,
                email: newEmail,
                newEmail: null,
                newEmailVerificationToken: null,
            });
            await userService.verifyNewEmail(verificationToken);
            expect(mockUserRepository.update).toHaveBeenCalledWith(expect.any(String), expect.objectContaining({
                email: newEmail,
            }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcYXV0aFxcY29tcGxldGUtYXV0aC1mbG93LmludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBVUgsSUFBSSxDQUFDLElBQUksQ0FBQyxvRUFBb0UsQ0FBQyxDQUFDO0FBQ2hGLElBQUksQ0FBQyxJQUFJLENBQUMsbUVBQW1FLENBQUMsQ0FBQztBQVQvRSw4RkFBMEY7QUFHMUYsZ0VBQThFO0FBQzlFLDBFQUFxRTtBQUNyRSxxREFBOEU7QUFDOUUsNEZBQWtHO0FBS2xHLFFBQVEsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7SUFDOUQsSUFBSSxXQUF3QixDQUFDO0lBQzdCLElBQUksa0JBQStDLENBQUM7SUFDcEQsSUFBSSx1QkFBeUQsQ0FBQztJQUU5RCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2Qsa0JBQWtCLEdBQUc7WUFDbkIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdEIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDckIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIseUJBQXlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hDLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3hCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLHNCQUFzQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNZLENBQUM7UUFFNUMsdUJBQXVCLEdBQUc7WUFDeEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixx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QUFJO2dCQUNkLHlCQUF5QixFQUFFLElBQUk7YUFDekIsQ0FBQyxDQUFDO1lBRVYsTUFBTSxXQUFXLENBQUMsY0FBYyxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFFcEQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUNwRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUNsQixNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLEtBQUssRUFBRSxRQUFRO2FBQ2hCLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFx0ZXN0c1xcaW50ZWdyYXRpb25cXGF1dGhcXGNvbXBsZXRlLWF1dGgtZmxvdy5pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW50ZWdyYXRpb24gVGVzdHM6IENvbXBsZXRlIEF1dGhlbnRpY2F0aW9uIEZsb3dzXG4gKlxuICogVGVzdGluZyBlbmQtdG8tZW5kIGF1dGhlbnRpY2F0aW9uIGFuZCBhdXRob3JpemF0aW9uIHdvcmtmbG93c1xuICovXG5cbmltcG9ydCB7IFVzZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL3VzZXItbWFuYWdlbWVudC9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvdXNlci1tYW5hZ2VtZW50L3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9ub3RpZmljYXRpb25zL3NlcnZpY2VzL25vdGlmaWNhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IHZlcmlmeVRva2VuLCBnZW5lcmF0ZVRva2VuIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2xpYnMvYXV0aC9qd3QudXRpbHMnO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2xpYnMvYXV0aC9wYXNzd29yZC51dGlscyc7XG5pbXBvcnQgeyBVbmF1dGhvcml6ZWRFcnJvciwgQmFkUmVxdWVzdEVycm9yIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2xpYnMvZXJyb3JzJztcbmltcG9ydCB7IFVzZXJSb2xlLCBVc2VyU3RhdHVzIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL3VzZXItbWFuYWdlbWVudC9lbnRpdGllcy91c2VyLmVudGl0eSc7XG5cbmplc3QubW9jaygnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL3VzZXItbWFuYWdlbWVudC9yZXBvc2l0b3JpZXMvdXNlci5yZXBvc2l0b3J5Jyk7XG5qZXN0Lm1vY2soJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9ub3RpZmljYXRpb25zL3NlcnZpY2VzL25vdGlmaWNhdGlvbi5zZXJ2aWNlJyk7XG5cbmRlc2NyaWJlKCdDb21wbGV0ZSBBdXRoZW50aWNhdGlvbiBGbG93IEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgdXNlclNlcnZpY2U6IFVzZXJTZXJ2aWNlO1xuICBsZXQgbW9ja1VzZXJSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxVc2VyUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrTm90aWZpY2F0aW9uU2VydmljZTogamVzdC5Nb2NrZWQ8Tm90aWZpY2F0aW9uU2VydmljZT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1VzZXJSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5RW1haWw6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZVVzZXI6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIHNldEVtYWlsVmVyaWZpY2F0aW9uVG9rZW46IGplc3QuZm4oKSxcbiAgICAgIHZlcmlmeUVtYWlsOiBqZXN0LmZuKCksXG4gICAgICBzZXRQYXNzd29yZFJlc2V0VG9rZW46IGplc3QuZm4oKSxcbiAgICAgIHJlc2V0UGFzc3dvcmQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZUxhc3RMb2dpbjogamVzdC5mbigpLFxuICAgICAgaW5jcmVtZW50TG9naW5BdHRlbXB0czogamVzdC5mbigpLFxuICAgICAgcmVzZXRMb2dpbkF0dGVtcHRzOiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlID0ge1xuICAgICAgc2VuZFdlbGNvbWVFbWFpbDogamVzdC5mbigpLFxuICAgICAgc2VuZFZlcmlmaWNhdGlvbkVtYWlsOiBqZXN0LmZuKCksXG4gICAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPE5vdGlmaWNhdGlvblNlcnZpY2U+O1xuXG4gICAgdXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UobW9ja1VzZXJSZXBvc2l0b3J5LCBtb2NrTm90aWZpY2F0aW9uU2VydmljZSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdOZXcgVXNlciBSZWdpc3RyYXRpb24gYW5kIFZlcmlmaWNhdGlvbiBGbG93JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY29tcGxldGUgZnVsbCByZWdpc3RyYXRpb24gdG8gZmlyc3QgbG9naW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICduZXd1c2VyQHRlc3QuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ1NlY3VyZVBhc3MxMjMhJztcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuID0gJ3ZlcmlmeV90b2tlbl8xMjMnO1xuXG4gICAgICAvLyBTdGVwIDE6IFVzZXIgcmVnaXN0cmF0aW9uXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuY3JlYXRlVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1uZXctMScsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICBlbWFpbFZlcmlmaWNhdGlvblRva2VuOiB2ZXJpZmljYXRpb25Ub2tlbixcbiAgICAgICAgZW1haWxWZXJpZmllZEF0OiBudWxsLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuUEVORElORyxcbiAgICAgIH0gYXMgYW55KTtcbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRXZWxjb21lRW1haWwubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pO1xuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZWdpc3RlcmVkID0gYXdhaXQgdXNlclNlcnZpY2UucmVnaXN0ZXIoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlZ2lzdGVyZWQudXNlci5zdGF0dXMpLnRvQmUoVXNlclN0YXR1cy5QRU5ESU5HKTtcbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kV2VsY29tZUVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cbiAgICAgIC8vIFN0ZXAgMjogVXNlciBjbGlja3MgdmVyaWZpY2F0aW9uIGxpbmtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS52ZXJpZnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1uZXctMScsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGVtYWlsVmVyaWZpY2F0aW9uVG9rZW46IG51bGwsXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpLFxuICAgICAgICBsb2dpbkF0dGVtcHRzOiAwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IHVzZXJTZXJ2aWNlLnZlcmlmeUVtYWlsKHZlcmlmaWNhdGlvblRva2VuKTtcblxuICAgICAgZXhwZWN0KHZlcmlmaWVkLnN0YXR1cykudG9CZShVc2VyU3RhdHVzLkFDVElWRSk7XG4gICAgICBleHBlY3QodmVyaWZpZWQuZW1haWxWZXJpZmllZEF0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAvLyBTdGVwIDM6IFVzZXIgbG9ncyBpbiBmb3IgZmlyc3QgdGltZVxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICd1c2VyLW5ldy0xJyxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlTGFzdExvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRMb2dpbkF0dGVtcHRzLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGxvZ2dlZEluID0gYXdhaXQgdXNlclNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlZEluLnRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2dlZEluLnVzZXIuZW1haWwpLnRvQmUoZW1haWwpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGVMYXN0TG9naW4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gU3RlcCA0OiBWZXJpZnkgdG9rZW4gd29ya3NcbiAgICAgIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnlUb2tlbihsb2dnZWRJbi50b2tlbik7XG4gICAgICBleHBlY3QoZGVjb2RlZC51c2VySWQpLnRvQmUoJ3VzZXItbmV3LTEnKTtcbiAgICAgIGV4cGVjdChkZWNvZGVkLmVtYWlsKS50b0JlKGVtYWlsKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmxvY2sgbG9naW4gYmVmb3JlIGVtYWlsIHZlcmlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3VudmVyaWZpZWRAdGVzdC5jb20nO1xuICAgICAgY29uc3QgcGFzc3dvcmQgPSAnU2VjdXJlUGFzczEyMyEnO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItdW52ZXJpZmllZCcsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKSxcbiAgICAgICAgZW1haWxWZXJpZmllZEF0OiBudWxsLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuUEVORElORyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLmxvZ2luKGVtYWlsLCBwYXNzd29yZCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgVW5hdXRob3JpemVkRXJyb3JcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc2VuZCB2ZXJpZmljYXRpb24gZW1haWwgaWYgcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1haWwgPSAnbmVlZHN2ZXJpZmljYXRpb25AdGVzdC5jb20nO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItcmVzZW5kJyxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbnVsbCxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLlBFTkRJTkcsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRFbWFpbFZlcmlmaWNhdGlvblRva2VuLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kVmVyaWZpY2F0aW9uRW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnJlc2VuZFZlcmlmaWNhdGlvbkVtYWlsKGVtYWlsKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRFbWFpbFZlcmlmaWNhdGlvblRva2VuKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQYXNzd29yZCBSZXNldCBGbG93JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY29tcGxldGUgZnVsbCBwYXNzd29yZCByZXNldCB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ2ZvcmdvdHBhc3NAdGVzdC5jb20nO1xuICAgICAgY29uc3QgbmV3UGFzc3dvcmQgPSAnTmV3U2VjdXJlUGFzczQ1NiEnO1xuICAgICAgY29uc3QgcmVzZXRUb2tlbiA9ICdyZXNldF90b2tlbl94eXonO1xuXG4gICAgICAvLyBTdGVwIDE6IFVzZXIgcmVxdWVzdHMgcGFzc3dvcmQgcmVzZXRcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1mb3Jnb3QnLFxuICAgICAgICBlbWFpbCxcbiAgICAgIH0gYXMgYW55KTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRQYXNzd29yZFJlc2V0VG9rZW4ubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRQYXNzd29yZFJlc2V0RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnJlcXVlc3RQYXNzd29yZFJlc2V0KGVtYWlsKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5zZXRQYXNzd29yZFJlc2V0VG9rZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kUGFzc3dvcmRSZXNldEVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZW1haWwsXG4gICAgICAgIGV4cGVjdC5hbnkoU3RyaW5nKVxuICAgICAgKTtcblxuICAgICAgLy8gU3RlcCAyOiBVc2VyIGNsaWNrcyByZXNldCBsaW5rIGFuZCBlbnRlcnMgbmV3IHBhc3N3b3JkXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRQYXNzd29yZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1mb3Jnb3QnLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmRSZXNldFRva2VuOiBudWxsLFxuICAgICAgICBwYXNzd29yZFJlc2V0RXhwaXJlczogbnVsbCxcbiAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc2V0ID0gYXdhaXQgdXNlclNlcnZpY2UucmVzZXRQYXNzd29yZChyZXNldFRva2VuLCBuZXdQYXNzd29yZCk7XG5cbiAgICAgIGV4cGVjdChyZXNldC5wYXNzd29yZFJlc2V0VG9rZW4pLnRvQmVOdWxsKCk7XG5cbiAgICAgIC8vIFN0ZXAgMzogVXNlciBsb2dzIGluIHdpdGggbmV3IHBhc3N3b3JkXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItZm9yZ290JyxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBoYXNoUGFzc3dvcmQobmV3UGFzc3dvcmQpLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlTGFzdExvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRMb2dpbkF0dGVtcHRzLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGxvZ2dlZEluID0gYXdhaXQgdXNlclNlcnZpY2UubG9naW4oZW1haWwsIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlZEluLnRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHBpcmUgcmVzZXQgdG9rZW4gYWZ0ZXIgdGltZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4cGlyZWRUb2tlbiA9ICdleHBpcmVkX3Rva2VuXzEyMyc7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldFBhc3N3b3JkLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ1Jlc2V0IHRva2VuIGhhcyBleHBpcmVkJylcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgdXNlclNlcnZpY2UucmVzZXRQYXNzd29yZChleHBpcmVkVG9rZW4sICdOZXdQYXNzMTIzIScpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGludmFsaWRhdGUgcmVzZXQgdG9rZW4gYWZ0ZXIgdXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZXRUb2tlbiA9ICdvbmV0aW1lX3Rva2VuXzQ1Nic7XG4gICAgICBjb25zdCBuZXdQYXNzd29yZCA9ICdPbmVUaW1lVXNlMTIzISc7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldFBhc3N3b3JkLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIGlkOiAndXNlci1vbmV0aW1lJyxcbiAgICAgICAgcGFzc3dvcmRSZXNldFRva2VuOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCB1c2VyU2VydmljZS5yZXNldFBhc3N3b3JkKHJlc2V0VG9rZW4sIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgLy8gVHJ5aW5nIHRvIHVzZSBzYW1lIHRva2VuIGFnYWluIHNob3VsZCBmYWlsXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRQYXNzd29yZC5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IFVuYXV0aG9yaXplZEVycm9yKCdJbnZhbGlkIG9yIGV4cGlyZWQgcmVzZXQgdG9rZW4nKVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICB1c2VyU2VydmljZS5yZXNldFBhc3N3b3JkKHJlc2V0VG9rZW4sICdBbm90aGVyUGFzczEyMyEnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWNjb3VudCBMb2Nrb3V0IGFuZCBSZWNvdmVyeScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvY2sgYWNjb3VudCBhZnRlciA1IGZhaWxlZCBsb2dpbiBhdHRlbXB0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ2xvY2tlZHVzZXJAdGVzdC5jb20nO1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQoJ0NvcnJlY3RQYXNzMTIzIScpO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItbG9ja291dCcsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgbG9naW5BdHRlbXB0czogMCxcbiAgICAgICAgbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIEF0dGVtcHQgNSBmYWlsZWQgbG9naW5zXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA1OyBpKyspIHtcbiAgICAgICAgY29uc3QgbG9ja2VkVW50aWwgPSBpID09PSA1ID8gbmV3IERhdGUoRGF0ZS5ub3coKSArIDMwICogNjAgKiAxMDAwKSA6IG51bGw7XG5cbiAgICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmluY3JlbWVudExvZ2luQXR0ZW1wdHMubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGxvZ2luQXR0ZW1wdHM6IGksXG4gICAgICAgICAgbG9ja2VkVW50aWwsXG4gICAgICAgIH0gYXMgYW55KTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLmxvZ2luKGVtYWlsLCAnV3JvbmdQYXNzd29yZCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIC8vIEV4cGVjdGVkIHRvIGZhaWxcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBleHBlY3QobW9ja1VzZXJSZXBvc2l0b3J5LmluY3JlbWVudExvZ2luQXR0ZW1wdHMpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyg1KTtcblxuICAgICAgLy8gVmVyaWZ5IGFjY291bnQgaXMgbG9ja2VkXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItbG9ja291dCcsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDUsXG4gICAgICAgIGxvY2tlZFVudGlsOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiA2MCAqIDEwMDApLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodXNlclNlcnZpY2UubG9naW4oZW1haWwsICdDb3JyZWN0UGFzczEyMyEnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnQWNjb3VudCBpcyB0ZW1wb3JhcmlseSBsb2NrZWQnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1bmxvY2sgYWNjb3VudCBhZnRlciBsb2Nrb3V0IHBlcmlvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3VubG9ja2luZ0B0ZXN0LmNvbSc7XG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdDb3JyZWN0UGFzczEyMyEnO1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpO1xuXG4gICAgICAvLyBBY2NvdW50IHdhcyBsb2NrZWQgYnV0IGxvY2tvdXQgZXhwaXJlZFxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICd1c2VyLXVubG9jaycsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgbG9naW5BdHRlbXB0czogNSxcbiAgICAgICAgbG9ja2VkVW50aWw6IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwKSwgLy8gRXhwaXJlZCAxIHNlY29uZCBhZ29cbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZUxhc3RMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnJlc2V0TG9naW5BdHRlbXB0cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgIGxvY2tlZFVudGlsOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5sb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldExvZ2luQXR0ZW1wdHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgZmFpbGVkIGF0dGVtcHRzIGFmdGVyIHN1Y2Nlc3NmdWwgbG9naW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICdyZXNldGF0dGVtcHRzQHRlc3QuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ0NvcnJlY3RQYXNzMTIzISc7XG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1yZXNldC1hdHRlbXB0cycsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgbG9naW5BdHRlbXB0czogMywgLy8gSGFkIHNvbWUgZmFpbGVkIGF0dGVtcHRzXG4gICAgICAgIGxvY2tlZFVudGlsOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlTGFzdExvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRMb2dpbkF0dGVtcHRzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgbG9naW5BdHRlbXB0czogMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgdXNlclNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldExvZ2luQXR0ZW1wdHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JvbGUtQmFzZWQgQWNjZXNzIENvbnRyb2wnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHJvbGUgaW4gSldUIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRtaW5FbWFpbCA9ICdhZG1pbkB0ZXN0LmNvbSc7XG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdBZG1pblBhc3MxMjMhJztcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdhZG1pbi0xJyxcbiAgICAgICAgZW1haWw6IGFkbWluRW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpLFxuICAgICAgICBlbWFpbFZlcmlmaWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHN0YXR1czogVXNlclN0YXR1cy5BQ1RJVkUsXG4gICAgICAgIHJvbGU6IFVzZXJSb2xlLkFETUlOLFxuICAgICAgICBsb2dpbkF0dGVtcHRzOiAwLFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZUxhc3RMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnJlc2V0TG9naW5BdHRlbXB0cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5sb2dpbihhZG1pbkVtYWlsLCBwYXNzd29yZCk7XG5cbiAgICAgIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnlUb2tlbihyZXN1bHQudG9rZW4pO1xuICAgICAgZXhwZWN0KGRlY29kZWQucm9sZSkudG9CZShVc2VyUm9sZS5BRE1JTik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBjdXN0b21lciBhbmQgYWRtaW4gcm9sZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21lckVtYWlsID0gJ2N1c3RvbWVyQHRlc3QuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ0N1c3RvbWVyUGFzczEyMyEnO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ2N1c3RvbWVyLTEnLFxuICAgICAgICBlbWFpbDogY3VzdG9tZXJFbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCksXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgcm9sZTogVXNlclJvbGUuQ1VTVE9NRVIsXG4gICAgICAgIGxvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlTGFzdExvZ2luLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkucmVzZXRMb2dpbkF0dGVtcHRzLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJTZXJ2aWNlLmxvZ2luKGN1c3RvbWVyRW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgY29uc3QgZGVjb2RlZCA9IHZlcmlmeVRva2VuKHJlc3VsdC50b2tlbik7XG4gICAgICBleHBlY3QoZGVjb2RlZC5yb2xlKS50b0JlKFVzZXJSb2xlLkNVU1RPTUVSKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Rva2VuIEV4cGlyYXRpb24gYW5kIFJlZnJlc2gnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB0b2tlbiB3aXRoIGV4cGlyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICd0b2tlbmV4cEB0ZXN0LmNvbSc7XG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdUb2tlblBhc3MxMjMhJztcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICd1c2VyLXRva2VuLWV4cCcsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKSxcbiAgICAgICAgZW1haWxWZXJpZmllZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBzdGF0dXM6IFVzZXJTdGF0dXMuQUNUSVZFLFxuICAgICAgICBsb2dpbkF0dGVtcHRzOiAwLFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZUxhc3RMb2dpbi5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnJlc2V0TG9naW5BdHRlbXB0cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5sb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuXG4gICAgICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5VG9rZW4ocmVzdWx0LnRva2VuKTtcbiAgICAgIGV4cGVjdChkZWNvZGVkLmV4cCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkZWNvZGVkLmV4cCkudG9CZUdyZWF0ZXJUaGFuKE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGV4cGlyZWQgdG9rZW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVkVG9rZW4gPSBnZW5lcmF0ZVRva2VuKFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsXG4gICAgICAgICAgcm9sZTogJ2N1c3RvbWVyJyxcbiAgICAgICAgfSxcbiAgICAgICAgJy0xaCcgLy8gRXhwaXJlZCAxIGhvdXIgYWdvXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoKCkgPT4gdmVyaWZ5VG9rZW4oZXhwaXJlZFRva2VuKSkudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWNjb3VudCBTdGF0dXMgV29ya2Zsb3dzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJldmVudCBsb2dpbiBmb3Igc3VzcGVuZGVkIGFjY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICdzdXNwZW5kZWRAdGVzdC5jb20nO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5RW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3VzZXItc3VzcGVuZGVkJyxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBoYXNoUGFzc3dvcmQoJ1Bhc3MxMjMhJyksXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLlNVU1BFTkRFRCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHVzZXJTZXJ2aWNlLmxvZ2luKGVtYWlsLCAnUGFzczEyMyEnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnQWNjb3VudCBoYXMgYmVlbiBzdXNwZW5kZWQnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY3RpdmF0ZSBwZW5kaW5nIGFjY291bnQgYWZ0ZXIgdmVyaWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSAnYWN0aXZhdGVfdG9rZW5fMTIzJztcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnZlcmlmeUVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICd1c2VyLWFjdGl2YXRlJyxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgZW1haWxWZXJpZmllZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS52ZXJpZnlFbWFpbCh2ZXJpZmljYXRpb25Ub2tlbik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFVzZXJTdGF0dXMuQUNUSVZFKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NoYW5nZSBQYXNzd29yZCBXaGlsZSBBdXRoZW50aWNhdGVkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2hhbmdlIHBhc3N3b3JkIGZvciBhdXRoZW50aWNhdGVkIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci1jaGFuZ2UtcGFzcyc7XG4gICAgICBjb25zdCBjdXJyZW50UGFzc3dvcmQgPSAnT2xkUGFzczEyMyEnO1xuICAgICAgY29uc3QgbmV3UGFzc3dvcmQgPSAnTmV3UGFzczQ1NiEnO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBlbWFpbDogJ2NoYW5nZXBhc3NAdGVzdC5jb20nLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgaGFzaFBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgaGFzaFBhc3N3b3JkKG5ld1Bhc3N3b3JkKSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgdXNlclNlcnZpY2UuY2hhbmdlUGFzc3dvcmQodXNlcklkLCBjdXJyZW50UGFzc3dvcmQsIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBwYXNzd29yZDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhc3N3b3JkIGNoYW5nZSB3aXRoIHdyb25nIGN1cnJlbnQgcGFzc3dvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci13cm9uZy1jdXJyZW50JztcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGhhc2hQYXNzd29yZCgnQ29ycmVjdFBhc3MxMjMhJyksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgdXNlclNlcnZpY2UuY2hhbmdlUGFzc3dvcmQodXNlcklkLCAnV3JvbmdQYXNzMTIzIScsICdOZXdQYXNzNDU2IScpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG5ldyBwYXNzd29yZCBzdHJlbmd0aCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLXdlYWstbmV3LXBhc3MnO1xuXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgaGFzaFBhc3N3b3JkKCdPbGRQYXNzMTIzIScpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHVzZXJTZXJ2aWNlLmNoYW5nZVBhc3N3b3JkKHVzZXJJZCwgJ09sZFBhc3MxMjMhJywgJ3dlYWsnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ011bHRpLURldmljZSBTZXNzaW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGxvZ2luIGZyb20gbXVsdGlwbGUgZGV2aWNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ211bHRpZGV2aWNlQHRlc3QuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ011bHRpRGV2aWNlMTIzISc7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAndXNlci1tdWx0aS1kZXZpY2UnLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCksXG4gICAgICAgIGVtYWlsVmVyaWZpZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgc3RhdHVzOiBVc2VyU3RhdHVzLkFDVElWRSxcbiAgICAgICAgbG9naW5BdHRlbXB0czogMCxcbiAgICAgIH0gYXMgYW55KTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGVMYXN0TG9naW4ubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5yZXNldExvZ2luQXR0ZW1wdHMubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgLy8gTG9naW4gZnJvbSBkZXZpY2UgMVxuICAgICAgY29uc3QgZGV2aWNlMVRva2VuID0gYXdhaXQgdXNlclNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgLy8gTG9naW4gZnJvbSBkZXZpY2UgMlxuICAgICAgY29uc3QgZGV2aWNlMlRva2VuID0gYXdhaXQgdXNlclNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgLy8gQm90aCB0b2tlbnMgc2hvdWxkIGJlIHZhbGlkXG4gICAgICBleHBlY3QoZGV2aWNlMVRva2VuLnRva2VuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRldmljZTJUb2tlbi50b2tlbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkZXZpY2UxVG9rZW4udG9rZW4pLm5vdC50b0JlKGRldmljZTJUb2tlbi50b2tlbik7XG5cbiAgICAgIC8vIEJvdGggdG9rZW5zIHNob3VsZCB2ZXJpZnkgc3VjY2Vzc2Z1bGx5XG4gICAgICBjb25zdCBkZWNvZGVkMSA9IHZlcmlmeVRva2VuKGRldmljZTFUb2tlbi50b2tlbik7XG4gICAgICBjb25zdCBkZWNvZGVkMiA9IHZlcmlmeVRva2VuKGRldmljZTJUb2tlbi50b2tlbik7XG5cbiAgICAgIGV4cGVjdChkZWNvZGVkMS51c2VySWQpLnRvQmUoJ3VzZXItbXVsdGktZGV2aWNlJyk7XG4gICAgICBleHBlY3QoZGVjb2RlZDIudXNlcklkKS50b0JlKCd1c2VyLW11bHRpLWRldmljZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRW1haWwgQ2hhbmdlIFdvcmtmbG93JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmVyaWZ5IG5ldyBlbWFpbCBiZWZvcmUgdXBkYXRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci1jaGFuZ2UtZW1haWwnO1xuICAgICAgY29uc3QgY3VycmVudEVtYWlsID0gJ29sZEB0ZXN0LmNvbSc7XG4gICAgICBjb25zdCBuZXdFbWFpbCA9ICduZXdAdGVzdC5jb20nO1xuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSAnZW1haWxfY2hhbmdlX3Rva2VuXzEyMyc7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiB1c2VySWQsXG4gICAgICAgIGVtYWlsOiBjdXJyZW50RW1haWwsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFJlcXVlc3QgZW1haWwgY2hhbmdlXG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgbmV3RW1haWwsXG4gICAgICAgIG5ld0VtYWlsVmVyaWZpY2F0aW9uVG9rZW46IHZlcmlmaWNhdGlvblRva2VuLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kVmVyaWZpY2F0aW9uRW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnJlcXVlc3RFbWFpbENoYW5nZSh1c2VySWQsIG5ld0VtYWlsKTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRWZXJpZmljYXRpb25FbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG5ld0VtYWlsLFxuICAgICAgICBleHBlY3QuYW55KFN0cmluZylcbiAgICAgICk7XG5cbiAgICAgIC8vIFZlcmlmeSBuZXcgZW1haWxcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBlbWFpbDogbmV3RW1haWwsXG4gICAgICAgIG5ld0VtYWlsOiBudWxsLFxuICAgICAgICBuZXdFbWFpbFZlcmlmaWNhdGlvblRva2VuOiBudWxsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCB1c2VyU2VydmljZS52ZXJpZnlOZXdFbWFpbCh2ZXJpZmljYXRpb25Ub2tlbik7XG5cbiAgICAgIGV4cGVjdChtb2NrVXNlclJlcG9zaXRvcnkudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZW1haWw6IG5ld0VtYWlsLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==