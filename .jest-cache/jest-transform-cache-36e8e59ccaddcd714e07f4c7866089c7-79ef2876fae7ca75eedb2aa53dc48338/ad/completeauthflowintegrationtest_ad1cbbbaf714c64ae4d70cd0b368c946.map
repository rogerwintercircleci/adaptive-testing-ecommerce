{"file":"C:\\Adaptive_Testing\\tests\\integration\\auth\\complete-auth-flow.integration.test.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\tests\\integration\\auth\\complete-auth-flow.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Complete Authentication Flows\n *\n * Testing end-to-end authentication and authorization workflows\n */\n\nimport { UserService } from '../../../src/services/user-management/services/user.service';\nimport { UserRepository } from '../../../src/services/user-management/repositories/user.repository';\nimport { NotificationService } from '../../../src/services/notifications/services/notification.service';\nimport { verifyToken, generateToken } from '../../../src/libs/auth/jwt.utils';\nimport { hashPassword } from '../../../src/libs/auth/password.utils';\nimport { UnauthorizedError, BadRequestError } from '../../../src/libs/errors';\nimport { UserRole, UserStatus } from '../../../src/services/user-management/entities/user.entity';\n\njest.mock('../../../src/services/user-management/repositories/user.repository');\njest.mock('../../../src/services/notifications/services/notification.service');\n\ndescribe('Complete Authentication Flow Integration Tests', () => {\n  let userService: UserService;\n  let mockUserRepository: jest.Mocked<UserRepository>;\n  let mockNotificationService: jest.Mocked<NotificationService>;\n\n  beforeEach(() => {\n    mockUserRepository = {\n      findByEmail: jest.fn(),\n      createUser: jest.fn(),\n      findById: jest.fn(),\n      update: jest.fn(),\n      setEmailVerificationToken: jest.fn(),\n      verifyEmail: jest.fn(),\n      setPasswordResetToken: jest.fn(),\n      resetPassword: jest.fn(),\n      updateLastLogin: jest.fn(),\n      incrementLoginAttempts: jest.fn(),\n      resetLoginAttempts: jest.fn(),\n    } as unknown as jest.Mocked<UserRepository>;\n\n    mockNotificationService = {\n      sendWelcomeEmail: jest.fn(),\n      sendVerificationEmail: jest.fn(),\n      sendPasswordResetEmail: jest.fn(),\n    } as unknown as jest.Mocked<NotificationService>;\n\n    userService = new UserService(mockUserRepository, mockNotificationService);\n  });\n\n  describe('New User Registration and Verification Flow', () => {\n    it('should complete full registration to first login', async () => {\n      const email = 'newuser@test.com';\n      const password = 'SecurePass123!';\n      const verificationToken = 'verify_token_123';\n\n      // Step 1: User registration\n      mockUserRepository.findByEmail.mockResolvedValue(null);\n      mockUserRepository.createUser.mockResolvedValue({\n        id: 'user-new-1',\n        email,\n        firstName: 'New',\n        lastName: 'User',\n        emailVerificationToken: verificationToken,\n        emailVerifiedAt: null,\n        status: UserStatus.PENDING,\n      } as any);\n      mockNotificationService.sendWelcomeEmail.mockResolvedValue({ success: true });\n      mockNotificationService.sendVerificationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const registered = await userService.register({\n        email,\n        password,\n        firstName: 'New',\n        lastName: 'User',\n      });\n\n      expect(registered.user.status).toBe(UserStatus.PENDING);\n      expect(mockNotificationService.sendWelcomeEmail).toHaveBeenCalled();\n      expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalled();\n\n      // Step 2: User clicks verification link\n      mockUserRepository.verifyEmail.mockResolvedValue({\n        id: 'user-new-1',\n        email,\n        emailVerifiedAt: new Date(),\n        emailVerificationToken: null,\n        status: UserStatus.ACTIVE,\n        password: await hashPassword(password),\n        loginAttempts: 0,\n      } as any);\n\n      const verified = await userService.verifyEmail(verificationToken);\n\n      expect(verified.status).toBe(UserStatus.ACTIVE);\n      expect(verified.emailVerifiedAt).toBeDefined();\n\n      // Step 3: User logs in for first time\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-new-1',\n        email,\n        password: await hashPassword(password),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      const loggedIn = await userService.login(email, password);\n\n      expect(loggedIn.token).toBeDefined();\n      expect(loggedIn.user.email).toBe(email);\n      expect(mockUserRepository.updateLastLogin).toHaveBeenCalled();\n\n      // Step 4: Verify token works\n      const decoded = verifyToken(loggedIn.token);\n      expect(decoded.userId).toBe('user-new-1');\n      expect(decoded.email).toBe(email);\n    });\n\n    it('should block login before email verification', async () => {\n      const email = 'unverified@test.com';\n      const password = 'SecurePass123!';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-unverified',\n        email,\n        password: await hashPassword(password),\n        emailVerifiedAt: null,\n        status: UserStatus.PENDING,\n      } as any);\n\n      await expect(userService.login(email, password)).rejects.toThrow(\n        UnauthorizedError\n      );\n    });\n\n    it('should resend verification email if requested', async () => {\n      const email = 'needsverification@test.com';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-resend',\n        email,\n        emailVerifiedAt: null,\n        status: UserStatus.PENDING,\n      } as any);\n\n      mockUserRepository.setEmailVerificationToken.mockResolvedValue({} as any);\n      mockNotificationService.sendVerificationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      await userService.resendVerificationEmail(email);\n\n      expect(mockUserRepository.setEmailVerificationToken).toHaveBeenCalled();\n      expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Password Reset Flow', () => {\n    it('should complete full password reset workflow', async () => {\n      const email = 'forgotpass@test.com';\n      const newPassword = 'NewSecurePass456!';\n      const resetToken = 'reset_token_xyz';\n\n      // Step 1: User requests password reset\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-forgot',\n        email,\n      } as any);\n      mockUserRepository.setPasswordResetToken.mockResolvedValue({} as any);\n      mockNotificationService.sendPasswordResetEmail.mockResolvedValue({\n        success: true,\n      });\n\n      await userService.requestPasswordReset(email);\n\n      expect(mockUserRepository.setPasswordResetToken).toHaveBeenCalled();\n      expect(mockNotificationService.sendPasswordResetEmail).toHaveBeenCalledWith(\n        email,\n        expect.any(String)\n      );\n\n      // Step 2: User clicks reset link and enters new password\n      mockUserRepository.resetPassword.mockResolvedValue({\n        id: 'user-forgot',\n        email,\n        passwordResetToken: null,\n        passwordResetExpires: null,\n        password: await hashPassword(newPassword),\n      } as any);\n\n      const reset = await userService.resetPassword(resetToken, newPassword);\n\n      expect(reset.passwordResetToken).toBeNull();\n\n      // Step 3: User logs in with new password\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-forgot',\n        email,\n        password: await hashPassword(newPassword),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      const loggedIn = await userService.login(email, newPassword);\n\n      expect(loggedIn.token).toBeDefined();\n    });\n\n    it('should expire reset token after time limit', async () => {\n      const expiredToken = 'expired_token_123';\n\n      mockUserRepository.resetPassword.mockRejectedValue(\n        new UnauthorizedError('Reset token has expired')\n      );\n\n      await expect(\n        userService.resetPassword(expiredToken, 'NewPass123!')\n      ).rejects.toThrow(UnauthorizedError);\n    });\n\n    it('should invalidate reset token after use', async () => {\n      const resetToken = 'onetime_token_456';\n      const newPassword = 'OneTimeUse123!';\n\n      mockUserRepository.resetPassword.mockResolvedValueOnce({\n        id: 'user-onetime',\n        passwordResetToken: null,\n      } as any);\n\n      await userService.resetPassword(resetToken, newPassword);\n\n      // Trying to use same token again should fail\n      mockUserRepository.resetPassword.mockRejectedValue(\n        new UnauthorizedError('Invalid or expired reset token')\n      );\n\n      await expect(\n        userService.resetPassword(resetToken, 'AnotherPass123!')\n      ).rejects.toThrow(UnauthorizedError);\n    });\n  });\n\n  describe('Account Lockout and Recovery', () => {\n    it('should lock account after 5 failed login attempts', async () => {\n      const email = 'lockeduser@test.com';\n      const hashedPassword = await hashPassword('CorrectPass123!');\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-lockout',\n        email,\n        password: hashedPassword,\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 0,\n        lockedUntil: null,\n      } as any);\n\n      // Attempt 5 failed logins\n      for (let i = 1; i <= 5; i++) {\n        const lockedUntil = i === 5 ? new Date(Date.now() + 30 * 60 * 1000) : null;\n\n        mockUserRepository.incrementLoginAttempts.mockResolvedValue({\n          loginAttempts: i,\n          lockedUntil,\n        } as any);\n\n        try {\n          await userService.login(email, 'WrongPassword');\n        } catch (error) {\n          // Expected to fail\n        }\n      }\n\n      expect(mockUserRepository.incrementLoginAttempts).toHaveBeenCalledTimes(5);\n\n      // Verify account is locked\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-lockout',\n        email,\n        password: hashedPassword,\n        loginAttempts: 5,\n        lockedUntil: new Date(Date.now() + 30 * 60 * 1000),\n        status: UserStatus.ACTIVE,\n      } as any);\n\n      await expect(userService.login(email, 'CorrectPass123!')).rejects.toThrow(\n        'Account is temporarily locked'\n      );\n    });\n\n    it('should unlock account after lockout period', async () => {\n      const email = 'unlocking@test.com';\n      const password = 'CorrectPass123!';\n      const hashedPassword = await hashPassword(password);\n\n      // Account was locked but lockout expired\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-unlock',\n        email,\n        password: hashedPassword,\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 5,\n        lockedUntil: new Date(Date.now() - 1000), // Expired 1 second ago\n      } as any);\n\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({\n        loginAttempts: 0,\n        lockedUntil: null,\n      } as any);\n\n      const result = await userService.login(email, password);\n\n      expect(result.token).toBeDefined();\n      expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalled();\n    });\n\n    it('should reset failed attempts after successful login', async () => {\n      const email = 'resetattempts@test.com';\n      const password = 'CorrectPass123!';\n      const hashedPassword = await hashPassword(password);\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-reset-attempts',\n        email,\n        password: hashedPassword,\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 3, // Had some failed attempts\n        lockedUntil: null,\n      } as any);\n\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({\n        loginAttempts: 0,\n      } as any);\n\n      await userService.login(email, password);\n\n      expect(mockUserRepository.resetLoginAttempts).toHaveBeenCalled();\n    });\n  });\n\n  describe('Role-Based Access Control', () => {\n    it('should include role in JWT token', async () => {\n      const adminEmail = 'admin@test.com';\n      const password = 'AdminPass123!';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'admin-1',\n        email: adminEmail,\n        password: await hashPassword(password),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        role: UserRole.ADMIN,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      const result = await userService.login(adminEmail, password);\n\n      const decoded = verifyToken(result.token);\n      expect(decoded.role).toBe(UserRole.ADMIN);\n    });\n\n    it('should differentiate between customer and admin roles', async () => {\n      const customerEmail = 'customer@test.com';\n      const password = 'CustomerPass123!';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'customer-1',\n        email: customerEmail,\n        password: await hashPassword(password),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        role: UserRole.CUSTOMER,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      const result = await userService.login(customerEmail, password);\n\n      const decoded = verifyToken(result.token);\n      expect(decoded.role).toBe(UserRole.CUSTOMER);\n    });\n  });\n\n  describe('Token Expiration and Refresh', () => {\n    it('should generate token with expiration', async () => {\n      const email = 'tokenexp@test.com';\n      const password = 'TokenPass123!';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-token-exp',\n        email,\n        password: await hashPassword(password),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      const result = await userService.login(email, password);\n\n      const decoded = verifyToken(result.token);\n      expect(decoded.exp).toBeDefined();\n      expect(decoded.exp).toBeGreaterThan(Math.floor(Date.now() / 1000));\n    });\n\n    it('should reject expired token', () => {\n      const expiredToken = generateToken(\n        {\n          userId: 'user-123',\n          email: 'test@test.com',\n          role: 'customer',\n        },\n        '-1h' // Expired 1 hour ago\n      );\n\n      expect(() => verifyToken(expiredToken)).toThrow();\n    });\n  });\n\n  describe('Account Status Workflows', () => {\n    it('should prevent login for suspended account', async () => {\n      const email = 'suspended@test.com';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-suspended',\n        email,\n        password: await hashPassword('Pass123!'),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.SUSPENDED,\n      } as any);\n\n      await expect(userService.login(email, 'Pass123!')).rejects.toThrow(\n        'Account has been suspended'\n      );\n    });\n\n    it('should activate pending account after verification', async () => {\n      const verificationToken = 'activate_token_123';\n\n      mockUserRepository.verifyEmail.mockResolvedValue({\n        id: 'user-activate',\n        status: UserStatus.ACTIVE,\n        emailVerifiedAt: new Date(),\n      } as any);\n\n      const result = await userService.verifyEmail(verificationToken);\n\n      expect(result.status).toBe(UserStatus.ACTIVE);\n    });\n  });\n\n  describe('Change Password While Authenticated', () => {\n    it('should change password for authenticated user', async () => {\n      const userId = 'user-change-pass';\n      const currentPassword = 'OldPass123!';\n      const newPassword = 'NewPass456!';\n\n      mockUserRepository.findById.mockResolvedValue({\n        id: userId,\n        email: 'changepass@test.com',\n        password: await hashPassword(currentPassword),\n      } as any);\n\n      mockUserRepository.update.mockResolvedValue({\n        id: userId,\n        password: await hashPassword(newPassword),\n      } as any);\n\n      await userService.changePassword(userId, currentPassword, newPassword);\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(\n        userId,\n        expect.objectContaining({\n          password: expect.any(String),\n        })\n      );\n    });\n\n    it('should reject password change with wrong current password', async () => {\n      const userId = 'user-wrong-current';\n\n      mockUserRepository.findById.mockResolvedValue({\n        id: userId,\n        password: await hashPassword('CorrectPass123!'),\n      } as any);\n\n      await expect(\n        userService.changePassword(userId, 'WrongPass123!', 'NewPass456!')\n      ).rejects.toThrow(UnauthorizedError);\n    });\n\n    it('should validate new password strength', async () => {\n      const userId = 'user-weak-new-pass';\n\n      mockUserRepository.findById.mockResolvedValue({\n        id: userId,\n        password: await hashPassword('OldPass123!'),\n      } as any);\n\n      await expect(\n        userService.changePassword(userId, 'OldPass123!', 'weak')\n      ).rejects.toThrow(BadRequestError);\n    });\n  });\n\n  describe('Multi-Device Sessions', () => {\n    it('should allow login from multiple devices', async () => {\n      const email = 'multidevice@test.com';\n      const password = 'MultiDevice123!';\n\n      mockUserRepository.findByEmail.mockResolvedValue({\n        id: 'user-multi-device',\n        email,\n        password: await hashPassword(password),\n        emailVerifiedAt: new Date(),\n        status: UserStatus.ACTIVE,\n        loginAttempts: 0,\n      } as any);\n      mockUserRepository.updateLastLogin.mockResolvedValue({} as any);\n      mockUserRepository.resetLoginAttempts.mockResolvedValue({} as any);\n\n      // Login from device 1\n      const device1Token = await userService.login(email, password);\n\n      // Login from device 2\n      const device2Token = await userService.login(email, password);\n\n      // Both tokens should be valid\n      expect(device1Token.token).toBeDefined();\n      expect(device2Token.token).toBeDefined();\n      expect(device1Token.token).not.toBe(device2Token.token);\n\n      // Both tokens should verify successfully\n      const decoded1 = verifyToken(device1Token.token);\n      const decoded2 = verifyToken(device2Token.token);\n\n      expect(decoded1.userId).toBe('user-multi-device');\n      expect(decoded2.userId).toBe('user-multi-device');\n    });\n  });\n\n  describe('Email Change Workflow', () => {\n    it('should verify new email before updating', async () => {\n      const userId = 'user-change-email';\n      const currentEmail = 'old@test.com';\n      const newEmail = 'new@test.com';\n      const verificationToken = 'email_change_token_123';\n\n      mockUserRepository.findById.mockResolvedValue({\n        id: userId,\n        email: currentEmail,\n      } as any);\n\n      // Request email change\n      mockUserRepository.update.mockResolvedValue({\n        id: userId,\n        newEmail,\n        newEmailVerificationToken: verificationToken,\n      } as any);\n\n      mockNotificationService.sendVerificationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      await userService.requestEmailChange(userId, newEmail);\n\n      expect(mockNotificationService.sendVerificationEmail).toHaveBeenCalledWith(\n        newEmail,\n        expect.any(String)\n      );\n\n      // Verify new email\n      mockUserRepository.update.mockResolvedValue({\n        id: userId,\n        email: newEmail,\n        newEmail: null,\n        newEmailVerificationToken: null,\n      } as any);\n\n      await userService.verifyNewEmail(verificationToken);\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(\n        expect.any(String),\n        expect.objectContaining({\n          email: newEmail,\n        })\n      );\n    });\n  });\n});\n"],"version":3}