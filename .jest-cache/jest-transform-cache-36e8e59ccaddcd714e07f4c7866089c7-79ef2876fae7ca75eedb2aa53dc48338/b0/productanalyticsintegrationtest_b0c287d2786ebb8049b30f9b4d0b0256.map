{"file":"C:\\Adaptive_Testing\\tests\\integration\\services\\product-analytics-integration.test.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\tests\\integration\\services\\product-analytics-integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Product Catalog with Analytics\n *\n * Testing how product operations affect analytics and reporting\n */\n\nimport { ProductService } from '../../../src/services/product-catalog/services/product.service';\nimport { ProductRepository } from '../../../src/services/product-catalog/repositories/product.repository';\nimport { AnalyticsService } from '../../../src/services/analytics/services/analytics.service';\nimport { OrderRepository } from '../../../src/services/order-processing/repositories/order.repository';\nimport { UserRepository } from '../../../src/services/user-management/repositories/user.repository';\nimport { ProductStatus } from '../../../src/services/product-catalog/entities/product.entity';\n\njest.mock('../../../src/services/product-catalog/repositories/product.repository');\njest.mock('../../../src/services/order-processing/repositories/order.repository');\njest.mock('../../../src/services/user-management/repositories/user.repository');\n\ndescribe('Product and Analytics Integration Tests', () => {\n  let productService: ProductService;\n  let analyticsService: AnalyticsService;\n  let mockProductRepository: jest.Mocked<ProductRepository>;\n  let mockOrderRepository: jest.Mocked<OrderRepository>;\n  let mockUserRepository: jest.Mocked<UserRepository>;\n\n  beforeEach(() => {\n    mockProductRepository = {\n      createProduct: jest.fn(),\n      findById: jest.fn(),\n      updateInventory: jest.fn(),\n      incrementSoldCount: jest.fn(),\n      findTopSelling: jest.fn(),\n      findTopRated: jest.fn(),\n      findLowStock: jest.fn(),\n      updateRating: jest.fn(),\n      count: jest.fn(),\n    } as unknown as jest.Mocked<ProductRepository>;\n\n    mockOrderRepository = {\n      getTotalRevenue: jest.fn(),\n      findOrdersByDateRange: jest.fn(),\n      count: jest.fn(),\n    } as unknown as jest.Mocked<OrderRepository>;\n\n    mockUserRepository = {\n      count: jest.fn(),\n      findByStatus: jest.fn(),\n    } as unknown as jest.Mocked<UserRepository>;\n\n    productService = new ProductService(mockProductRepository);\n    analyticsService = new AnalyticsService(\n      mockOrderRepository,\n      mockProductRepository,\n      mockUserRepository\n    );\n  });\n\n  describe('Product Sales Tracking', () => {\n    it('should track product views in analytics', async () => {\n      const productId = 'prod-track-1';\n      const userId = 'user-viewer-1';\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: productId,\n        name: 'Tracked Product',\n        sku: 'TRACK-001',\n        price: 99.99,\n        inventory: 10,\n        status: ProductStatus.ACTIVE,\n      } as any);\n\n      // User views product\n      await productService.getProductById(productId);\n\n      // Track view event in analytics\n      await analyticsService.trackEvent({\n        userId,\n        eventType: 'product_view',\n        productId,\n        timestamp: new Date(),\n      });\n\n      // Get product performance metrics\n      const metrics = await analyticsService.getProductPerformance(productId);\n\n      expect(metrics.views).toBe(1);\n    });\n\n    it('should update top selling products when sales occur', async () => {\n      const products = [\n        { id: 'prod-1', name: 'Bestseller 1', soldCount: 1000, price: 50 },\n        { id: 'prod-2', name: 'Bestseller 2', soldCount: 800, price: 60 },\n        { id: 'prod-3', name: 'Bestseller 3', soldCount: 600, price: 70 },\n      ];\n\n      mockProductRepository.findTopSelling.mockResolvedValue(products as any);\n\n      const topSelling = await analyticsService.getTopSellingProducts(10);\n\n      expect(topSelling.length).toBe(3);\n      expect(topSelling[0].soldCount).toBeGreaterThan(topSelling[1].soldCount);\n    });\n\n    it('should track product purchases and update sold count', async () => {\n      const productId = 'prod-purchase-1';\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: productId,\n        name: 'Purchase Product',\n        soldCount: 50,\n      } as any);\n\n      mockProductRepository.incrementSoldCount.mockResolvedValue({\n        id: productId,\n        soldCount: 53,\n      } as any);\n\n      // Simulate 3 products sold\n      await mockProductRepository.incrementSoldCount(productId, 3);\n\n      const updated = await mockProductRepository.findById(productId);\n      expect(updated.soldCount).toBeGreaterThan(50);\n    });\n  });\n\n  describe('Inventory Analytics', () => {\n    it('should identify low stock products', async () => {\n      const lowStockProducts = [\n        { id: 'prod-low-1', name: 'Low Stock 1', inventory: 3 },\n        { id: 'prod-low-2', name: 'Low Stock 2', inventory: 5 },\n        { id: 'prod-low-3', name: 'Low Stock 3', inventory: 8 },\n      ];\n\n      mockProductRepository.findLowStock.mockResolvedValue(lowStockProducts as any);\n\n      const alerts = await analyticsService.getLowStockAlert(10);\n\n      expect(alerts.length).toBe(3);\n      expect(alerts.every(p => p.inventory <= 10)).toBe(true);\n    });\n\n    it('should track inventory changes', async () => {\n      const productId = 'prod-inventory-1';\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: productId,\n        inventory: 100,\n      } as any);\n\n      // Track inventory before order\n      const before = await mockProductRepository.findById(productId);\n      const initialInventory = before.inventory;\n\n      // Simulate order decreasing inventory\n      mockProductRepository.updateInventory.mockResolvedValue({\n        id: productId,\n        inventory: 95,\n      } as any);\n\n      await mockProductRepository.updateInventory(productId, 95);\n\n      // Track inventory after order\n      const after = await mockProductRepository.findById(productId);\n\n      expect(after.inventory).toBeLessThan(initialInventory);\n    });\n  });\n\n  describe('Product Performance Metrics', () => {\n    it('should calculate conversion rate for products', async () => {\n      const productId = 'prod-conversion-1';\n      const views = 1000;\n      const purchases = 50;\n\n      // Track views\n      for (let i = 0; i < 5; i++) {\n        await analyticsService.trackEvent({\n          userId: `user-${i}`,\n          eventType: 'product_view',\n          productId,\n          timestamp: new Date(),\n        });\n      }\n\n      // Calculate conversion rate\n      const conversionRate = await analyticsService.getConversionRate(views, purchases);\n\n      expect(conversionRate).toBe(5); // 50/1000 * 100\n    });\n\n    it('should track product revenue', async () => {\n      const productId = 'prod-revenue-1';\n\n      // Track product sales events\n      await analyticsService.trackEvent({\n        userId: 'user-buyer-1',\n        eventType: 'product_purchase',\n        productId,\n        timestamp: new Date(),\n        metadata: {\n          quantity: 2,\n          unitPrice: 75.00,\n          revenue: 150.00,\n        },\n      });\n\n      const metrics = await analyticsService.getProductPerformance(productId);\n      expect(metrics).toBeDefined();\n    });\n  });\n\n  describe('Product Ratings and Reviews', () => {\n    it('should update top rated products list', async () => {\n      const topRatedProducts = [\n        { id: 'prod-rated-1', name: 'Excellent Product', rating: 4.9, reviewCount: 500 },\n        { id: 'prod-rated-2', name: 'Great Product', rating: 4.7, reviewCount: 300 },\n        { id: 'prod-rated-3', name: 'Good Product', rating: 4.5, reviewCount: 200 },\n      ];\n\n      mockProductRepository.findTopRated.mockResolvedValue(topRatedProducts as any);\n\n      const topRated = await analyticsService.getTopRatedProducts(10);\n\n      expect(topRated.length).toBe(3);\n      expect(topRated[0].rating).toBeGreaterThanOrEqual(topRated[1].rating);\n    });\n\n    it('should track rating changes', async () => {\n      const productId = 'prod-rating-1';\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: productId,\n        rating: 4.0,\n        reviewCount: 10,\n      } as any);\n\n      // Add new rating\n      mockProductRepository.updateRating.mockResolvedValue({\n        id: productId,\n        rating: 4.2,\n        reviewCount: 11,\n      } as any);\n\n      await mockProductRepository.updateRating(productId, 4.2, 11);\n\n      const updated = await mockProductRepository.findById(productId);\n      expect(updated.rating).toBeGreaterThan(4.0);\n      expect(updated.reviewCount).toBe(11);\n    });\n  });\n\n  describe('Dashboard Metrics Integration', () => {\n    it('should aggregate product metrics for dashboard', async () => {\n      mockOrderRepository.getTotalRevenue.mockResolvedValue(100000);\n      mockOrderRepository.count.mockResolvedValue(500);\n      mockUserRepository.count.mockResolvedValue(2000);\n      mockProductRepository.count.mockResolvedValue(150);\n\n      const dashboard = await analyticsService.getDashboardMetrics();\n\n      expect(dashboard.totalProducts).toBe(150);\n      expect(dashboard.totalRevenue).toBe(100000);\n      expect(dashboard.totalOrders).toBe(500);\n      expect(dashboard.averageOrderValue).toBe(200);\n    });\n\n    it('should include product-specific metrics in reports', async () => {\n      mockProductRepository.count.mockResolvedValue(150);\n      mockProductRepository.findTopSelling.mockResolvedValue([\n        { id: '1', soldCount: 1000 },\n        { id: '2', soldCount: 800 },\n      ] as any);\n      mockProductRepository.findTopRated.mockResolvedValue([\n        { id: '3', rating: 4.9 },\n        { id: '4', rating: 4.8 },\n      ] as any);\n      mockProductRepository.findLowStock.mockResolvedValue([\n        { id: '5', inventory: 3 },\n      ] as any);\n\n      const report = await analyticsService.exportReport('products');\n\n      expect(report.type).toBe('products');\n      expect(report.data).toHaveProperty('totalProducts');\n      expect(report.data).toHaveProperty('topSelling');\n      expect(report.data).toHaveProperty('topRated');\n      expect(report.data).toHaveProperty('lowStock');\n    });\n  });\n\n  describe('Sales Period Analytics', () => {\n    it('should track product sales by time period', async () => {\n      const mockOrders = [\n        {\n          createdAt: new Date('2024-01-15'),\n          total: 100,\n          items: [{ productId: 'prod-1', quantity: 2 }],\n        },\n        {\n          createdAt: new Date('2024-01-20'),\n          total: 200,\n          items: [{ productId: 'prod-1', quantity: 1 }],\n        },\n        {\n          createdAt: new Date('2024-02-05'),\n          total: 150,\n          items: [{ productId: 'prod-2', quantity: 3 }],\n        },\n      ];\n\n      mockOrderRepository.findOrdersByDateRange.mockResolvedValue(mockOrders as any);\n\n      const metrics = await analyticsService.getSalesMetricsByPeriod('month');\n\n      expect(metrics.length).toBeGreaterThan(0);\n      expect(metrics[0]).toHaveProperty('period');\n      expect(metrics[0]).toHaveProperty('revenue');\n      expect(metrics[0]).toHaveProperty('orderCount');\n    });\n  });\n\n  describe('Product Lifecycle Analytics', () => {\n    it('should track product from creation to first sale', async () => {\n      // 1. Create product\n      const createDto = {\n        name: 'New Product',\n        description: 'A brand new product',\n        sku: 'NEW-001',\n        price: 49.99,\n        inventory: 100,\n      };\n\n      mockProductRepository.createProduct.mockResolvedValue({\n        id: 'prod-new-1',\n        ...createDto,\n        soldCount: 0,\n        status: ProductStatus.ACTIVE,\n        createdAt: new Date(),\n      } as any);\n\n      const newProduct = await productService.createProduct(createDto);\n      expect(newProduct.soldCount).toBe(0);\n\n      // 2. Track product view\n      await analyticsService.trackEvent({\n        userId: 'user-1',\n        eventType: 'product_view',\n        productId: newProduct.id,\n        timestamp: new Date(),\n      });\n\n      // 3. Simulate first sale\n      mockProductRepository.incrementSoldCount.mockResolvedValue({\n        id: 'prod-new-1',\n        soldCount: 1,\n      } as any);\n\n      await mockProductRepository.incrementSoldCount(newProduct.id, 1);\n\n      // 4. Verify analytics reflect the sale\n      const performance = await analyticsService.getProductPerformance(newProduct.id);\n      expect(performance.views).toBeGreaterThan(0);\n    });\n\n    it('should track product status changes in analytics', async () => {\n      const productId = 'prod-status-1';\n\n      // Product starts as DRAFT\n      mockProductRepository.findById.mockResolvedValue({\n        id: productId,\n        status: ProductStatus.DRAFT,\n        soldCount: 0,\n      } as any);\n\n      let product = await productService.getProductById(productId);\n      expect(product.status).toBe(ProductStatus.DRAFT);\n\n      // Activate product\n      mockProductRepository.update = jest.fn().mockResolvedValue({\n        id: productId,\n        status: ProductStatus.ACTIVE,\n        soldCount: 0,\n      } as any);\n\n      await mockProductRepository.update(productId, {\n        status: ProductStatus.ACTIVE,\n      });\n\n      // After activation, product should appear in analytics\n      mockProductRepository.count.mockResolvedValue(1);\n      const totalProducts = await analyticsService.getDashboardMetrics();\n      expect(totalProducts.totalProducts).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Cross-Service Event Tracking', () => {\n    it('should track complete purchase funnel', async () => {\n      const productId = 'prod-funnel-1';\n      const userId = 'user-funnel-1';\n\n      // 1. Product view\n      await analyticsService.trackEvent({\n        userId,\n        eventType: 'product_view',\n        productId,\n        timestamp: new Date(),\n      });\n\n      // 2. Add to cart\n      await analyticsService.trackEvent({\n        userId,\n        eventType: 'add_to_cart',\n        productId,\n        timestamp: new Date(),\n      });\n\n      // 3. Checkout\n      await analyticsService.trackEvent({\n        userId,\n        eventType: 'checkout',\n        productId,\n        timestamp: new Date(),\n      });\n\n      // 4. Purchase\n      await analyticsService.trackEvent({\n        userId,\n        eventType: 'product_purchase',\n        productId,\n        timestamp: new Date(),\n      });\n\n      // Verify all events tracked\n      const events = await analyticsService.getEventsByUser(userId);\n      expect(events.length).toBe(4);\n      expect(events.map(e => e.eventType)).toContain('product_view');\n      expect(events.map(e => e.eventType)).toContain('add_to_cart');\n      expect(events.map(e => e.eventType)).toContain('checkout');\n      expect(events.map(e => e.eventType)).toContain('product_purchase');\n    });\n\n    it('should calculate customer lifetime value with product purchases', async () => {\n      mockOrderRepository.getTotalRevenue.mockResolvedValue(50000);\n      mockUserRepository.count.mockResolvedValue(250);\n\n      const clv = await analyticsService.getCustomerLifetimeValue();\n\n      expect(clv).toBe(200); // 50000 / 250\n    });\n  });\n\n  describe('Promotional Analytics', () => {\n    it('should track sales for discounted products', async () => {\n      const saleProducts = [\n        {\n          id: 'prod-sale-1',\n          price: 79.99,\n          compareAtPrice: 99.99,\n          soldCount: 100,\n        },\n        {\n          id: 'prod-sale-2',\n          price: 49.99,\n          compareAtPrice: 69.99,\n          soldCount: 150,\n        },\n      ];\n\n      mockProductRepository.findOnSale = jest.fn().mockResolvedValue(saleProducts);\n\n      const onSale = await mockProductRepository.findOnSale();\n\n      expect(onSale.length).toBe(2);\n      expect(onSale.every(p => p.compareAtPrice! > p.price)).toBe(true);\n    });\n\n    it('should measure promotion effectiveness', async () => {\n      const productId = 'prod-promo-1';\n\n      // Sales before promotion\n      const beforeSales = 10;\n\n      // Apply discount\n      mockProductRepository.update = jest.fn().mockResolvedValue({\n        id: productId,\n        price: 59.99,\n        compareAtPrice: 79.99,\n      } as any);\n\n      // Sales after promotion\n      mockProductRepository.incrementSoldCount.mockResolvedValue({\n        id: productId,\n        soldCount: 50, // 40 additional sales during promotion\n      } as any);\n\n      await mockProductRepository.incrementSoldCount(productId, 40);\n\n      // Promotion increased sales by 400%\n      const salesIncrease = ((50 - beforeSales) / beforeSales) * 100;\n      expect(salesIncrease).toBe(400);\n    });\n  });\n\n  describe('Inventory Optimization', () => {\n    it('should identify fast-moving products for restocking', async () => {\n      const topSelling = [\n        { id: 'prod-fast-1', soldCount: 500, inventory: 5 },\n        { id: 'prod-fast-2', soldCount: 450, inventory: 8 },\n        { id: 'prod-fast-3', soldCount: 400, inventory: 3 },\n      ];\n\n      mockProductRepository.findTopSelling.mockResolvedValue(topSelling as any);\n\n      const fastMoving = await analyticsService.getTopSellingProducts(10);\n\n      // Identify products with high sales but low inventory\n      const needRestock = fastMoving.filter(\n        p => p.soldCount > 100 && p.inventory < 10\n      );\n\n      expect(needRestock.length).toBe(3);\n    });\n\n    it('should identify slow-moving products', async () => {\n      mockProductRepository.findAll = jest.fn().mockResolvedValue([\n        { id: 'prod-slow-1', soldCount: 2, inventory: 50, createdAt: new Date('2023-01-01') },\n        { id: 'prod-slow-2', soldCount: 1, inventory: 100, createdAt: new Date('2023-01-01') },\n      ]);\n\n      const allProducts = await mockProductRepository.findAll();\n\n      // Products with low sales after 1 year\n      const slowMoving = allProducts.filter(p => p.soldCount < 5);\n\n      expect(slowMoving.length).toBe(2);\n    });\n  });\n});\n"],"version":3}