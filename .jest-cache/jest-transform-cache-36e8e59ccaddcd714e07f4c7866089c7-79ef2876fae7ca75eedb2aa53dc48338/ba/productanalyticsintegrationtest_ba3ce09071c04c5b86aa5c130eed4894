11e3cf71484783e76521cb1e3194f780
"use strict";
/**
 * Integration Tests: Product Catalog with Analytics
 *
 * Testing how product operations affect analytics and reporting
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../../src/services/product-catalog/repositories/product.repository');
jest.mock('../../../src/services/order-processing/repositories/order.repository');
jest.mock('../../../src/services/user-management/repositories/user.repository');
const product_service_1 = require("../../../src/services/product-catalog/services/product.service");
const analytics_service_1 = require("../../../src/services/analytics/services/analytics.service");
const product_entity_1 = require("../../../src/services/product-catalog/entities/product.entity");
describe('Product and Analytics Integration Tests', () => {
    let productService;
    let analyticsService;
    let mockProductRepository;
    let mockOrderRepository;
    let mockUserRepository;
    beforeEach(() => {
        mockProductRepository = {
            createProduct: jest.fn(),
            findById: jest.fn(),
            updateInventory: jest.fn(),
            incrementSoldCount: jest.fn(),
            findTopSelling: jest.fn(),
            findTopRated: jest.fn(),
            findLowStock: jest.fn(),
            updateRating: jest.fn(),
            count: jest.fn(),
        };
        mockOrderRepository = {
            getTotalRevenue: jest.fn(),
            findOrdersByDateRange: jest.fn(),
            count: jest.fn(),
        };
        mockUserRepository = {
            count: jest.fn(),
            findByStatus: jest.fn(),
        };
        productService = new product_service_1.ProductService(mockProductRepository);
        analyticsService = new analytics_service_1.AnalyticsService(mockOrderRepository, mockProductRepository, mockUserRepository);
    });
    describe('Product Sales Tracking', () => {
        it('should track product views in analytics', async () => {
            const productId = 'prod-track-1';
            const userId = 'user-viewer-1';
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                name: 'Tracked Product',
                sku: 'TRACK-001',
                price: 99.99,
                inventory: 10,
                status: product_entity_1.ProductStatus.ACTIVE,
            });
            // User views product
            await productService.getProductById(productId);
            // Track view event in analytics
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_view',
                productId,
                timestamp: new Date(),
            });
            // Get product performance metrics
            const metrics = await analyticsService.getProductPerformance(productId);
            expect(metrics.views).toBe(1);
        });
        it('should update top selling products when sales occur', async () => {
            const products = [
                { id: 'prod-1', name: 'Bestseller 1', soldCount: 1000, price: 50 },
                { id: 'prod-2', name: 'Bestseller 2', soldCount: 800, price: 60 },
                { id: 'prod-3', name: 'Bestseller 3', soldCount: 600, price: 70 },
            ];
            mockProductRepository.findTopSelling.mockResolvedValue(products);
            const topSelling = await analyticsService.getTopSellingProducts(10);
            expect(topSelling.length).toBe(3);
            expect(topSelling[0].soldCount).toBeGreaterThan(topSelling[1].soldCount);
        });
        it('should track product purchases and update sold count', async () => {
            const productId = 'prod-purchase-1';
            mockProductRepository.findById
                .mockResolvedValueOnce({
                id: productId,
                name: 'Purchase Product',
                soldCount: 50,
            })
                .mockResolvedValueOnce({
                id: productId,
                name: 'Purchase Product',
                soldCount: 53,
            });
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: productId,
                soldCount: 53,
            });
            // Simulate 3 products sold
            await mockProductRepository.incrementSoldCount(productId, 3);
            const updated = await mockProductRepository.findById(productId);
            expect(updated.soldCount).toBeGreaterThan(50);
        });
    });
    describe('Inventory Analytics', () => {
        it('should identify low stock products', async () => {
            const lowStockProducts = [
                { id: 'prod-low-1', name: 'Low Stock 1', inventory: 3 },
                { id: 'prod-low-2', name: 'Low Stock 2', inventory: 5 },
                { id: 'prod-low-3', name: 'Low Stock 3', inventory: 8 },
            ];
            mockProductRepository.findLowStock.mockResolvedValue(lowStockProducts);
            const alerts = await analyticsService.getLowStockAlert(10);
            expect(alerts.length).toBe(3);
            expect(alerts.every(p => p.inventory <= 10)).toBe(true);
        });
        it('should track inventory changes', async () => {
            const productId = 'prod-inventory-1';
            mockProductRepository.findById
                .mockResolvedValueOnce({
                id: productId,
                inventory: 100,
            })
                .mockResolvedValueOnce({
                id: productId,
                inventory: 95,
            });
            // Track inventory before order
            const before = await mockProductRepository.findById(productId);
            const initialInventory = before.inventory;
            // Simulate order decreasing inventory
            mockProductRepository.updateInventory.mockResolvedValue({
                id: productId,
                inventory: 95,
            });
            await mockProductRepository.updateInventory(productId, 95);
            // Track inventory after order
            const after = await mockProductRepository.findById(productId);
            expect(after.inventory).toBeLessThan(initialInventory);
        });
    });
    describe('Product Performance Metrics', () => {
        it('should calculate conversion rate for products', async () => {
            const productId = 'prod-conversion-1';
            const views = 1000;
            const purchases = 50;
            // Track views
            for (let i = 0; i < 5; i++) {
                await analyticsService.trackEvent({
                    userId: `user-${i}`,
                    eventType: 'product_view',
                    productId,
                    timestamp: new Date(),
                });
            }
            // Calculate conversion rate
            const conversionRate = await analyticsService.getConversionRate(views, purchases);
            expect(conversionRate).toBe(5); // 50/1000 * 100
        });
        it('should track product revenue', async () => {
            const productId = 'prod-revenue-1';
            // Track product sales events
            await analyticsService.trackEvent({
                userId: 'user-buyer-1',
                eventType: 'product_purchase',
                productId,
                timestamp: new Date(),
                metadata: {
                    quantity: 2,
                    unitPrice: 75.00,
                    revenue: 150.00,
                },
            });
            const metrics = await analyticsService.getProductPerformance(productId);
            expect(metrics).toBeDefined();
        });
    });
    describe('Product Ratings and Reviews', () => {
        it('should update top rated products list', async () => {
            const topRatedProducts = [
                { id: 'prod-rated-1', name: 'Excellent Product', rating: 4.9, reviewCount: 500 },
                { id: 'prod-rated-2', name: 'Great Product', rating: 4.7, reviewCount: 300 },
                { id: 'prod-rated-3', name: 'Good Product', rating: 4.5, reviewCount: 200 },
            ];
            mockProductRepository.findTopRated.mockResolvedValue(topRatedProducts);
            const topRated = await analyticsService.getTopRatedProducts(10);
            expect(topRated.length).toBe(3);
            expect(topRated[0].rating).toBeGreaterThanOrEqual(topRated[1].rating);
        });
        it('should track rating changes', async () => {
            const productId = 'prod-rating-1';
            mockProductRepository.findById
                .mockResolvedValueOnce({
                id: productId,
                rating: 4.0,
                reviewCount: 10,
            })
                .mockResolvedValueOnce({
                id: productId,
                rating: 4.2,
                reviewCount: 11,
            });
            // Add new rating
            mockProductRepository.updateRating.mockResolvedValue({
                id: productId,
                rating: 4.2,
                reviewCount: 11,
            });
            await mockProductRepository.updateRating(productId, 4.2, 11);
            const updated = await mockProductRepository.findById(productId);
            expect(updated.rating).toBeGreaterThan(4.0);
            expect(updated.reviewCount).toBe(11);
        });
    });
    describe('Dashboard Metrics Integration', () => {
        it('should aggregate product metrics for dashboard', async () => {
            mockOrderRepository.getTotalRevenue.mockResolvedValue(100000);
            mockOrderRepository.count.mockResolvedValue(500);
            mockUserRepository.count.mockResolvedValue(2000);
            mockProductRepository.count.mockResolvedValue(150);
            const dashboard = await analyticsService.getDashboardMetrics();
            expect(dashboard.totalProducts).toBe(150);
            expect(dashboard.totalRevenue).toBe(100000);
            expect(dashboard.totalOrders).toBe(500);
            expect(dashboard.averageOrderValue).toBe(200);
        });
        it('should include product-specific metrics in reports', async () => {
            mockProductRepository.count.mockResolvedValue(150);
            mockProductRepository.findTopSelling.mockResolvedValue([
                { id: '1', soldCount: 1000 },
                { id: '2', soldCount: 800 },
            ]);
            mockProductRepository.findTopRated.mockResolvedValue([
                { id: '3', rating: 4.9 },
                { id: '4', rating: 4.8 },
            ]);
            mockProductRepository.findLowStock.mockResolvedValue([
                { id: '5', inventory: 3 },
            ]);
            const report = await analyticsService.exportReport('products');
            expect(report.type).toBe('products');
            expect(report.data).toHaveProperty('totalProducts');
            expect(report.data).toHaveProperty('topSelling');
            expect(report.data).toHaveProperty('topRated');
            expect(report.data).toHaveProperty('lowStock');
        });
    });
    describe('Sales Period Analytics', () => {
        it('should track product sales by time period', async () => {
            const mockOrders = [
                {
                    createdAt: new Date('2024-01-15'),
                    total: 100,
                    items: [{ productId: 'prod-1', quantity: 2 }],
                },
                {
                    createdAt: new Date('2024-01-20'),
                    total: 200,
                    items: [{ productId: 'prod-1', quantity: 1 }],
                },
                {
                    createdAt: new Date('2024-02-05'),
                    total: 150,
                    items: [{ productId: 'prod-2', quantity: 3 }],
                },
            ];
            mockOrderRepository.findOrdersByDateRange.mockResolvedValue(mockOrders);
            const metrics = await analyticsService.getSalesMetricsByPeriod('month');
            expect(metrics.length).toBeGreaterThan(0);
            expect(metrics[0]).toHaveProperty('period');
            expect(metrics[0]).toHaveProperty('revenue');
            expect(metrics[0]).toHaveProperty('orderCount');
        });
    });
    describe('Product Lifecycle Analytics', () => {
        it('should track product from creation to first sale', async () => {
            // 1. Create product
            const createDto = {
                name: 'New Product',
                description: 'A brand new product',
                sku: 'NEW-001',
                price: 49.99,
                inventory: 100,
            };
            mockProductRepository.createProduct.mockResolvedValue({
                id: 'prod-new-1',
                ...createDto,
                soldCount: 0,
                status: product_entity_1.ProductStatus.ACTIVE,
                createdAt: new Date(),
            });
            const newProduct = await productService.createProduct(createDto);
            expect(newProduct.soldCount).toBe(0);
            // 2. Track product view
            await analyticsService.trackEvent({
                userId: 'user-1',
                eventType: 'product_view',
                productId: newProduct.id,
                timestamp: new Date(),
            });
            // 3. Simulate first sale
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: 'prod-new-1',
                soldCount: 1,
            });
            await mockProductRepository.incrementSoldCount(newProduct.id, 1);
            // 4. Verify analytics reflect the sale
            const performance = await analyticsService.getProductPerformance(newProduct.id);
            expect(performance.views).toBeGreaterThan(0);
        });
        it('should track product status changes in analytics', async () => {
            const productId = 'prod-status-1';
            // Product starts as DRAFT
            mockProductRepository.findById.mockResolvedValue({
                id: productId,
                status: product_entity_1.ProductStatus.DRAFT,
                soldCount: 0,
            });
            let product = await productService.getProductById(productId);
            expect(product.status).toBe(product_entity_1.ProductStatus.DRAFT);
            // Activate product
            mockProductRepository.update = jest.fn().mockResolvedValue({
                id: productId,
                status: product_entity_1.ProductStatus.ACTIVE,
                soldCount: 0,
            });
            await mockProductRepository.update(productId, {
                status: product_entity_1.ProductStatus.ACTIVE,
            });
            // After activation, product should appear in analytics
            mockProductRepository.count.mockResolvedValue(1);
            const totalProducts = await analyticsService.getDashboardMetrics();
            expect(totalProducts.totalProducts).toBeGreaterThan(0);
        });
    });
    describe('Cross-Service Event Tracking', () => {
        it('should track complete purchase funnel', async () => {
            const productId = 'prod-funnel-1';
            const userId = 'user-funnel-1';
            // 1. Product view
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_view',
                productId,
                timestamp: new Date(),
            });
            // 2. Add to cart
            await analyticsService.trackEvent({
                userId,
                eventType: 'add_to_cart',
                productId,
                timestamp: new Date(),
            });
            // 3. Checkout
            await analyticsService.trackEvent({
                userId,
                eventType: 'checkout',
                productId,
                timestamp: new Date(),
            });
            // 4. Purchase
            await analyticsService.trackEvent({
                userId,
                eventType: 'product_purchase',
                productId,
                timestamp: new Date(),
            });
            // Verify all events tracked
            const events = await analyticsService.getEventsByUser(userId);
            expect(events.length).toBe(4);
            expect(events.map(e => e.eventType)).toContain('product_view');
            expect(events.map(e => e.eventType)).toContain('add_to_cart');
            expect(events.map(e => e.eventType)).toContain('checkout');
            expect(events.map(e => e.eventType)).toContain('product_purchase');
        });
        it('should calculate customer lifetime value with product purchases', async () => {
            mockOrderRepository.getTotalRevenue.mockResolvedValue(50000);
            mockUserRepository.count.mockResolvedValue(250);
            const clv = await analyticsService.getCustomerLifetimeValue();
            expect(clv).toBe(200); // 50000 / 250
        });
    });
    describe('Promotional Analytics', () => {
        it('should track sales for discounted products', async () => {
            const saleProducts = [
                {
                    id: 'prod-sale-1',
                    price: 79.99,
                    compareAtPrice: 99.99,
                    soldCount: 100,
                },
                {
                    id: 'prod-sale-2',
                    price: 49.99,
                    compareAtPrice: 69.99,
                    soldCount: 150,
                },
            ];
            mockProductRepository.findOnSale = jest.fn().mockResolvedValue(saleProducts);
            const onSale = await mockProductRepository.findOnSale();
            expect(onSale.length).toBe(2);
            expect(onSale.every(p => p.compareAtPrice > p.price)).toBe(true);
        });
        it('should measure promotion effectiveness', async () => {
            const productId = 'prod-promo-1';
            // Sales before promotion
            const beforeSales = 10;
            // Apply discount
            mockProductRepository.update = jest.fn().mockResolvedValue({
                id: productId,
                price: 59.99,
                compareAtPrice: 79.99,
            });
            // Sales after promotion
            mockProductRepository.incrementSoldCount.mockResolvedValue({
                id: productId,
                soldCount: 50, // 40 additional sales during promotion
            });
            await mockProductRepository.incrementSoldCount(productId, 40);
            // Promotion increased sales by 400%
            const salesIncrease = ((50 - beforeSales) / beforeSales) * 100;
            expect(salesIncrease).toBe(400);
        });
    });
    describe('Inventory Optimization', () => {
        it('should identify fast-moving products for restocking', async () => {
            const topSelling = [
                { id: 'prod-fast-1', soldCount: 500, inventory: 5 },
                { id: 'prod-fast-2', soldCount: 450, inventory: 8 },
                { id: 'prod-fast-3', soldCount: 400, inventory: 3 },
            ];
            mockProductRepository.findTopSelling.mockResolvedValue(topSelling);
            const fastMoving = await analyticsService.getTopSellingProducts(10);
            // Identify products with high sales but low inventory
            const needRestock = fastMoving.filter(p => p.soldCount > 100 && p.inventory < 10);
            expect(needRestock.length).toBe(3);
        });
        it('should identify slow-moving products', async () => {
            mockProductRepository.findAll = jest.fn().mockResolvedValue([
                { id: 'prod-slow-1', soldCount: 2, inventory: 50, createdAt: new Date('2023-01-01') },
                { id: 'prod-slow-2', soldCount: 1, inventory: 100, createdAt: new Date('2023-01-01') },
            ]);
            const allProducts = await mockProductRepository.findAll();
            // Products with low sales after 1 year
            const slowMoving = allProducts.filter(p => p.soldCount < 5);
            expect(slowMoving.length).toBe(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcc2VydmljZXNcXHByb2R1Y3QtYW5hbHl0aWNzLWludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBU0gsSUFBSSxDQUFDLElBQUksQ0FBQyx1RUFBdUUsQ0FBQyxDQUFDO0FBQ25GLElBQUksQ0FBQyxJQUFJLENBQUMsc0VBQXNFLENBQUMsQ0FBQztBQUNsRixJQUFJLENBQUMsSUFBSSxDQUFDLG9FQUFvRSxDQUFDLENBQUM7QUFUaEYsb0dBQWdHO0FBRWhHLGtHQUE4RjtBQUc5RixrR0FBOEY7QUFNOUYsUUFBUSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtJQUN2RCxJQUFJLGNBQThCLENBQUM7SUFDbkMsSUFBSSxnQkFBa0MsQ0FBQztJQUN2QyxJQUFJLHFCQUFxRCxDQUFDO0lBQzFELElBQUksbUJBQWlELENBQUM7SUFDdEQsSUFBSSxrQkFBK0MsQ0FBQztJQUVwRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QscUJBQXFCLEdBQUc7WUFDdEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN6QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUM0QixDQUFDO1FBRS9DLG1CQUFtQixHQUFHO1lBQ3BCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDMEIsQ0FBQztRQUU3QyxrQkFBa0IsR0FBRztZQUNuQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNoQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNrQixDQUFDO1FBRTVDLGNBQWMsR0FBRyxJQUFJLGdDQUFjLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUMzRCxnQkFBZ0IsR0FBRyxJQUFJLG9DQUFnQixDQUNyQyxtQkFBbUIsRUFDbkIscUJBQXFCLEVBQ3JCLGtCQUFrQixDQUNuQixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLFNBQVMsR0FBRyxjQUFjLENBQUM7WUFDakMsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDO1lBRS9CLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDL0MsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsSUFBSSxFQUFFLGlCQUFpQjtnQkFDdkIsR0FBRyxFQUFFLFdBQVc7Z0JBQ2hCLEtBQUssRUFBRSxLQUFLO2dCQUNaLFNBQVMsRUFBRSxFQUFFO2dCQUNiLE1BQU0sRUFBRSw4QkFBYSxDQUFDLE1BQU07YUFDdEIsQ0FBQyxDQUFDO1lBRVYscUJBQXFCO1lBQ3JCLE1BQU0sY0FBYyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUUvQyxnQ0FBZ0M7WUFDaEMsTUFBTSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7Z0JBQ2hDLE1BQU07Z0JBQ04sU0FBUyxFQUFFLGNBQWM7Z0JBQ3pCLFNBQVM7Z0JBQ1QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCLENBQUMsQ0FBQztZQUVILGtDQUFrQztZQUNsQyxNQUFNLE9BQU8sR0FBRyxNQUFNLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXhFLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLE1BQU0sUUFBUSxHQUFHO2dCQUNmLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtnQkFDbEUsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO2dCQUNqRSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7YUFDbEUsQ0FBQztZQUVGLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFlLENBQUMsQ0FBQztZQUV4RSxNQUFNLFVBQVUsR0FBRyxNQUFNLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRXBFLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRSxNQUFNLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQztZQUVwQyxxQkFBcUIsQ0FBQyxRQUFRO2lCQUMzQixxQkFBcUIsQ0FBQztnQkFDckIsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsSUFBSSxFQUFFLGtCQUFrQjtnQkFDeEIsU0FBUyxFQUFFLEVBQUU7YUFDUCxDQUFDO2lCQUNSLHFCQUFxQixDQUFDO2dCQUNyQixFQUFFLEVBQUUsU0FBUztnQkFDYixJQUFJLEVBQUUsa0JBQWtCO2dCQUN4QixTQUFTLEVBQUUsRUFBRTthQUNQLENBQUMsQ0FBQztZQUVaLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxFQUFFLEVBQUUsU0FBUztnQkFDYixTQUFTLEVBQUUsRUFBRTthQUNQLENBQUMsQ0FBQztZQUVWLDJCQUEyQjtZQUMzQixNQUFNLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUU3RCxNQUFNLE9BQU8sR0FBRyxNQUFNLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNoRSxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxnQkFBZ0IsR0FBRztnQkFDdkIsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtnQkFDdkQsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtnQkFDdkQsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTthQUN4RCxDQUFDO1lBRUYscUJBQXFCLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLGdCQUF1QixDQUFDLENBQUM7WUFFOUUsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUMsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLENBQUM7WUFFckMscUJBQXFCLENBQUMsUUFBUTtpQkFDM0IscUJBQXFCLENBQUM7Z0JBQ3JCLEVBQUUsRUFBRSxTQUFTO2dCQUNiLFNBQVMsRUFBRSxHQUFHO2FBQ1IsQ0FBQztpQkFDUixxQkFBcUIsQ0FBQztnQkFDckIsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsU0FBUyxFQUFFLEVBQUU7YUFDUCxDQUFDLENBQUM7WUFFWiwrQkFBK0I7WUFDL0IsTUFBTSxNQUFNLEdBQUcsTUFBTSxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDL0QsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDO1lBRTFDLHNDQUFzQztZQUN0QyxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3RELEVBQUUsRUFBRSxTQUFTO2dCQUNiLFNBQVMsRUFBRSxFQUFFO2FBQ1AsQ0FBQyxDQUFDO1lBRVYsTUFBTSxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRTNELDhCQUE4QjtZQUM5QixNQUFNLEtBQUssR0FBRyxNQUFNLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1FBQzNDLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFNBQVMsR0FBRyxtQkFBbUIsQ0FBQztZQUN0QyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbkIsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBRXJCLGNBQWM7WUFDZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzNCLE1BQU0sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO29CQUNoQyxNQUFNLEVBQUUsUUFBUSxDQUFDLEVBQUU7b0JBQ25CLFNBQVMsRUFBRSxjQUFjO29CQUN6QixTQUFTO29CQUNULFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtpQkFDdEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDRCQUE0QjtZQUM1QixNQUFNLGNBQWMsR0FBRyxNQUFNLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztZQUVsRixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCO1FBQ2xELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVDLE1BQU0sU0FBUyxHQUFHLGdCQUFnQixDQUFDO1lBRW5DLDZCQUE2QjtZQUM3QixNQUFNLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztnQkFDaEMsTUFBTSxFQUFFLGNBQWM7Z0JBQ3RCLFNBQVMsRUFBRSxrQkFBa0I7Z0JBQzdCLFNBQVM7Z0JBQ1QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2dCQUNyQixRQUFRLEVBQUU7b0JBQ1IsUUFBUSxFQUFFLENBQUM7b0JBQ1gsU0FBUyxFQUFFLEtBQUs7b0JBQ2hCLE9BQU8sRUFBRSxNQUFNO2lCQUNoQjthQUNGLENBQUMsQ0FBQztZQUVILE1BQU0sT0FBTyxHQUFHLE1BQU0sZ0JBQWdCLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDeEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1FBQzNDLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLGdCQUFnQixHQUFHO2dCQUN2QixFQUFFLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLEdBQUcsRUFBRTtnQkFDaEYsRUFBRSxFQUFFLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsR0FBRyxFQUFFO2dCQUM1RSxFQUFFLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUU7YUFDNUUsQ0FBQztZQUVGLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBdUIsQ0FBQyxDQUFDO1lBRTlFLE1BQU0sUUFBUSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFDO1lBRWxDLHFCQUFxQixDQUFDLFFBQVE7aUJBQzNCLHFCQUFxQixDQUFDO2dCQUNyQixFQUFFLEVBQUUsU0FBUztnQkFDYixNQUFNLEVBQUUsR0FBRztnQkFDWCxXQUFXLEVBQUUsRUFBRTthQUNULENBQUM7aUJBQ1IscUJBQXFCLENBQUM7Z0JBQ3JCLEVBQUUsRUFBRSxTQUFTO2dCQUNiLE1BQU0sRUFBRSxHQUFHO2dCQUNYLFdBQVcsRUFBRSxFQUFFO2FBQ1QsQ0FBQyxDQUFDO1lBRVosaUJBQWlCO1lBQ2pCLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztnQkFDbkQsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsV0FBVyxFQUFFLEVBQUU7YUFDVCxDQUFDLENBQUM7WUFFVixNQUFNLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRTdELE1BQU0sT0FBTyxHQUFHLE1BQU0scUJBQXFCLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1FBQzdDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxtQkFBbUIsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUQsbUJBQW1CLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pELGtCQUFrQixDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqRCxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFbkQsTUFBTSxTQUFTLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEUscUJBQXFCLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25ELHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDckQsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUU7Z0JBQzVCLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFO2FBQ3JCLENBQUMsQ0FBQztZQUNWLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztnQkFDbkQsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUU7Z0JBQ3hCLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFO2FBQ2xCLENBQUMsQ0FBQztZQUNWLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztnQkFDbkQsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7YUFDbkIsQ0FBQyxDQUFDO1lBRVYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7UUFDdEMsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pELE1BQU0sVUFBVSxHQUFHO2dCQUNqQjtvQkFDRSxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUNqQyxLQUFLLEVBQUUsR0FBRztvQkFDVixLQUFLLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDO2lCQUM5QztnQkFDRDtvQkFDRSxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUNqQyxLQUFLLEVBQUUsR0FBRztvQkFDVixLQUFLLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDO2lCQUM5QztnQkFDRDtvQkFDRSxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUNqQyxLQUFLLEVBQUUsR0FBRztvQkFDVixLQUFLLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDO2lCQUM5QzthQUNGLENBQUM7WUFFRixtQkFBbUIsQ0FBQyxxQkFBcUIsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFpQixDQUFDLENBQUM7WUFFL0UsTUFBTSxPQUFPLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUV4RSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtRQUMzQyxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEUsb0JBQW9CO1lBQ3BCLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixJQUFJLEVBQUUsYUFBYTtnQkFDbkIsV0FBVyxFQUFFLHFCQUFxQjtnQkFDbEMsR0FBRyxFQUFFLFNBQVM7Z0JBQ2QsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osU0FBUyxFQUFFLEdBQUc7YUFDZixDQUFDO1lBRUYscUJBQXFCLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDO2dCQUNwRCxFQUFFLEVBQUUsWUFBWTtnQkFDaEIsR0FBRyxTQUFTO2dCQUNaLFNBQVMsRUFBRSxDQUFDO2dCQUNaLE1BQU0sRUFBRSw4QkFBYSxDQUFDLE1BQU07Z0JBQzVCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTthQUNmLENBQUMsQ0FBQztZQUVWLE1BQU0sVUFBVSxHQUFHLE1BQU0sY0FBYyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNqRSxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVyQyx3QkFBd0I7WUFDeEIsTUFBTSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7Z0JBQ2hDLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixTQUFTLEVBQUUsY0FBYztnQkFDekIsU0FBUyxFQUFFLFVBQVUsQ0FBQyxFQUFFO2dCQUN4QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQyxDQUFDO1lBRUgseUJBQXlCO1lBQ3pCLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxFQUFFLEVBQUUsWUFBWTtnQkFDaEIsU0FBUyxFQUFFLENBQUM7YUFDTixDQUFDLENBQUM7WUFFVixNQUFNLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFakUsdUNBQXVDO1lBQ3ZDLE1BQU0sV0FBVyxHQUFHLE1BQU0sZ0JBQWdCLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2hGLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hFLE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQztZQUVsQywwQkFBMEI7WUFDMUIscUJBQXFCLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDO2dCQUMvQyxFQUFFLEVBQUUsU0FBUztnQkFDYixNQUFNLEVBQUUsOEJBQWEsQ0FBQyxLQUFLO2dCQUMzQixTQUFTLEVBQUUsQ0FBQzthQUNOLENBQUMsQ0FBQztZQUVWLElBQUksT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWpELG1CQUFtQjtZQUNuQixxQkFBcUIsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxFQUFFLEVBQUUsU0FBUztnQkFDYixNQUFNLEVBQUUsOEJBQWEsQ0FBQyxNQUFNO2dCQUM1QixTQUFTLEVBQUUsQ0FBQzthQUNOLENBQUMsQ0FBQztZQUVWLE1BQU0scUJBQXFCLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRTtnQkFDNUMsTUFBTSxFQUFFLDhCQUFhLENBQUMsTUFBTTthQUM3QixDQUFDLENBQUM7WUFFSCx1REFBdUQ7WUFDdkQscUJBQXFCLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sYUFBYSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUNuRSxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUM1QyxFQUFFLENBQUMsdUNBQXVDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckQsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFDO1lBQ2xDLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQztZQUUvQixrQkFBa0I7WUFDbEIsTUFBTSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7Z0JBQ2hDLE1BQU07Z0JBQ04sU0FBUyxFQUFFLGNBQWM7Z0JBQ3pCLFNBQVM7Z0JBQ1QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCLENBQUMsQ0FBQztZQUVILGlCQUFpQjtZQUNqQixNQUFNLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztnQkFDaEMsTUFBTTtnQkFDTixTQUFTLEVBQUUsYUFBYTtnQkFDeEIsU0FBUztnQkFDVCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQyxDQUFDO1lBRUgsY0FBYztZQUNkLE1BQU0sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2dCQUNoQyxNQUFNO2dCQUNOLFNBQVMsRUFBRSxVQUFVO2dCQUNyQixTQUFTO2dCQUNULFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTthQUN0QixDQUFDLENBQUM7WUFFSCxjQUFjO1lBQ2QsTUFBTSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7Z0JBQ2hDLE1BQU07Z0JBQ04sU0FBUyxFQUFFLGtCQUFrQjtnQkFDN0IsU0FBUztnQkFDVCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQyxDQUFDO1lBRUgsNEJBQTRCO1lBQzVCLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzlELE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDckUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaUVBQWlFLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0UsbUJBQW1CLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdELGtCQUFrQixDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVoRCxNQUFNLEdBQUcsR0FBRyxNQUFNLGdCQUFnQixDQUFDLHdCQUF3QixFQUFFLENBQUM7WUFFOUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGNBQWM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDckMsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFELE1BQU0sWUFBWSxHQUFHO2dCQUNuQjtvQkFDRSxFQUFFLEVBQUUsYUFBYTtvQkFDakIsS0FBSyxFQUFFLEtBQUs7b0JBQ1osY0FBYyxFQUFFLEtBQUs7b0JBQ3JCLFNBQVMsRUFBRSxHQUFHO2lCQUNmO2dCQUNEO29CQUNFLEVBQUUsRUFBRSxhQUFhO29CQUNqQixLQUFLLEVBQUUsS0FBSztvQkFDWixjQUFjLEVBQUUsS0FBSztvQkFDckIsU0FBUyxFQUFFLEdBQUc7aUJBQ2Y7YUFDRixDQUFDO1lBRUYscUJBQXFCLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUU3RSxNQUFNLE1BQU0sR0FBRyxNQUFNLHFCQUFxQixDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRXhELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEQsTUFBTSxTQUFTLEdBQUcsY0FBYyxDQUFDO1lBRWpDLHlCQUF5QjtZQUN6QixNQUFNLFdBQVcsR0FBRyxFQUFFLENBQUM7WUFFdkIsaUJBQWlCO1lBQ2pCLHFCQUFxQixDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3pELEVBQUUsRUFBRSxTQUFTO2dCQUNiLEtBQUssRUFBRSxLQUFLO2dCQUNaLGNBQWMsRUFBRSxLQUFLO2FBQ2YsQ0FBQyxDQUFDO1lBRVYsd0JBQXdCO1lBQ3hCLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxFQUFFLEVBQUUsU0FBUztnQkFDYixTQUFTLEVBQUUsRUFBRSxFQUFFLHVDQUF1QzthQUNoRCxDQUFDLENBQUM7WUFFVixNQUFNLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUU5RCxvQ0FBb0M7WUFDcEMsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxXQUFXLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDL0QsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtRQUN0QyxFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkUsTUFBTSxVQUFVLEdBQUc7Z0JBQ2pCLEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7Z0JBQ25ELEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7Z0JBQ25ELEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7YUFDcEQsQ0FBQztZQUVGLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFpQixDQUFDLENBQUM7WUFFMUUsTUFBTSxVQUFVLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVwRSxzREFBc0Q7WUFDdEQsTUFBTSxXQUFXLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FDbkMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FDM0MsQ0FBQztZQUVGLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELHFCQUFxQixDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7Z0JBQzFELEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUNyRixFQUFFLEVBQUUsRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTthQUN2RixDQUFDLENBQUM7WUFFSCxNQUFNLFdBQVcsR0FBRyxNQUFNLHFCQUFxQixDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRTFELHVDQUF1QztZQUN2QyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUU1RCxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcc2VydmljZXNcXHByb2R1Y3QtYW5hbHl0aWNzLWludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiBUZXN0czogUHJvZHVjdCBDYXRhbG9nIHdpdGggQW5hbHl0aWNzXG4gKlxuICogVGVzdGluZyBob3cgcHJvZHVjdCBvcGVyYXRpb25zIGFmZmVjdCBhbmFseXRpY3MgYW5kIHJlcG9ydGluZ1xuICovXG5cbmltcG9ydCB7IFByb2R1Y3RTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL3Byb2R1Y3QtY2F0YWxvZy9zZXJ2aWNlcy9wcm9kdWN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJvZHVjdFJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvcHJvZHVjdC1jYXRhbG9nL3JlcG9zaXRvcmllcy9wcm9kdWN0LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgQW5hbHl0aWNzU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9hbmFseXRpY3Mvc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3JkZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL29yZGVyLXByb2Nlc3NpbmcvcmVwb3NpdG9yaWVzL29yZGVyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgVXNlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvdXNlci1tYW5hZ2VtZW50L3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUHJvZHVjdFN0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvZW50aXRpZXMvcHJvZHVjdC5lbnRpdHknO1xuXG5qZXN0Lm1vY2soJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeScpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvc2VydmljZXMvb3JkZXItcHJvY2Vzc2luZy9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeScpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvc2VydmljZXMvdXNlci1tYW5hZ2VtZW50L3JlcG9zaXRvcmllcy91c2VyLnJlcG9zaXRvcnknKTtcblxuZGVzY3JpYmUoJ1Byb2R1Y3QgYW5kIEFuYWx5dGljcyBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHByb2R1Y3RTZXJ2aWNlOiBQcm9kdWN0U2VydmljZTtcbiAgbGV0IGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2U7XG4gIGxldCBtb2NrUHJvZHVjdFJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tPcmRlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrVXNlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGVQcm9kdWN0OiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlSW52ZW50b3J5OiBqZXN0LmZuKCksXG4gICAgICBpbmNyZW1lbnRTb2xkQ291bnQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRUb3BTZWxsaW5nOiBqZXN0LmZuKCksXG4gICAgICBmaW5kVG9wUmF0ZWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRMb3dTdG9jazogamVzdC5mbigpLFxuICAgICAgdXBkYXRlUmF0aW5nOiBqZXN0LmZuKCksXG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgIH0gYXMgdW5rbm93biBhcyBqZXN0Lk1vY2tlZDxQcm9kdWN0UmVwb3NpdG9yeT47XG5cbiAgICBtb2NrT3JkZXJSZXBvc2l0b3J5ID0ge1xuICAgICAgZ2V0VG90YWxSZXZlbnVlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kT3JkZXJzQnlEYXRlUmFuZ2U6IGplc3QuZm4oKSxcbiAgICAgIGNvdW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG5cbiAgICBtb2NrVXNlclJlcG9zaXRvcnkgPSB7XG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5U3RhdHVzOiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPFVzZXJSZXBvc2l0b3J5PjtcblxuICAgIHByb2R1Y3RTZXJ2aWNlID0gbmV3IFByb2R1Y3RTZXJ2aWNlKG1vY2tQcm9kdWN0UmVwb3NpdG9yeSk7XG4gICAgYW5hbHl0aWNzU2VydmljZSA9IG5ldyBBbmFseXRpY3NTZXJ2aWNlKFxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeVxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm9kdWN0IFNhbGVzIFRyYWNraW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCB2aWV3cyBpbiBhbmFseXRpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC10cmFjay0xJztcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLXZpZXdlci0xJztcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgbmFtZTogJ1RyYWNrZWQgUHJvZHVjdCcsXG4gICAgICAgIHNrdTogJ1RSQUNLLTAwMScsXG4gICAgICAgIHByaWNlOiA5OS45OSxcbiAgICAgICAgaW52ZW50b3J5OiAxMCxcbiAgICAgICAgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFDVElWRSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gVXNlciB2aWV3cyBwcm9kdWN0XG4gICAgICBhd2FpdCBwcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlJZChwcm9kdWN0SWQpO1xuXG4gICAgICAvLyBUcmFjayB2aWV3IGV2ZW50IGluIGFuYWx5dGljc1xuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3ZpZXcnLFxuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBHZXQgcHJvZHVjdCBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRQcm9kdWN0UGVyZm9ybWFuY2UocHJvZHVjdElkKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3Mudmlld3MpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB0b3Agc2VsbGluZyBwcm9kdWN0cyB3aGVuIHNhbGVzIG9jY3VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdHMgPSBbXG4gICAgICAgIHsgaWQ6ICdwcm9kLTEnLCBuYW1lOiAnQmVzdHNlbGxlciAxJywgc29sZENvdW50OiAxMDAwLCBwcmljZTogNTAgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtMicsIG5hbWU6ICdCZXN0c2VsbGVyIDInLCBzb2xkQ291bnQ6IDgwMCwgcHJpY2U6IDYwIH0sXG4gICAgICAgIHsgaWQ6ICdwcm9kLTMnLCBuYW1lOiAnQmVzdHNlbGxlciAzJywgc29sZENvdW50OiA2MDAsIHByaWNlOiA3MCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRUb3BTZWxsaW5nLm1vY2tSZXNvbHZlZFZhbHVlKHByb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHRvcFNlbGxpbmcgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFRvcFNlbGxpbmdQcm9kdWN0cygxMCk7XG5cbiAgICAgIGV4cGVjdCh0b3BTZWxsaW5nLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdCh0b3BTZWxsaW5nWzBdLnNvbGRDb3VudCkudG9CZUdyZWF0ZXJUaGFuKHRvcFNlbGxpbmdbMV0uc29sZENvdW50KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCBwdXJjaGFzZXMgYW5kIHVwZGF0ZSBzb2xkIGNvdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gJ3Byb2QtcHVyY2hhc2UtMSc7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICAgIG5hbWU6ICdQdXJjaGFzZSBQcm9kdWN0JyxcbiAgICAgICAgICBzb2xkQ291bnQ6IDUwLFxuICAgICAgICB9IGFzIGFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgICBuYW1lOiAnUHVyY2hhc2UgUHJvZHVjdCcsXG4gICAgICAgICAgc29sZENvdW50OiA1MyxcbiAgICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgc29sZENvdW50OiA1MyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gU2ltdWxhdGUgMyBwcm9kdWN0cyBzb2xkXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50KHByb2R1Y3RJZCwgMyk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQocHJvZHVjdElkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkLnNvbGRDb3VudCkudG9CZUdyZWF0ZXJUaGFuKDUwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludmVudG9yeSBBbmFseXRpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpZGVudGlmeSBsb3cgc3RvY2sgcHJvZHVjdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb3dTdG9ja1Byb2R1Y3RzID0gW1xuICAgICAgICB7IGlkOiAncHJvZC1sb3ctMScsIG5hbWU6ICdMb3cgU3RvY2sgMScsIGludmVudG9yeTogMyB9LFxuICAgICAgICB7IGlkOiAncHJvZC1sb3ctMicsIG5hbWU6ICdMb3cgU3RvY2sgMicsIGludmVudG9yeTogNSB9LFxuICAgICAgICB7IGlkOiAncHJvZC1sb3ctMycsIG5hbWU6ICdMb3cgU3RvY2sgMycsIGludmVudG9yeTogOCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRMb3dTdG9jay5tb2NrUmVzb2x2ZWRWYWx1ZShsb3dTdG9ja1Byb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0TG93U3RvY2tBbGVydCgxMCk7XG5cbiAgICAgIGV4cGVjdChhbGVydHMubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGFsZXJ0cy5ldmVyeShwID0+IHAuaW52ZW50b3J5IDw9IDEwKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgaW52ZW50b3J5IGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1pbnZlbnRvcnktMSc7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICAgIGludmVudG9yeTogMTAwLFxuICAgICAgICB9IGFzIGFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgICBpbnZlbnRvcnk6IDk1LFxuICAgICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFRyYWNrIGludmVudG9yeSBiZWZvcmUgb3JkZXJcbiAgICAgIGNvbnN0IGJlZm9yZSA9IGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZChwcm9kdWN0SWQpO1xuICAgICAgY29uc3QgaW5pdGlhbEludmVudG9yeSA9IGJlZm9yZS5pbnZlbnRvcnk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIG9yZGVyIGRlY3JlYXNpbmcgaW52ZW50b3J5XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlSW52ZW50b3J5Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgaW52ZW50b3J5OiA5NSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZUludmVudG9yeShwcm9kdWN0SWQsIDk1KTtcblxuICAgICAgLy8gVHJhY2sgaW52ZW50b3J5IGFmdGVyIG9yZGVyXG4gICAgICBjb25zdCBhZnRlciA9IGF3YWl0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZChwcm9kdWN0SWQpO1xuXG4gICAgICBleHBlY3QoYWZ0ZXIuaW52ZW50b3J5KS50b0JlTGVzc1RoYW4oaW5pdGlhbEludmVudG9yeSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm9kdWN0IFBlcmZvcm1hbmNlIE1ldHJpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29udmVyc2lvbiByYXRlIGZvciBwcm9kdWN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9ICdwcm9kLWNvbnZlcnNpb24tMSc7XG4gICAgICBjb25zdCB2aWV3cyA9IDEwMDA7XG4gICAgICBjb25zdCBwdXJjaGFzZXMgPSA1MDtcblxuICAgICAgLy8gVHJhY2sgdmlld3NcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIGF3YWl0IGFuYWx5dGljc1NlcnZpY2UudHJhY2tFdmVudCh7XG4gICAgICAgICAgdXNlcklkOiBgdXNlci0ke2l9YCxcbiAgICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3ZpZXcnLFxuICAgICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgY29udmVyc2lvbiByYXRlXG4gICAgICBjb25zdCBjb252ZXJzaW9uUmF0ZSA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0Q29udmVyc2lvblJhdGUodmlld3MsIHB1cmNoYXNlcyk7XG5cbiAgICAgIGV4cGVjdChjb252ZXJzaW9uUmF0ZSkudG9CZSg1KTsgLy8gNTAvMTAwMCAqIDEwMFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBwcm9kdWN0IHJldmVudWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1yZXZlbnVlLTEnO1xuXG4gICAgICAvLyBUcmFjayBwcm9kdWN0IHNhbGVzIGV2ZW50c1xuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkOiAndXNlci1idXllci0xJyxcbiAgICAgICAgZXZlbnRUeXBlOiAncHJvZHVjdF9wdXJjaGFzZScsXG4gICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHF1YW50aXR5OiAyLFxuICAgICAgICAgIHVuaXRQcmljZTogNzUuMDAsXG4gICAgICAgICAgcmV2ZW51ZTogMTUwLjAwLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFByb2R1Y3RQZXJmb3JtYW5jZShwcm9kdWN0SWQpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm9kdWN0IFJhdGluZ3MgYW5kIFJldmlld3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgdG9wIHJhdGVkIHByb2R1Y3RzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0b3BSYXRlZFByb2R1Y3RzID0gW1xuICAgICAgICB7IGlkOiAncHJvZC1yYXRlZC0xJywgbmFtZTogJ0V4Y2VsbGVudCBQcm9kdWN0JywgcmF0aW5nOiA0LjksIHJldmlld0NvdW50OiA1MDAgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtcmF0ZWQtMicsIG5hbWU6ICdHcmVhdCBQcm9kdWN0JywgcmF0aW5nOiA0LjcsIHJldmlld0NvdW50OiAzMDAgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtcmF0ZWQtMycsIG5hbWU6ICdHb29kIFByb2R1Y3QnLCByYXRpbmc6IDQuNSwgcmV2aWV3Q291bnQ6IDIwMCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRUb3BSYXRlZC5tb2NrUmVzb2x2ZWRWYWx1ZSh0b3BSYXRlZFByb2R1Y3RzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHRvcFJhdGVkID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRUb3BSYXRlZFByb2R1Y3RzKDEwKTtcblxuICAgICAgZXhwZWN0KHRvcFJhdGVkLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdCh0b3BSYXRlZFswXS5yYXRpbmcpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwodG9wUmF0ZWRbMV0ucmF0aW5nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgcmF0aW5nIGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1yYXRpbmctMSc7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICAgIHJhdGluZzogNC4wLFxuICAgICAgICAgIHJldmlld0NvdW50OiAxMCxcbiAgICAgICAgfSBhcyBhbnkpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGlkOiBwcm9kdWN0SWQsXG4gICAgICAgICAgcmF0aW5nOiA0LjIsXG4gICAgICAgICAgcmV2aWV3Q291bnQ6IDExLFxuICAgICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIEFkZCBuZXcgcmF0aW5nXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgcmF0aW5nOiA0LjIsXG4gICAgICAgIHJldmlld0NvdW50OiAxMSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZyhwcm9kdWN0SWQsIDQuMiwgMTEpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkKHByb2R1Y3RJZCk7XG4gICAgICBleHBlY3QodXBkYXRlZC5yYXRpbmcpLnRvQmVHcmVhdGVyVGhhbig0LjApO1xuICAgICAgZXhwZWN0KHVwZGF0ZWQucmV2aWV3Q291bnQpLnRvQmUoMTEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGFzaGJvYXJkIE1ldHJpY3MgSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhZ2dyZWdhdGUgcHJvZHVjdCBtZXRyaWNzIGZvciBkYXNoYm9hcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmdldFRvdGFsUmV2ZW51ZS5tb2NrUmVzb2x2ZWRWYWx1ZSgxMDAwMDApO1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSg1MDApO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDIwMDApO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDE1MCk7XG5cbiAgICAgIGNvbnN0IGRhc2hib2FyZCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0RGFzaGJvYXJkTWV0cmljcygpO1xuXG4gICAgICBleHBlY3QoZGFzaGJvYXJkLnRvdGFsUHJvZHVjdHMpLnRvQmUoMTUwKTtcbiAgICAgIGV4cGVjdChkYXNoYm9hcmQudG90YWxSZXZlbnVlKS50b0JlKDEwMDAwMCk7XG4gICAgICBleHBlY3QoZGFzaGJvYXJkLnRvdGFsT3JkZXJzKS50b0JlKDUwMCk7XG4gICAgICBleHBlY3QoZGFzaGJvYXJkLmF2ZXJhZ2VPcmRlclZhbHVlKS50b0JlKDIwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcHJvZHVjdC1zcGVjaWZpYyBtZXRyaWNzIGluIHJlcG9ydHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMTUwKTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kVG9wU2VsbGluZy5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgaWQ6ICcxJywgc29sZENvdW50OiAxMDAwIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgc29sZENvdW50OiA4MDAgfSxcbiAgICAgIF0gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kVG9wUmF0ZWQubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICB7IGlkOiAnMycsIHJhdGluZzogNC45IH0sXG4gICAgICAgIHsgaWQ6ICc0JywgcmF0aW5nOiA0LjggfSxcbiAgICAgIF0gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kTG93U3RvY2subW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICB7IGlkOiAnNScsIGludmVudG9yeTogMyB9LFxuICAgICAgXSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmV4cG9ydFJlcG9ydCgncHJvZHVjdHMnKTtcblxuICAgICAgZXhwZWN0KHJlcG9ydC50eXBlKS50b0JlKCdwcm9kdWN0cycpO1xuICAgICAgZXhwZWN0KHJlcG9ydC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgndG90YWxQcm9kdWN0cycpO1xuICAgICAgZXhwZWN0KHJlcG9ydC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgndG9wU2VsbGluZycpO1xuICAgICAgZXhwZWN0KHJlcG9ydC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgndG9wUmF0ZWQnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ2xvd1N0b2NrJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTYWxlcyBQZXJpb2QgQW5hbHl0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCBzYWxlcyBieSB0aW1lIHBlcmlvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlcnMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgICAgdG90YWw6IDEwMCxcbiAgICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDIgfV0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTIwJyksXG4gICAgICAgICAgdG90YWw6IDIwMCxcbiAgICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfV0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAyLTA1JyksXG4gICAgICAgICAgdG90YWw6IDE1MCxcbiAgICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDMgfV0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRPcmRlcnNCeURhdGVSYW5nZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXJzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldFNhbGVzTWV0cmljc0J5UGVyaW9kKCdtb250aCcpO1xuXG4gICAgICBleHBlY3QobWV0cmljcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzWzBdKS50b0hhdmVQcm9wZXJ0eSgncGVyaW9kJyk7XG4gICAgICBleHBlY3QobWV0cmljc1swXSkudG9IYXZlUHJvcGVydHkoJ3JldmVudWUnKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzWzBdKS50b0hhdmVQcm9wZXJ0eSgnb3JkZXJDb3VudCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUHJvZHVjdCBMaWZlY3ljbGUgQW5hbHl0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCBmcm9tIGNyZWF0aW9uIHRvIGZpcnN0IHNhbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyAxLiBDcmVhdGUgcHJvZHVjdFxuICAgICAgY29uc3QgY3JlYXRlRHRvID0ge1xuICAgICAgICBuYW1lOiAnTmV3IFByb2R1Y3QnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgYnJhbmQgbmV3IHByb2R1Y3QnLFxuICAgICAgICBza3U6ICdORVctMDAxJyxcbiAgICAgICAgcHJpY2U6IDQ5Ljk5LFxuICAgICAgICBpbnZlbnRvcnk6IDEwMCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5jcmVhdGVQcm9kdWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdwcm9kLW5ldy0xJyxcbiAgICAgICAgLi4uY3JlYXRlRHRvLFxuICAgICAgICBzb2xkQ291bnQ6IDAsXG4gICAgICAgIHN0YXR1czogUHJvZHVjdFN0YXR1cy5BQ1RJVkUsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgbmV3UHJvZHVjdCA9IGF3YWl0IHByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QoY3JlYXRlRHRvKTtcbiAgICAgIGV4cGVjdChuZXdQcm9kdWN0LnNvbGRDb3VudCkudG9CZSgwKTtcblxuICAgICAgLy8gMi4gVHJhY2sgcHJvZHVjdCB2aWV3XG4gICAgICBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLnRyYWNrRXZlbnQoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3ZpZXcnLFxuICAgICAgICBwcm9kdWN0SWQ6IG5ld1Byb2R1Y3QuaWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyAzLiBTaW11bGF0ZSBmaXJzdCBzYWxlXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdwcm9kLW5ldy0xJyxcbiAgICAgICAgc29sZENvdW50OiAxLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50KG5ld1Byb2R1Y3QuaWQsIDEpO1xuXG4gICAgICAvLyA0LiBWZXJpZnkgYW5hbHl0aWNzIHJlZmxlY3QgdGhlIHNhbGVcbiAgICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRQcm9kdWN0UGVyZm9ybWFuY2UobmV3UHJvZHVjdC5pZCk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2Uudmlld3MpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgcHJvZHVjdCBzdGF0dXMgY2hhbmdlcyBpbiBhbmFseXRpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1zdGF0dXMtMSc7XG5cbiAgICAgIC8vIFByb2R1Y3Qgc3RhcnRzIGFzIERSQUZUXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogcHJvZHVjdElkLFxuICAgICAgICBzdGF0dXM6IFByb2R1Y3RTdGF0dXMuRFJBRlQsXG4gICAgICAgIHNvbGRDb3VudDogMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbGV0IHByb2R1Y3QgPSBhd2FpdCBwcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlJZChwcm9kdWN0SWQpO1xuICAgICAgZXhwZWN0KHByb2R1Y3Quc3RhdHVzKS50b0JlKFByb2R1Y3RTdGF0dXMuRFJBRlQpO1xuXG4gICAgICAvLyBBY3RpdmF0ZSBwcm9kdWN0XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFDVElWRSxcbiAgICAgICAgc29sZENvdW50OiAwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlKHByb2R1Y3RJZCwge1xuICAgICAgICBzdGF0dXM6IFByb2R1Y3RTdGF0dXMuQUNUSVZFLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFmdGVyIGFjdGl2YXRpb24sIHByb2R1Y3Qgc2hvdWxkIGFwcGVhciBpbiBhbmFseXRpY3NcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxKTtcbiAgICAgIGNvbnN0IHRvdGFsUHJvZHVjdHMgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldERhc2hib2FyZE1ldHJpY3MoKTtcbiAgICAgIGV4cGVjdCh0b3RhbFByb2R1Y3RzLnRvdGFsUHJvZHVjdHMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nyb3NzLVNlcnZpY2UgRXZlbnQgVHJhY2tpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBjb21wbGV0ZSBwdXJjaGFzZSBmdW5uZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAncHJvZC1mdW5uZWwtMSc7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci1mdW5uZWwtMSc7XG5cbiAgICAgIC8vIDEuIFByb2R1Y3Qgdmlld1xuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBldmVudFR5cGU6ICdwcm9kdWN0X3ZpZXcnLFxuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyAyLiBBZGQgdG8gY2FydFxuICAgICAgYXdhaXQgYW5hbHl0aWNzU2VydmljZS50cmFja0V2ZW50KHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBldmVudFR5cGU6ICdhZGRfdG9fY2FydCcsXG4gICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIDMuIENoZWNrb3V0XG4gICAgICBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLnRyYWNrRXZlbnQoe1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGV2ZW50VHlwZTogJ2NoZWNrb3V0JyxcbiAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgLy8gNC4gUHVyY2hhc2VcbiAgICAgIGF3YWl0IGFuYWx5dGljc1NlcnZpY2UudHJhY2tFdmVudCh7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgZXZlbnRUeXBlOiAncHJvZHVjdF9wdXJjaGFzZScsXG4gICAgICAgIHByb2R1Y3RJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZlcmlmeSBhbGwgZXZlbnRzIHRyYWNrZWRcbiAgICAgIGNvbnN0IGV2ZW50cyA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0RXZlbnRzQnlVc2VyKHVzZXJJZCk7XG4gICAgICBleHBlY3QoZXZlbnRzLmxlbmd0aCkudG9CZSg0KTtcbiAgICAgIGV4cGVjdChldmVudHMubWFwKGUgPT4gZS5ldmVudFR5cGUpKS50b0NvbnRhaW4oJ3Byb2R1Y3RfdmlldycpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5tYXAoZSA9PiBlLmV2ZW50VHlwZSkpLnRvQ29udGFpbignYWRkX3RvX2NhcnQnKTtcbiAgICAgIGV4cGVjdChldmVudHMubWFwKGUgPT4gZS5ldmVudFR5cGUpKS50b0NvbnRhaW4oJ2NoZWNrb3V0Jyk7XG4gICAgICBleHBlY3QoZXZlbnRzLm1hcChlID0+IGUuZXZlbnRUeXBlKSkudG9Db250YWluKCdwcm9kdWN0X3B1cmNoYXNlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjdXN0b21lciBsaWZldGltZSB2YWx1ZSB3aXRoIHByb2R1Y3QgcHVyY2hhc2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5nZXRUb3RhbFJldmVudWUubW9ja1Jlc29sdmVkVmFsdWUoNTAwMDApO1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDI1MCk7XG5cbiAgICAgIGNvbnN0IGNsdiA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0Q3VzdG9tZXJMaWZldGltZVZhbHVlKCk7XG5cbiAgICAgIGV4cGVjdChjbHYpLnRvQmUoMjAwKTsgLy8gNTAwMDAgLyAyNTBcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Byb21vdGlvbmFsIEFuYWx5dGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIHNhbGVzIGZvciBkaXNjb3VudGVkIHByb2R1Y3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2FsZVByb2R1Y3RzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwcm9kLXNhbGUtMScsXG4gICAgICAgICAgcHJpY2U6IDc5Ljk5LFxuICAgICAgICAgIGNvbXBhcmVBdFByaWNlOiA5OS45OSxcbiAgICAgICAgICBzb2xkQ291bnQ6IDEwMCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAncHJvZC1zYWxlLTInLFxuICAgICAgICAgIHByaWNlOiA0OS45OSxcbiAgICAgICAgICBjb21wYXJlQXRQcmljZTogNjkuOTksXG4gICAgICAgICAgc29sZENvdW50OiAxNTAsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZE9uU2FsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShzYWxlUHJvZHVjdHMpO1xuXG4gICAgICBjb25zdCBvblNhbGUgPSBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZE9uU2FsZSgpO1xuXG4gICAgICBleHBlY3Qob25TYWxlLmxlbmd0aCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChvblNhbGUuZXZlcnkocCA9PiBwLmNvbXBhcmVBdFByaWNlISA+IHAucHJpY2UpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtZWFzdXJlIHByb21vdGlvbiBlZmZlY3RpdmVuZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gJ3Byb2QtcHJvbW8tMSc7XG5cbiAgICAgIC8vIFNhbGVzIGJlZm9yZSBwcm9tb3Rpb25cbiAgICAgIGNvbnN0IGJlZm9yZVNhbGVzID0gMTA7XG5cbiAgICAgIC8vIEFwcGx5IGRpc2NvdW50XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgcHJpY2U6IDU5Ljk5LFxuICAgICAgICBjb21wYXJlQXRQcmljZTogNzkuOTksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFNhbGVzIGFmdGVyIHByb21vdGlvblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmluY3JlbWVudFNvbGRDb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiBwcm9kdWN0SWQsXG4gICAgICAgIHNvbGRDb3VudDogNTAsIC8vIDQwIGFkZGl0aW9uYWwgc2FsZXMgZHVyaW5nIHByb21vdGlvblxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50KHByb2R1Y3RJZCwgNDApO1xuXG4gICAgICAvLyBQcm9tb3Rpb24gaW5jcmVhc2VkIHNhbGVzIGJ5IDQwMCVcbiAgICAgIGNvbnN0IHNhbGVzSW5jcmVhc2UgPSAoKDUwIC0gYmVmb3JlU2FsZXMpIC8gYmVmb3JlU2FsZXMpICogMTAwO1xuICAgICAgZXhwZWN0KHNhbGVzSW5jcmVhc2UpLnRvQmUoNDAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludmVudG9yeSBPcHRpbWl6YXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpZGVudGlmeSBmYXN0LW1vdmluZyBwcm9kdWN0cyBmb3IgcmVzdG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRvcFNlbGxpbmcgPSBbXG4gICAgICAgIHsgaWQ6ICdwcm9kLWZhc3QtMScsIHNvbGRDb3VudDogNTAwLCBpbnZlbnRvcnk6IDUgfSxcbiAgICAgICAgeyBpZDogJ3Byb2QtZmFzdC0yJywgc29sZENvdW50OiA0NTAsIGludmVudG9yeTogOCB9LFxuICAgICAgICB7IGlkOiAncHJvZC1mYXN0LTMnLCBzb2xkQ291bnQ6IDQwMCwgaW52ZW50b3J5OiAzIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZFRvcFNlbGxpbmcubW9ja1Jlc29sdmVkVmFsdWUodG9wU2VsbGluZyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBmYXN0TW92aW5nID0gYXdhaXQgYW5hbHl0aWNzU2VydmljZS5nZXRUb3BTZWxsaW5nUHJvZHVjdHMoMTApO1xuXG4gICAgICAvLyBJZGVudGlmeSBwcm9kdWN0cyB3aXRoIGhpZ2ggc2FsZXMgYnV0IGxvdyBpbnZlbnRvcnlcbiAgICAgIGNvbnN0IG5lZWRSZXN0b2NrID0gZmFzdE1vdmluZy5maWx0ZXIoXG4gICAgICAgIHAgPT4gcC5zb2xkQ291bnQgPiAxMDAgJiYgcC5pbnZlbnRvcnkgPCAxMFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG5lZWRSZXN0b2NrLmxlbmd0aCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgc2xvdy1tb3ZpbmcgcHJvZHVjdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEFsbCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgaWQ6ICdwcm9kLXNsb3ctMScsIHNvbGRDb3VudDogMiwgaW52ZW50b3J5OiA1MCwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyMy0wMS0wMScpIH0sXG4gICAgICAgIHsgaWQ6ICdwcm9kLXNsb3ctMicsIHNvbGRDb3VudDogMSwgaW52ZW50b3J5OiAxMDAsIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDEnKSB9LFxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IGFsbFByb2R1Y3RzID0gYXdhaXQgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRBbGwoKTtcblxuICAgICAgLy8gUHJvZHVjdHMgd2l0aCBsb3cgc2FsZXMgYWZ0ZXIgMSB5ZWFyXG4gICAgICBjb25zdCBzbG93TW92aW5nID0gYWxsUHJvZHVjdHMuZmlsdGVyKHAgPT4gcC5zb2xkQ291bnQgPCA1KTtcblxuICAgICAgZXhwZWN0KHNsb3dNb3ZpbmcubGVuZ3RoKS50b0JlKDIpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9