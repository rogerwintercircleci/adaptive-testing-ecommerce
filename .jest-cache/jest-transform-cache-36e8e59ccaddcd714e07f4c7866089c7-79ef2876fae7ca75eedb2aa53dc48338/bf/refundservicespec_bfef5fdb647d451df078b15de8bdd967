cd435c1da1bc1bd4aa920f0175be992d
"use strict";
/**
 * TDD: Refund & Return Service Tests
 *
 * Testing refund requests, return processing, and restock logic
 */
Object.defineProperty(exports, "__esModule", { value: true });
const refund_service_1 = require("./refund.service");
const errors_1 = require("@libs/errors");
const order_entity_1 = require("../entities/order.entity");
describe('RefundService', () => {
    let refundService;
    let mockRefundRepository;
    let mockOrderRepository;
    let mockInventoryRepository;
    let mockPaymentGatewayService;
    let mockShippingProviderService;
    beforeEach(() => {
        mockRefundRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByOrderId: jest.fn(),
            findByUserId: jest.fn(),
            findByTrackingNumber: jest.fn(),
            update: jest.fn(),
            updateStatus: jest.fn(),
            updateReturnStatus: jest.fn(),
            countByStatus: jest.fn(),
            getTotalRefundedAmount: jest.fn(),
        };
        mockOrderRepository = {
            findById: jest.fn(),
            update: jest.fn(),
        };
        mockInventoryRepository = {
            findByProductId: jest.fn(),
            update: jest.fn(),
            recordAdjustment: jest.fn(),
        };
        mockPaymentGatewayService = {
            refundPayment: jest.fn(),
        };
        mockShippingProviderService = {
            createReturnLabel: jest.fn(),
            trackShipment: jest.fn(),
        };
        refundService = new refund_service_1.RefundService(mockRefundRepository, mockOrderRepository, mockInventoryRepository, mockPaymentGatewayService, mockShippingProviderService);
    });
    describe('createRefundRequest', () => {
        it('should create a refund request', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                description: 'Product was damaged',
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
                photos: ['photo1.jpg'],
            };
            const mockOrder = {
                id: 'order-1',
                userId: 'user-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 100,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 100, subtotal: 100 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                ...refundDto,
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.status).toBe(refund_service_1.RefundStatus.PENDING);
            expect(result.refundAmount).toBe(100);
        });
        it('should reject refund request for non-existent order', async () => {
            const refundDto = {
                orderId: 'invalid',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [],
            };
            mockOrderRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Order not found'));
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject refund request for unpaid order', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const mockOrder = {
                id: 'order-1',
                paymentStatus: order_entity_1.PaymentStatus.PENDING,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Order must be paid to request a refund');
        });
        it('should reject refund request after return window expired', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const sixtyDaysAgo = new Date();
            sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: sixtyDaysAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('return window');
        });
        it('should calculate partial refund amount for partial return', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
                photos: ['photo1.jpg'],
            };
            const mockOrder = {
                id: 'order-1',
                userId: 'user-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 200,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 50, subtotal: 50 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 150, subtotal: 150 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                refundAmount: 50,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.refundAmount).toBe(50);
        });
        it('should require photos for defective items', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [{ productId: 'prod-1', quantity: 1 }],
                photos: [],
            };
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Photos are required for defective or damaged items');
        });
    });
    describe('approveRefund', () => {
        it('should approve a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
                items: [{ productId: 'prod-1', quantity: 1 }],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
        });
        it('should approve partial refund with adjusted amount', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 75,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
            expect(result.refundAmount).toBe(75);
        });
    });
    describe('rejectRefund', () => {
        it('should reject a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.update.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.REJECTED,
                rejectionReason: 'Outside return window',
            });
            const result = await refundService.rejectRefund('refund-1', 'Outside return window');
            expect(result.status).toBe(refund_service_1.RefundStatus.REJECTED);
            expect(result.rejectionReason).toBe('Outside return window');
        });
    });
    describe('processRefund', () => {
        it('should process approved refund and issue payment', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                refundAmount: 100,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.PROCESSING,
            });
            mockOrderRepository.findById.mockResolvedValue({ id: 'order-1' });
            mockPaymentGatewayService.refundPayment.mockResolvedValue({ success: true, refundId: 'ref-123' });
            mockRefundRepository.update.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.COMPLETED,
                processedAt: new Date(),
            });
            const result = await refundService.processRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.COMPLETED);
            expect(result.processedAt).toBeDefined();
        });
        it('should not process refund that is not approved', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await expect(refundService.processRefund('refund-1')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('restockItems', () => {
        it('should restock returned items to inventory', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                restockItems: true,
                items: [
                    { productId: 'prod-1', quantity: 2 },
                    { productId: 'prod-2', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 10 });
            mockInventoryRepository.update.mockResolvedValue({});
            mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).toHaveBeenCalledTimes(2);
            expect(mockInventoryRepository.update).toHaveBeenCalledWith('prod-1', {
                quantity: 12,
            });
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);
        });
        it('should not restock defective items', async () => {
            const mockRefund = {
                id: 'refund-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                restockItems: false,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).not.toHaveBeenCalled();
        });
    });
    describe('getUserRefunds', () => {
        it('should get all refund requests for a user', async () => {
            const mockRefunds = [
                { id: '1', userId: 'user-1', status: refund_service_1.RefundStatus.COMPLETED },
                { id: '2', userId: 'user-1', status: refund_service_1.RefundStatus.PENDING },
            ];
            mockRefundRepository.findByUserId.mockResolvedValue(mockRefunds);
            const result = await refundService.getUserRefunds('user-1');
            expect(result).toHaveLength(2);
        });
    });
    describe('calculateRefundAmount', () => {
        it('should calculate full refund amount', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                taxAmount: 15,
                shippingCost: 10,
                subtotal: 125,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBeGreaterThan(0);
        });
        it('should calculate partial refund for subset of items', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 250,
                subtotal: 225,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 100 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(100);
            expect(result.refundAmount).toBeLessThan(mockOrder.total);
        });
        it('should not include shipping in partial refund', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                subtotal: 100,
                shippingCost: 10,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 50 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 50 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(50);
        });
    });
    describe('generateReturnLabel', () => {
        it('should generate return shipping label', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            const mockOrder = {
                id: 'order-1',
                shippingAddress: {
                    street: '123 Main St',
                    city: 'City',
                    state: 'ST',
                    postalCode: '12345',
                    country: 'US',
                },
            };
            const mockLabel = {
                labelUrl: 'https://example.com/label.pdf',
                trackingNumber: '1Z999AA10123456784',
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            mockShippingProviderService.createReturnLabel.mockResolvedValue(mockLabel);
            mockRefundRepository.update.mockResolvedValue({});
            const result = await refundService.generateReturnLabel('refund-1');
            expect(result.labelUrl).toBeDefined();
            expect(result.trackingNumber).toBeDefined();
        });
    });
    describe('trackReturn', () => {
        it('should track return shipment status', async () => {
            const trackingNumber = '1Z999AA10123456784';
            const mockRefund = {
                id: 'refund-1',
                returnTrackingNumber: trackingNumber,
                returnStatus: 'LABEL_GENERATED',
            };
            const mockTrackingInfo = {
                status: 'in_transit',
                events: [
                    { timestamp: new Date(), status: 'picked_up', location: 'Origin' },
                ],
            };
            mockRefundRepository.findByTrackingNumber.mockResolvedValue(mockRefund);
            mockShippingProviderService.trackShipment.mockResolvedValue(mockTrackingInfo);
            mockRefundRepository.updateReturnStatus.mockResolvedValue({});
            const result = await refundService.trackReturn(trackingNumber);
            expect(result.status).toBeDefined();
            expect(result.refundId).toBe('refund-1');
        });
    });
    describe('markReturnAsReceived', () => {
        it('should mark return as received', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateReturnStatus.mockResolvedValue({
                ...mockRefund,
                returnStatus: 'received',
            });
            await refundService.markReturnAsReceived('refund-1');
            expect(mockRefundRepository.updateReturnStatus).toHaveBeenCalled();
        });
    });
    describe('getRefundStatistics', () => {
        it('should get refund statistics', async () => {
            mockRefundRepository.getTotalRefundedAmount.mockResolvedValue(150);
            mockRefundRepository.countByStatus.mockImplementation((status) => {
                if (status === refund_service_1.RefundStatus.PENDING)
                    return Promise.resolve(1);
                if (status === refund_service_1.RefundStatus.APPROVED)
                    return Promise.resolve(0);
                if (status === refund_service_1.RefundStatus.REJECTED)
                    return Promise.resolve(0);
                if (status === refund_service_1.RefundStatus.COMPLETED)
                    return Promise.resolve(2);
                return Promise.resolve(0);
            });
            const result = await refundService.getRefundStatistics();
            expect(result.totalRefunded).toBe(150);
            expect(result.pending).toBe(1);
            expect(result.completed).toBe(2);
        });
    });
    describe('checkEligibility', () => {
        it('should check if order is eligible for refund', async () => {
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(true);
        });
        it('should return false for order outside return window', async () => {
            const longAgo = new Date();
            longAgo.setDate(longAgo.getDate() - 100);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: longAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(false);
            expect(result.issues.length).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxyZWZ1bmQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILHFEQUFxRztBQU1yRyx5Q0FBOEQ7QUFDOUQsMkRBQXNFO0FBRXRFLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksYUFBNEIsQ0FBQztJQUNqQyxJQUFJLG9CQUFtRCxDQUFDO0lBQ3hELElBQUksbUJBQWlELENBQUM7SUFDdEQsSUFBSSx1QkFBeUQsQ0FBQztJQUM5RCxJQUFJLHlCQUE2RCxDQUFDO0lBQ2xFLElBQUksMkJBQWlFLENBQUM7SUFFdEUsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG9CQUFvQixHQUFHO1lBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3hCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLG9CQUFvQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDL0IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdkIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN4QixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQzNCLENBQUM7UUFFVCxtQkFBbUIsR0FBRztZQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNYLENBQUM7UUFFVCx1QkFBdUIsR0FBRztZQUN4QixlQUFlLEVBQUUsSUFBSSxDQUFDLEVB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QyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXHNlcnZpY2VzXFxvcmRlci1wcm9jZXNzaW5nXFxzZXJ2aWNlc1xccmVmdW5kLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRERDogUmVmdW5kICYgUmV0dXJuIFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIHJlZnVuZCByZXF1ZXN0cywgcmV0dXJuIHByb2Nlc3NpbmcsIGFuZCByZXN0b2NrIGxvZ2ljXG4gKi9cblxuaW1wb3J0IHsgUmVmdW5kU2VydmljZSwgQ3JlYXRlUmVmdW5kUmVxdWVzdER0bywgUmVmdW5kU3RhdHVzLCBSZXR1cm5SZWFzb24gfSBmcm9tICcuL3JlZnVuZC5zZXJ2aWNlJztcbmltcG9ydCB7IFJlZnVuZFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvcmVmdW5kLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgT3JkZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL29yZGVyLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgSW52ZW50b3J5UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uL2ludmVudG9yeS9yZXBvc2l0b3JpZXMvaW52ZW50b3J5LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUGF5bWVudEdhdGV3YXlTZXJ2aWNlIH0gZnJvbSAnLi9wYXltZW50LWdhdGV3YXkuc2VydmljZSc7XG5pbXBvcnQgeyBTaGlwcGluZ1Byb3ZpZGVyU2VydmljZSB9IGZyb20gJy4vc2hpcHBpbmctcHJvdmlkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXJyb3IsIE5vdEZvdW5kRXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuaW1wb3J0IHsgT3JkZXJTdGF0dXMsIFBheW1lbnRTdGF0dXMgfSBmcm9tICcuLi9lbnRpdGllcy9vcmRlci5lbnRpdHknO1xuXG5kZXNjcmliZSgnUmVmdW5kU2VydmljZScsICgpID0+IHtcbiAgbGV0IHJlZnVuZFNlcnZpY2U6IFJlZnVuZFNlcnZpY2U7XG4gIGxldCBtb2NrUmVmdW5kUmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8UmVmdW5kUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrT3JkZXJSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxPcmRlclJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja0ludmVudG9yeVJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPEludmVudG9yeVJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja1BheW1lbnRHYXRld2F5U2VydmljZTogamVzdC5Nb2NrZWQ8UGF5bWVudEdhdGV3YXlTZXJ2aWNlPjtcbiAgbGV0IG1vY2tTaGlwcGluZ1Byb3ZpZGVyU2VydmljZTogamVzdC5Nb2NrZWQ8U2hpcHBpbmdQcm92aWRlclNlcnZpY2U+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5ID0ge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5T3JkZXJJZDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5VXNlcklkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlUcmFja2luZ051bWJlcjogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVTdGF0dXM6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVJldHVyblN0YXR1czogamVzdC5mbigpLFxuICAgICAgY291bnRCeVN0YXR1czogamVzdC5mbigpLFxuICAgICAgZ2V0VG90YWxSZWZ1bmRlZEFtb3VudDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja09yZGVyUmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5UHJvZHVjdElkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIHJlY29yZEFkanVzdG1lbnQ6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tQYXltZW50R2F0ZXdheVNlcnZpY2UgPSB7XG4gICAgICByZWZ1bmRQYXltZW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBtb2NrU2hpcHBpbmdQcm92aWRlclNlcnZpY2UgPSB7XG4gICAgICBjcmVhdGVSZXR1cm5MYWJlbDogamVzdC5mbigpLFxuICAgICAgdHJhY2tTaGlwbWVudDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgcmVmdW5kU2VydmljZSA9IG5ldyBSZWZ1bmRTZXJ2aWNlKFxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnksXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LFxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnksXG4gICAgICBtb2NrUGF5bWVudEdhdGV3YXlTZXJ2aWNlLFxuICAgICAgbW9ja1NoaXBwaW5nUHJvdmlkZXJTZXJ2aWNlXG4gICAgKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVJlZnVuZFJlcXVlc3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYSByZWZ1bmQgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5ERUZFQ1RJVkUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUHJvZHVjdCB3YXMgZGFtYWdlZCcsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9LFxuICAgICAgICBdLFxuICAgICAgICBwaG90b3M6IFsncGhvdG8xLmpwZyddLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkRFTElWRVJFRCxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICB0b3RhbDogMTAwLFxuICAgICAgICBkZWxpdmVyZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxLCB1bml0UHJpY2U6IDEwMCwgc3VidG90YWw6IDEwMCB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIC4uLnJlZnVuZER0byxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLlBFTkRJTkcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJlZnVuZCByZXF1ZXN0IGZvciBub24tZXhpc3RlbnQgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdpbnZhbGlkJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBOb3RGb3VuZEVycm9yKCdPcmRlciBub3QgZm91bmQnKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVmdW5kIHJlcXVlc3QgZm9yIHVucGFpZCBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5DSEFOR0VEX01JTkQsXG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KCdPcmRlciBtdXN0IGJlIHBhaWQgdG8gcmVxdWVzdCBhIHJlZnVuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVmdW5kIHJlcXVlc3QgYWZ0ZXIgcmV0dXJuIHdpbmRvdyBleHBpcmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVmdW5kRHRvOiBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvID0ge1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkNIQU5HRURfTUlORCxcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc2l4dHlEYXlzQWdvID0gbmV3IERhdGUoKTtcbiAgICAgIHNpeHR5RGF5c0Fnby5zZXREYXRlKHNpeHR5RGF5c0Fnby5nZXREYXRlKCkgLSA2MCk7XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IHNpeHR5RGF5c0FnbyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0bykpLnJlamVjdHMudG9UaHJvdygncmV0dXJuIHdpbmRvdycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgcGFydGlhbCByZWZ1bmQgYW1vdW50IGZvciBwYXJ0aWFsIHJldHVybicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5ERUZFQ1RJVkUsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9LFxuICAgICAgICBdLFxuICAgICAgICBwaG90b3M6IFsncGhvdG8xLmpwZyddLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkRFTElWRVJFRCxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICB0b3RhbDogMjAwLFxuICAgICAgICBkZWxpdmVyZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxLCB1bml0UHJpY2U6IDUwLCBzdWJ0b3RhbDogNTAgfSxcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAxLCB1bml0UHJpY2U6IDE1MCwgc3VidG90YWw6IDE1MCB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIHJlZnVuZEFtb3VudDogNTAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoNTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIHBob3RvcyBmb3IgZGVmZWN0aXZlIGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVmdW5kRHRvOiBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvID0ge1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkRFRkVDVElWRSxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgICBwaG90b3M6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkRFTElWRVJFRCxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICBkZWxpdmVyZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0bykpLnJlamVjdHMudG9UaHJvdygnUGhvdG9zIGFyZSByZXF1aXJlZCBmb3IgZGVmZWN0aXZlIG9yIGRhbWFnZWQgaXRlbXMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FwcHJvdmVSZWZ1bmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhcHByb3ZlIGEgcmVmdW5kIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDEwMCxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuYXBwcm92ZVJlZnVuZCgncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLkFQUFJPVkVEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXBwcm92ZSBwYXJ0aWFsIHJlZnVuZCB3aXRoIGFkanVzdGVkIGFtb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDc1LFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuYXBwcm92ZVJlZnVuZCgncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLkFQUFJPVkVEKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlKDc1KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlamVjdFJlZnVuZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhIHJlZnVuZCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLlBFTkRJTkcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kIGFzIGFueSk7XG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrUmVmdW5kLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5SRUpFQ1RFRCxcbiAgICAgICAgcmVqZWN0aW9uUmVhc29uOiAnT3V0c2lkZSByZXR1cm4gd2luZG93JyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5yZWplY3RSZWZ1bmQoJ3JlZnVuZC0xJywgJ091dHNpZGUgcmV0dXJuIHdpbmRvdycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShSZWZ1bmRTdGF0dXMuUkVKRUNURUQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWplY3Rpb25SZWFzb24pLnRvQmUoJ091dHNpZGUgcmV0dXJuIHdpbmRvdycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJvY2Vzc1JlZnVuZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgYXBwcm92ZWQgcmVmdW5kIGFuZCBpc3N1ZSBwYXltZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICAgIHJlZnVuZEFtb3VudDogMTAwLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUFJPQ0VTU0lORyxcbiAgICAgIH0gYXMgYW55KTtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ29yZGVyLTEnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tQYXltZW50R2F0ZXdheVNlcnZpY2UucmVmdW5kUGF5bWVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUsIHJlZnVuZElkOiAncmVmLTEyMycgfSBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQ09NUExFVEVELFxuICAgICAgICBwcm9jZXNzZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5wcm9jZXNzUmVmdW5kKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShSZWZ1bmRTdGF0dXMuQ09NUExFVEVEKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucHJvY2Vzc2VkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBwcm9jZXNzIHJlZnVuZCB0aGF0IGlzIG5vdCBhcHByb3ZlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5wcm9jZXNzUmVmdW5kKCdyZWZ1bmQtMScpKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Jlc3RvY2tJdGVtcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc3RvY2sgcmV0dXJuZWQgaXRlbXMgdG8gaW52ZW50b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICAgIHJlc3RvY2tJdGVtczogdHJ1ZSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAyIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMSB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDEwIH0gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVjb3JkQWRqdXN0bWVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCByZWZ1bmRTZXJ2aWNlLnJlc3RvY2tJdGVtcygncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Byb2QtMScsIHtcbiAgICAgICAgcXVhbnRpdHk6IDEyLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVjb3JkQWRqdXN0bWVudCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmVzdG9jayBkZWZlY3RpdmUgaXRlbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICByZXN0b2NrSXRlbXM6IGZhbHNlLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgYXdhaXQgcmVmdW5kU2VydmljZS5yZXN0b2NrSXRlbXMoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgZGVzY3JpYmUoJ2dldFVzZXJSZWZ1bmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFsbCByZWZ1bmQgcmVxdWVzdHMgZm9yIGEgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmRzID0gW1xuICAgICAgICB7IGlkOiAnMScsIHVzZXJJZDogJ3VzZXItMScsIHN0YXR1czogUmVmdW5kU3RhdHVzLkNPTVBMRVRFRCB9LFxuICAgICAgICB7IGlkOiAnMicsIHVzZXJJZDogJ3VzZXItMScsIHN0YXR1czogUmVmdW5kU3RhdHVzLlBFTkRJTkcgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kcyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmdldFVzZXJSZWZ1bmRzKCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuICB9KTtcblxuXG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVSZWZ1bmRBbW91bnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgZnVsbCByZWZ1bmQgYW1vdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMTUwLFxuICAgICAgICB0YXhBbW91bnQ6IDE1LFxuICAgICAgICBzaGlwcGluZ0Nvc3Q6IDEwLFxuICAgICAgICBzdWJ0b3RhbDogMTI1LFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogMTI1IH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNhbGN1bGF0ZVJlZnVuZEFtb3VudCh7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBwYXJ0aWFsIHJlZnVuZCBmb3Igc3Vic2V0IG9mIGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMjUwLFxuICAgICAgICBzdWJ0b3RhbDogMjI1LFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogMTAwIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiAxMjUgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuY2FsY3VsYXRlUmVmdW5kQW1vdW50KHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfV0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlTGVzc1RoYW4obW9ja09yZGVyLnRvdGFsKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGluY2x1ZGUgc2hpcHBpbmcgaW4gcGFydGlhbCByZWZ1bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHRvdGFsOiAxNTAsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAsXG4gICAgICAgIHNoaXBwaW5nQ29zdDogMTAsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiA1MCB9LFxuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogNTAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuY2FsY3VsYXRlUmVmdW5kQW1vdW50KHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfV0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoNTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVSZXR1cm5MYWJlbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHJldHVybiBzaGlwcGluZyBsYWJlbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICBzdHJlZXQ6ICcxMjMgTWFpbiBTdCcsXG4gICAgICAgICAgY2l0eTogJ0NpdHknLFxuICAgICAgICAgIHN0YXRlOiAnU1QnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICcxMjM0NScsXG4gICAgICAgICAgY291bnRyeTogJ1VTJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tMYWJlbCA9IHtcbiAgICAgICAgbGFiZWxVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2xhYmVsLnBkZicsXG4gICAgICAgIHRyYWNraW5nTnVtYmVyOiAnMVo5OTlBQTEwMTIzNDU2Nzg0JyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG4gICAgICBtb2NrU2hpcHBpbmdQcm92aWRlclNlcnZpY2UuY3JlYXRlUmV0dXJuTGFiZWwubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xhYmVsIGFzIGFueSk7XG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5nZW5lcmF0ZVJldHVybkxhYmVsKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmxhYmVsVXJsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50cmFja2luZ051bWJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RyYWNrUmV0dXJuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcmV0dXJuIHNoaXBtZW50IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRyYWNraW5nTnVtYmVyID0gJzFaOTk5QUExMDEyMzQ1Njc4NCc7XG5cbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICByZXR1cm5UcmFja2luZ051bWJlcjogdHJhY2tpbmdOdW1iZXIsXG4gICAgICAgIHJldHVyblN0YXR1czogJ0xBQkVMX0dFTkVSQVRFRCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrVHJhY2tpbmdJbmZvID0ge1xuICAgICAgICBzdGF0dXM6ICdpbl90cmFuc2l0JyxcbiAgICAgICAgZXZlbnRzOiBbXG4gICAgICAgICAgeyB0aW1lc3RhbXA6IG5ldyBEYXRlKCksIHN0YXR1czogJ3BpY2tlZF91cCcsIGxvY2F0aW9uOiAnT3JpZ2luJyB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5VHJhY2tpbmdOdW1iZXIubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1NoaXBwaW5nUHJvdmlkZXJTZXJ2aWNlLnRyYWNrU2hpcG1lbnQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1RyYWNraW5nSW5mbyBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UudHJhY2tSZXR1cm4odHJhY2tpbmdOdW1iZXIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kSWQpLnRvQmUoJ3JlZnVuZC0xJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrUmV0dXJuQXNSZWNlaXZlZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgcmV0dXJuIGFzIHJlY2VpdmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgcmV0dXJuU3RhdHVzOiAncmVjZWl2ZWQnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCByZWZ1bmRTZXJ2aWNlLm1hcmtSZXR1cm5Bc1JlY2VpdmVkKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QobW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRSZWZ1bmRTdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHJlZnVuZCBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZ2V0VG90YWxSZWZ1bmRlZEFtb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxNTApO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuY291bnRCeVN0YXR1cy5tb2NrSW1wbGVtZW50YXRpb24oKHN0YXR1cykgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSBSZWZ1bmRTdGF0dXMuUEVORElORykgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgxKTtcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gUmVmdW5kU3RhdHVzLkFQUFJPVkVEKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDApO1xuICAgICAgICBpZiAoc3RhdHVzID09PSBSZWZ1bmRTdGF0dXMuUkVKRUNURUQpIHJldHVybiBQcm9taXNlLnJlc29sdmUoMCk7XG4gICAgICAgIGlmIChzdGF0dXMgPT09IFJlZnVuZFN0YXR1cy5DT01QTEVURUQpIHJldHVybiBQcm9taXNlLnJlc29sdmUoMik7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMCk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5nZXRSZWZ1bmRTdGF0aXN0aWNzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxSZWZ1bmRlZCkudG9CZSgxNTApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wZW5kaW5nKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wbGV0ZWQpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja0VsaWdpYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2hlY2sgaWYgb3JkZXIgaXMgZWxpZ2libGUgZm9yIHJlZnVuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNoZWNrRWxpZ2liaWxpdHkoJ29yZGVyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbGlnaWJsZSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciBvcmRlciBvdXRzaWRlIHJldHVybiB3aW5kb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nQWdvID0gbmV3IERhdGUoKTtcbiAgICAgIGxvbmdBZ28uc2V0RGF0ZShsb25nQWdvLmdldERhdGUoKSAtIDEwMCk7XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IGxvbmdBZ28sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNoZWNrRWxpZ2liaWxpdHkoJ29yZGVyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbGlnaWJsZSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmlzc3Vlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==