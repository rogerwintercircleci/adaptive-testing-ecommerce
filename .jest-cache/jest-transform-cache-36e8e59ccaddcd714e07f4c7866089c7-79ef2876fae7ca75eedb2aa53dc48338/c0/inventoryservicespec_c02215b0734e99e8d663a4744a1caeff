404f8baa086d5b910c122a4d464bbe9c
"use strict";
/**
 * TDD: Inventory Management Service Tests
 *
 * Testing stock tracking, reservations, and inventory control
 */
Object.defineProperty(exports, "__esModule", { value: true });
const inventory_service_1 = require("./inventory.service");
const errors_1 = require("@libs/errors");
describe('InventoryService', () => {
    let inventoryService;
    let mockInventoryRepository;
    let mockProductRepository;
    beforeEach(() => {
        mockInventoryRepository = {
            findByProductId: jest.fn(),
            update: jest.fn(),
            createReservation: jest.fn(),
            releaseReservation: jest.fn(),
            findReservation: jest.fn(),
            findExpiredReservations: jest.fn(),
            findLowStock: jest.fn(),
            getInventoryHistory: jest.fn(),
            recordAdjustment: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            updateInventory: jest.fn(),
        };
        inventoryService = new inventory_service_1.InventoryService(mockInventoryRepository, mockProductRepository);
    });
    describe('getStock', () => {
        it('should get current stock level for a product', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
                available: 90,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            const result = await inventoryService.getStock('prod-1');
            expect(result.quantity).toBe(100);
            expect(result.available).toBe(90);
        });
        it('should calculate available stock (quantity - reserved)', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 50,
                reserved: 15,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            const result = await inventoryService.getStock('prod-1');
            expect(result.available).toBe(35);
        });
    });
    describe('adjustInventory', () => {
        it('should increase inventory quantity', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 150,
            });
            const result = await inventoryService.adjustInventory(adjustDto);
            expect(result.quantity).toBe(150);
        });
        it('should decrease inventory quantity', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: -20,
                reason: 'damage',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 80,
            });
            const result = await inventoryService.adjustInventory(adjustDto);
            expect(result.quantity).toBe(80);
        });
        it('should reject adjustment that would make quantity negative', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: -150,
                reason: 'adjustment',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            await expect(inventoryService.adjustInventory(adjustDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(inventoryService.adjustInventory(adjustDto)).rejects.toThrow('Insufficient inventory');
        });
        it('should record inventory adjustment in history', async () => {
            const adjustDto = {
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
                userId: 'admin-1',
            };
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 100 });
            mockInventoryRepository.update.mockResolvedValue({ quantity: 150 });
            mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);
            await inventoryService.adjustInventory(adjustDto);
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledWith(expect.objectContaining({
                productId: 'prod-1',
                quantity: 50,
                reason: 'restock',
            }));
        });
    });
    describe('reserveStock', () => {
        it('should reserve stock for an order', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
                available: 90,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.createReservation.mockResolvedValue({
                id: 'reservation-1',
                ...reservationDto,
                expiresAt: new Date(Date.now() + 15 * 60 * 1000),
            });
            const result = await inventoryService.reserveStock(reservationDto);
            expect(result.quantity).toBe(5);
            expect(result.expiresAt).toBeDefined();
        });
        it('should reject reservation if insufficient available stock', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 100,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 95,
                available: 5,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            await expect(inventoryService.reserveStock(reservationDto)).rejects.toThrow(errors_1.ConflictError);
            await expect(inventoryService.reserveStock(reservationDto)).rejects.toThrow('Insufficient stock available');
        });
        it('should set expiration time for reservation', async () => {
            const reservationDto = {
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
                expirationMinutes: 30,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 100,
                available: 100,
            });
            mockInventoryRepository.createReservation.mockResolvedValue({
                id: 'reservation-1',
                expiresAt: new Date(Date.now() + 30 * 60 * 1000),
            });
            const result = await inventoryService.reserveStock(reservationDto);
            const expiresIn = result.expiresAt.getTime() - Date.now();
            expect(expiresIn).toBeGreaterThan(29 * 60 * 1000);
            expect(expiresIn).toBeLessThan(31 * 60 * 1000);
        });
    });
    describe('releaseReservation', () => {
        it('should release a stock reservation', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            await inventoryService.releaseReservation('reservation-1');
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalledWith('reservation-1');
        });
        it('should update available quantity after releasing reservation', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            await inventoryService.releaseReservation('reservation-1');
            // Verify that reserved quantity decreased
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalled();
        });
    });
    describe('confirmReservation', () => {
        it('should convert reservation to actual inventory deduction', async () => {
            const mockReservation = {
                id: 'reservation-1',
                productId: 'prod-1',
                quantity: 5,
                orderId: 'order-1',
            };
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
                reserved: 10,
            };
            mockInventoryRepository.findReservation.mockResolvedValue(mockReservation);
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockInventoryRepository.update.mockResolvedValue({
                ...mockInventory,
                quantity: 95,
                reserved: 5,
            });
            const result = await inventoryService.confirmReservation('reservation-1');
            expect(result.quantity).toBe(95);
        });
    });
    describe('checkAvailability', () => {
        it('should check if quantity is available in stock', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                available: 50,
            });
            const result = await inventoryService.checkAvailability('prod-1', 30);
            expect(result).toBe(true);
        });
        it('should return false if requested quantity exceeds available stock', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                available: 50,
            });
            const result = await inventoryService.checkAvailability('prod-1', 60);
            expect(result).toBe(false);
        });
    });
    describe('getLowStockProducts', () => {
        it('should get products below minimum stock level', async () => {
            const mockLowStock = [
                { productId: 'prod-1', quantity: 5, minStockLevel: 10 },
                { productId: 'prod-2', quantity: 2, minStockLevel: 20 },
            ];
            mockInventoryRepository.findLowStock.mockResolvedValue(mockLowStock);
            const result = await inventoryService.getLowStockProducts();
            expect(result).toHaveLength(2);
            expect(result[0].quantity).toBeLessThan(result[0].minStockLevel);
        });
        it('should filter low stock by threshold percentage', async () => {
            const mockLowStock = [
                { productId: 'prod-1', quantity: 5, minStockLevel: 10 },
            ];
            mockInventoryRepository.findLowStock.mockResolvedValue(mockLowStock);
            const result = await inventoryService.getLowStockProducts({ threshold: 50 });
            expect(result[0].stockPercentage).toBeLessThanOrEqual(50);
        });
    });
    describe('getOutOfStockProducts', () => {
        it('should get products with zero stock', async () => {
            const mockOutOfStock = [
                { productId: 'prod-1', quantity: 0 },
                { productId: 'prod-2', quantity: 0 },
            ];
            mockInventoryRepository.findByProductId.mockImplementation((id) => {
                return Promise.resolve(mockOutOfStock.find(p => p.productId === id));
            });
            const result = await inventoryService.getOutOfStockProducts();
            expect(result.every(p => p.quantity === 0)).toBe(true);
        });
    });
    describe('setMinStockLevel', () => {
        it('should set minimum stock level for a product', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                productId: 'prod-1',
                quantity: 50,
            });
            mockInventoryRepository.update.mockResolvedValue({
                productId: 'prod-1',
                minStockLevel: 20,
            });
            const result = await inventoryService.setMinStockLevel('prod-1', 20);
            expect(result.minStockLevel).toBe(20);
        });
        it('should reject negative minimum stock level', async () => {
            await expect(inventoryService.setMinStockLevel('prod-1', -10)).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('setReorderPoint', () => {
        it('should set reorder point for automatic restocking', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                productId: 'prod-1',
            });
            mockInventoryRepository.update.mockResolvedValue({
                productId: 'prod-1',
                reorderPoint: 25,
                reorderQuantity: 100,
            });
            const result = await inventoryService.setReorderPoint('prod-1', 25, 100);
            expect(result.reorderPoint).toBe(25);
            expect(result.reorderQuantity).toBe(100);
        });
    });
    describe('getInventoryHistory', () => {
        it('should get inventory adjustment history', async () => {
            const mockHistory = [
                { id: '1', productId: 'prod-1', quantity: 50, reason: 'restock', date: new Date() },
                { id: '2', productId: 'prod-1', quantity: -5, reason: 'sale', date: new Date() },
            ];
            mockInventoryRepository.getInventoryHistory.mockResolvedValue(mockHistory);
            const result = await inventoryService.getInventoryHistory('prod-1');
            expect(result).toHaveLength(2);
        });
        it('should filter history by date range', async () => {
            const startDate = new Date('2025-01-01');
            const endDate = new Date('2025-01-31');
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([]);
            await inventoryService.getInventoryHistory('prod-1', { startDate, endDate });
            expect(mockInventoryRepository.getInventoryHistory).toHaveBeenCalledWith('prod-1', expect.objectContaining({ startDate, endDate }));
        });
    });
    describe('releaseExpiredReservations', () => {
        it('should release all expired stock reservations', async () => {
            const mockExpired = [
                { id: 'res-1', productId: 'prod-1', quantity: 5 },
                { id: 'res-2', productId: 'prod-2', quantity: 3 },
            ];
            mockInventoryRepository.findExpiredReservations.mockResolvedValue(mockExpired);
            mockInventoryRepository.releaseReservation.mockResolvedValue(undefined);
            const result = await inventoryService.releaseExpiredReservations();
            expect(result.releasedCount).toBe(2);
            expect(mockInventoryRepository.releaseReservation).toHaveBeenCalledTimes(2);
        });
    });
    describe('getStockValue', () => {
        it('should calculate total value of inventory', async () => {
            const mockInventory = {
                productId: 'prod-1',
                quantity: 100,
            };
            const mockProduct = {
                id: 'prod-1',
                cost: 50,
            };
            mockInventoryRepository.findByProductId.mockResolvedValue(mockInventory);
            mockProductRepository.findById.mockResolvedValue(mockProduct);
            const result = await inventoryService.getStockValue('prod-1');
            expect(result).toBe(5000); // 100 * 50
        });
    });
    describe('bulkUpdateInventory', () => {
        it('should update inventory for multiple products', async () => {
            const updates = [
                { productId: 'prod-1', quantity: 10 },
                { productId: 'prod-2', quantity: -5 },
            ];
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 100 });
            mockInventoryRepository.update.mockResolvedValue({});
            const result = await inventoryService.bulkUpdateInventory(updates);
            expect(result.updated).toBe(2);
            expect(result.failed).toBe(0);
        });
    });
    describe('getInventoryTurnover', () => {
        it('should calculate inventory turnover rate', async () => {
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([
                { quantity: -10, date: new Date('2025-01-15') },
                { quantity: -20, date: new Date('2025-01-20') },
            ]);
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 50,
            });
            const result = await inventoryService.getInventoryTurnover('prod-1', 30);
            expect(result.totalSold).toBe(30);
            expect(result.turnoverRate).toBeGreaterThan(0);
        });
    });
    describe('predictRestockDate', () => {
        it('should predict when product will need restocking', async () => {
            mockInventoryRepository.findByProductId.mockResolvedValue({
                quantity: 50,
                reorderPoint: 10,
            });
            mockInventoryRepository.getInventoryHistory.mockResolvedValue([
                { quantity: -2, date: new Date(Date.now() - 24 * 60 * 60 * 1000) },
                { quantity: -2, date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) },
                { quantity: -2, date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000) },
            ]);
            const result = await inventoryService.predictRestockDate('prod-1');
            expect(result.estimatedDays).toBeGreaterThan(0);
            expect(result.restockDate).toBeDefined();
        });
    });
    describe('transferStock', () => {
        it('should transfer stock between warehouses/locations', async () => {
            const transferDto = {
                productId: 'prod-1',
                fromLocation: 'warehouse-1',
                toLocation: 'warehouse-2',
                quantity: 20,
            };
            await inventoryService.transferStock(transferDto);
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXGludmVudG9yeVxcc2VydmljZXNcXGludmVudG9yeS5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsMkRBQTJGO0FBRzNGLHlDQUE4RDtBQUU5RCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLElBQUksZ0JBQWtDLENBQUM7SUFDdkMsSUFBSSx1QkFBeUQsQ0FBQztJQUM5RCxJQUFJLHFCQUFxRCxDQUFDO0lBRTFELFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCx1QkFBdUIsR0FBRztZQUN4QixlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMxQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzVCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDN0IsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDMUIsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDckIsQ0FBQztRQUVULHFCQUFxQixHQUFHO1lBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ3BCLENBQUM7UUFFVCxnQkFBZ0IsR0FBRyxJQUFJLG9DQUFnQixDQUFDLHVCQUF1QixFQUFFLHFCQUFxQixDQUFDLENBQUM7SUFDMUYsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVB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QUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXGludmVudG9yeVxcc2VydmljZXNcXGludmVudG9yeS5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUREQ6IEludmVudG9yeSBNYW5hZ2VtZW50IFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIHN0b2NrIHRyYWNraW5nLCByZXNlcnZhdGlvbnMsIGFuZCBpbnZlbnRvcnkgY29udHJvbFxuICovXG5cbmltcG9ydCB7IEludmVudG9yeVNlcnZpY2UsIEFkanVzdEludmVudG9yeUR0bywgUmVzZXJ2YXRpb25EdG8gfSBmcm9tICcuL2ludmVudG9yeS5zZXJ2aWNlJztcbmltcG9ydCB7IEludmVudG9yeVJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvaW52ZW50b3J5LnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgUHJvZHVjdFJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXJyb3IsIENvbmZsaWN0RXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuXG5kZXNjcmliZSgnSW52ZW50b3J5U2VydmljZScsICgpID0+IHtcbiAgbGV0IGludmVudG9yeVNlcnZpY2U6IEludmVudG9yeVNlcnZpY2U7XG4gIGxldCBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8SW52ZW50b3J5UmVwb3NpdG9yeT47XG4gIGxldCBtb2NrUHJvZHVjdFJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeVByb2R1Y3RJZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBjcmVhdGVSZXNlcnZhdGlvbjogamVzdC5mbigpLFxuICAgICAgcmVsZWFzZVJlc2VydmF0aW9uOiBqZXN0LmZuKCksXG4gICAgICBmaW5kUmVzZXJ2YXRpb246IGplc3QuZm4oKSxcbiAgICAgIGZpbmRFeHBpcmVkUmVzZXJ2YXRpb25zOiBqZXN0LmZuKCksXG4gICAgICBmaW5kTG93U3RvY2s6IGplc3QuZm4oKSxcbiAgICAgIGdldEludmVudG9yeUhpc3Rvcnk6IGplc3QuZm4oKSxcbiAgICAgIHJlY29yZEFkanVzdG1lbnQ6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVJbnZlbnRvcnk6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIGludmVudG9yeVNlcnZpY2UgPSBuZXcgSW52ZW50b3J5U2VydmljZShtb2NrSW52ZW50b3J5UmVwb3NpdG9yeSwgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFN0b2NrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGN1cnJlbnQgc3RvY2sgbGV2ZWwgZm9yIGEgcHJvZHVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tJbnZlbnRvcnkgPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICAgIHJlc2VydmVkOiAxMCxcbiAgICAgICAgYXZhaWxhYmxlOiA5MCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSW52ZW50b3J5IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuZ2V0U3RvY2soJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnF1YW50aXR5KS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmF2YWlsYWJsZSkudG9CZSg5MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBhdmFpbGFibGUgc3RvY2sgKHF1YW50aXR5IC0gcmVzZXJ2ZWQpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ludmVudG9yeSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDUwLFxuICAgICAgICByZXNlcnZlZDogMTUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldFN0b2NrKCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5hdmFpbGFibGUpLnRvQmUoMzUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWRqdXN0SW52ZW50b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5jcmVhc2UgaW52ZW50b3J5IHF1YW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRqdXN0RHRvOiBBZGp1c3RJbnZlbnRvcnlEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgcmVhc29uOiAncmVzdG9jaycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tJbnZlbnRvcnksXG4gICAgICAgIHF1YW50aXR5OiAxNTAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuYWRqdXN0SW52ZW50b3J5KGFkanVzdER0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbnRpdHkpLnRvQmUoMTUwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVjcmVhc2UgaW52ZW50b3J5IHF1YW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRqdXN0RHRvOiBBZGp1c3RJbnZlbnRvcnlEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHF1YW50aXR5OiAtMjAsXG4gICAgICAgIHJlYXNvbjogJ2RhbWFnZScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tJbnZlbnRvcnksXG4gICAgICAgIHF1YW50aXR5OiA4MCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5hZGp1c3RJbnZlbnRvcnkoYWRqdXN0RHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFudGl0eSkudG9CZSg4MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhZGp1c3RtZW50IHRoYXQgd291bGQgbWFrZSBxdWFudGl0eSBuZWdhdGl2ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFkanVzdER0bzogQWRqdXN0SW52ZW50b3J5RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogLTE1MCxcbiAgICAgICAgcmVhc29uOiAnYWRqdXN0bWVudCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGludmVudG9yeVNlcnZpY2UuYWRqdXN0SW52ZW50b3J5KGFkanVzdER0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KGludmVudG9yeVNlcnZpY2UuYWRqdXN0SW52ZW50b3J5KGFkanVzdER0bykpLnJlamVjdHMudG9UaHJvdygnSW5zdWZmaWNpZW50IGludmVudG9yeScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWNvcmQgaW52ZW50b3J5IGFkanVzdG1lbnQgaW4gaGlzdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFkanVzdER0bzogQWRqdXN0SW52ZW50b3J5RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICAgIHJlYXNvbjogJ3Jlc3RvY2snLFxuICAgICAgICB1c2VySWQ6ICdhZG1pbi0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHF1YW50aXR5OiAxMDAgfSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDE1MCB9IGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWNvcmRBZGp1c3RtZW50Lm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IGludmVudG9yeVNlcnZpY2UuYWRqdXN0SW52ZW50b3J5KGFkanVzdER0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWNvcmRBZGp1c3RtZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgICAgcXVhbnRpdHk6IDUwLFxuICAgICAgICAgIHJlYXNvbjogJ3Jlc3RvY2snLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Jlc2VydmVTdG9jaycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2VydmUgc3RvY2sgZm9yIGFuIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZXJ2YXRpb25EdG86IFJlc2VydmF0aW9uRHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNSxcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja0ludmVudG9yeSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDEwMCxcbiAgICAgICAgcmVzZXJ2ZWQ6IDEwLFxuICAgICAgICBhdmFpbGFibGU6IDkwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmNyZWF0ZVJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdyZXNlcnZhdGlvbi0xJyxcbiAgICAgICAgLi4ucmVzZXJ2YXRpb25EdG8sXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDE1ICogNjAgKiAxMDAwKSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5yZXNlcnZlU3RvY2socmVzZXJ2YXRpb25EdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnF1YW50aXR5KS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leHBpcmVzQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZXNlcnZhdGlvbiBpZiBpbnN1ZmZpY2llbnQgYXZhaWxhYmxlIHN0b2NrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZXJ2YXRpb25EdG86IFJlc2VydmF0aW9uRHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICByZXNlcnZlZDogOTUsXG4gICAgICAgIGF2YWlsYWJsZTogNSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSW52ZW50b3J5IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChpbnZlbnRvcnlTZXJ2aWNlLnJlc2VydmVTdG9jayhyZXNlcnZhdGlvbkR0bykpLnJlamVjdHMudG9UaHJvdyhDb25mbGljdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChpbnZlbnRvcnlTZXJ2aWNlLnJlc2VydmVTdG9jayhyZXNlcnZhdGlvbkR0bykpLnJlamVjdHMudG9UaHJvdygnSW5zdWZmaWNpZW50IHN0b2NrIGF2YWlsYWJsZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgZXhwaXJhdGlvbiB0aW1lIGZvciByZXNlcnZhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc2VydmF0aW9uRHRvOiBSZXNlcnZhdGlvbkR0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDUsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgZXhwaXJhdGlvbk1pbnV0ZXM6IDMwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgcXVhbnRpdHk6IDEwMCxcbiAgICAgICAgYXZhaWxhYmxlOiAxMDAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmNyZWF0ZVJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdyZXNlcnZhdGlvbi0xJyxcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiA2MCAqIDEwMDApLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnJlc2VydmVTdG9jayhyZXNlcnZhdGlvbkR0byk7XG5cbiAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IHJlc3VsdC5leHBpcmVzQXQuZ2V0VGltZSgpIC0gRGF0ZS5ub3coKTtcbiAgICAgIGV4cGVjdChleHBpcmVzSW4pLnRvQmVHcmVhdGVyVGhhbigyOSAqIDYwICogMTAwMCk7XG4gICAgICBleHBlY3QoZXhwaXJlc0luKS50b0JlTGVzc1RoYW4oMzEgKiA2MCAqIDEwMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVsZWFzZVJlc2VydmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVsZWFzZSBhIHN0b2NrIHJlc2VydmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc2VydmF0aW9uID0ge1xuICAgICAgICBpZDogJ3Jlc2VydmF0aW9uLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRSZXNlcnZhdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzZXJ2YXRpb24gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlbGVhc2VSZXNlcnZhdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnJlbGVhc2VSZXNlcnZhdGlvbigncmVzZXJ2YXRpb24tMScpO1xuXG4gICAgICBleHBlY3QobW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVsZWFzZVJlc2VydmF0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncmVzZXJ2YXRpb24tMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgYXZhaWxhYmxlIHF1YW50aXR5IGFmdGVyIHJlbGVhc2luZyByZXNlcnZhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXNlcnZhdGlvbiA9IHtcbiAgICAgICAgaWQ6ICdyZXNlcnZhdGlvbi0xJyxcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kUmVzZXJ2YXRpb24ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc2VydmF0aW9uIGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWxlYXNlUmVzZXJ2YXRpb24ubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgaW52ZW50b3J5U2VydmljZS5yZWxlYXNlUmVzZXJ2YXRpb24oJ3Jlc2VydmF0aW9uLTEnKTtcblxuICAgICAgLy8gVmVyaWZ5IHRoYXQgcmVzZXJ2ZWQgcXVhbnRpdHkgZGVjcmVhc2VkXG4gICAgICBleHBlY3QobW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVsZWFzZVJlc2VydmF0aW9uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25maXJtUmVzZXJ2YXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb252ZXJ0IHJlc2VydmF0aW9uIHRvIGFjdHVhbCBpbnZlbnRvcnkgZGVkdWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc2VydmF0aW9uID0ge1xuICAgICAgICBpZDogJ3Jlc2VydmF0aW9uLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNSxcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja0ludmVudG9yeSA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgcXVhbnRpdHk6IDEwMCxcbiAgICAgICAgcmVzZXJ2ZWQ6IDEwLFxuICAgICAgfTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZFJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNlcnZhdGlvbiBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZlbnRvcnkgYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tJbnZlbnRvcnksXG4gICAgICAgIHF1YW50aXR5OiA5NSxcbiAgICAgICAgcmVzZXJ2ZWQ6IDUsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuY29uZmlybVJlc2VydmF0aW9uKCdyZXNlcnZhdGlvbi0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbnRpdHkpLnRvQmUoOTUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2hlY2tBdmFpbGFiaWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjaGVjayBpZiBxdWFudGl0eSBpcyBhdmFpbGFibGUgaW4gc3RvY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBhdmFpbGFibGU6IDUwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmNoZWNrQXZhaWxhYmlsaXR5KCdwcm9kLTEnLCAzMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiByZXF1ZXN0ZWQgcXVhbnRpdHkgZXhjZWVkcyBhdmFpbGFibGUgc3RvY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBhdmFpbGFibGU6IDUwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmNoZWNrQXZhaWxhYmlsaXR5KCdwcm9kLTEnLCA2MCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TG93U3RvY2tQcm9kdWN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBwcm9kdWN0cyBiZWxvdyBtaW5pbXVtIHN0b2NrIGxldmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0xvd1N0b2NrID0gW1xuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiA1LCBtaW5TdG9ja0xldmVsOiAxMCB9LFxuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAyLCBtaW5TdG9ja0xldmVsOiAyMCB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZExvd1N0b2NrLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb3dTdG9jayBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldExvd1N0b2NrUHJvZHVjdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5xdWFudGl0eSkudG9CZUxlc3NUaGFuKHJlc3VsdFswXS5taW5TdG9ja0xldmVsKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIGxvdyBzdG9jayBieSB0aHJlc2hvbGQgcGVyY2VudGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tMb3dTdG9jayA9IFtcbiAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogNSwgbWluU3RvY2tMZXZlbDogMTAgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRMb3dTdG9jay5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG93U3RvY2sgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRMb3dTdG9ja1Byb2R1Y3RzKHsgdGhyZXNob2xkOiA1MCB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zdG9ja1BlcmNlbnRhZ2UpLnRvQmVMZXNzVGhhbk9yRXF1YWwoNTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0T3V0T2ZTdG9ja1Byb2R1Y3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHByb2R1Y3RzIHdpdGggemVybyBzdG9jaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPdXRPZlN0b2NrID0gW1xuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAwIH0sXG4gICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDAgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrSW1wbGVtZW50YXRpb24oKGlkKSA9PiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoXG4gICAgICAgICAgbW9ja091dE9mU3RvY2suZmluZChwID0+IHAucHJvZHVjdElkID09PSBpZCkgYXMgYW55XG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRPdXRPZlN0b2NrUHJvZHVjdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5ldmVyeShwID0+IHAucXVhbnRpdHkgPT09IDApKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0TWluU3RvY2tMZXZlbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBtaW5pbXVtIHN0b2NrIGxldmVsIGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIG1pblN0b2NrTGV2ZWw6IDIwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnNldE1pblN0b2NrTGV2ZWwoJ3Byb2QtMScsIDIwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5taW5TdG9ja0xldmVsKS50b0JlKDIwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5lZ2F0aXZlIG1pbmltdW0gc3RvY2sgbGV2ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGludmVudG9yeVNlcnZpY2Uuc2V0TWluU3RvY2tMZXZlbCgncHJvZC0xJywgLTEwKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NldFJlb3JkZXJQb2ludCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCByZW9yZGVyIHBvaW50IGZvciBhdXRvbWF0aWMgcmVzdG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHJlb3JkZXJQb2ludDogMjUsXG4gICAgICAgIHJlb3JkZXJRdWFudGl0eTogMTAwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLnNldFJlb3JkZXJQb2ludCgncHJvZC0xJywgMjUsIDEwMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVvcmRlclBvaW50KS50b0JlKDI1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVvcmRlclF1YW50aXR5KS50b0JlKDEwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRJbnZlbnRvcnlIaXN0b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGludmVudG9yeSBhZGp1c3RtZW50IGhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSGlzdG9yeSA9IFtcbiAgICAgICAgeyBpZDogJzEnLCBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogNTAsIHJlYXNvbjogJ3Jlc3RvY2snLCBkYXRlOiBuZXcgRGF0ZSgpIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IC01LCByZWFzb246ICdzYWxlJywgZGF0ZTogbmV3IERhdGUoKSB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5SGlzdG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSGlzdG9yeSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldEludmVudG9yeUhpc3RvcnkoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBoaXN0b3J5IGJ5IGRhdGUgcmFuZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgnMjAyNS0wMS0wMScpO1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKCcyMDI1LTAxLTMxJyk7XG5cbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmdldEludmVudG9yeUhpc3RvcnkubW9ja1Jlc29sdmVkVmFsdWUoW10gYXMgYW55KTtcblxuICAgICAgYXdhaXQgaW52ZW50b3J5U2VydmljZS5nZXRJbnZlbnRvcnlIaXN0b3J5KCdwcm9kLTEnLCB7IHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmdldEludmVudG9yeUhpc3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAncHJvZC0xJyxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGFydERhdGUsIGVuZERhdGUgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWxlYXNlRXhwaXJlZFJlc2VydmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbGVhc2UgYWxsIGV4cGlyZWQgc3RvY2sgcmVzZXJ2YXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0V4cGlyZWQgPSBbXG4gICAgICAgIHsgaWQ6ICdyZXMtMScsIHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiA1IH0sXG4gICAgICAgIHsgaWQ6ICdyZXMtMicsIHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAzIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kRXhwaXJlZFJlc2VydmF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRXhwaXJlZCBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVsZWFzZVJlc2VydmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UucmVsZWFzZUV4cGlyZWRSZXNlcnZhdGlvbnMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWxlYXNlZENvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnJlbGVhc2VSZXNlcnZhdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U3RvY2tWYWx1ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSB0b3RhbCB2YWx1ZSBvZiBpbnZlbnRvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSW52ZW50b3J5ID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1Byb2R1Y3QgPSB7XG4gICAgICAgIGlkOiAncHJvZC0xJyxcbiAgICAgICAgY29zdDogNTAsXG4gICAgICB9O1xuXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludmVudG9yeSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmVudG9yeVNlcnZpY2UuZ2V0U3RvY2tWYWx1ZSgncHJvZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoNTAwMCk7IC8vIDEwMCAqIDUwXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdidWxrVXBkYXRlSW52ZW50b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIGludmVudG9yeSBmb3IgbXVsdGlwbGUgcHJvZHVjdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVzID0gW1xuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxMCB9LFxuICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMicsIHF1YW50aXR5OiAtNSB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDEwMCB9IGFzIGFueSk7XG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5idWxrVXBkYXRlSW52ZW50b3J5KHVwZGF0ZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnVwZGF0ZWQpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0LmZhaWxlZCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEludmVudG9yeVR1cm5vdmVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGludmVudG9yeSB0dXJub3ZlciByYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5SGlzdG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgcXVhbnRpdHk6IC0xMCwgZGF0ZTogbmV3IERhdGUoJzIwMjUtMDEtMTUnKSB9LFxuICAgICAgICB7IHF1YW50aXR5OiAtMjAsIGRhdGU6IG5ldyBEYXRlKCcyMDI1LTAxLTIwJykgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgcXVhbnRpdHk6IDUwLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnZlbnRvcnlTZXJ2aWNlLmdldEludmVudG9yeVR1cm5vdmVyKCdwcm9kLTEnLCAzMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxTb2xkKS50b0JlKDMwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHVybm92ZXJSYXRlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmVkaWN0UmVzdG9ja0RhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcmVkaWN0IHdoZW4gcHJvZHVjdCB3aWxsIG5lZWQgcmVzdG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgcmVvcmRlclBvaW50OiAxMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5SGlzdG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHsgcXVhbnRpdHk6IC0yLCBkYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgICAgeyBxdWFudGl0eTogLTIsIGRhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSAyICogMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgICAgeyBxdWFudGl0eTogLTIsIGRhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzICogMjQgKiA2MCAqIDYwICogMTAwMCkgfSxcbiAgICAgIF0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW52ZW50b3J5U2VydmljZS5wcmVkaWN0UmVzdG9ja0RhdGUoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmVzdGltYXRlZERheXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdG9ja0RhdGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd0cmFuc2ZlclN0b2NrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhbnNmZXIgc3RvY2sgYmV0d2VlbiB3YXJlaG91c2VzL2xvY2F0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRyYW5zZmVyRHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICBmcm9tTG9jYXRpb246ICd3YXJlaG91c2UtMScsXG4gICAgICAgIHRvTG9jYXRpb246ICd3YXJlaG91c2UtMicsXG4gICAgICAgIHF1YW50aXR5OiAyMCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGludmVudG9yeVNlcnZpY2UudHJhbnNmZXJTdG9jayh0cmFuc2ZlckR0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS5yZWNvcmRBZGp1c3RtZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=