65669929d2db799b1b40b01f45d5d61e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifyToken = exports.generateToken = exports.extractTokenFromHeader = exports.decodeToken = exports.verifyRefreshToken = exports.verifyAccessToken = exports.generateRefreshToken = exports.generateAccessToken = void 0;
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
const errors_1 = require("../errors");
const JWT_SECRET = process.env.JWT_SECRET || 'your_super_secret_jwt_key';
const JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '24h';
const JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || 'your_refresh_token_secret';
const JWT_REFRESH_EXPIRES_IN = process.env.JWT_REFRESH_EXPIRES_IN || '7d';
/**
 * Generate access token
 */
const generateAccessToken = (payload) => {
    return jsonwebtoken_1.default.sign(payload, JWT_SECRET, {
        expiresIn: JWT_EXPIRES_IN,
    });
};
exports.generateAccessToken = generateAccessToken;
/**
 * Generate refresh token
 */
const generateRefreshToken = (payload) => {
    return jsonwebtoken_1.default.sign(payload, JWT_REFRESH_SECRET, {
        expiresIn: JWT_REFRESH_EXPIRES_IN,
    });
};
exports.generateRefreshToken = generateRefreshToken;
/**
 * Verify access token
 * @throws UnauthorizedError if token is invalid
 */
const verifyAccessToken = (token) => {
    try {
        return jsonwebtoken_1.default.verify(token, JWT_SECRET);
    }
    catch (error) {
        if (error instanceof jsonwebtoken_1.default.TokenExpiredError) {
            throw new errors_1.UnauthorizedError('Access token expired');
        }
        if (error instanceof jsonwebtoken_1.default.JsonWebTokenError) {
            throw new errors_1.UnauthorizedError('Invalid access token');
        }
        throw new errors_1.UnauthorizedError('Token verification failed');
    }
};
exports.verifyAccessToken = verifyAccessToken;
/**
 * Verify refresh token
 * @throws UnauthorizedError if token is invalid
 */
const verifyRefreshToken = (token) => {
    try {
        return jsonwebtoken_1.default.verify(token, JWT_REFRESH_SECRET);
    }
    catch (error) {
        if (error instanceof jsonwebtoken_1.default.TokenExpiredError) {
            throw new errors_1.UnauthorizedError('Refresh token expired');
        }
        if (error instanceof jsonwebtoken_1.default.JsonWebTokenError) {
            throw new errors_1.UnauthorizedError('Invalid refresh token');
        }
        throw new errors_1.UnauthorizedError('Token verification failed');
    }
};
exports.verifyRefreshToken = verifyRefreshToken;
/**
 * Decode token without verification (for debugging)
 */
const decodeToken = (token) => {
    try {
        return jsonwebtoken_1.default.decode(token);
    }
    catch {
        return null;
    }
};
exports.decodeToken = decodeToken;
/**
 * Extract token from Authorization header
 */
const extractTokenFromHeader = (authHeader) => {
    if (!authHeader) {
        return null;
    }
    const parts = authHeader.split(' ');
    if (parts.length !== 2 || parts[0] !== 'Bearer') {
        return null;
    }
    return parts[1];
};
exports.extractTokenFromHeader = extractTokenFromHeader;
/**
 * Generate token (alias for generateAccessToken with optional custom expiry)
 */
const generateToken = (payload, expiresIn) => {
    if (expiresIn) {
        return jsonwebtoken_1.default.sign(payload, JWT_SECRET, { expiresIn });
    }
    return (0, exports.generateAccessToken)(payload);
};
exports.generateToken = generateToken;
/**
 * Verify token (alias for verifyAccessToken)
 */
const verifyToken = (token) => {
    return (0, exports.verifyAccessToken)(token);
};
exports.verifyToken = verifyToken;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcbGlic1xcYXV0aFxcand0LnV0aWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGdFQUErQjtBQUMvQixzQ0FBOEM7QUFFOUMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksMkJBQTJCLENBQUM7QUFDekUsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLElBQUksS0FBSyxDQUFDO0FBQzNELE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSwyQkFBMkIsQ0FBQztBQUN6RixNQUFNLHNCQUFzQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLElBQUksSUFBSSxDQUFDO0FBVTFFOztHQUVHO0FBQ0ksTUFBTSxtQkFBbUIsR0FBRyxDQUFDLE9BQXdDLEVBQVUsRUFBRTtJQUN0RixPQUFPLHNCQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUU7UUFDbkMsU0FBUyxFQUFFLGNBQWM7S0FDUCxDQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFDO0FBSlcsUUFBQSxtQkFBbUIsdUJBSTlCO0FBRUY7O0dBRUc7QUFDSSxNQUFNLG9CQUFvQixHQUFHLENBQUMsT0FBd0MsRUFBVSxFQUFFO0lBQ3ZGLE9BQU8sc0JBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGtCQUFrQixFQUFFO1FBQzNDLFNBQVMsRUFBRSxzQkFBc0I7S0FDZixDQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFDO0FBSlcsUUFBQSxvQkFBb0Isd0JBSS9CO0FBRUY7OztHQUdHO0FBQ0ksTUFBTSxpQkFBaUIsR0FBRyxDQUFDLEtBQWEsRUFBYyxFQUFFO0lBQzdELElBQUksQ0FBQztRQUNILE9BQU8sc0JBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBZSxDQUFDO0lBQ3JELENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsSUFBSSxLQUFLLFlBQVksc0JBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzNDLE1BQU0sSUFBSSwwQkFBaUIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCxJQUFJLEtBQUssWUFBWSxzQkFBRyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDM0MsTUFBTSxJQUFJLDBCQUFpQixDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELE1BQU0sSUFBSSwwQkFBaUIsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQzNELENBQUM7QUFDSCxDQUFDLENBQUM7QUFaVyxRQUFBLGlCQUFpQixxQkFZNUI7QUFFRjs7O0dBR0c7QUFDSSxNQUFNLGtCQUFrQixHQUFHLENBQUMsS0FBYSxFQUFjLEVBQUU7SUFDOUQsSUFBSSxDQUFDO1FBQ0gsT0FBTyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsa0JBQWtCLENBQWUsQ0FBQztJQUM3RCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLElBQUksS0FBSyxZQUFZLHNCQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUMzQyxNQUFNLElBQUksMEJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUN2RCxDQUFDO1FBQ0QsSUFBSSxLQUFLLFlBQVksc0JBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzNDLE1BQU0sSUFBSSwwQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7UUFDRCxNQUFNLElBQUksMEJBQWlCLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUMzRCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBWlcsUUFBQSxrQkFBa0Isc0JBWTdCO0FBRUY7O0dBRUc7QUFDSSxNQUFNLFdBQVcsR0FBRyxDQUFDLEtBQWEsRUFBcUIsRUFBRTtJQUM5RCxJQUFJLENBQUM7UUFDSCxPQUFPLHNCQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBZSxDQUFDO0lBQ3pDLENBQUM7SUFBQyxNQUFNLENBQUM7UUFDUCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7QUFDSCxDQUFDLENBQUM7QUFOVyxRQUFBLFdBQVcsZUFNdEI7QUFFRjs7R0FFRztBQUNJLE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxVQUFtQixFQUFpQixFQUFFO0lBQzNFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNoQixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ2hELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQztBQVhXLFFBQUEsc0JBQXNCLDBCQVdqQztBQUVGOztHQUVHO0FBQ0ksTUFBTSxhQUFhLEdBQUcsQ0FDM0IsT0FBd0MsRUFDeEMsU0FBa0IsRUFDVixFQUFFO0lBQ1YsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUNkLE9BQU8sc0JBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBcUIsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFDRCxPQUFPLElBQUEsMkJBQW1CLEVBQUMsT0FBTyxDQUFDLENBQUM7QUFDdEMsQ0FBQyxDQUFDO0FBUlcsUUFBQSxhQUFhLGlCQVF4QjtBQUVGOztHQUVHO0FBQ0ksTUFBTSxXQUFXLEdBQUcsQ0FBQyxLQUFhLEVBQWMsRUFBRTtJQUN2RCxPQUFPLElBQUEseUJBQWlCLEVBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDO0FBRlcsUUFBQSxXQUFXLGVBRXRCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXGxpYnNcXGF1dGhcXGp3dC51dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgeyBVbmF1dGhvcml6ZWRFcnJvciB9IGZyb20gJy4uL2Vycm9ycyc7XG5cbmNvbnN0IEpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd5b3VyX3N1cGVyX3NlY3JldF9qd3Rfa2V5JztcbmNvbnN0IEpXVF9FWFBJUkVTX0lOID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzI0aCc7XG5jb25zdCBKV1RfUkVGUkVTSF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfUkVGUkVTSF9TRUNSRVQgfHwgJ3lvdXJfcmVmcmVzaF90b2tlbl9zZWNyZXQnO1xuY29uc3QgSldUX1JFRlJFU0hfRVhQSVJFU19JTiA9IHByb2Nlc3MuZW52LkpXVF9SRUZSRVNIX0VYUElSRVNfSU4gfHwgJzdkJztcblxuZXhwb3J0IGludGVyZmFjZSBKV1RQYXlsb2FkIHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHJvbGU6IHN0cmluZztcbiAgaWF0PzogbnVtYmVyO1xuICBleHA/OiBudW1iZXI7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgYWNjZXNzIHRva2VuXG4gKi9cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUFjY2Vzc1Rva2VuID0gKHBheWxvYWQ6IE9taXQ8SldUUGF5bG9hZCwgJ2lhdCcgfCAnZXhwJz4pOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwge1xuICAgIGV4cGlyZXNJbjogSldUX0VYUElSRVNfSU4sXG4gIH0gYXMgand0LlNpZ25PcHRpb25zKTtcbn07XG5cbi8qKlxuICogR2VuZXJhdGUgcmVmcmVzaCB0b2tlblxuICovXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVSZWZyZXNoVG9rZW4gPSAocGF5bG9hZDogT21pdDxKV1RQYXlsb2FkLCAnaWF0JyB8ICdleHAnPik6IHN0cmluZyA9PiB7XG4gIHJldHVybiBqd3Quc2lnbihwYXlsb2FkLCBKV1RfUkVGUkVTSF9TRUNSRVQsIHtcbiAgICBleHBpcmVzSW46IEpXVF9SRUZSRVNIX0VYUElSRVNfSU4sXG4gIH0gYXMgand0LlNpZ25PcHRpb25zKTtcbn07XG5cbi8qKlxuICogVmVyaWZ5IGFjY2VzcyB0b2tlblxuICogQHRocm93cyBVbmF1dGhvcml6ZWRFcnJvciBpZiB0b2tlbiBpcyBpbnZhbGlkXG4gKi9cbmV4cG9ydCBjb25zdCB2ZXJpZnlBY2Nlc3NUb2tlbiA9ICh0b2tlbjogc3RyaW5nKTogSldUUGF5bG9hZCA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGp3dC52ZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpIGFzIEpXVFBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygand0LlRva2VuRXhwaXJlZEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ0FjY2VzcyB0b2tlbiBleHBpcmVkJyk7XG4gICAgfVxuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIGp3dC5Kc29uV2ViVG9rZW5FcnJvcikge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEVycm9yKCdJbnZhbGlkIGFjY2VzcyB0b2tlbicpO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBWZXJpZnkgcmVmcmVzaCB0b2tlblxuICogQHRocm93cyBVbmF1dGhvcml6ZWRFcnJvciBpZiB0b2tlbiBpcyBpbnZhbGlkXG4gKi9cbmV4cG9ydCBjb25zdCB2ZXJpZnlSZWZyZXNoVG9rZW4gPSAodG9rZW46IHN0cmluZyk6IEpXVFBheWxvYWQgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBqd3QudmVyaWZ5KHRva2VuLCBKV1RfUkVGUkVTSF9TRUNSRVQpIGFzIEpXVFBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygand0LlRva2VuRXhwaXJlZEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXJyb3IoJ1JlZnJlc2ggdG9rZW4gZXhwaXJlZCcpO1xuICAgIH1cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBqd3QuSnNvbldlYlRva2VuRXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFcnJvcignSW52YWxpZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfVxuICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFcnJvcignVG9rZW4gdmVyaWZpY2F0aW9uIGZhaWxlZCcpO1xuICB9XG59O1xuXG4vKipcbiAqIERlY29kZSB0b2tlbiB3aXRob3V0IHZlcmlmaWNhdGlvbiAoZm9yIGRlYnVnZ2luZylcbiAqL1xuZXhwb3J0IGNvbnN0IGRlY29kZVRva2VuID0gKHRva2VuOiBzdHJpbmcpOiBKV1RQYXlsb2FkIHwgbnVsbCA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGp3dC5kZWNvZGUodG9rZW4pIGFzIEpXVFBheWxvYWQ7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG4vKipcbiAqIEV4dHJhY3QgdG9rZW4gZnJvbSBBdXRob3JpemF0aW9uIGhlYWRlclxuICovXG5leHBvcnQgY29uc3QgZXh0cmFjdFRva2VuRnJvbUhlYWRlciA9IChhdXRoSGVhZGVyPzogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGlmICghYXV0aEhlYWRlcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgcGFydHMgPSBhdXRoSGVhZGVyLnNwbGl0KCcgJyk7XG4gIGlmIChwYXJ0cy5sZW5ndGggIT09IDIgfHwgcGFydHNbMF0gIT09ICdCZWFyZXInKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gcGFydHNbMV07XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlIHRva2VuIChhbGlhcyBmb3IgZ2VuZXJhdGVBY2Nlc3NUb2tlbiB3aXRoIG9wdGlvbmFsIGN1c3RvbSBleHBpcnkpXG4gKi9cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVRva2VuID0gKFxuICBwYXlsb2FkOiBPbWl0PEpXVFBheWxvYWQsICdpYXQnIHwgJ2V4cCc+LFxuICBleHBpcmVzSW4/OiBzdHJpbmdcbik6IHN0cmluZyA9PiB7XG4gIGlmIChleHBpcmVzSW4pIHtcbiAgICByZXR1cm4gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwgeyBleHBpcmVzSW4gfSBhcyBqd3QuU2lnbk9wdGlvbnMpO1xuICB9XG4gIHJldHVybiBnZW5lcmF0ZUFjY2Vzc1Rva2VuKHBheWxvYWQpO1xufTtcblxuLyoqXG4gKiBWZXJpZnkgdG9rZW4gKGFsaWFzIGZvciB2ZXJpZnlBY2Nlc3NUb2tlbilcbiAqL1xuZXhwb3J0IGNvbnN0IHZlcmlmeVRva2VuID0gKHRva2VuOiBzdHJpbmcpOiBKV1RQYXlsb2FkID0+IHtcbiAgcmV0dXJuIHZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuKTtcbn07XG4iXSwidmVyc2lvbiI6M30=