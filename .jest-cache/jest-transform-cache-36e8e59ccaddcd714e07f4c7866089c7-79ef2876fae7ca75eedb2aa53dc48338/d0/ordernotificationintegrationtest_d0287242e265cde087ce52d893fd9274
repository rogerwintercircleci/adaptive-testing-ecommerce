a0944d10b7dc9492821a7fa9f99144a7
"use strict";
/**
 * Integration Tests: Order Processing with Notifications
 *
 * Testing order lifecycle events and notification triggers
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../../src/services/order-processing/repositories/order.repository');
jest.mock('../../../src/services/product-catalog/repositories/product.repository');
jest.mock('../../../src/services/notifications/services/notification.service');
const order_service_1 = require("../../../src/services/order-processing/services/order.service");
const order_entity_1 = require("../../../src/services/order-processing/entities/order.entity");
describe('Order and Notification Integration Tests', () => {
    let orderService;
    let mockOrderRepository;
    let mockProductRepository;
    let mockNotificationService;
    beforeEach(() => {
        mockOrderRepository = {
            createOrder: jest.fn(),
            findById: jest.fn(),
            updateStatus: jest.fn(),
            updatePaymentStatus: jest.fn(),
            updateShippingInfo: jest.fn(),
            cancel: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            decrementInventory: jest.fn(),
            incrementInventory: jest.fn(),
            incrementSoldCount: jest.fn(),
        };
        mockNotificationService = {
            sendOrderConfirmationEmail: jest.fn(),
            sendOrderShippedEmail: jest.fn(),
            sendOrderDeliveredEmail: jest.fn(),
            sendOrderCancelledEmail: jest.fn(),
            sendPaymentSuccessEmail: jest.fn(),
            sendWebhook: jest.fn(),
        };
        orderService = new order_service_1.OrderService(mockOrderRepository, mockProductRepository, mockNotificationService);
    });
    describe('Order Creation with Notifications', () => {
        it('should create order and send confirmation email', async () => {
            const createOrderDto = {
                userId: 'user-123',
                items: [
                    {
                        productId: 'prod-1',
                        quantity: 2,
                        unitPrice: 50.00,
                    },
                ],
                shippingAddress: {
                    street: '123 Main St',
                    city: 'City',
                    state: 'ST',
                    zip: '12345',
                    country: 'US',
                },
            };
            mockProductRepository.findById.mockResolvedValue({
                id: 'prod-1',
                name: 'Test Product',
                sku: 'TEST-001',
                price: 50.00,
                inventory: 10,
                status: 'active',
            });
            mockProductRepository.decrementInventory.mockResolvedValue({});
            mockProductRepository.incrementSoldCount.mockResolvedValue({});
            mockOrderRepository.createOrder.mockResolvedValue({
                id: 'order-123',
                orderNumber: 'ORD-2024-001',
                userId: 'user-123',
                total: 110.00,
                status: order_entity_1.OrderStatus.PENDING,
            });
            mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.createOrder(createOrderDto);
            expect(result.id).toBe('order-123');
            expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalledWith('user-123', 'ORD-2024-001', expect.any(Number));
        });
        it('should send webhook on order creation', async () => {
            const createOrderDto = {
                userId: 'user-456',
                items: [
                    {
                        productId: 'prod-2',
                        quantity: 1,
                        unitPrice: 75.00,
                    },
                ],
                shippingAddress: {
                    street: '456 Oak Ave',
                    city: 'Town',
                    state: 'ST',
                    zip: '54321',
                    country: 'US',
                },
                webhookUrl: 'https://api.example.com/webhooks/orders',
            };
            mockProductRepository.findById.mockResolvedValue({
                id: 'prod-2',
                name: 'Product 2',
                sku: 'TEST-002',
                price: 75.00,
                inventory: 5,
                status: 'active',
            });
            mockProductRepository.decrementInventory.mockResolvedValue({});
            mockProductRepository.incrementSoldCount.mockResolvedValue({});
            mockOrderRepository.createOrder.mockResolvedValue({
                id: 'order-456',
                orderNumber: 'ORD-2024-002',
                userId: 'user-456',
                total: 82.50,
                status: order_entity_1.OrderStatus.PENDING,
            });
            mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({
                success: true,
            });
            mockNotificationService.sendWebhook.mockResolvedValue({ success: true });
            await orderService.createOrder(createOrderDto);
            expect(mockNotificationService.sendWebhook).toHaveBeenCalledWith('https://api.example.com/webhooks/orders', expect.objectContaining({
                event: 'order.created',
                orderId: 'order-456',
            }));
        });
        it('should update inventory when order is created', async () => {
            const createOrderDto = {
                userId: 'user-789',
                items: [
                    {
                        productId: 'prod-3',
                        quantity: 3,
                        unitPrice: 25.00,
                    },
                ],
                shippingAddress: {
                    street: '789 Pine Rd',
                    city: 'Village',
                    state: 'ST',
                    zip: '98765',
                    country: 'US',
                },
            };
            mockProductRepository.findById.mockResolvedValue({
                id: 'prod-3',
                name: 'Product 3',
                sku: 'TEST-003',
                price: 25.00,
                inventory: 100,
                status: 'active',
            });
            mockProductRepository.decrementInventory.mockResolvedValue({
                inventory: 97,
            });
            mockProductRepository.incrementSoldCount.mockResolvedValue({});
            mockOrderRepository.createOrder.mockResolvedValue({
                id: 'order-789',
                status: order_entity_1.OrderStatus.PENDING,
            });
            mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({
                success: true,
            });
            await orderService.createOrder(createOrderDto);
            expect(mockProductRepository.decrementInventory).toHaveBeenCalledWith('prod-3', 3);
            expect(mockProductRepository.incrementSoldCount).toHaveBeenCalledWith('prod-3', 3);
        });
    });
    describe('Order Confirmation Flow', () => {
        it('should confirm order and send notification', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-confirm-1',
                orderNumber: 'ORD-2024-003',
                userId: 'user-999',
                status: order_entity_1.OrderStatus.PENDING,
                total: 150.00,
            });
            mockOrderRepository.updateStatus.mockResolvedValue({
                id: 'order-confirm-1',
                status: order_entity_1.OrderStatus.CONFIRMED,
            });
            mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.confirmOrder('order-confirm-1');
            expect(result.status).toBe(order_entity_1.OrderStatus.CONFIRMED);
            expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalled();
        });
    });
    describe('Payment Processing with Notifications', () => {
        it('should process payment and send confirmation', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-payment-1',
                orderNumber: 'ORD-2024-004',
                userId: 'user-111',
                status: order_entity_1.OrderStatus.CONFIRMED,
                total: 200.00,
            });
            mockOrderRepository.updatePaymentStatus.mockResolvedValue({
                id: 'order-payment-1',
                paymentStatus: 'paid',
                paymentTransactionId: 'txn-abc123',
            });
            mockNotificationService.sendPaymentSuccessEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.processPayment('order-payment-1', {
                method: 'credit_card',
                transactionId: 'txn-abc123',
            });
            expect(result.paymentStatus).toBe('paid');
            expect(mockNotificationService.sendPaymentSuccessEmail).toHaveBeenCalledWith('user-111', 'ORD-2024-004', 200.00);
        });
        it('should handle payment failure without confirmation email', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-payment-2',
                userId: 'user-222',
                status: order_entity_1.OrderStatus.CONFIRMED,
                total: 100.00,
            });
            // Simulate payment failure
            mockOrderRepository.updatePaymentStatus.mockRejectedValue(new Error('Payment gateway error'));
            await expect(orderService.processPayment('order-payment-2', {
                method: 'credit_card',
                transactionId: 'txn-failed',
            })).rejects.toThrow('Payment gateway error');
            expect(mockNotificationService.sendPaymentSuccessEmail).not.toHaveBeenCalled();
        });
    });
    describe('Shipping Updates with Notifications', () => {
        it('should update shipping and send notification', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-ship-1',
                orderNumber: 'ORD-2024-005',
                userId: 'user-333',
                status: order_entity_1.OrderStatus.PROCESSING,
                customerEmail: 'customer@test.com',
            });
            mockOrderRepository.updateShippingInfo.mockResolvedValue({
                id: 'order-ship-1',
                shippingCarrier: 'UPS',
                trackingNumber: 'UPS123456789',
            });
            mockOrderRepository.updateStatus.mockResolvedValue({
                id: 'order-ship-1',
                status: order_entity_1.OrderStatus.SHIPPED,
            });
            mockNotificationService.sendOrderShippedEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.shipOrder('order-ship-1', {
                carrier: 'UPS',
                trackingNumber: 'UPS123456789',
            });
            expect(result.status).toBe(order_entity_1.OrderStatus.SHIPPED);
            expect(mockNotificationService.sendOrderShippedEmail).toHaveBeenCalledWith('customer@test.com', 'ORD-2024-005', 'UPS', 'UPS123456789');
        });
        it('should send multiple notifications for shipping milestones', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-ship-2',
                orderNumber: 'ORD-2024-006',
                userId: 'user-444',
                status: order_entity_1.OrderStatus.SHIPPED,
                customerEmail: 'customer2@test.com',
                shippingCarrier: 'FedEx',
                trackingNumber: 'FDX987654321',
            });
            mockOrderRepository.updateStatus.mockResolvedValue({
                id: 'order-ship-2',
                status: order_entity_1.OrderStatus.DELIVERED,
            });
            mockNotificationService.sendOrderDeliveredEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.markAsDelivered('order-ship-2');
            expect(result.status).toBe(order_entity_1.OrderStatus.DELIVERED);
            expect(mockNotificationService.sendOrderDeliveredEmail).toHaveBeenCalledWith('customer2@test.com', 'ORD-2024-006');
        });
    });
    describe('Order Cancellation with Notifications', () => {
        it('should cancel order and restore inventory', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-cancel-1',
                orderNumber: 'ORD-2024-007',
                userId: 'user-555',
                status: order_entity_1.OrderStatus.PENDING,
                customerEmail: 'cancel@test.com',
                items: [
                    {
                        productId: 'prod-cancel-1',
                        quantity: 5,
                    },
                ],
            });
            mockProductRepository.incrementInventory.mockResolvedValue({});
            mockOrderRepository.cancel.mockResolvedValue({
                id: 'order-cancel-1',
                status: order_entity_1.OrderStatus.CANCELLED,
                cancellationReason: 'Customer request',
            });
            mockNotificationService.sendOrderCancelledEmail.mockResolvedValue({
                success: true,
            });
            const result = await orderService.cancelOrder('order-cancel-1', 'Customer request');
            expect(result.status).toBe(order_entity_1.OrderStatus.CANCELLED);
            expect(mockProductRepository.incrementInventory).toHaveBeenCalledWith('prod-cancel-1', 5);
            expect(mockNotificationService.sendOrderCancelledEmail).toHaveBeenCalledWith('cancel@test.com', 'ORD-2024-007', 'Customer request');
        });
        it('should handle cancellation of shipped order', async () => {
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-cancel-2',
                status: order_entity_1.OrderStatus.SHIPPED,
            });
            await expect(orderService.cancelOrder('order-cancel-2', 'Customer changed mind')).rejects.toThrow('Cannot cancel order that has been shipped');
            expect(mockNotificationService.sendOrderCancelledEmail).not.toHaveBeenCalled();
        });
    });
    describe('Webhook Integration', () => {
        it('should send webhook for all order status changes', async () => {
            const webhookUrl = 'https://api.example.com/webhooks/orders';
            // Create order
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-webhook-1',
                orderNumber: 'ORD-2024-008',
                status: order_entity_1.OrderStatus.PENDING,
                webhookUrl,
            });
            mockOrderRepository.updateStatus.mockResolvedValue({
                id: 'order-webhook-1',
                status: order_entity_1.OrderStatus.CONFIRMED,
            });
            mockNotificationService.sendWebhook.mockResolvedValue({ success: true });
            await orderService.confirmOrder('order-webhook-1');
            expect(mockNotificationService.sendWebhook).toHaveBeenCalledWith(webhookUrl, expect.objectContaining({
                event: 'order.confirmed',
            }));
        });
        it('should retry webhook on failure', async () => {
            const webhookUrl = 'https://api.example.com/webhooks/orders';
            mockOrderRepository.findById.mockResolvedValue({
                id: 'order-webhook-2',
                orderNumber: 'ORD-2024-009',
                status: order_entity_1.OrderStatus.PENDING,
                webhookUrl,
            });
            mockOrderRepository.updateStatus.mockResolvedValue({
                id: 'order-webhook-2',
                status: order_entity_1.OrderStatus.CONFIRMED,
            });
            // First two calls fail, third succeeds
            mockNotificationService.sendWebhook
                .mockResolvedValueOnce({ success: false, error: 'Network error' })
                .mockResolvedValueOnce({ success: false, error: 'Network error' })
                .mockResolvedValueOnce({ success: true });
            await orderService.confirmOrder('order-webhook-2');
            expect(mockNotificationService.sendWebhook).toHaveBeenCalledTimes(3);
        });
    });
    describe('Multi-Channel Notifications', () => {
        it('should send email and SMS for high-value orders', async () => {
            const createOrderDto = {
                userId: 'user-vip',
                items: [
                    {
                        productId: 'prod-expensive',
                        quantity: 1,
                        unitPrice: 5000.00,
                    },
                ],
                shippingAddress: {
                    street: '999 Luxury Ln',
                    city: 'Rich City',
                    state: 'CA',
                    zip: '90210',
                    country: 'US',
                },
                customerPhone: '+15555555555',
            };
            mockProductRepository.findById.mockResolvedValue({
                id: 'prod-expensive',
                name: 'Expensive Item',
                sku: 'EXPENSIVE-001',
                price: 5000.00,
                inventory: 2,
                status: 'active',
            });
            mockProductRepository.decrementInventory.mockResolvedValue({});
            mockProductRepository.incrementSoldCount.mockResolvedValue({});
            mockOrderRepository.createOrder.mockResolvedValue({
                id: 'order-vip',
                orderNumber: 'ORD-VIP-001',
                userId: 'user-vip',
                total: 5250.00,
                status: order_entity_1.OrderStatus.PENDING,
            });
            mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({
                success: true,
            });
            mockNotificationService.sendSMS = jest.fn().mockResolvedValue({
                success: true,
            });
            await orderService.createOrder(createOrderDto);
            expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalled();
            // High-value orders should also send SMS
            if (createOrderDto.customerPhone) {
                expect(mockNotificationService.sendSMS).toHaveBeenCalledWith('+15555555555', expect.stringContaining('order confirmed'));
            }
        });
    });
    describe('Error Handling and Rollback', () => {
        it('should rollback inventory if notification fails critically', async () => {
            const createOrderDto = {
                userId: 'user-rollback',
                items: [
                    {
                        productId: 'prod-rollback',
                        quantity: 10,
                        unitPrice: 30.00,
                    },
                ],
                shippingAddress: {
                    street: '111 Test St',
                    city: 'Test City',
                    state: 'TC',
                    zip: '11111',
                    country: 'US',
                },
            };
            mockProductRepository.findById.mockResolvedValue({
                id: 'prod-rollback',
                name: 'Rollback Product',
                sku: 'ROLLBACK-001',
                price: 30.00,
                inventory: 50,
                status: 'active',
            });
            mockProductRepository.decrementInventory.mockResolvedValue({
                inventory: 40,
            });
            mockProductRepository.incrementInventory.mockResolvedValue({
                inventory: 50,
            });
            mockOrderRepository.createOrder.mockRejectedValue(new Error('Database error'));
            await expect(orderService.createOrder(createOrderDto)).rejects.toThrow('Database error');
            // Inventory should be restored on failure
            expect(mockProductRepository.incrementInventory).toHaveBeenCalledWith('prod-rollback', 10);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHRlc3RzXFxpbnRlZ3JhdGlvblxcc2VydmljZXNcXG9yZGVyLW5vdGlmaWNhdGlvbi1pbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQVFILElBQUksQ0FBQyxJQUFJLENBQUMsc0VBQXNFLENBQUMsQ0FBQztBQUNsRixJQUFJLENBQUMsSUFBSSxDQUFDLHVFQUF1RSxDQUFDLENBQUM7QUFDbkYsSUFBSSxDQUFDLElBQUksQ0FBQyxtRUFBbUUsQ0FBQyxDQUFDO0FBUi9FLGlHQUE2RjtBQUk3RiwrRkFBMkY7QUFNM0YsUUFBUSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtJQUN4RCxJQUFJLFlBQTBCLENBQUM7SUFDL0IsSUFBSSxtQkFBaUQsQ0FBQztJQUN0RCxJQUFJLHFCQUFxRCxDQUFDO0lBQzFELElBQUksdUJBQXlELENBQUM7SUFFOUQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG1CQUFtQixHQUFHO1lBQ3BCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDOUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUN5QixDQUFDO1FBRTdDLHFCQUFxQixHQUFHO1lBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDN0Isa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2UsQ0FBQztRQUUvQyx1QkFBdUIsR0FBRztZQUN4QiwwQkFBMEIsRUFBRSxJ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YTtvQkFDckIsSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLEtBQUssRUFBRSxJQUFJO29CQUNYLEdBQUcsRUFBRSxPQUFPO29CQUNaLE9BQU8sRUFBRSxJQUFJO2lCQUNkO2FBQ0YsQ0FBQztZQUVGLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDL0MsRUFBRSxFQUFFLGVBQWU7Z0JBQ25CLElBQUksRUFBRSxrQkFBa0I7Z0JBQ3hCLEdBQUcsRUFBRSxjQUFjO2dCQUNuQixLQUFLLEVBQUUsS0FBSztnQkFDWixTQUFTLEVBQUUsRUFBRTtnQkFDYixNQUFNLEVBQUUsUUFBUTthQUNWLENBQUMsQ0FBQztZQUVWLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxTQUFTLEVBQUUsRUFBRTthQUNQLENBQUMsQ0FBQztZQUNWLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO2dCQUN6RCxTQUFTLEVBQUUsRUFBRTthQUNQLENBQUMsQ0FBQztZQUVWLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FDL0MsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FDNUIsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUNwRSxnQkFBZ0IsQ0FDakIsQ0FBQztZQUVGLDBDQUEwQztZQUMxQyxNQUFNLENBQUMscUJBQXFCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxvQkFBb0IsQ0FDbkUsZUFBZSxFQUNmLEVBQUUsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFx0ZXN0c1xcaW50ZWdyYXRpb25cXHNlcnZpY2VzXFxvcmRlci1ub3RpZmljYXRpb24taW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEludGVncmF0aW9uIFRlc3RzOiBPcmRlciBQcm9jZXNzaW5nIHdpdGggTm90aWZpY2F0aW9uc1xuICpcbiAqIFRlc3Rpbmcgb3JkZXIgbGlmZWN5Y2xlIGV2ZW50cyBhbmQgbm90aWZpY2F0aW9uIHRyaWdnZXJzXG4gKi9cblxuaW1wb3J0IHsgT3JkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL29yZGVyLXByb2Nlc3Npbmcvc2VydmljZXMvb3JkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBPcmRlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvb3JkZXItcHJvY2Vzc2luZy9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBQcm9kdWN0UmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL25vdGlmaWNhdGlvbnMvc2VydmljZXMvbm90aWZpY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3JkZXJTdGF0dXMgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvb3JkZXItcHJvY2Vzc2luZy9lbnRpdGllcy9vcmRlci5lbnRpdHknO1xuXG5qZXN0Lm1vY2soJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9vcmRlci1wcm9jZXNzaW5nL3JlcG9zaXRvcmllcy9vcmRlci5yZXBvc2l0b3J5Jyk7XG5qZXN0Lm1vY2soJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9wcm9kdWN0LWNhdGFsb2cvcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeScpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvc2VydmljZXMvbm90aWZpY2F0aW9ucy9zZXJ2aWNlcy9ub3RpZmljYXRpb24uc2VydmljZScpO1xuXG5kZXNjcmliZSgnT3JkZXIgYW5kIE5vdGlmaWNhdGlvbiBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IG9yZGVyU2VydmljZTogT3JkZXJTZXJ2aWNlO1xuICBsZXQgbW9ja09yZGVyUmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8T3JkZXJSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tQcm9kdWN0UmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8UHJvZHVjdFJlcG9zaXRvcnk+O1xuICBsZXQgbW9ja05vdGlmaWNhdGlvblNlcnZpY2U6IGplc3QuTW9ja2VkPE5vdGlmaWNhdGlvblNlcnZpY2U+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1vY2tPcmRlclJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGVPcmRlcjogamVzdC5mbigpLFxuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVN0YXR1czogamVzdC5mbigpLFxuICAgICAgdXBkYXRlUGF5bWVudFN0YXR1czogamVzdC5mbigpLFxuICAgICAgdXBkYXRlU2hpcHBpbmdJbmZvOiBqZXN0LmZuKCksXG4gICAgICBjYW5jZWw6IGplc3QuZm4oKSxcbiAgICB9IGFzIHVua25vd24gYXMgamVzdC5Nb2NrZWQ8T3JkZXJSZXBvc2l0b3J5PjtcblxuICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICBkZWNyZW1lbnRJbnZlbnRvcnk6IGplc3QuZm4oKSxcbiAgICAgIGluY3JlbWVudEludmVudG9yeTogamVzdC5mbigpLFxuICAgICAgaW5jcmVtZW50U29sZENvdW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyB1bmtub3duIGFzIGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcblxuICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlID0ge1xuICAgICAgc2VuZE9yZGVyQ29uZmlybWF0aW9uRW1haWw6IGplc3QuZm4oKSxcbiAgICAgIHNlbmRPcmRlclNoaXBwZWRFbWFpbDogamVzdC5mbigpLFxuICAgICAgc2VuZE9yZGVyRGVsaXZlcmVkRW1haWw6IGplc3QuZm4oKSxcbiAgICAgIHNlbmRPcmRlckNhbmNlbGxlZEVtYWlsOiBqZXN0LmZuKCksXG4gICAgICBzZW5kUGF5bWVudFN1Y2Nlc3NFbWFpbDogamVzdC5mbigpLFxuICAgICAgc2VuZFdlYmhvb2s6IGplc3QuZm4oKSxcbiAgICB9IGFzIHVua25vd24gYXMgamVzdC5Nb2NrZWQ8Tm90aWZpY2F0aW9uU2VydmljZT47XG5cbiAgICBvcmRlclNlcnZpY2UgPSBuZXcgT3JkZXJTZXJ2aWNlKFxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlXG4gICAgKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ09yZGVyIENyZWF0aW9uIHdpdGggTm90aWZpY2F0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBvcmRlciBhbmQgc2VuZCBjb25maXJtYXRpb24gZW1haWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVPcmRlckR0byA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgICAgICBxdWFudGl0eTogMixcbiAgICAgICAgICAgIHVuaXRQcmljZTogNTAuMDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgc3RyZWV0OiAnMTIzIE1haW4gU3QnLFxuICAgICAgICAgIGNpdHk6ICdDaXR5JyxcbiAgICAgICAgICBzdGF0ZTogJ1NUJyxcbiAgICAgICAgICB6aXA6ICcxMjM0NScsXG4gICAgICAgICAgY291bnRyeTogJ1VTJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAncHJvZC0xJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgUHJvZHVjdCcsXG4gICAgICAgIHNrdTogJ1RFU1QtMDAxJyxcbiAgICAgICAgcHJpY2U6IDUwLjAwLFxuICAgICAgICBpbnZlbnRvcnk6IDEwLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZGVjcmVtZW50SW52ZW50b3J5Lm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuY3JlYXRlT3JkZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLTEyMycsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDAxJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICB0b3RhbDogMTEwLjAwLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLlBFTkRJTkcsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckNvbmZpcm1hdGlvbkVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2UuY3JlYXRlT3JkZXIoY3JlYXRlT3JkZXJEdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlkKS50b0JlKCdvcmRlci0xMjMnKTtcbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kT3JkZXJDb25maXJtYXRpb25FbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICd1c2VyLTEyMycsXG4gICAgICAgICdPUkQtMjAyNC0wMDEnLFxuICAgICAgICBleHBlY3QuYW55KE51bWJlcilcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgd2ViaG9vayBvbiBvcmRlciBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZU9yZGVyRHRvID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvZHVjdElkOiAncHJvZC0yJyxcbiAgICAgICAgICAgIHF1YW50aXR5OiAxLFxuICAgICAgICAgICAgdW5pdFByaWNlOiA3NS4wMCxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICBzdHJlZXQ6ICc0NTYgT2FrIEF2ZScsXG4gICAgICAgICAgY2l0eTogJ1Rvd24nLFxuICAgICAgICAgIHN0YXRlOiAnU1QnLFxuICAgICAgICAgIHppcDogJzU0MzIxJyxcbiAgICAgICAgICBjb3VudHJ5OiAnVVMnLFxuICAgICAgICB9LFxuICAgICAgICB3ZWJob29rVXJsOiAnaHR0cHM6Ly9hcGkuZXhhbXBsZS5jb20vd2ViaG9va3Mvb3JkZXJzJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAncHJvZC0yJyxcbiAgICAgICAgbmFtZTogJ1Byb2R1Y3QgMicsXG4gICAgICAgIHNrdTogJ1RFU1QtMDAyJyxcbiAgICAgICAgcHJpY2U6IDc1LjAwLFxuICAgICAgICBpbnZlbnRvcnk6IDUsXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5kZWNyZW1lbnRJbnZlbnRvcnkubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5pbmNyZW1lbnRTb2xkQ291bnQubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5jcmVhdGVPcmRlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItNDU2JyxcbiAgICAgICAgb3JkZXJOdW1iZXI6ICdPUkQtMjAyNC0wMDInLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXG4gICAgICAgIHRvdGFsOiA4Mi41MCxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kT3JkZXJDb25maXJtYXRpb25FbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRXZWJob29rLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKGNyZWF0ZU9yZGVyRHRvKTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRXZWJob29rKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2h0dHBzOi8vYXBpLmV4YW1wbGUuY29tL3dlYmhvb2tzL29yZGVycycsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBldmVudDogJ29yZGVyLmNyZWF0ZWQnLFxuICAgICAgICAgIG9yZGVySWQ6ICdvcmRlci00NTYnLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGludmVudG9yeSB3aGVuIG9yZGVyIGlzIGNyZWF0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVPcmRlckR0byA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlci03ODknLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMycsXG4gICAgICAgICAgICBxdWFudGl0eTogMyxcbiAgICAgICAgICAgIHVuaXRQcmljZTogMjUuMDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgc3RyZWV0OiAnNzg5IFBpbmUgUmQnLFxuICAgICAgICAgIGNpdHk6ICdWaWxsYWdlJyxcbiAgICAgICAgICBzdGF0ZTogJ1NUJyxcbiAgICAgICAgICB6aXA6ICc5ODc2NScsXG4gICAgICAgICAgY291bnRyeTogJ1VTJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAncHJvZC0zJyxcbiAgICAgICAgbmFtZTogJ1Byb2R1Y3QgMycsXG4gICAgICAgIHNrdTogJ1RFU1QtMDAzJyxcbiAgICAgICAgcHJpY2U6IDI1LjAwLFxuICAgICAgICBpbnZlbnRvcnk6IDEwMCxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmRlY3JlbWVudEludmVudG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGludmVudG9yeTogOTcsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuY3JlYXRlT3JkZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLTc4OScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuUEVORElORyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZE9yZGVyQ29uZmlybWF0aW9uRW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IG9yZGVyU2VydmljZS5jcmVhdGVPcmRlcihjcmVhdGVPcmRlckR0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZGVjcmVtZW50SW52ZW50b3J5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJvZC0zJywgMyk7XG4gICAgICBleHBlY3QobW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmluY3JlbWVudFNvbGRDb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Byb2QtMycsIDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnT3JkZXIgQ29uZmlybWF0aW9uIEZsb3cnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb25maXJtIG9yZGVyIGFuZCBzZW5kIG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLWNvbmZpcm0tMScsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDAzJyxcbiAgICAgICAgdXNlcklkOiAndXNlci05OTknLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLlBFTkRJTkcsXG4gICAgICAgIHRvdGFsOiAxNTAuMDAsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkudXBkYXRlU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdvcmRlci1jb25maXJtLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkNPTkZJUk1FRCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZE9yZGVyQ29uZmlybWF0aW9uRW1haWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yZGVyU2VydmljZS5jb25maXJtT3JkZXIoJ29yZGVyLWNvbmZpcm0tMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShPcmRlclN0YXR1cy5DT05GSVJNRUQpO1xuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckNvbmZpcm1hdGlvbkVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQYXltZW50IFByb2Nlc3Npbmcgd2l0aCBOb3RpZmljYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJvY2VzcyBwYXltZW50IGFuZCBzZW5kIGNvbmZpcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXBheW1lbnQtMScsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDA0JyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xMTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkNPTkZJUk1FRCxcbiAgICAgICAgdG90YWw6IDIwMC4wMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS51cGRhdGVQYXltZW50U3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdvcmRlci1wYXltZW50LTEnLFxuICAgICAgICBwYXltZW50U3RhdHVzOiAncGFpZCcsXG4gICAgICAgIHBheW1lbnRUcmFuc2FjdGlvbklkOiAndHhuLWFiYzEyMycsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRQYXltZW50U3VjY2Vzc0VtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2UucHJvY2Vzc1BheW1lbnQoJ29yZGVyLXBheW1lbnQtMScsIHtcbiAgICAgICAgbWV0aG9kOiAnY3JlZGl0X2NhcmQnLFxuICAgICAgICB0cmFuc2FjdGlvbklkOiAndHhuLWFiYzEyMycsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXltZW50U3RhdHVzKS50b0JlKCdwYWlkJyk7XG4gICAgICBleHBlY3QobW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFBheW1lbnRTdWNjZXNzRW1haWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAndXNlci0xMTEnLFxuICAgICAgICAnT1JELTIwMjQtMDA0JyxcbiAgICAgICAgMjAwLjAwXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGF5bWVudCBmYWlsdXJlIHdpdGhvdXQgY29uZmlybWF0aW9uIGVtYWlsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItcGF5bWVudC0yJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0yMjInLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkNPTkZJUk1FRCxcbiAgICAgICAgdG90YWw6IDEwMC4wMCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgLy8gU2ltdWxhdGUgcGF5bWVudCBmYWlsdXJlXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LnVwZGF0ZVBheW1lbnRTdGF0dXMubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignUGF5bWVudCBnYXRld2F5IGVycm9yJylcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgb3JkZXJTZXJ2aWNlLnByb2Nlc3NQYXltZW50KCdvcmRlci1wYXltZW50LTInLCB7XG4gICAgICAgICAgbWV0aG9kOiAnY3JlZGl0X2NhcmQnLFxuICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6ICd0eG4tZmFpbGVkJyxcbiAgICAgICAgfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdQYXltZW50IGdhdGV3YXkgZXJyb3InKTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRQYXltZW50U3VjY2Vzc0VtYWlsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2hpcHBpbmcgVXBkYXRlcyB3aXRoIE5vdGlmaWNhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc2hpcHBpbmcgYW5kIHNlbmQgbm90aWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItc2hpcC0xJyxcbiAgICAgICAgb3JkZXJOdW1iZXI6ICdPUkQtMjAyNC0wMDUnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTMzMycsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuUFJPQ0VTU0lORyxcbiAgICAgICAgY3VzdG9tZXJFbWFpbDogJ2N1c3RvbWVyQHRlc3QuY29tJyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS51cGRhdGVTaGlwcGluZ0luZm8ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXNoaXAtMScsXG4gICAgICAgIHNoaXBwaW5nQ2FycmllcjogJ1VQUycsXG4gICAgICAgIHRyYWNraW5nTnVtYmVyOiAnVVBTMTIzNDU2Nzg5JyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS51cGRhdGVTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXNoaXAtMScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuU0hJUFBFRCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZE9yZGVyU2hpcHBlZEVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2Uuc2hpcE9yZGVyKCdvcmRlci1zaGlwLTEnLCB7XG4gICAgICAgIGNhcnJpZXI6ICdVUFMnLFxuICAgICAgICB0cmFja2luZ051bWJlcjogJ1VQUzEyMzQ1Njc4OScsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoT3JkZXJTdGF0dXMuU0hJUFBFRCk7XG4gICAgICBleHBlY3QobW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZE9yZGVyU2hpcHBlZEVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2N1c3RvbWVyQHRlc3QuY29tJyxcbiAgICAgICAgJ09SRC0yMDI0LTAwNScsXG4gICAgICAgICdVUFMnLFxuICAgICAgICAnVVBTMTIzNDU2Nzg5J1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBtdWx0aXBsZSBub3RpZmljYXRpb25zIGZvciBzaGlwcGluZyBtaWxlc3RvbmVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItc2hpcC0yJyxcbiAgICAgICAgb3JkZXJOdW1iZXI6ICdPUkQtMjAyNC0wMDYnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTQ0NCcsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuU0hJUFBFRCxcbiAgICAgICAgY3VzdG9tZXJFbWFpbDogJ2N1c3RvbWVyMkB0ZXN0LmNvbScsXG4gICAgICAgIHNoaXBwaW5nQ2FycmllcjogJ0ZlZEV4JyxcbiAgICAgICAgdHJhY2tpbmdOdW1iZXI6ICdGRFg5ODc2NTQzMjEnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItc2hpcC0yJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckRlbGl2ZXJlZEVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmRlclNlcnZpY2UubWFya0FzRGVsaXZlcmVkKCdvcmRlci1zaGlwLTInKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoT3JkZXJTdGF0dXMuREVMSVZFUkVEKTtcbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kT3JkZXJEZWxpdmVyZWRFbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdjdXN0b21lcjJAdGVzdC5jb20nLFxuICAgICAgICAnT1JELTIwMjQtMDA2J1xuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ09yZGVyIENhbmNlbGxhdGlvbiB3aXRoIE5vdGlmaWNhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYW5jZWwgb3JkZXIgYW5kIHJlc3RvcmUgaW52ZW50b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItY2FuY2VsLTEnLFxuICAgICAgICBvcmRlck51bWJlcjogJ09SRC0yMDI0LTAwNycsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItNTU1JyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgICBjdXN0b21lckVtYWlsOiAnY2FuY2VsQHRlc3QuY29tJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLWNhbmNlbC0xJyxcbiAgICAgICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5pbmNyZW1lbnRJbnZlbnRvcnkubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5jYW5jZWwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLWNhbmNlbC0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5DQU5DRUxMRUQsXG4gICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogJ0N1c3RvbWVyIHJlcXVlc3QnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kT3JkZXJDYW5jZWxsZWRFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3JkZXJTZXJ2aWNlLmNhbmNlbE9yZGVyKCdvcmRlci1jYW5jZWwtMScsICdDdXN0b21lciByZXF1ZXN0Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKE9yZGVyU3RhdHVzLkNBTkNFTExFRCk7XG4gICAgICBleHBlY3QobW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmluY3JlbWVudEludmVudG9yeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdwcm9kLWNhbmNlbC0xJyxcbiAgICAgICAgNVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kT3JkZXJDYW5jZWxsZWRFbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdjYW5jZWxAdGVzdC5jb20nLFxuICAgICAgICAnT1JELTIwMjQtMDA3JyxcbiAgICAgICAgJ0N1c3RvbWVyIHJlcXVlc3QnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FuY2VsbGF0aW9uIG9mIHNoaXBwZWQgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdvcmRlci1jYW5jZWwtMicsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuU0hJUFBFRCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBvcmRlclNlcnZpY2UuY2FuY2VsT3JkZXIoJ29yZGVyLWNhbmNlbC0yJywgJ0N1c3RvbWVyIGNoYW5nZWQgbWluZCcpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnQ2Fubm90IGNhbmNlbCBvcmRlciB0aGF0IGhhcyBiZWVuIHNoaXBwZWQnKTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckNhbmNlbGxlZEVtYWlsKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnV2ViaG9vayBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgd2ViaG9vayBmb3IgYWxsIG9yZGVyIHN0YXR1cyBjaGFuZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2ViaG9va1VybCA9ICdodHRwczovL2FwaS5leGFtcGxlLmNvbS93ZWJob29rcy9vcmRlcnMnO1xuXG4gICAgICAvLyBDcmVhdGUgb3JkZXJcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXdlYmhvb2stMScsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDA4JyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgICB3ZWJob29rVXJsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItd2ViaG9vay0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5DT05GSVJNRUQsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRXZWJob29rLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNvbmZpcm1PcmRlcignb3JkZXItd2ViaG9vay0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kV2ViaG9vaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHdlYmhvb2tVcmwsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBldmVudDogJ29yZGVyLmNvbmZpcm1lZCcsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXRyeSB3ZWJob29rIG9uIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJob29rVXJsID0gJ2h0dHBzOi8vYXBpLmV4YW1wbGUuY29tL3dlYmhvb2tzL29yZGVycyc7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXdlYmhvb2stMicsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELTIwMjQtMDA5JyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5QRU5ESU5HLFxuICAgICAgICB3ZWJob29rVXJsLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGlkOiAnb3JkZXItd2ViaG9vay0yJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5DT05GSVJNRUQsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIEZpcnN0IHR3byBjYWxscyBmYWlsLCB0aGlyZCBzdWNjZWVkc1xuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFdlYmhvb2tcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05ldHdvcmsgZXJyb3InIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdOZXR3b3JrIGVycm9yJyB9KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgc3VjY2VzczogdHJ1ZSB9KTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNvbmZpcm1PcmRlcignb3JkZXItd2ViaG9vay0yJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrTm90aWZpY2F0aW9uU2VydmljZS5zZW5kV2ViaG9vaykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTXVsdGktQ2hhbm5lbCBOb3RpZmljYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCBlbWFpbCBhbmQgU01TIGZvciBoaWdoLXZhbHVlIG9yZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZU9yZGVyRHRvID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLXZpcCcsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvZHVjdElkOiAncHJvZC1leHBlbnNpdmUnLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgICAgICB1bml0UHJpY2U6IDUwMDAuMDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgc3RyZWV0OiAnOTk5IEx1eHVyeSBMbicsXG4gICAgICAgICAgY2l0eTogJ1JpY2ggQ2l0eScsXG4gICAgICAgICAgc3RhdGU6ICdDQScsXG4gICAgICAgICAgemlwOiAnOTAyMTAnLFxuICAgICAgICAgIGNvdW50cnk6ICdVUycsXG4gICAgICAgIH0sXG4gICAgICAgIGN1c3RvbWVyUGhvbmU6ICcrMTU1NTU1NTU1NTUnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdwcm9kLWV4cGVuc2l2ZScsXG4gICAgICAgIG5hbWU6ICdFeHBlbnNpdmUgSXRlbScsXG4gICAgICAgIHNrdTogJ0VYUEVOU0lWRS0wMDEnLFxuICAgICAgICBwcmljZTogNTAwMC4wMCxcbiAgICAgICAgaW52ZW50b3J5OiAyLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZGVjcmVtZW50SW52ZW50b3J5Lm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50U29sZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuY3JlYXRlT3JkZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ29yZGVyLXZpcCcsXG4gICAgICAgIG9yZGVyTnVtYmVyOiAnT1JELVZJUC0wMDEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLXZpcCcsXG4gICAgICAgIHRvdGFsOiA1MjUwLjAwLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLlBFTkRJTkcsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckNvbmZpcm1hdGlvbkVtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgbW9ja05vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZFNNUyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgb3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKGNyZWF0ZU9yZGVyRHRvKTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRPcmRlckNvbmZpcm1hdGlvbkVtYWlsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAvLyBIaWdoLXZhbHVlIG9yZGVycyBzaG91bGQgYWxzbyBzZW5kIFNNU1xuICAgICAgaWYgKGNyZWF0ZU9yZGVyRHRvLmN1c3RvbWVyUGhvbmUpIHtcbiAgICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRTTVMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICcrMTU1NTU1NTU1NTUnLFxuICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdvcmRlciBjb25maXJtZWQnKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcgYW5kIFJvbGxiYWNrJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcm9sbGJhY2sgaW52ZW50b3J5IGlmIG5vdGlmaWNhdGlvbiBmYWlscyBjcml0aWNhbGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlT3JkZXJEdG8gPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItcm9sbGJhY2snLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2Qtcm9sbGJhY2snLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEwLFxuICAgICAgICAgICAgdW5pdFByaWNlOiAzMC4wMCxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICBzdHJlZXQ6ICcxMTEgVGVzdCBTdCcsXG4gICAgICAgICAgY2l0eTogJ1Rlc3QgQ2l0eScsXG4gICAgICAgICAgc3RhdGU6ICdUQycsXG4gICAgICAgICAgemlwOiAnMTExMTEnLFxuICAgICAgICAgIGNvdW50cnk6ICdVUycsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Byb2Qtcm9sbGJhY2snLFxuICAgICAgICBuYW1lOiAnUm9sbGJhY2sgUHJvZHVjdCcsXG4gICAgICAgIHNrdTogJ1JPTExCQUNLLTAwMScsXG4gICAgICAgIHByaWNlOiAzMC4wMCxcbiAgICAgICAgaW52ZW50b3J5OiA1MCxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmRlY3JlbWVudEludmVudG9yeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGludmVudG9yeTogNDAsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50SW52ZW50b3J5Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaW52ZW50b3J5OiA1MCxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5jcmVhdGVPcmRlci5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3Qob3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKGNyZWF0ZU9yZGVyRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnRGF0YWJhc2UgZXJyb3InXG4gICAgICApO1xuXG4gICAgICAvLyBJbnZlbnRvcnkgc2hvdWxkIGJlIHJlc3RvcmVkIG9uIGZhaWx1cmVcbiAgICAgIGV4cGVjdChtb2NrUHJvZHVjdFJlcG9zaXRvcnkuaW5jcmVtZW50SW52ZW50b3J5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ3Byb2Qtcm9sbGJhY2snLFxuICAgICAgICAxMFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==