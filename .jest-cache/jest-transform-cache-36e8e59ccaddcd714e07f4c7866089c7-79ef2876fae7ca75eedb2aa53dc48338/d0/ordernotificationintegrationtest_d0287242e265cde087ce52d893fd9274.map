{"file":"C:\\Adaptive_Testing\\tests\\integration\\services\\order-notification-integration.test.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\tests\\integration\\services\\order-notification-integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: Order Processing with Notifications\n *\n * Testing order lifecycle events and notification triggers\n */\n\nimport { OrderService } from '../../../src/services/order-processing/services/order.service';\nimport { OrderRepository } from '../../../src/services/order-processing/repositories/order.repository';\nimport { ProductRepository } from '../../../src/services/product-catalog/repositories/product.repository';\nimport { NotificationService } from '../../../src/services/notifications/services/notification.service';\nimport { OrderStatus } from '../../../src/services/order-processing/entities/order.entity';\n\njest.mock('../../../src/services/order-processing/repositories/order.repository');\njest.mock('../../../src/services/product-catalog/repositories/product.repository');\njest.mock('../../../src/services/notifications/services/notification.service');\n\ndescribe('Order and Notification Integration Tests', () => {\n  let orderService: OrderService;\n  let mockOrderRepository: jest.Mocked<OrderRepository>;\n  let mockProductRepository: jest.Mocked<ProductRepository>;\n  let mockNotificationService: jest.Mocked<NotificationService>;\n\n  beforeEach(() => {\n    mockOrderRepository = {\n      createOrder: jest.fn(),\n      findById: jest.fn(),\n      updateStatus: jest.fn(),\n      updatePaymentStatus: jest.fn(),\n      updateShippingInfo: jest.fn(),\n      cancel: jest.fn(),\n    } as unknown as jest.Mocked<OrderRepository>;\n\n    mockProductRepository = {\n      findById: jest.fn(),\n      decrementInventory: jest.fn(),\n      incrementInventory: jest.fn(),\n      incrementSoldCount: jest.fn(),\n    } as unknown as jest.Mocked<ProductRepository>;\n\n    mockNotificationService = {\n      sendOrderConfirmationEmail: jest.fn(),\n      sendOrderShippedEmail: jest.fn(),\n      sendOrderDeliveredEmail: jest.fn(),\n      sendOrderCancelledEmail: jest.fn(),\n      sendPaymentSuccessEmail: jest.fn(),\n      sendWebhook: jest.fn(),\n    } as unknown as jest.Mocked<NotificationService>;\n\n    orderService = new OrderService(\n      mockOrderRepository,\n      mockProductRepository,\n      mockNotificationService\n    );\n  });\n\n  describe('Order Creation with Notifications', () => {\n    it('should create order and send confirmation email', async () => {\n      const createOrderDto = {\n        userId: 'user-123',\n        items: [\n          {\n            productId: 'prod-1',\n            quantity: 2,\n            unitPrice: 50.00,\n          },\n        ],\n        shippingAddress: {\n          street: '123 Main St',\n          city: 'City',\n          state: 'ST',\n          zip: '12345',\n          country: 'US',\n        },\n      };\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: 'prod-1',\n        name: 'Test Product',\n        sku: 'TEST-001',\n        price: 50.00,\n        inventory: 10,\n        status: 'active',\n      } as any);\n\n      mockProductRepository.decrementInventory.mockResolvedValue({} as any);\n      mockProductRepository.incrementSoldCount.mockResolvedValue({} as any);\n\n      mockOrderRepository.createOrder.mockResolvedValue({\n        id: 'order-123',\n        orderNumber: 'ORD-2024-001',\n        userId: 'user-123',\n        total: 110.00,\n        status: OrderStatus.PENDING,\n      } as any);\n\n      mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.createOrder(createOrderDto);\n\n      expect(result.id).toBe('order-123');\n      expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalledWith(\n        'user-123',\n        'ORD-2024-001',\n        expect.any(Number)\n      );\n    });\n\n    it('should send webhook on order creation', async () => {\n      const createOrderDto = {\n        userId: 'user-456',\n        items: [\n          {\n            productId: 'prod-2',\n            quantity: 1,\n            unitPrice: 75.00,\n          },\n        ],\n        shippingAddress: {\n          street: '456 Oak Ave',\n          city: 'Town',\n          state: 'ST',\n          zip: '54321',\n          country: 'US',\n        },\n        webhookUrl: 'https://api.example.com/webhooks/orders',\n      };\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: 'prod-2',\n        name: 'Product 2',\n        sku: 'TEST-002',\n        price: 75.00,\n        inventory: 5,\n        status: 'active',\n      } as any);\n\n      mockProductRepository.decrementInventory.mockResolvedValue({} as any);\n      mockProductRepository.incrementSoldCount.mockResolvedValue({} as any);\n\n      mockOrderRepository.createOrder.mockResolvedValue({\n        id: 'order-456',\n        orderNumber: 'ORD-2024-002',\n        userId: 'user-456',\n        total: 82.50,\n        status: OrderStatus.PENDING,\n      } as any);\n\n      mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({\n        success: true,\n      });\n      mockNotificationService.sendWebhook.mockResolvedValue({ success: true });\n\n      await orderService.createOrder(createOrderDto);\n\n      expect(mockNotificationService.sendWebhook).toHaveBeenCalledWith(\n        'https://api.example.com/webhooks/orders',\n        expect.objectContaining({\n          event: 'order.created',\n          orderId: 'order-456',\n        })\n      );\n    });\n\n    it('should update inventory when order is created', async () => {\n      const createOrderDto = {\n        userId: 'user-789',\n        items: [\n          {\n            productId: 'prod-3',\n            quantity: 3,\n            unitPrice: 25.00,\n          },\n        ],\n        shippingAddress: {\n          street: '789 Pine Rd',\n          city: 'Village',\n          state: 'ST',\n          zip: '98765',\n          country: 'US',\n        },\n      };\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: 'prod-3',\n        name: 'Product 3',\n        sku: 'TEST-003',\n        price: 25.00,\n        inventory: 100,\n        status: 'active',\n      } as any);\n\n      mockProductRepository.decrementInventory.mockResolvedValue({\n        inventory: 97,\n      } as any);\n      mockProductRepository.incrementSoldCount.mockResolvedValue({} as any);\n\n      mockOrderRepository.createOrder.mockResolvedValue({\n        id: 'order-789',\n        status: OrderStatus.PENDING,\n      } as any);\n\n      mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      await orderService.createOrder(createOrderDto);\n\n      expect(mockProductRepository.decrementInventory).toHaveBeenCalledWith('prod-3', 3);\n      expect(mockProductRepository.incrementSoldCount).toHaveBeenCalledWith('prod-3', 3);\n    });\n  });\n\n  describe('Order Confirmation Flow', () => {\n    it('should confirm order and send notification', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-confirm-1',\n        orderNumber: 'ORD-2024-003',\n        userId: 'user-999',\n        status: OrderStatus.PENDING,\n        total: 150.00,\n      } as any);\n\n      mockOrderRepository.updateStatus.mockResolvedValue({\n        id: 'order-confirm-1',\n        status: OrderStatus.CONFIRMED,\n      } as any);\n\n      mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.confirmOrder('order-confirm-1');\n\n      expect(result.status).toBe(OrderStatus.CONFIRMED);\n      expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalled();\n    });\n  });\n\n  describe('Payment Processing with Notifications', () => {\n    it('should process payment and send confirmation', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-payment-1',\n        orderNumber: 'ORD-2024-004',\n        userId: 'user-111',\n        status: OrderStatus.CONFIRMED,\n        total: 200.00,\n      } as any);\n\n      mockOrderRepository.updatePaymentStatus.mockResolvedValue({\n        id: 'order-payment-1',\n        paymentStatus: 'paid',\n        paymentTransactionId: 'txn-abc123',\n      } as any);\n\n      mockNotificationService.sendPaymentSuccessEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.processPayment('order-payment-1', {\n        method: 'credit_card',\n        transactionId: 'txn-abc123',\n      });\n\n      expect(result.paymentStatus).toBe('paid');\n      expect(mockNotificationService.sendPaymentSuccessEmail).toHaveBeenCalledWith(\n        'user-111',\n        'ORD-2024-004',\n        200.00\n      );\n    });\n\n    it('should handle payment failure without confirmation email', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-payment-2',\n        userId: 'user-222',\n        status: OrderStatus.CONFIRMED,\n        total: 100.00,\n      } as any);\n\n      // Simulate payment failure\n      mockOrderRepository.updatePaymentStatus.mockRejectedValue(\n        new Error('Payment gateway error')\n      );\n\n      await expect(\n        orderService.processPayment('order-payment-2', {\n          method: 'credit_card',\n          transactionId: 'txn-failed',\n        })\n      ).rejects.toThrow('Payment gateway error');\n\n      expect(mockNotificationService.sendPaymentSuccessEmail).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Shipping Updates with Notifications', () => {\n    it('should update shipping and send notification', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-ship-1',\n        orderNumber: 'ORD-2024-005',\n        userId: 'user-333',\n        status: OrderStatus.PROCESSING,\n        customerEmail: 'customer@test.com',\n      } as any);\n\n      mockOrderRepository.updateShippingInfo.mockResolvedValue({\n        id: 'order-ship-1',\n        shippingCarrier: 'UPS',\n        trackingNumber: 'UPS123456789',\n      } as any);\n\n      mockOrderRepository.updateStatus.mockResolvedValue({\n        id: 'order-ship-1',\n        status: OrderStatus.SHIPPED,\n      } as any);\n\n      mockNotificationService.sendOrderShippedEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.shipOrder('order-ship-1', {\n        carrier: 'UPS',\n        trackingNumber: 'UPS123456789',\n      });\n\n      expect(result.status).toBe(OrderStatus.SHIPPED);\n      expect(mockNotificationService.sendOrderShippedEmail).toHaveBeenCalledWith(\n        'customer@test.com',\n        'ORD-2024-005',\n        'UPS',\n        'UPS123456789'\n      );\n    });\n\n    it('should send multiple notifications for shipping milestones', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-ship-2',\n        orderNumber: 'ORD-2024-006',\n        userId: 'user-444',\n        status: OrderStatus.SHIPPED,\n        customerEmail: 'customer2@test.com',\n        shippingCarrier: 'FedEx',\n        trackingNumber: 'FDX987654321',\n      } as any);\n\n      mockOrderRepository.updateStatus.mockResolvedValue({\n        id: 'order-ship-2',\n        status: OrderStatus.DELIVERED,\n      } as any);\n\n      mockNotificationService.sendOrderDeliveredEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.markAsDelivered('order-ship-2');\n\n      expect(result.status).toBe(OrderStatus.DELIVERED);\n      expect(mockNotificationService.sendOrderDeliveredEmail).toHaveBeenCalledWith(\n        'customer2@test.com',\n        'ORD-2024-006'\n      );\n    });\n  });\n\n  describe('Order Cancellation with Notifications', () => {\n    it('should cancel order and restore inventory', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-cancel-1',\n        orderNumber: 'ORD-2024-007',\n        userId: 'user-555',\n        status: OrderStatus.PENDING,\n        customerEmail: 'cancel@test.com',\n        items: [\n          {\n            productId: 'prod-cancel-1',\n            quantity: 5,\n          },\n        ],\n      } as any);\n\n      mockProductRepository.incrementInventory.mockResolvedValue({} as any);\n\n      mockOrderRepository.cancel.mockResolvedValue({\n        id: 'order-cancel-1',\n        status: OrderStatus.CANCELLED,\n        cancellationReason: 'Customer request',\n      } as any);\n\n      mockNotificationService.sendOrderCancelledEmail.mockResolvedValue({\n        success: true,\n      });\n\n      const result = await orderService.cancelOrder('order-cancel-1', 'Customer request');\n\n      expect(result.status).toBe(OrderStatus.CANCELLED);\n      expect(mockProductRepository.incrementInventory).toHaveBeenCalledWith(\n        'prod-cancel-1',\n        5\n      );\n      expect(mockNotificationService.sendOrderCancelledEmail).toHaveBeenCalledWith(\n        'cancel@test.com',\n        'ORD-2024-007',\n        'Customer request'\n      );\n    });\n\n    it('should handle cancellation of shipped order', async () => {\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-cancel-2',\n        status: OrderStatus.SHIPPED,\n      } as any);\n\n      await expect(\n        orderService.cancelOrder('order-cancel-2', 'Customer changed mind')\n      ).rejects.toThrow('Cannot cancel order that has been shipped');\n\n      expect(mockNotificationService.sendOrderCancelledEmail).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Webhook Integration', () => {\n    it('should send webhook for all order status changes', async () => {\n      const webhookUrl = 'https://api.example.com/webhooks/orders';\n\n      // Create order\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-webhook-1',\n        orderNumber: 'ORD-2024-008',\n        status: OrderStatus.PENDING,\n        webhookUrl,\n      } as any);\n\n      mockOrderRepository.updateStatus.mockResolvedValue({\n        id: 'order-webhook-1',\n        status: OrderStatus.CONFIRMED,\n      } as any);\n\n      mockNotificationService.sendWebhook.mockResolvedValue({ success: true });\n\n      await orderService.confirmOrder('order-webhook-1');\n\n      expect(mockNotificationService.sendWebhook).toHaveBeenCalledWith(\n        webhookUrl,\n        expect.objectContaining({\n          event: 'order.confirmed',\n        })\n      );\n    });\n\n    it('should retry webhook on failure', async () => {\n      const webhookUrl = 'https://api.example.com/webhooks/orders';\n\n      mockOrderRepository.findById.mockResolvedValue({\n        id: 'order-webhook-2',\n        orderNumber: 'ORD-2024-009',\n        status: OrderStatus.PENDING,\n        webhookUrl,\n      } as any);\n\n      mockOrderRepository.updateStatus.mockResolvedValue({\n        id: 'order-webhook-2',\n        status: OrderStatus.CONFIRMED,\n      } as any);\n\n      // First two calls fail, third succeeds\n      mockNotificationService.sendWebhook\n        .mockResolvedValueOnce({ success: false, error: 'Network error' })\n        .mockResolvedValueOnce({ success: false, error: 'Network error' })\n        .mockResolvedValueOnce({ success: true });\n\n      await orderService.confirmOrder('order-webhook-2');\n\n      expect(mockNotificationService.sendWebhook).toHaveBeenCalledTimes(3);\n    });\n  });\n\n  describe('Multi-Channel Notifications', () => {\n    it('should send email and SMS for high-value orders', async () => {\n      const createOrderDto = {\n        userId: 'user-vip',\n        items: [\n          {\n            productId: 'prod-expensive',\n            quantity: 1,\n            unitPrice: 5000.00,\n          },\n        ],\n        shippingAddress: {\n          street: '999 Luxury Ln',\n          city: 'Rich City',\n          state: 'CA',\n          zip: '90210',\n          country: 'US',\n        },\n        customerPhone: '+15555555555',\n      };\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: 'prod-expensive',\n        name: 'Expensive Item',\n        sku: 'EXPENSIVE-001',\n        price: 5000.00,\n        inventory: 2,\n        status: 'active',\n      } as any);\n\n      mockProductRepository.decrementInventory.mockResolvedValue({} as any);\n      mockProductRepository.incrementSoldCount.mockResolvedValue({} as any);\n\n      mockOrderRepository.createOrder.mockResolvedValue({\n        id: 'order-vip',\n        orderNumber: 'ORD-VIP-001',\n        userId: 'user-vip',\n        total: 5250.00,\n        status: OrderStatus.PENDING,\n      } as any);\n\n      mockNotificationService.sendOrderConfirmationEmail.mockResolvedValue({\n        success: true,\n      });\n      mockNotificationService.sendSMS = jest.fn().mockResolvedValue({\n        success: true,\n      });\n\n      await orderService.createOrder(createOrderDto);\n\n      expect(mockNotificationService.sendOrderConfirmationEmail).toHaveBeenCalled();\n      // High-value orders should also send SMS\n      if (createOrderDto.customerPhone) {\n        expect(mockNotificationService.sendSMS).toHaveBeenCalledWith(\n          '+15555555555',\n          expect.stringContaining('order confirmed')\n        );\n      }\n    });\n  });\n\n  describe('Error Handling and Rollback', () => {\n    it('should rollback inventory if notification fails critically', async () => {\n      const createOrderDto = {\n        userId: 'user-rollback',\n        items: [\n          {\n            productId: 'prod-rollback',\n            quantity: 10,\n            unitPrice: 30.00,\n          },\n        ],\n        shippingAddress: {\n          street: '111 Test St',\n          city: 'Test City',\n          state: 'TC',\n          zip: '11111',\n          country: 'US',\n        },\n      };\n\n      mockProductRepository.findById.mockResolvedValue({\n        id: 'prod-rollback',\n        name: 'Rollback Product',\n        sku: 'ROLLBACK-001',\n        price: 30.00,\n        inventory: 50,\n        status: 'active',\n      } as any);\n\n      mockProductRepository.decrementInventory.mockResolvedValue({\n        inventory: 40,\n      } as any);\n      mockProductRepository.incrementInventory.mockResolvedValue({\n        inventory: 50,\n      } as any);\n\n      mockOrderRepository.createOrder.mockRejectedValue(\n        new Error('Database error')\n      );\n\n      await expect(orderService.createOrder(createOrderDto)).rejects.toThrow(\n        'Database error'\n      );\n\n      // Inventory should be restored on failure\n      expect(mockProductRepository.incrementInventory).toHaveBeenCalledWith(\n        'prod-rollback',\n        10\n      );\n    });\n  });\n});\n"],"version":3}