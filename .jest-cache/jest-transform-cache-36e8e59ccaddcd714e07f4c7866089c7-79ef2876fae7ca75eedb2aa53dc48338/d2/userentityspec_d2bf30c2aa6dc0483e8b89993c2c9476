e16f712f0ae6e0ecac3ea1a9f69a37cd
"use strict";
/**
 * Unit Tests: User Entity
 *
 * Testing entity business logic methods
 */
Object.defineProperty(exports, "__esModule", { value: true });
const user_entity_1 = require("./user.entity");
describe('User Entity', () => {
    let user;
    beforeEach(() => {
        user = new user_entity_1.User();
        user.id = '123';
        user.email = 'test@example.com';
        user.password = 'hashed_password';
        user.firstName = 'John';
        user.lastName = 'Doe';
        user.role = user_entity_1.UserRole.CUSTOMER;
        user.status = user_entity_1.UserStatus.ACTIVE;
        user.loginAttempts = 0;
        user.createdAt = new Date();
        user.updatedAt = new Date();
    });
    describe('fullName getter', () => {
        it('should return full name', () => {
            expect(user.fullName).toBe('John Doe');
        });
        it('should handle different names', () => {
            user.firstName = 'Jane';
            user.lastName = 'Smith';
            expect(user.fullName).toBe('Jane Smith');
        });
        it('should handle single character names', () => {
            user.firstName = 'A';
            user.lastName = 'B';
            expect(user.fullName).toBe('A B');
        });
    });
    describe('isEmailVerified', () => {
        it('should return true when email is verified', () => {
            user.emailVerifiedAt = new Date();
            expect(user.isEmailVerified()).toBe(true);
        });
        it('should return false when email is not verified', () => {
            user.emailVerifiedAt = undefined;
            expect(user.isEmailVerified()).toBe(false);
        });
        it('should return false when emailVerifiedAt is null', () => {
            user.emailVerifiedAt = null;
            expect(user.isEmailVerified()).toBe(false);
        });
        it('should return true for past verification date', () => {
            user.emailVerifiedAt = new Date('2020-01-01');
            expect(user.isEmailVerified()).toBe(true);
        });
    });
    describe('isLocked', () => {
        it('should return false when not locked', () => {
            user.lockedUntil = undefined;
            expect(user.isLocked()).toBe(false);
        });
        it('should return true when locked in future', () => {
            user.lockedUntil = new Date(Date.now() + 3600000);
            expect(user.isLocked()).toBe(true);
        });
        it('should return false when lock expired', () => {
            user.lockedUntil = new Date(Date.now() - 1000);
            expect(user.isLocked()).toBe(false);
        });
        it('should return false when lockedUntil is null', () => {
            user.lockedUntil = null;
            expect(user.isLocked()).toBe(false);
        });
        it('should handle exact lock expiration time', () => {
            user.lockedUntil = new Date();
            // Should be considered unlocked at exact expiration
            expect(user.isLocked()).toBe(false);
        });
    });
    describe('isActive', () => {
        it('should return true for active unlocked user', () => {
            user.status = user_entity_1.UserStatus.ACTIVE;
            user.lockedUntil = undefined;
            expect(user.isActive()).toBe(true);
        });
        it('should return false for locked user', () => {
            user.status = user_entity_1.UserStatus.ACTIVE;
            user.lockedUntil = new Date(Date.now() + 3600000);
            expect(user.isActive()).toBe(false);
        });
        it('should return false for pending user', () => {
            user.status = user_entity_1.UserStatus.PENDING;
            user.lockedUntil = undefined;
            expect(user.isActive()).toBe(false);
        });
        it('should return false for suspended user', () => {
            user.status = user_entity_1.UserStatus.SUSPENDED;
            user.lockedUntil = undefined;
            expect(user.isActive()).toBe(false);
        });
        it('should return false for deleted user', () => {
            user.status = user_entity_1.UserStatus.DELETED;
            user.lockedUntil = undefined;
            expect(user.isActive()).toBe(false);
        });
        it('should return false for suspended and locked user', () => {
            user.status = user_entity_1.UserStatus.SUSPENDED;
            user.lockedUntil = new Date(Date.now() + 3600000);
            expect(user.isActive()).toBe(false);
        });
    });
    describe('toJSON', () => {
        it('should exclude password from JSON', () => {
            const json = user.toJSON();
            expect(json.password).toBeUndefined();
        });
        it('should exclude emailVerificationToken from JSON', () => {
            user.emailVerificationToken = 'secret-token';
            const json = user.toJSON();
            expect(json.emailVerificationToken).toBeUndefined();
        });
        it('should exclude passwordResetToken from JSON', () => {
            user.passwordResetToken = 'reset-token';
            const json = user.toJSON();
            expect(json.passwordResetToken).toBeUndefined();
        });
        it('should include safe fields in JSON', () => {
            const json = user.toJSON();
            expect(json.id).toBe(user.id);
            expect(json.email).toBe(user.email);
            expect(json.firstName).toBe(user.firstName);
            expect(json.lastName).toBe(user.lastName);
            expect(json.role).toBe(user.role);
            expect(json.status).toBe(user.status);
        });
        it('should include timestamps in JSON', () => {
            const json = user.toJSON();
            expect(json.createdAt).toBeDefined();
            expect(json.updatedAt).toBeDefined();
        });
        it('should include optional fields when present', () => {
            user.phoneNumber = '+1234567890';
            user.lastLoginAt = new Date();
            const json = user.toJSON();
            expect(json.phoneNumber).toBe(user.phoneNumber);
            expect(json.lastLoginAt).toBe(user.lastLoginAt);
        });
    });
    describe('Role-based checks', () => {
        it('should identify admin role', () => {
            user.role = user_entity_1.UserRole.ADMIN;
            expect(user.role).toBe(user_entity_1.UserRole.ADMIN);
        });
        it('should identify customer role', () => {
            user.role = user_entity_1.UserRole.CUSTOMER;
            expect(user.role).toBe(user_entity_1.UserRole.CUSTOMER);
        });
        it('should identify vendor role', () => {
            user.role = user_entity_1.UserRole.VENDOR;
            expect(user.role).toBe(user_entity_1.UserRole.VENDOR);
        });
    });
    describe('Status transitions', () => {
        it('should allow pending to active transition', () => {
            user.status = user_entity_1.UserStatus.PENDING;
            user.status = user_entity_1.UserStatus.ACTIVE;
            expect(user.status).toBe(user_entity_1.UserStatus.ACTIVE);
        });
        it('should allow active to suspended transition', () => {
            user.status = user_entity_1.UserStatus.ACTIVE;
            user.status = user_entity_1.UserStatus.SUSPENDED;
            expect(user.status).toBe(user_entity_1.UserStatus.SUSPENDED);
        });
        it('should allow suspended to active transition', () => {
            user.status = user_entity_1.UserStatus.SUSPENDED;
            user.status = user_entity_1.UserStatus.ACTIVE;
            expect(user.status).toBe(user_entity_1.UserStatus.ACTIVE);
        });
    });
    describe('Login attempt tracking', () => {
        it('should track login attempts', () => {
            user.loginAttempts = 0;
            expect(user.loginAttempts).toBe(0);
            user.loginAttempts++;
            expect(user.loginAttempts).toBe(1);
        });
        it('should handle multiple failed attempts', () => {
            user.loginAttempts = 4;
            expect(user.loginAttempts).toBe(4);
        });
        it('should reset login attempts', () => {
            user.loginAttempts = 5;
            user.loginAttempts = 0;
            expect(user.loginAttempts).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHVzZXItbWFuYWdlbWVudFxcZW50aXRpZXNcXHVzZXIuZW50aXR5LnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsK0NBQTJEO0FBRTNELFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksSUFBVSxDQUFDO0lBRWYsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksR0FBRyxJQUFJLGtCQUFJLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxHQUFHLGtCQUFrQixDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsaUJBQWlCLENBQUM7UUFDbEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFDdEIsSUFBSSxDQUFDLElBQUksR0FBRyxzQkFBUSxDQUFDLFFBQVEsQ0FBQztRQUM5QixJQUFJLENBQUMsTUFBTSxHQUFHLHdCQUFVLENBQUMsTUFBTSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxTQUFTLEdB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QUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHVzZXItbWFuYWdlbWVudFxcZW50aXRpZXNcXHVzZXIuZW50aXR5LnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbml0IFRlc3RzOiBVc2VyIEVudGl0eVxuICpcbiAqIFRlc3RpbmcgZW50aXR5IGJ1c2luZXNzIGxvZ2ljIG1ldGhvZHNcbiAqL1xuXG5pbXBvcnQgeyBVc2VyLCBVc2VyUm9sZSwgVXNlclN0YXR1cyB9IGZyb20gJy4vdXNlci5lbnRpdHknO1xuXG5kZXNjcmliZSgnVXNlciBFbnRpdHknLCAoKSA9PiB7XG4gIGxldCB1c2VyOiBVc2VyO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHVzZXIgPSBuZXcgVXNlcigpO1xuICAgIHVzZXIuaWQgPSAnMTIzJztcbiAgICB1c2VyLmVtYWlsID0gJ3Rlc3RAZXhhbXBsZS5jb20nO1xuICAgIHVzZXIucGFzc3dvcmQgPSAnaGFzaGVkX3Bhc3N3b3JkJztcbiAgICB1c2VyLmZpcnN0TmFtZSA9ICdKb2huJztcbiAgICB1c2VyLmxhc3ROYW1lID0gJ0RvZSc7XG4gICAgdXNlci5yb2xlID0gVXNlclJvbGUuQ1VTVE9NRVI7XG4gICAgdXNlci5zdGF0dXMgPSBVc2VyU3RhdHVzLkFDVElWRTtcbiAgICB1c2VyLmxvZ2luQXR0ZW1wdHMgPSAwO1xuICAgIHVzZXIuY3JlYXRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICB1c2VyLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmdWxsTmFtZSBnZXR0ZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZnVsbCBuYW1lJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHVzZXIuZnVsbE5hbWUpLnRvQmUoJ0pvaG4gRG9lJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgbmFtZXMnLCAoKSA9PiB7XG4gICAgICB1c2VyLmZpcnN0TmFtZSA9ICdKYW5lJztcbiAgICAgIHVzZXIubGFzdE5hbWUgPSAnU21pdGgnO1xuXG4gICAgICBleHBlY3QodXNlci5mdWxsTmFtZSkudG9CZSgnSmFuZSBTbWl0aCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2luZ2xlIGNoYXJhY3RlciBuYW1lcycsICgpID0+IHtcbiAgICAgIHVzZXIuZmlyc3ROYW1lID0gJ0EnO1xuICAgICAgdXNlci5sYXN0TmFtZSA9ICdCJztcblxuICAgICAgZXhwZWN0KHVzZXIuZnVsbE5hbWUpLnRvQmUoJ0EgQicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNFbWFpbFZlcmlmaWVkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiBlbWFpbCBpcyB2ZXJpZmllZCcsICgpID0+IHtcbiAgICAgIHVzZXIuZW1haWxWZXJpZmllZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgZXhwZWN0KHVzZXIuaXNFbWFpbFZlcmlmaWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIGVtYWlsIGlzIG5vdCB2ZXJpZmllZCcsICgpID0+IHtcbiAgICAgIHVzZXIuZW1haWxWZXJpZmllZEF0ID0gdW5kZWZpbmVkO1xuXG4gICAgICBleHBlY3QodXNlci5pc0VtYWlsVmVyaWZpZWQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIGVtYWlsVmVyaWZpZWRBdCBpcyBudWxsJywgKCkgPT4ge1xuICAgICAgdXNlci5lbWFpbFZlcmlmaWVkQXQgPSBudWxsIGFzIHVua25vd24gYXMgdW5kZWZpbmVkO1xuXG4gICAgICBleHBlY3QodXNlci5pc0VtYWlsVmVyaWZpZWQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGZvciBwYXN0IHZlcmlmaWNhdGlvbiBkYXRlJywgKCkgPT4ge1xuICAgICAgdXNlci5lbWFpbFZlcmlmaWVkQXQgPSBuZXcgRGF0ZSgnMjAyMC0wMS0wMScpO1xuXG4gICAgICBleHBlY3QodXNlci5pc0VtYWlsVmVyaWZpZWQoKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2lzTG9ja2VkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gbm90IGxvY2tlZCcsICgpID0+IHtcbiAgICAgIHVzZXIubG9ja2VkVW50aWwgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmlzTG9ja2VkKCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIGxvY2tlZCBpbiBmdXR1cmUnLCAoKSA9PiB7XG4gICAgICB1c2VyLmxvY2tlZFVudGlsID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApO1xuXG4gICAgICBleHBlY3QodXNlci5pc0xvY2tlZCgpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBsb2NrIGV4cGlyZWQnLCAoKSA9PiB7XG4gICAgICB1c2VyLmxvY2tlZFVudGlsID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDEwMDApO1xuXG4gICAgICBleHBlY3QodXNlci5pc0xvY2tlZCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gbG9ja2VkVW50aWwgaXMgbnVsbCcsICgpID0+IHtcbiAgICAgIHVzZXIubG9ja2VkVW50aWwgPSBudWxsIGFzIHVua25vd24gYXMgdW5kZWZpbmVkO1xuXG4gICAgICBleHBlY3QodXNlci5pc0xvY2tlZCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4YWN0IGxvY2sgZXhwaXJhdGlvbiB0aW1lJywgKCkgPT4ge1xuICAgICAgdXNlci5sb2NrZWRVbnRpbCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgIC8vIFNob3VsZCBiZSBjb25zaWRlcmVkIHVubG9ja2VkIGF0IGV4YWN0IGV4cGlyYXRpb25cbiAgICAgIGV4cGVjdCh1c2VyLmlzTG9ja2VkKCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNBY3RpdmUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSBmb3IgYWN0aXZlIHVubG9ja2VkIHVzZXInLCAoKSA9PiB7XG4gICAgICB1c2VyLnN0YXR1cyA9IFVzZXJTdGF0dXMuQUNUSVZFO1xuICAgICAgdXNlci5sb2NrZWRVbnRpbCA9IHVuZGVmaW5lZDtcblxuICAgICAgZXhwZWN0KHVzZXIuaXNBY3RpdmUoKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciBsb2NrZWQgdXNlcicsICgpID0+IHtcbiAgICAgIHVzZXIuc3RhdHVzID0gVXNlclN0YXR1cy5BQ1RJVkU7XG4gICAgICB1c2VyLmxvY2tlZFVudGlsID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApO1xuXG4gICAgICBleHBlY3QodXNlci5pc0FjdGl2ZSgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciBwZW5kaW5nIHVzZXInLCAoKSA9PiB7XG4gICAgICB1c2VyLnN0YXR1cyA9IFVzZXJTdGF0dXMuUEVORElORztcbiAgICAgIHVzZXIubG9ja2VkVW50aWwgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmlzQWN0aXZlKCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIHN1c3BlbmRlZCB1c2VyJywgKCkgPT4ge1xuICAgICAgdXNlci5zdGF0dXMgPSBVc2VyU3RhdHVzLlNVU1BFTkRFRDtcbiAgICAgIHVzZXIubG9ja2VkVW50aWwgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmlzQWN0aXZlKCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIGRlbGV0ZWQgdXNlcicsICgpID0+IHtcbiAgICAgIHVzZXIuc3RhdHVzID0gVXNlclN0YXR1cy5ERUxFVEVEO1xuICAgICAgdXNlci5sb2NrZWRVbnRpbCA9IHVuZGVmaW5lZDtcblxuICAgICAgZXhwZWN0KHVzZXIuaXNBY3RpdmUoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3Igc3VzcGVuZGVkIGFuZCBsb2NrZWQgdXNlcicsICgpID0+IHtcbiAgICAgIHVzZXIuc3RhdHVzID0gVXNlclN0YXR1cy5TVVNQRU5ERUQ7XG4gICAgICB1c2VyLmxvY2tlZFVudGlsID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApO1xuXG4gICAgICBleHBlY3QodXNlci5pc0FjdGl2ZSgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RvSlNPTicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4Y2x1ZGUgcGFzc3dvcmQgZnJvbSBKU09OJywgKCkgPT4ge1xuICAgICAgY29uc3QganNvbiA9IHVzZXIudG9KU09OKCk7XG5cbiAgICAgIGV4cGVjdChqc29uLnBhc3N3b3JkKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4Y2x1ZGUgZW1haWxWZXJpZmljYXRpb25Ub2tlbiBmcm9tIEpTT04nLCAoKSA9PiB7XG4gICAgICB1c2VyLmVtYWlsVmVyaWZpY2F0aW9uVG9rZW4gPSAnc2VjcmV0LXRva2VuJztcbiAgICAgIGNvbnN0IGpzb24gPSB1c2VyLnRvSlNPTigpO1xuXG4gICAgICBleHBlY3QoanNvbi5lbWFpbFZlcmlmaWNhdGlvblRva2VuKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4Y2x1ZGUgcGFzc3dvcmRSZXNldFRva2VuIGZyb20gSlNPTicsICgpID0+IHtcbiAgICAgIHVzZXIucGFzc3dvcmRSZXNldFRva2VuID0gJ3Jlc2V0LXRva2VuJztcbiAgICAgIGNvbnN0IGpzb24gPSB1c2VyLnRvSlNPTigpO1xuXG4gICAgICBleHBlY3QoanNvbi5wYXNzd29yZFJlc2V0VG9rZW4pLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBzYWZlIGZpZWxkcyBpbiBKU09OJywgKCkgPT4ge1xuICAgICAgY29uc3QganNvbiA9IHVzZXIudG9KU09OKCk7XG5cbiAgICAgIGV4cGVjdChqc29uLmlkKS50b0JlKHVzZXIuaWQpO1xuICAgICAgZXhwZWN0KGpzb24uZW1haWwpLnRvQmUodXNlci5lbWFpbCk7XG4gICAgICBleHBlY3QoanNvbi5maXJzdE5hbWUpLnRvQmUodXNlci5maXJzdE5hbWUpO1xuICAgICAgZXhwZWN0KGpzb24ubGFzdE5hbWUpLnRvQmUodXNlci5sYXN0TmFtZSk7XG4gICAgICBleHBlY3QoanNvbi5yb2xlKS50b0JlKHVzZXIucm9sZSk7XG4gICAgICBleHBlY3QoanNvbi5zdGF0dXMpLnRvQmUodXNlci5zdGF0dXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHRpbWVzdGFtcHMgaW4gSlNPTicsICgpID0+IHtcbiAgICAgIGNvbnN0IGpzb24gPSB1c2VyLnRvSlNPTigpO1xuXG4gICAgICBleHBlY3QoanNvbi5jcmVhdGVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoanNvbi51cGRhdGVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgb3B0aW9uYWwgZmllbGRzIHdoZW4gcHJlc2VudCcsICgpID0+IHtcbiAgICAgIHVzZXIucGhvbmVOdW1iZXIgPSAnKzEyMzQ1Njc4OTAnO1xuICAgICAgdXNlci5sYXN0TG9naW5BdCA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBqc29uID0gdXNlci50b0pTT04oKTtcblxuICAgICAgZXhwZWN0KGpzb24ucGhvbmVOdW1iZXIpLnRvQmUodXNlci5waG9uZU51bWJlcik7XG4gICAgICBleHBlY3QoanNvbi5sYXN0TG9naW5BdCkudG9CZSh1c2VyLmxhc3RMb2dpbkF0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JvbGUtYmFzZWQgY2hlY2tzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgYWRtaW4gcm9sZScsICgpID0+IHtcbiAgICAgIHVzZXIucm9sZSA9IFVzZXJSb2xlLkFETUlOO1xuXG4gICAgICBleHBlY3QodXNlci5yb2xlKS50b0JlKFVzZXJSb2xlLkFETUlOKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgY3VzdG9tZXIgcm9sZScsICgpID0+IHtcbiAgICAgIHVzZXIucm9sZSA9IFVzZXJSb2xlLkNVU1RPTUVSO1xuXG4gICAgICBleHBlY3QodXNlci5yb2xlKS50b0JlKFVzZXJSb2xlLkNVU1RPTUVSKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgdmVuZG9yIHJvbGUnLCAoKSA9PiB7XG4gICAgICB1c2VyLnJvbGUgPSBVc2VyUm9sZS5WRU5ET1I7XG5cbiAgICAgIGV4cGVjdCh1c2VyLnJvbGUpLnRvQmUoVXNlclJvbGUuVkVORE9SKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0YXR1cyB0cmFuc2l0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IHBlbmRpbmcgdG8gYWN0aXZlIHRyYW5zaXRpb24nLCAoKSA9PiB7XG4gICAgICB1c2VyLnN0YXR1cyA9IFVzZXJTdGF0dXMuUEVORElORztcbiAgICAgIHVzZXIuc3RhdHVzID0gVXNlclN0YXR1cy5BQ1RJVkU7XG5cbiAgICAgIGV4cGVjdCh1c2VyLnN0YXR1cykudG9CZShVc2VyU3RhdHVzLkFDVElWRSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFjdGl2ZSB0byBzdXNwZW5kZWQgdHJhbnNpdGlvbicsICgpID0+IHtcbiAgICAgIHVzZXIuc3RhdHVzID0gVXNlclN0YXR1cy5BQ1RJVkU7XG4gICAgICB1c2VyLnN0YXR1cyA9IFVzZXJTdGF0dXMuU1VTUEVOREVEO1xuXG4gICAgICBleHBlY3QodXNlci5zdGF0dXMpLnRvQmUoVXNlclN0YXR1cy5TVVNQRU5ERUQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBzdXNwZW5kZWQgdG8gYWN0aXZlIHRyYW5zaXRpb24nLCAoKSA9PiB7XG4gICAgICB1c2VyLnN0YXR1cyA9IFVzZXJTdGF0dXMuU1VTUEVOREVEO1xuICAgICAgdXNlci5zdGF0dXMgPSBVc2VyU3RhdHVzLkFDVElWRTtcblxuICAgICAgZXhwZWN0KHVzZXIuc3RhdHVzKS50b0JlKFVzZXJTdGF0dXMuQUNUSVZFKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xvZ2luIGF0dGVtcHQgdHJhY2tpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBsb2dpbiBhdHRlbXB0cycsICgpID0+IHtcbiAgICAgIHVzZXIubG9naW5BdHRlbXB0cyA9IDA7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmxvZ2luQXR0ZW1wdHMpLnRvQmUoMCk7XG5cbiAgICAgIHVzZXIubG9naW5BdHRlbXB0cysrO1xuICAgICAgZXhwZWN0KHVzZXIubG9naW5BdHRlbXB0cykudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIGZhaWxlZCBhdHRlbXB0cycsICgpID0+IHtcbiAgICAgIHVzZXIubG9naW5BdHRlbXB0cyA9IDQ7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmxvZ2luQXR0ZW1wdHMpLnRvQmUoNCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc2V0IGxvZ2luIGF0dGVtcHRzJywgKCkgPT4ge1xuICAgICAgdXNlci5sb2dpbkF0dGVtcHRzID0gNTtcbiAgICAgIHVzZXIubG9naW5BdHRlbXB0cyA9IDA7XG5cbiAgICAgIGV4cGVjdCh1c2VyLmxvZ2luQXR0ZW1wdHMpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=