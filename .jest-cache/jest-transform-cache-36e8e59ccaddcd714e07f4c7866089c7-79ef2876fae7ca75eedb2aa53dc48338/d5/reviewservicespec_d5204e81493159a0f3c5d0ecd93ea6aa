a57a409df42cd272daded958d125ce4c
"use strict";
/**
 * TDD: Product Review Service Tests
 *
 * Testing product review and rating functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const review_service_1 = require("./review.service");
const errors_1 = require("@libs/errors");
describe('ReviewService', () => {
    let reviewService;
    let mockReviewRepository;
    let mockProductRepository;
    let mockOrderRepository;
    beforeEach(() => {
        mockReviewRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByProductId: jest.fn(),
            findByUserId: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
            countByProductId: jest.fn(),
            getAverageRating: jest.fn(),
            findVerifiedPurchases: jest.fn(),
            findHelpful: jest.fn(),
            markAsHelpful: jest.fn(),
        };
        mockProductRepository = {
            findById: jest.fn(),
            updateRating: jest.fn(),
        };
        mockOrderRepository = {
            findByUserId: jest.fn(),
            hasUserPurchasedProduct: jest.fn(),
        };
        reviewService = new review_service_1.ReviewService(mockReviewRepository, mockProductRepository, mockOrderRepository);
    });
    describe('createReview', () => {
        it('should create a review for a product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Excellent product!',
                comment: 'This product exceeded my expectations.',
            };
            const mockProduct = { id: 'prod-1', name: 'Test Product' };
            mockProductRepository.findById.mockResolvedValue(mockProduct);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockReviewRepository.getAverageRating.mockResolvedValue(5.0);
            mockProductRepository.updateRating.mockResolvedValue({});
            const mockReview = {
                id: 'review-1',
                ...reviewDto,
                isVerifiedPurchase: false,
                helpfulCount: 0,
                createdAt: new Date(),
            };
            mockReviewRepository.create.mockResolvedValue(mockReview);
            const result = await reviewService.createReview(reviewDto);
            expect(result).toEqual(mockReview);
            expect(mockReviewRepository.create).toHaveBeenCalledWith(expect.objectContaining({
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
            }));
        });
        it('should mark review as verified purchase if user bought the product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great!',
                comment: 'Love it!',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockOrderRepository.hasUserPurchasedProduct.mockResolvedValue(true);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockReviewRepository.getAverageRating.mockResolvedValue(5.0);
            mockProductRepository.updateRating.mockResolvedValue({});
            const mockReview = {
                id: 'review-1',
                ...reviewDto,
                isVerifiedPurchase: true,
            };
            mockReviewRepository.create.mockResolvedValue(mockReview);
            const result = await reviewService.createReview(reviewDto);
            expect(result.isVerifiedPurchase).toBe(true);
        });
        it('should reject review with rating below 1', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 0,
                title: 'Bad',
                comment: 'Terrible',
            };
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow('Rating must be between 1 and 5');
        });
        it('should reject review with rating above 5', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 6,
                title: 'Amazing',
                comment: 'Best ever',
            };
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
        });
        it('should reject review for non-existent product', async () => {
            const reviewDto = {
                productId: 'invalid',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Excellent',
            };
            mockProductRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Product not found'));
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject duplicate review from same user for same product', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Love it',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.findByProductId.mockResolvedValue([
                { id: 'existing', userId: 'user-1', productId: 'prod-1' },
            ]);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(reviewService.createReview(reviewDto)).rejects.toThrow('already reviewed');
        });
        it('should update product average rating after review creation', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 5,
                title: 'Great',
                comment: 'Excellent',
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockReviewRepository.create.mockResolvedValue({ id: 'review-1', ...reviewDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.createReview(reviewDto);
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.5, 0);
        });
        it('should allow review with only rating (no comment)', async () => {
            const reviewDto = {
                productId: 'prod-1',
                userId: 'user-1',
                rating: 4,
            };
            mockProductRepository.findById.mockResolvedValue({ id: 'prod-1' });
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockReviewRepository.getAverageRating.mockResolvedValue(4.0);
            mockProductRepository.updateRating.mockResolvedValue({});
            mockReviewRepository.create.mockResolvedValue({ id: 'review-1', ...reviewDto });
            const result = await reviewService.createReview(reviewDto);
            expect(result.rating).toBe(4);
            expect(result.comment).toBeUndefined();
        });
    });
    describe('getProductReviews', () => {
        it('should get all reviews for a product', async () => {
            const mockReviews = [
                { id: '1', productId: 'prod-1', rating: 5, comment: 'Great' },
                { id: '2', productId: 'prod-1', rating: 4, comment: 'Good' },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1');
            expect(result).toHaveLength(2);
            expect(result[0].rating).toBe(5);
        });
        it('should get reviews with pagination', async () => {
            const mockReviews = Array.from({ length: 10 }, (_, i) => ({
                id: `review-${i}`,
                productId: 'prod-1',
                rating: 5,
            }));
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { page: 1, limit: 5 });
            expect(result).toHaveLength(5);
        });
        it('should filter reviews by minimum rating', async () => {
            const mockReviews = [
                { id: '1', rating: 5 },
                { id: '2', rating: 4 },
                { id: '3', rating: 3 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { minRating: 4 });
            expect(result.every(r => r.rating >= 4)).toBe(true);
        });
        it('should sort reviews by most helpful', async () => {
            const mockReviews = [
                { id: '1', helpfulCount: 10 },
                { id: '2', helpfulCount: 50 },
                { id: '3', helpfulCount: 5 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductReviews('prod-1', { sortBy: 'helpful' });
            expect(result[0].helpfulCount).toBeGreaterThan(result[1].helpfulCount);
        });
        it('should get only verified purchase reviews', async () => {
            const mockReviews = [
                { id: '1', isVerifiedPurchase: true },
                { id: '2', isVerifiedPurchase: false },
            ];
            mockReviewRepository.findVerifiedPurchases.mockResolvedValue([mockReviews[0]]);
            const result = await reviewService.getProductReviews('prod-1', { verifiedOnly: true });
            expect(result.every(r => r.isVerifiedPurchase)).toBe(true);
        });
    });
    describe('getUserReviews', () => {
        it('should get all reviews by a user', async () => {
            const mockReviews = [
                { id: '1', userId: 'user-1', productId: 'prod-1' },
                { id: '2', userId: 'user-1', productId: 'prod-2' },
            ];
            mockReviewRepository.findByUserId.mockResolvedValue(mockReviews);
            const result = await reviewService.getUserReviews('user-1');
            expect(result).toHaveLength(2);
        });
    });
    describe('updateReview', () => {
        it('should update a review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
                rating: 4,
                comment: 'Good',
            };
            const updateDto = {
                rating: 5,
                comment: 'Actually, it\'s excellent!',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.update.mockResolvedValue({ ...existingReview, ...updateDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            mockReviewRepository.findByProductId.mockResolvedValue([existingReview]);
            mockProductRepository.updateRating.mockResolvedValue({});
            const result = await reviewService.updateReview('review-1', 'user-1', updateDto);
            expect(result.rating).toBe(5);
            expect(result.comment).toContain('excellent');
        });
        it('should only allow user to update their own review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                rating: 4,
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            const updateDto = {
                rating: 5,
            };
            await expect(reviewService.updateReview('review-1', 'user-2', updateDto)).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should update product rating after review update', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
                rating: 3,
            };
            const updateDto = {
                rating: 5,
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.update.mockResolvedValue({ ...existingReview, ...updateDto });
            mockReviewRepository.getAverageRating.mockResolvedValue(4.7);
            mockReviewRepository.findByProductId.mockResolvedValue([existingReview]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.updateReview('review-1', 'user-1', updateDto);
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.7, 1);
        });
    });
    describe('deleteReview', () => {
        it('should delete a review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.delete.mockResolvedValue(undefined);
            mockReviewRepository.getAverageRating.mockResolvedValue(4.0);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.deleteReview('review-1', 'user-1');
            expect(mockReviewRepository.delete).toHaveBeenCalledWith('review-1');
        });
        it('should only allow user to delete their own review', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            await expect(reviewService.deleteReview('review-1', 'user-2')).rejects.toThrow(errors_1.UnauthorizedError);
        });
        it('should update product rating after review deletion', async () => {
            const existingReview = {
                id: 'review-1',
                userId: 'user-1',
                productId: 'prod-1',
            };
            mockReviewRepository.findById.mockResolvedValue(existingReview);
            mockReviewRepository.delete.mockResolvedValue(undefined);
            mockReviewRepository.getAverageRating.mockResolvedValue(4.2);
            mockReviewRepository.findByProductId.mockResolvedValue([]);
            mockProductRepository.updateRating.mockResolvedValue({});
            await reviewService.deleteReview('review-1', 'user-1');
            expect(mockProductRepository.updateRating).toHaveBeenCalledWith('prod-1', 4.2, 0);
        });
    });
    describe('markReviewAsHelpful', () => {
        it('should mark a review as helpful', async () => {
            const mockReview = {
                id: 'review-1',
                helpfulCount: 5,
            };
            mockReviewRepository.findById.mockResolvedValue(mockReview);
            mockReviewRepository.markAsHelpful.mockResolvedValue(undefined);
            await reviewService.markReviewAsHelpful('review-1', 'user-2');
            expect(mockReviewRepository.markAsHelpful).toHaveBeenCalledWith('review-1', 'user-2');
        });
        it('should prevent user from marking their own review as helpful', async () => {
            const mockReview = {
                id: 'review-1',
                userId: 'user-1',
            };
            mockReviewRepository.findById.mockResolvedValue(mockReview);
            await expect(reviewService.markReviewAsHelpful('review-1', 'user-1')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('getProductRatingDistribution', () => {
        it('should get rating distribution for a product', async () => {
            const mockReviews = [
                { rating: 5 },
                { rating: 5 },
                { rating: 4 },
                { rating: 3 },
                { rating: 1 },
            ];
            mockReviewRepository.findByProductId.mockResolvedValue(mockReviews);
            const result = await reviewService.getProductRatingDistribution('prod-1');
            expect(result.fiveStars).toBe(2);
            expect(result.fourStars).toBe(1);
            expect(result.threeStars).toBe(1);
            expect(result.twoStars).toBe(0);
            expect(result.oneStars).toBe(1);
        });
    });
    describe('getAverageRating', () => {
        it('should calculate average rating for a product', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(4.3);
            const result = await reviewService.getAverageRating('prod-1');
            expect(result).toBe(4.3);
        });
        it('should return 0 for product with no reviews', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(0);
            const result = await reviewService.getAverageRating('prod-1');
            expect(result).toBe(0);
        });
    });
    describe('getReviewCount', () => {
        it('should get total review count for a product', async () => {
            mockReviewRepository.countByProductId.mockResolvedValue(42);
            const result = await reviewService.getReviewCount('prod-1');
            expect(result).toBe(42);
        });
    });
    describe('getReviewSummary', () => {
        it('should get complete review summary for a product', async () => {
            mockReviewRepository.getAverageRating.mockResolvedValue(4.5);
            mockReviewRepository.countByProductId.mockResolvedValue(100);
            mockReviewRepository.findByProductId.mockResolvedValue(Array(100).fill({ rating: 4.5 }));
            const result = await reviewService.getReviewSummary('prod-1');
            expect(result.averageRating).toBe(4.5);
            expect(result.totalReviews).toBe(100);
            expect(result.distribution).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHByb2R1Y3QtY2F0YWxvZ1xcc2VydmljZXNcXHJldmlldy5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgscURBQW1GO0FBSW5GLHlDQUFpRjtBQUVqRixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLGFBQTRCLENBQUM7SUFDakMsSUFBSSxvQkFBbUQsQ0FBQztJQUN4RCxJQUFJLHFCQUFxRCxDQUFDO0lBQzFELElBQUksbUJBQWlELENBQUM7SUFFdEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG9CQUFvQixHQUFHO1lBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2hDLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3RCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCLENBQUM7UUFFVCxxQkFBcUIsR0FBRztZQUN0QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNqQixDQUFDO1FBRVQsbUJBQW1CLEdBQUc7WUFDcEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdkIsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUM1QixDQUFDO1FBRVQsYUFBYSxHQUFHLElBQUksOEJBQWEsQ0FDL0Isb0JBQW9CLEVBQ3BCLHFCQUFxQixFQUNyQixtQkFBbUIsQ0FDcEIsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDNUIsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELE1BQU0sU0FBUyxHQUFvQjtnQkFDakMsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixNQUFNLEVBQUUsQ0FBQztnQkFDVCxLQUFLLEVBQUUsb0JBQW9CO2dCQUMzQixPQUFPLEVBQUUsd0NBQXdDO2FBQ2xELENBQUM7WUFFRixNQUFNLFdBQVcsR0FBRyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDO1lBQzNELHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFrQixDQUFDLENBQUM7WUFDckUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzNELG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFTLENBQUMsQ0FBQztZQUVoRSxNQUFNLFVBQVUsR0FBRztnQkFDakIsRUFBRSxFQUFFLFVBQVU7Z0JBQ2QsR0FBRyxTQUFTO2dCQUNaLGtCQUFrQixFQUFFLEtBQUs7Z0JBQ3pCLFlBQVksRUFBRSxDQUFDO2dCQUNmLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTthQUN0QixDQUFDO1lBRUYsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFVBQWlCLENBQUMsQ0FBQztZQUVqRSxNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFM0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQ3RELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixNQUFNLEVBQUUsQ0FBQzthQUNWLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0VBQW9FLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEYsTUFBTSxTQUFTLEdBQW9CO2dCQUNqQyxTQUFTLEVBQUUsUUFBUTtnQkFDbkIsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLE1BQU0sRUFBRSxDQUFDO2dCQUNULEtBQUssRUFBRSxRQUFRO2dCQUNmLE9BQU8sRUFBRSxVQUFVO2FBQ3BCLENBQUM7WUFFRixxQkFBcUIsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFTLENBQUMsQ0FBQztZQUMxRSxtQkFBbUIsQ0FBQyx1QkFBdUIsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRSxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDM0Qsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0QscUJBQXFCLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sVUFBVSxHQUFHO2dCQUNqQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxHQUFHLFNBQVM7Z0JBQ1osa0JBQWtCLEVBQUUsSUFBSTthQUN6QixDQUFDO1lBRUYsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFVBQWlCLENBQUMsQ0FBQztZQUVqRSxNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFM0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4RCxNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osT0FBTyxFQUFFLFVBQVU7YUFDcEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHdCQUFlLENBQUMsQ0FBQztZQUNyRixNQUFNLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQ3hHLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hELE1BQU0sU0FBUyxHQUFvQjtnQkFDakMsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixNQUFNLEVBQUUsQ0FBQztnQkFDVCxLQUFLLEVBQUUsU0FBUztnQkFDaEIsT0FBTyxFQUFFLFdBQVc7YUFDckIsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHdCQUFlLENBQUMsQ0FBQztRQUN2RixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLFNBQVMsRUFBRSxTQUFTO2dCQUNwQixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLFdBQVc7YUFDckIsQ0FBQztZQUVGLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLHNCQUFhLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1lBRXpGLE1BQU0sTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHNCQUFhLENBQUMsQ0FBQztRQUNyRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnRUFBZ0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RSxNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLFNBQVM7YUFDbkIsQ0FBQztZQUVGLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQVMsQ0FBQyxDQUFDO1lBQzFFLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDckQsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRTthQUNuRCxDQUFDLENBQUM7WUFFVixNQUFNLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyx3QkFBZSxDQUFDLENBQUM7WUFDckYsTUFBTSxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUMxRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0REFBNEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRSxNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLFdBQVc7YUFDckIsQ0FBQztZQUVGLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQVMsQ0FBQyxDQUFDO1lBQzFFLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzRCxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLEdBQUcsU0FBUyxFQUFTLENBQUMsQ0FBQztZQUN2RixvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3RCxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBUyxDQUFDLENBQUM7WUFFaEUsTUFBTSxhQUFhLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTVDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLE1BQU0sU0FBUyxHQUFvQjtnQkFDakMsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixNQUFNLEVBQUUsQ0FBQzthQUNWLENBQUM7WUFFRixxQkFBcUIsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFTLENBQUMsQ0FBQztZQUMxRSxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDM0Qsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0QscUJBQXFCLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBQ2hFLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsR0FBRyxTQUFTLEVBQVMsQ0FBQyxDQUFDO1lBRXZGLE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRCxNQUFNLFdBQVcsR0FBRztnQkFDbEIsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFO2dCQUM3RCxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUU7YUFDN0QsQ0FBQztZQUVGLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFrQixDQUFDLENBQUM7WUFFM0UsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDeEQsRUFBRSxFQUFFLFVBQVUsQ0FBQyxFQUFFO2dCQUNqQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDLENBQUMsQ0FBQztZQUVKLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFrQixDQUFDLENBQUM7WUFFM0UsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsaUJBQWlCLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUV0RixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRTtnQkFDdEIsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUU7Z0JBQ3RCLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFO2FBQ3ZCLENBQUM7WUFFRixvQkFBb0IsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsV0FBa0IsQ0FBQyxDQUFDO1lBRTNFLE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWpGLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxNQUFNLFdBQVcsR0FBRztnQkFDbEIsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUU7Z0JBQzdCLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsRUFBRSxFQUFFO2dCQUM3QixFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRTthQUM3QixDQUFDO1lBRUYsb0JBQW9CLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLFdBQWtCLENBQUMsQ0FBQztZQUUzRSxNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUV0RixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDekQsTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRSxJQUFJLEVBQUU7Z0JBQ3JDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRSxLQUFLLEVBQUU7YUFDdkMsQ0FBQztZQUVGLG9CQUFvQixDQUFDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFRLENBQUMsQ0FBQztZQUV0RixNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUV2RixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLFdBQVcsR0FBRztnQkFDbEIsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRTtnQkFDbEQsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRTthQUNuRCxDQUFDO1lBRUYsb0JBQW9CLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLFdBQWtCLENBQUMsQ0FBQztZQUV4RSxNQUFNLE1BQU0sR0FBRyxNQUFNLGFBQWEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDNUIsRUFBRSxDQUFDLHdCQUF3QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RDLE1BQU0sY0FBYyxHQUFHO2dCQUNyQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxNQUFNLEVBQUUsUUFBUTtnQkFDaEIsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLE1BQU0sRUFBRSxDQUFDO2dCQUNULE9BQU8sRUFBRSxNQUFNO2FBQ2hCLENBQUM7WUFFRixNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLE1BQU0sRUFBRSxDQUFDO2dCQUNULE9BQU8sRUFBRSw0QkFBNEI7YUFDdEMsQ0FBQztZQUVGLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFxQixDQUFDLENBQUM7WUFDdkUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsR0FBRyxjQUFjLEVBQUUsR0FBRyxTQUFTLEVBQVMsQ0FBQyxDQUFDO1lBQzFGLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGNBQWMsQ0FBUSxDQUFDLENBQUM7WUFDaEYscUJBQXFCLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRWpGLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLE1BQU0sY0FBYyxHQUFHO2dCQUNyQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBRUYsb0JBQW9CLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLGNBQXFCLENBQUMsQ0FBQztZQUV2RSxNQUFNLFNBQVMsR0FBb0I7Z0JBQ2pDLE1BQU0sRUFBRSxDQUFDO2FBQ1YsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUNWLGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FDNUQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEUsTUFBTSxjQUFjLEdBQUc7Z0JBQ3JCLEVBQUUsRUFBRSxVQUFVO2dCQUNkLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBRUYsTUFBTSxTQUFTLEdBQW9CO2dCQUNqQyxNQUFNLEVBQUUsQ0FBQzthQUNWLENBQUM7WUFFRixvQkFBb0IsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsY0FBcUIsQ0FBQyxDQUFDO1lBQ3ZFLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEdBQUcsY0FBYyxFQUFFLEdBQUcsU0FBUyxFQUFTLENBQUMsQ0FBQztZQUMxRixvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3RCxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxjQUFjLENBQVEsQ0FBQyxDQUFDO1lBQ2hGLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFTLENBQUMsQ0FBQztZQUVoRSxNQUFNLGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUVsRSxNQUFNLENBQUMscUJBQXFCLENBQUMsWUFBWSxDQUFDLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDNUIsRUFBRSxDQUFDLHdCQUF3QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RDLE1BQU0sY0FBYyxHQUFHO2dCQUNyQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxNQUFNLEVBQUUsUUFBUTtnQkFDaEIsU0FBUyxFQUFFLFFBQVE7YUFDcEIsQ0FBQztZQUVGLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFxQixDQUFDLENBQUM7WUFDdkUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3pELG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFTLENBQUMsQ0FBQztZQUNsRSxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBUyxDQUFDLENBQUM7WUFFaEUsTUFBTSxhQUFhLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV2RCxNQUFNLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbURBQW1ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakUsTUFBTSxjQUFjLEdBQUc7Z0JBQ3JCLEVBQUUsRUFBRSxVQUFVO2dCQUNkLE1BQU0sRUFBRSxRQUFRO2FBQ2pCLENBQUM7WUFFRixvQkFBb0IsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsY0FBcUIsQ0FBQyxDQUFDO1lBRXZFLE1BQU0sTUFBTSxDQUNWLGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUNqRCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQWlCLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRSxNQUFNLGNBQWMsR0FBRztnQkFDckIsRUFBRSxFQUFFLFVBQVU7Z0JBQ2QsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLFNBQVMsRUFBRSxRQUFRO2FBQ3BCLENBQUM7WUFFRixvQkFBb0IsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsY0FBcUIsQ0FBQyxDQUFDO1lBQ3ZFLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN6RCxvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3RCxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsRUFBUyxDQUFDLENBQUM7WUFDbEUscUJBQXFCLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sYUFBYSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdkQsTUFBTSxDQUFDLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9DLE1BQU0sVUFBVSxHQUFHO2dCQUNqQixFQUFFLEVBQUUsVUFBVTtnQkFDZCxZQUFZLEVBQUUsQ0FBQzthQUNoQixDQUFDO1lBRUYsb0JBQW9CLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFVBQWlCLENBQUMsQ0FBQztZQUNuRSxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFaEUsTUFBTSxhQUFhLENBQUMsbUJBQW1CLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDeEYsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOERBQThELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUUsTUFBTSxVQUFVLEdBQUc7Z0JBQ2pCLEVBQUUsRUFBRSxVQUFVO2dCQUNkLE1BQU0sRUFBRSxRQUFRO2FBQ2pCLENBQUM7WUFFRixvQkFBb0IsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsVUFBaUIsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sTUFBTSxDQUNWLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQ3hELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyx3QkFBZSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDNUMsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUU7Z0JBQ2IsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFO2dCQUNiLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRTtnQkFDYixFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUU7Z0JBQ2IsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFO2FBQ2QsQ0FBQztZQUVGLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFrQixDQUFDLENBQUM7WUFFM0UsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsNEJBQTRCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFMUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRTdELE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0Qsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFM0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFOUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0Qsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFNUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTVELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hFLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdELG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FDcEQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBUSxDQUN4QyxDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFOUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXHByb2R1Y3QtY2F0YWxvZ1xcc2VydmljZXNcXHJldmlldy5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUREQ6IFByb2R1Y3QgUmV2aWV3IFNlcnZpY2UgVGVzdHNcbiAqXG4gKiBUZXN0aW5nIHByb2R1Y3QgcmV2aWV3IGFuZCByYXRpbmcgZnVuY3Rpb25hbGl0eVxuICovXG5cbmltcG9ydCB7IFJldmlld1NlcnZpY2UsIENyZWF0ZVJldmlld0R0bywgVXBkYXRlUmV2aWV3RHRvIH0gZnJvbSAnLi9yZXZpZXcuc2VydmljZSc7XG5pbXBvcnQgeyBSZXZpZXdSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3Jldmlldy5yZXBvc2l0b3J5JztcbmltcG9ydCB7IFByb2R1Y3RSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yaWVzL3Byb2R1Y3QucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBPcmRlclJlcG9zaXRvcnkgfSBmcm9tICcuLi8uLi9vcmRlci1wcm9jZXNzaW5nL3JlcG9zaXRvcmllcy9vcmRlci5yZXBvc2l0b3J5JztcbmltcG9ydCB7IEJhZFJlcXVlc3RFcnJvciwgVW5hdXRob3JpemVkRXJyb3IsIE5vdEZvdW5kRXJyb3IgfSBmcm9tICdAbGlicy9lcnJvcnMnO1xuXG5kZXNjcmliZSgnUmV2aWV3U2VydmljZScsICgpID0+IHtcbiAgbGV0IHJldmlld1NlcnZpY2U6IFJldmlld1NlcnZpY2U7XG4gIGxldCBtb2NrUmV2aWV3UmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8UmV2aWV3UmVwb3NpdG9yeT47XG4gIGxldCBtb2NrUHJvZHVjdFJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPFByb2R1Y3RSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tPcmRlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1Jldmlld1JlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeVVzZXJJZDogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICAgIGNvdW50QnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIGdldEF2ZXJhZ2VSYXRpbmc6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRWZXJpZmllZFB1cmNoYXNlczogamVzdC5mbigpLFxuICAgICAgZmluZEhlbHBmdWw6IGplc3QuZm4oKSxcbiAgICAgIG1hcmtBc0hlbHBmdWw6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSA9IHtcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVSYXRpbmc6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tPcmRlclJlcG9zaXRvcnkgPSB7XG4gICAgICBmaW5kQnlVc2VySWQ6IGplc3QuZm4oKSxcbiAgICAgIGhhc1VzZXJQdXJjaGFzZWRQcm9kdWN0OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICByZXZpZXdTZXJ2aWNlID0gbmV3IFJldmlld1NlcnZpY2UoXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnlcbiAgICApO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUmV2aWV3JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgcmV2aWV3IGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA1LFxuICAgICAgICB0aXRsZTogJ0V4Y2VsbGVudCBwcm9kdWN0IScsXG4gICAgICAgIGNvbW1lbnQ6ICdUaGlzIHByb2R1Y3QgZXhjZWVkZWQgbXkgZXhwZWN0YXRpb25zLicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUHJvZHVjdCA9IHsgaWQ6ICdwcm9kLTEnLCBuYW1lOiAnVGVzdCBQcm9kdWN0JyB9O1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg1LjApO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBtb2NrUmV2aWV3ID0ge1xuICAgICAgICBpZDogJ3Jldmlldy0xJyxcbiAgICAgICAgLi4ucmV2aWV3RHRvLFxuICAgICAgICBpc1ZlcmlmaWVkUHVyY2hhc2U6IGZhbHNlLFxuICAgICAgICBoZWxwZnVsQ291bnQ6IDAsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jldmlldyk7XG4gICAgICBleHBlY3QobW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYXJrIHJldmlldyBhcyB2ZXJpZmllZCBwdXJjaGFzZSBpZiB1c2VyIGJvdWdodCB0aGUgcHJvZHVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJldmlld0R0bzogQ3JlYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIHRpdGxlOiAnR3JlYXQhJyxcbiAgICAgICAgY29tbWVudDogJ0xvdmUgaXQhJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncHJvZC0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5Lmhhc1VzZXJQdXJjaGFzZWRQcm9kdWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmdldEF2ZXJhZ2VSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoNS4wKTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgbW9ja1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIC4uLnJldmlld0R0byxcbiAgICAgICAgaXNWZXJpZmllZFB1cmNoYXNlOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZlcmlmaWVkUHVyY2hhc2UpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZXZpZXcgd2l0aCByYXRpbmcgYmVsb3cgMScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJldmlld0R0bzogQ3JlYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICByYXRpbmc6IDAsXG4gICAgICAgIHRpdGxlOiAnQmFkJyxcbiAgICAgICAgY29tbWVudDogJ1RlcnJpYmxlJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZXZpZXdTZXJ2aWNlLmNyZWF0ZVJldmlldyhyZXZpZXdEdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChyZXZpZXdTZXJ2aWNlLmNyZWF0ZVJldmlldyhyZXZpZXdEdG8pKS5yZWplY3RzLnRvVGhyb3coJ1JhdGluZyBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmV2aWV3IHdpdGggcmF0aW5nIGFib3ZlIDUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcmF0aW5nOiA2LFxuICAgICAgICB0aXRsZTogJ0FtYXppbmcnLFxuICAgICAgICBjb21tZW50OiAnQmVzdCBldmVyJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZXZpZXdTZXJ2aWNlLmNyZWF0ZVJldmlldyhyZXZpZXdEdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHJldmlldyBmb3Igbm9uLWV4aXN0ZW50IHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXZpZXdEdG86IENyZWF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcHJvZHVjdElkOiAnaW52YWxpZCcsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNSxcbiAgICAgICAgdGl0bGU6ICdHcmVhdCcsXG4gICAgICAgIGNvbW1lbnQ6ICdFeGNlbGxlbnQnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBOb3RGb3VuZEVycm9yKCdQcm9kdWN0IG5vdCBmb3VuZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0bykpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGR1cGxpY2F0ZSByZXZpZXcgZnJvbSBzYW1lIHVzZXIgZm9yIHNhbWUgcHJvZHVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJldmlld0R0bzogQ3JlYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIHRpdGxlOiAnR3JlYXQnLFxuICAgICAgICBjb21tZW50OiAnTG92ZSBpdCcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3Byb2QtMScgfSBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgeyBpZDogJ2V4aXN0aW5nJywgdXNlcklkOiAndXNlci0xJywgcHJvZHVjdElkOiAncHJvZC0xJyB9LFxuICAgICAgXSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFcnJvcik7XG4gICAgICBhd2FpdCBleHBlY3QocmV2aWV3U2VydmljZS5jcmVhdGVSZXZpZXcocmV2aWV3RHRvKSkucmVqZWN0cy50b1Rocm93KCdhbHJlYWR5IHJldmlld2VkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwcm9kdWN0IGF2ZXJhZ2UgcmF0aW5nIGFmdGVyIHJldmlldyBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJldmlld0R0bzogQ3JlYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIHRpdGxlOiAnR3JlYXQnLFxuICAgICAgICBjb21tZW50OiAnRXhjZWxsZW50JyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncHJvZC0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdyZXZpZXctMScsIC4uLnJldmlld0R0byB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuNSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJvZC0xJywgNC41LCAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgcmV2aWV3IHdpdGggb25seSByYXRpbmcgKG5vIGNvbW1lbnQpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmV2aWV3RHRvOiBDcmVhdGVSZXZpZXdEdG8gPSB7XG4gICAgICAgIHByb2R1Y3RJZDogJ3Byb2QtMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncHJvZC0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjApO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdyZXZpZXctMScsIC4uLnJldmlld0R0byB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuY3JlYXRlUmV2aWV3KHJldmlld0R0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmF0aW5nKS50b0JlKDQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21tZW50KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQcm9kdWN0UmV2aWV3cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgcmV2aWV3cyBmb3IgYSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgcHJvZHVjdElkOiAncHJvZC0xJywgcmF0aW5nOiA1LCBjb21tZW50OiAnR3JlYXQnIH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcHJvZHVjdElkOiAncHJvZC0xJywgcmF0aW5nOiA0LCBjb21tZW50OiAnR29vZCcgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFByb2R1Y3RSZXZpZXdzKCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5yYXRpbmcpLnRvQmUoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCByZXZpZXdzIHdpdGggcGFnaW5hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXZpZXdzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+ICh7XG4gICAgICAgIGlkOiBgcmV2aWV3LSR7aX1gLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICByYXRpbmc6IDUsXG4gICAgICB9KSk7XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFByb2R1Y3RSZXZpZXdzKCdwcm9kLTEnLCB7IHBhZ2U6IDEsIGxpbWl0OiA1IH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciByZXZpZXdzIGJ5IG1pbmltdW0gcmF0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgcmF0aW5nOiA1IH0sXG4gICAgICAgIHsgaWQ6ICcyJywgcmF0aW5nOiA0IH0sXG4gICAgICAgIHsgaWQ6ICczJywgcmF0aW5nOiAzIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jldmlld3MgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRQcm9kdWN0UmV2aWV3cygncHJvZC0xJywgeyBtaW5SYXRpbmc6IDQgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZXZlcnkociA9PiByLnJhdGluZyA+PSA0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCByZXZpZXdzIGJ5IG1vc3QgaGVscGZ1bCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXZpZXdzID0gW1xuICAgICAgICB7IGlkOiAnMScsIGhlbHBmdWxDb3VudDogMTAgfSxcbiAgICAgICAgeyBpZDogJzInLCBoZWxwZnVsQ291bnQ6IDUwIH0sXG4gICAgICAgIHsgaWQ6ICczJywgaGVscGZ1bENvdW50OiA1IH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jldmlld3MgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRQcm9kdWN0UmV2aWV3cygncHJvZC0xJywgeyBzb3J0Qnk6ICdoZWxwZnVsJyB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5oZWxwZnVsQ291bnQpLnRvQmVHcmVhdGVyVGhhbihyZXN1bHRbMV0uaGVscGZ1bENvdW50KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IG9ubHkgdmVyaWZpZWQgcHVyY2hhc2UgcmV2aWV3cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXZpZXdzID0gW1xuICAgICAgICB7IGlkOiAnMScsIGlzVmVyaWZpZWRQdXJjaGFzZTogdHJ1ZSB9LFxuICAgICAgICB7IGlkOiAnMicsIGlzVmVyaWZpZWRQdXJjaGFzZTogZmFsc2UgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRWZXJpZmllZFB1cmNoYXNlcy5tb2NrUmVzb2x2ZWRWYWx1ZShbbW9ja1Jldmlld3NbMF1dIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0UHJvZHVjdFJldmlld3MoJ3Byb2QtMScsIHsgdmVyaWZpZWRPbmx5OiB0cnVlIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmV2ZXJ5KHIgPT4gci5pc1ZlcmlmaWVkUHVyY2hhc2UpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlclJldmlld3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgYWxsIHJldmlld3MgYnkgYSB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgaWQ6ICcxJywgdXNlcklkOiAndXNlci0xJywgcHJvZHVjdElkOiAncHJvZC0xJyB9LFxuICAgICAgICB7IGlkOiAnMicsIHVzZXJJZDogJ3VzZXItMScsIHByb2R1Y3RJZDogJ3Byb2QtMicgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3cyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFVzZXJSZXZpZXdzKCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlUmV2aWV3JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIGEgcmV2aWV3JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXhpc3RpbmdSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICByYXRpbmc6IDQsXG4gICAgICAgIGNvbW1lbnQ6ICdHb29kJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICByYXRpbmc6IDUsXG4gICAgICAgIGNvbW1lbnQ6ICdBY3R1YWxseSwgaXRcXCdzIGV4Y2VsbGVudCEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdSZXZpZXcgYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLmV4aXN0aW5nUmV2aWV3LCAuLi51cGRhdGVEdG8gfSBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjUpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtleGlzdGluZ1Jldmlld10gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS51cGRhdGVSZXZpZXcoJ3Jldmlldy0xJywgJ3VzZXItMScsIHVwZGF0ZUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmF0aW5nKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21tZW50KS50b0NvbnRhaW4oJ2V4Y2VsbGVudCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBvbmx5IGFsbG93IHVzZXIgdG8gdXBkYXRlIHRoZWlyIG93biByZXZpZXcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHJhdGluZzogNCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKGV4aXN0aW5nUmV2aWV3IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlUmV2aWV3RHRvID0ge1xuICAgICAgICByYXRpbmc6IDUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHJldmlld1NlcnZpY2UudXBkYXRlUmV2aWV3KCdyZXZpZXctMScsICd1c2VyLTInLCB1cGRhdGVEdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwcm9kdWN0IHJhdGluZyBhZnRlciByZXZpZXcgdXBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXhpc3RpbmdSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgICByYXRpbmc6IDMsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB1cGRhdGVEdG86IFVwZGF0ZVJldmlld0R0byA9IHtcbiAgICAgICAgcmF0aW5nOiA1LFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdSZXZpZXcgYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLmV4aXN0aW5nUmV2aWV3LCAuLi51cGRhdGVEdG8gfSBhcyBhbnkpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjcpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtleGlzdGluZ1Jldmlld10gYXMgYW55KTtcbiAgICAgIG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgYXdhaXQgcmV2aWV3U2VydmljZS51cGRhdGVSZXZpZXcoJ3Jldmlldy0xJywgJ3VzZXItMScsIHVwZGF0ZUR0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncHJvZC0xJywgNC43LCAxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZVJldmlldycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBhIHJldmlldycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmV2aWV3ID0ge1xuICAgICAgICBpZDogJ3Jldmlldy0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgcHJvZHVjdElkOiAncHJvZC0xJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKGV4aXN0aW5nUmV2aWV3IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmdldEF2ZXJhZ2VSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoNC4wKTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmZpbmRCeVByb2R1Y3RJZC5tb2NrUmVzb2x2ZWRWYWx1ZShbXSBhcyBhbnkpO1xuICAgICAgbW9ja1Byb2R1Y3RSZXBvc2l0b3J5LnVwZGF0ZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCByZXZpZXdTZXJ2aWNlLmRlbGV0ZVJldmlldygncmV2aWV3LTEnLCAndXNlci0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmV2aWV3UmVwb3NpdG9yeS5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdyZXZpZXctMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBvbmx5IGFsbG93IHVzZXIgdG8gZGVsZXRlIHRoZWlyIG93biByZXZpZXcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1JldmlldyBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHJldmlld1NlcnZpY2UuZGVsZXRlUmV2aWV3KCdyZXZpZXctMScsICd1c2VyLTInKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgcHJvZHVjdCByYXRpbmcgYWZ0ZXIgcmV2aWV3IGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXhpc3RpbmdSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICB1c2VySWQ6ICd1c2VyLTEnLFxuICAgICAgICBwcm9kdWN0SWQ6ICdwcm9kLTEnLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoZXhpc3RpbmdSZXZpZXcgYXMgYW55KTtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmRlbGV0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjIpO1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKFtdIGFzIGFueSk7XG4gICAgICBtb2NrUHJvZHVjdFJlcG9zaXRvcnkudXBkYXRlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IHJldmlld1NlcnZpY2UuZGVsZXRlUmV2aWV3KCdyZXZpZXctMScsICd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tQcm9kdWN0UmVwb3NpdG9yeS51cGRhdGVSYXRpbmcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcm9kLTEnLCA0LjIsIDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWFya1Jldmlld0FzSGVscGZ1bCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgYSByZXZpZXcgYXMgaGVscGZ1bCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXZpZXcgPSB7XG4gICAgICAgIGlkOiAncmV2aWV3LTEnLFxuICAgICAgICBoZWxwZnVsQ291bnQ6IDUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3IGFzIGFueSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5tYXJrQXNIZWxwZnVsLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IHJldmlld1NlcnZpY2UubWFya1Jldmlld0FzSGVscGZ1bCgncmV2aWV3LTEnLCAndXNlci0yJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmV2aWV3UmVwb3NpdG9yeS5tYXJrQXNIZWxwZnVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncmV2aWV3LTEnLCAndXNlci0yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgdXNlciBmcm9tIG1hcmtpbmcgdGhlaXIgb3duIHJldmlldyBhcyBoZWxwZnVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JldmlldyA9IHtcbiAgICAgICAgaWQ6ICdyZXZpZXctMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcmV2aWV3U2VydmljZS5tYXJrUmV2aWV3QXNIZWxwZnVsKCdyZXZpZXctMScsICd1c2VyLTEnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2R1Y3RSYXRpbmdEaXN0cmlidXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgcmF0aW5nIGRpc3RyaWJ1dGlvbiBmb3IgYSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jldmlld3MgPSBbXG4gICAgICAgIHsgcmF0aW5nOiA1IH0sXG4gICAgICAgIHsgcmF0aW5nOiA1IH0sXG4gICAgICAgIHsgcmF0aW5nOiA0IH0sXG4gICAgICAgIHsgcmF0aW5nOiAzIH0sXG4gICAgICAgIHsgcmF0aW5nOiAxIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jldmlld3MgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRQcm9kdWN0UmF0aW5nRGlzdHJpYnV0aW9uKCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5maXZlU3RhcnMpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0LmZvdXJTdGFycykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGhyZWVTdGFycykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudHdvU3RhcnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm9uZVN0YXJzKS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0QXZlcmFnZVJhdGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBhdmVyYWdlIHJhdGluZyBmb3IgYSBwcm9kdWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1Jldmlld1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSg0LjMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldEF2ZXJhZ2VSYXRpbmcoJ3Byb2QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDQuMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiAwIGZvciBwcm9kdWN0IHdpdGggbm8gcmV2aWV3cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmdldEF2ZXJhZ2VSYXRpbmcubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmlld1NlcnZpY2UuZ2V0QXZlcmFnZVJhdGluZygncHJvZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRSZXZpZXdDb3VudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCB0b3RhbCByZXZpZXcgY291bnQgZm9yIGEgcHJvZHVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXZpZXdSZXBvc2l0b3J5LmNvdW50QnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoNDIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXZpZXdTZXJ2aWNlLmdldFJldmlld0NvdW50KCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg0Mik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRSZXZpZXdTdW1tYXJ5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGNvbXBsZXRlIHJldmlldyBzdW1tYXJ5IGZvciBhIHByb2R1Y3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKDQuNSk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5jb3VudEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKDEwMCk7XG4gICAgICBtb2NrUmV2aWV3UmVwb3NpdG9yeS5maW5kQnlQcm9kdWN0SWQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIEFycmF5KDEwMCkuZmlsbCh7IHJhdGluZzogNC41IH0pIGFzIGFueVxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmV2aWV3U2VydmljZS5nZXRSZXZpZXdTdW1tYXJ5KCdwcm9kLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5hdmVyYWdlUmF0aW5nKS50b0JlKDQuNSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUmV2aWV3cykudG9CZSgxMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kaXN0cmlidXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=