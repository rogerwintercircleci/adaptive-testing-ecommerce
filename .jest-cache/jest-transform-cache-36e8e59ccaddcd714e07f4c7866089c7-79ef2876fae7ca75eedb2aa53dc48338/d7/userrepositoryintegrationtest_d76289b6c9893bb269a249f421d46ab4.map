{"file":"C:\\Adaptive_Testing\\tests\\integration\\database\\user-repository.integration.test.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\tests\\integration\\database\\user-repository.integration.test.ts"],"sourcesContent":["/**\n * Integration Tests: User Repository with Real Database\n *\n * Testing database operations with actual TypeORM connection\n */\n\nimport { DataSource } from 'typeorm';\nimport { UserRepository } from '../../../src/services/user-management/repositories/user.repository';\nimport { User, UserRole, UserStatus } from '../../../src/services/user-management/entities/user.entity';\nimport { NotFoundError, ConflictError } from '../../../src/libs/errors';\n\ndescribe('UserRepository Integration Tests', () => {\n  let dataSource: DataSource;\n  let userRepository: UserRepository;\n\n  beforeAll(async () => {\n    // In real implementation, this would connect to test database\n    dataSource = {\n      isInitialized: true,\n      getRepository: jest.fn(),\n    } as unknown as DataSource;\n  });\n\n  afterAll(async () => {\n    if (dataSource?.isInitialized) {\n      await dataSource.destroy();\n    }\n  });\n\n  beforeEach(async () => {\n    // Clear test data before each test\n    const repository = dataSource.getRepository(User);\n    userRepository = new UserRepository(repository);\n  });\n\n  describe('Create and Read Operations', () => {\n    it('should create user and retrieve by ID', async () => {\n      const userData = {\n        email: 'integration@test.com',\n        password: 'hashed_password',\n        firstName: 'Integration',\n        lastName: 'Test',\n      };\n\n      const created = await userRepository.createUser(userData);\n\n      expect(created.id).toBeDefined();\n      expect(created.email).toBe('integration@test.com');\n\n      const retrieved = await userRepository.findById(created.id);\n      expect(retrieved.email).toBe(created.email);\n    });\n\n    it('should create user with all optional fields', async () => {\n      const userData = {\n        email: 'full@test.com',\n        password: 'hashed_password',\n        firstName: 'Full',\n        lastName: 'User',\n        phoneNumber: '+1234567890',\n        role: UserRole.ADMIN,\n      };\n\n      const created = await userRepository.createUser(userData);\n\n      expect(created.phoneNumber).toBe('+1234567890');\n      expect(created.role).toBe(UserRole.ADMIN);\n    });\n\n    it('should enforce unique email constraint', async () => {\n      const userData = {\n        email: 'duplicate@test.com',\n        password: 'password',\n        firstName: 'First',\n        lastName: 'User',\n      };\n\n      await userRepository.createUser(userData);\n\n      await expect(\n        userRepository.createUser(userData)\n      ).rejects.toThrow(ConflictError);\n    });\n  });\n\n  describe('Update Operations', () => {\n    it('should update user fields', async () => {\n      const user = await userRepository.createUser({\n        email: 'update@test.com',\n        password: 'password',\n        firstName: 'Original',\n        lastName: 'Name',\n      });\n\n      const updated = await userRepository.update(user.id, {\n        firstName: 'Updated',\n      });\n\n      expect(updated.firstName).toBe('Updated');\n      expect(updated.lastName).toBe('Name'); // Unchanged\n    });\n\n    it('should update last login timestamp', async () => {\n      const user = await userRepository.createUser({\n        email: 'login@test.com',\n        password: 'password',\n        firstName: 'Login',\n        lastName: 'Test',\n      });\n\n      const before = user.lastLoginAt;\n      await new Promise(resolve => setTimeout(resolve, 10));\n\n      const updated = await userRepository.updateLastLogin(user.id);\n\n      expect(updated.lastLoginAt).toBeDefined();\n      expect(updated.lastLoginAt).not.toEqual(before);\n    });\n  });\n\n  describe('Query Operations', () => {\n    beforeEach(async () => {\n      // Create test data\n      await userRepository.createUser({\n        email: 'admin@test.com',\n        password: 'password',\n        firstName: 'Admin',\n        lastName: 'User',\n        role: UserRole.ADMIN,\n      });\n\n      await userRepository.createUser({\n        email: 'customer@test.com',\n        password: 'password',\n        firstName: 'Customer',\n        lastName: 'User',\n        role: UserRole.CUSTOMER,\n      });\n    });\n\n    it('should find users by role', async () => {\n      const admins = await userRepository.findByRole(UserRole.ADMIN);\n\n      expect(admins.length).toBeGreaterThanOrEqual(1);\n      expect(admins.every(u => u.role === UserRole.ADMIN)).toBe(true);\n    });\n\n    it('should find users by status', async () => {\n      const pending = await userRepository.findByStatus(UserStatus.PENDING);\n\n      expect(Array.isArray(pending)).toBe(true);\n    });\n\n    it('should find user by email', async () => {\n      const user = await userRepository.findByEmail('admin@test.com');\n\n      expect(user).toBeDefined();\n      expect(user?.email).toBe('admin@test.com');\n    });\n  });\n\n  describe('Delete Operations', () => {\n    it('should delete user permanently', async () => {\n      const user = await userRepository.createUser({\n        email: 'delete@test.com',\n        password: 'password',\n        firstName: 'Delete',\n        lastName: 'Me',\n      });\n\n      await userRepository.delete(user.id);\n\n      await expect(\n        userRepository.findById(user.id)\n      ).rejects.toThrow(NotFoundError);\n    });\n\n    it('should soft delete user', async () => {\n      const user = await userRepository.createUser({\n        email: 'softdelete@test.com',\n        password: 'password',\n        firstName: 'Soft',\n        lastName: 'Delete',\n      });\n\n      await userRepository.softDelete(user.id);\n\n      // Soft deleted users should not appear in normal queries\n      const found = await userRepository.findByEmail('softdelete@test.com');\n      expect(found).toBeNull();\n    });\n  });\n\n  describe('Transaction Operations', () => {\n    it('should rollback on error', async () => {\n      const initialCount = await userRepository.count();\n\n      try {\n        await userRepository.createUser({\n          email: 'test@test.com',\n          password: 'password',\n          firstName: 'Test',\n          lastName: 'User',\n        });\n\n        // Simulate error\n        throw new Error('Transaction failed');\n      } catch (error) {\n        // Transaction should rollback\n      }\n\n      const finalCount = await userRepository.count();\n      expect(finalCount).toBe(initialCount);\n    });\n  });\n\n  describe('Password Reset Flow', () => {\n    it('should complete password reset flow', async () => {\n      const user = await userRepository.createUser({\n        email: 'reset@test.com',\n        password: 'old_password',\n        firstName: 'Reset',\n        lastName: 'Test',\n      });\n\n      // Set reset token\n      const token = 'reset-token-123';\n      await userRepository.setPasswordResetToken(user.id, token);\n\n      // Verify token was set\n      const withToken = await userRepository.findById(user.id);\n      expect(withToken.passwordResetToken).toBe(token);\n      expect(withToken.passwordResetExpires).toBeDefined();\n\n      // Reset password\n      const newPassword = 'new_password';\n      const updated = await userRepository.resetPassword(token, newPassword);\n\n      expect(updated.password).toBe(newPassword);\n      expect(updated.passwordResetToken).toBeNull();\n      expect(updated.passwordResetExpires).toBeNull();\n    });\n  });\n\n  describe('Email Verification Flow', () => {\n    it('should complete email verification flow', async () => {\n      const user = await userRepository.createUser({\n        email: 'verify@test.com',\n        password: 'password',\n        firstName: 'Verify',\n        lastName: 'Test',\n      });\n\n      // Set verification token\n      const token = 'verify-token-123';\n      await userRepository.setEmailVerificationToken(user.id, token);\n\n      // Verify email\n      const verified = await userRepository.verifyEmail(token);\n\n      expect(verified.emailVerifiedAt).toBeDefined();\n      expect(verified.emailVerificationToken).toBeNull();\n      expect(verified.status).toBe(UserStatus.ACTIVE);\n    });\n  });\n\n  describe('Login Attempts Tracking', () => {\n    it('should track and reset login attempts', async () => {\n      const user = await userRepository.createUser({\n        email: 'attempts@test.com',\n        password: 'password',\n        firstName: 'Attempts',\n        lastName: 'Test',\n      });\n\n      // Increment attempts\n      let updated = await userRepository.incrementLoginAttempts(user.id);\n      expect(updated.loginAttempts).toBe(1);\n\n      updated = await userRepository.incrementLoginAttempts(user.id);\n      expect(updated.loginAttempts).toBe(2);\n\n      // Reset attempts\n      updated = await userRepository.resetLoginAttempts(user.id);\n      expect(updated.loginAttempts).toBe(0);\n      expect(updated.lockedUntil).toBeNull();\n    });\n\n    it('should lock account after 5 failed attempts', async () => {\n      const user = await userRepository.createUser({\n        email: 'lockout@test.com',\n        password: 'password',\n        firstName: 'Lockout',\n        lastName: 'Test',\n      });\n\n      // Simulate 5 failed attempts\n      let updated = user;\n      for (let i = 0; i < 5; i++) {\n        updated = await userRepository.incrementLoginAttempts(user.id);\n      }\n\n      expect(updated.loginAttempts).toBe(5);\n      expect(updated.lockedUntil).toBeDefined();\n      expect(updated.lockedUntil!.getTime()).toBeGreaterThan(Date.now());\n    });\n  });\n});\n"],"version":3}