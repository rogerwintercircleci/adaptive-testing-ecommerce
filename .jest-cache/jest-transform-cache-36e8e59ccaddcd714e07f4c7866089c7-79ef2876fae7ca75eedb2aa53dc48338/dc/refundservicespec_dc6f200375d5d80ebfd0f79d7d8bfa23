9e7df43f31f46de96d9f3fdc1211c31d
"use strict";
/**
 * TDD: Refund & Return Service Tests
 *
 * Testing refund requests, return processing, and restock logic
 */
Object.defineProperty(exports, "__esModule", { value: true });
const refund_service_1 = require("./refund.service");
const errors_1 = require("@libs/errors");
const order_entity_1 = require("../entities/order.entity");
describe('RefundService', () => {
    let refundService;
    let mockRefundRepository;
    let mockOrderRepository;
    let mockInventoryRepository;
    let mockPaymentGatewayService;
    let mockShippingProviderService;
    beforeEach(() => {
        mockRefundRepository = {
            create: jest.fn(),
            findById: jest.fn(),
            findByOrderId: jest.fn(),
            findByUserId: jest.fn(),
            findByTrackingNumber: jest.fn(),
            update: jest.fn(),
            updateStatus: jest.fn(),
            updateReturnStatus: jest.fn(),
            countByStatus: jest.fn(),
            getTotalRefundedAmount: jest.fn(),
        };
        mockOrderRepository = {
            findById: jest.fn(),
            update: jest.fn(),
        };
        mockInventoryRepository = {
            findByProductId: jest.fn(),
            update: jest.fn(),
            recordAdjustment: jest.fn(),
        };
        mockPaymentGatewayService = {
            refundPayment: jest.fn(),
        };
        mockShippingProviderService = {
            createReturnLabel: jest.fn(),
            trackShipment: jest.fn(),
        };
        refundService = new refund_service_1.RefundService(mockRefundRepository, mockOrderRepository, mockInventoryRepository, mockPaymentGatewayService, mockShippingProviderService);
    });
    describe('createRefundRequest', () => {
        it('should create a refund request', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                description: 'Product was damaged',
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
                photos: ['photo1.jpg'],
            };
            const mockOrder = {
                id: 'order-1',
                userId: 'user-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 100,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 100, subtotal: 100 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                ...refundDto,
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.status).toBe(refund_service_1.RefundStatus.PENDING);
            expect(result.refundAmount).toBe(100);
        });
        it('should reject refund request for non-existent order', async () => {
            const refundDto = {
                orderId: 'invalid',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [],
            };
            mockOrderRepository.findById.mockRejectedValue(new errors_1.NotFoundError('Order not found'));
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.NotFoundError);
        });
        it('should reject refund request for unpaid order', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const mockOrder = {
                id: 'order-1',
                paymentStatus: order_entity_1.PaymentStatus.PENDING,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Order must be paid to request a refund');
        });
        it('should reject refund request after return window expired', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.CHANGED_MIND,
                items: [],
            };
            const sixtyDaysAgo = new Date();
            sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: sixtyDaysAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Return window of 30 days has expired');
        });
        it('should calculate partial refund amount for partial return', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
                photos: ['photo1.jpg'],
            };
            const mockOrder = {
                id: 'order-1',
                userId: 'user-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                total: 200,
                deliveredAt: new Date(),
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 50, subtotal: 50 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 150, subtotal: 150 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const mockRefund = {
                id: 'refund-1',
                refundAmount: 50,
            };
            mockRefundRepository.create.mockResolvedValue(mockRefund);
            const result = await refundService.createRefundRequest(refundDto);
            expect(result.refundAmount).toBe(50);
        });
        it('should require photos for defective items', async () => {
            const refundDto = {
                orderId: 'order-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                items: [{ productId: 'prod-1', quantity: 1 }],
                photos: [],
            };
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(errors_1.BadRequestError);
            await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Photos are required for defective or damaged items');
        });
    });
    describe('approveRefund', () => {
        it('should approve a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 100,
                items: [{ productId: 'prod-1', quantity: 1 }],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
        });
        it('should approve partial refund with adjusted amount', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
                refundAmount: 75,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.APPROVED,
            });
            const result = await refundService.approveRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.APPROVED);
            expect(result.refundAmount).toBe(75);
        });
    });
    describe('rejectRefund', () => {
        it('should reject a refund request', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            const updatedRefund = {
                ...mockRefund,
                status: refund_service_1.RefundStatus.REJECTED,
                rejectionReason: 'Outside return window',
            };
            mockRefundRepository.findById
                .mockResolvedValueOnce(mockRefund)
                .mockResolvedValueOnce(updatedRefund);
            mockRefundRepository.update.mockResolvedValue(updatedRefund);
            const result = await refundService.rejectRefund('refund-1', 'Outside return window');
            expect(result.status).toBe(refund_service_1.RefundStatus.REJECTED);
            expect(result.rejectionReason).toBe('Outside return window');
        });
    });
    describe('processRefund', () => {
        it('should process approved refund and issue payment', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                refundAmount: 100,
                restockItems: false,
                items: [],
            };
            const completedRefund = {
                ...mockRefund,
                status: refund_service_1.RefundStatus.COMPLETED,
                processedAt: new Date(),
            };
            mockRefundRepository.findById
                .mockResolvedValueOnce(mockRefund)
                .mockResolvedValueOnce(completedRefund);
            mockRefundRepository.updateStatus.mockResolvedValue({
                ...mockRefund,
                status: refund_service_1.RefundStatus.PROCESSING,
            });
            mockOrderRepository.findById.mockResolvedValue({ id: 'order-1' });
            mockPaymentGatewayService.refundPayment.mockResolvedValue({ success: true, refundId: 'ref-123' });
            mockRefundRepository.update.mockResolvedValue(completedRefund);
            const result = await refundService.processRefund('refund-1');
            expect(result.status).toBe(refund_service_1.RefundStatus.COMPLETED);
            expect(result.processedAt).toBeDefined();
        });
        it('should not process refund that is not approved', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.PENDING,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await expect(refundService.processRefund('refund-1')).rejects.toThrow(errors_1.BadRequestError);
        });
    });
    describe('restockItems', () => {
        it('should restock returned items to inventory', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
                restockItems: true,
                items: [
                    { productId: 'prod-1', quantity: 2 },
                    { productId: 'prod-2', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 10 });
            mockInventoryRepository.update.mockResolvedValue({});
            mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).toHaveBeenCalledTimes(2);
            expect(mockInventoryRepository.update).toHaveBeenCalledWith('prod-1', {
                quantity: 12,
            });
            expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);
        });
        it('should not restock defective items', async () => {
            const mockRefund = {
                id: 'refund-1',
                reason: refund_service_1.ReturnReason.DEFECTIVE,
                restockItems: false,
                items: [
                    { productId: 'prod-1', quantity: 1 },
                ],
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            await refundService.restockItems('refund-1');
            expect(mockInventoryRepository.update).not.toHaveBeenCalled();
        });
    });
    describe('getUserRefunds', () => {
        it('should get all refund requests for a user', async () => {
            const mockRefunds = [
                { id: '1', userId: 'user-1', status: refund_service_1.RefundStatus.COMPLETED },
                { id: '2', userId: 'user-1', status: refund_service_1.RefundStatus.PENDING },
            ];
            mockRefundRepository.findByUserId.mockResolvedValue(mockRefunds);
            const result = await refundService.getUserRefunds('user-1');
            expect(result).toHaveLength(2);
        });
    });
    describe('calculateRefundAmount', () => {
        it('should calculate full refund amount', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                taxAmount: 15,
                shippingCost: 10,
                subtotal: 125,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBeGreaterThan(0);
        });
        it('should calculate partial refund for subset of items', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 250,
                subtotal: 225,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 100 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 125 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(100);
            expect(result.refundAmount).toBeLessThan(mockOrder.total);
        });
        it('should not include shipping in partial refund', async () => {
            const mockOrder = {
                id: 'order-1',
                total: 150,
                subtotal: 100,
                shippingCost: 10,
                items: [
                    { productId: 'prod-1', quantity: 1, unitPrice: 50 },
                    { productId: 'prod-2', quantity: 1, unitPrice: 50 },
                ],
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.calculateRefundAmount({
                orderId: 'order-1',
                items: [{ productId: 'prod-1', quantity: 1 }],
            });
            expect(result.refundAmount).toBe(50);
        });
    });
    describe('generateReturnLabel', () => {
        it('should generate return shipping label', async () => {
            const mockRefund = {
                id: 'refund-1',
                orderId: 'order-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            const mockOrder = {
                id: 'order-1',
                shippingAddress: {
                    street: '123 Main St',
                    city: 'City',
                    state: 'ST',
                    postalCode: '12345',
                    country: 'US',
                },
            };
            const mockLabel = {
                labelUrl: 'https://example.com/label.pdf',
                trackingNumber: '1Z999AA10123456784',
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            mockShippingProviderService.createReturnLabel.mockResolvedValue(mockLabel);
            mockRefundRepository.update.mockResolvedValue({});
            const result = await refundService.generateReturnLabel('refund-1');
            expect(result.labelUrl).toBeDefined();
            expect(result.trackingNumber).toBeDefined();
        });
    });
    describe('trackReturn', () => {
        it('should track return shipment status', async () => {
            const trackingNumber = '1Z999AA10123456784';
            const mockRefund = {
                id: 'refund-1',
                returnTrackingNumber: trackingNumber,
                returnStatus: 'LABEL_GENERATED',
            };
            const mockTrackingInfo = {
                status: 'in_transit',
                events: [
                    { timestamp: new Date(), status: 'picked_up', location: 'Origin' },
                ],
            };
            mockRefundRepository.findByTrackingNumber.mockResolvedValue(mockRefund);
            mockShippingProviderService.trackShipment.mockResolvedValue(mockTrackingInfo);
            mockRefundRepository.updateReturnStatus.mockResolvedValue({});
            const result = await refundService.trackReturn(trackingNumber);
            expect(result.status).toBeDefined();
            expect(result.refundId).toBe('refund-1');
        });
    });
    describe('markReturnAsReceived', () => {
        it('should mark return as received', async () => {
            const mockRefund = {
                id: 'refund-1',
                status: refund_service_1.RefundStatus.APPROVED,
            };
            mockRefundRepository.findById.mockResolvedValue(mockRefund);
            mockRefundRepository.updateReturnStatus.mockResolvedValue({
                ...mockRefund,
                returnStatus: 'received',
            });
            await refundService.markReturnAsReceived('refund-1');
            expect(mockRefundRepository.updateReturnStatus).toHaveBeenCalled();
        });
    });
    describe('getRefundStatistics', () => {
        it('should get refund statistics', async () => {
            mockRefundRepository.getTotalRefundedAmount.mockResolvedValue(150);
            mockRefundRepository.countByStatus.mockImplementation((status) => {
                if (status === refund_service_1.RefundStatus.PENDING)
                    return Promise.resolve(1);
                if (status === refund_service_1.RefundStatus.APPROVED)
                    return Promise.resolve(0);
                if (status === refund_service_1.RefundStatus.REJECTED)
                    return Promise.resolve(0);
                if (status === refund_service_1.RefundStatus.COMPLETED)
                    return Promise.resolve(2);
                return Promise.resolve(0);
            });
            const result = await refundService.getRefundStatistics();
            expect(result.totalRefunded).toBe(150);
            expect(result.pending).toBe(1);
            expect(result.completed).toBe(2);
        });
    });
    describe('checkEligibility', () => {
        it('should check if order is eligible for refund', async () => {
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: new Date(),
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(true);
        });
        it('should return false for order outside return window', async () => {
            const longAgo = new Date();
            longAgo.setDate(longAgo.getDate() - 100);
            const mockOrder = {
                id: 'order-1',
                status: order_entity_1.OrderStatus.DELIVERED,
                paymentStatus: order_entity_1.PaymentStatus.PAID,
                deliveredAt: longAgo,
            };
            mockOrderRepository.findById.mockResolvedValue(mockOrder);
            const result = await refundService.checkEligibility('order-1');
            expect(result.eligible).toBe(false);
            expect(result.issues.length).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxyZWZ1bmQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILHFEQUFxRztBQU1yRyx5Q0FBOEQ7QUFDOUQsMkRBQXNFO0FBRXRFLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksYUFBNEIsQ0FBQztJQUNqQyxJQUFJLG9CQUFtRCxDQUFDO0lBQ3hELElBQUksbUJBQWlELENBQUM7SUFDdEQsSUFBSSx1QkFBeUQsQ0FBQztJQUM5RCxJQUFJLHlCQUE2RCxDQUFDO0lBQ2xFLElBQUksMkJBQWlFLENBQUM7SUFFdEUsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG9CQUFvQixHQUFHO1lBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3hCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLG9CQUFvQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDL0IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDdkIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM3QixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN4QixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQzNCLENBQUM7UUFFVCxtQkFBbUIsR0FBRztZQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNYLENBQUM7UUFFVCx1QkFBdUIsR0FBRztZQUN4QixlQUFlLEVBQUUsSUFBSSxDQUFDLEVB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LE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcc2VydmljZXNcXG9yZGVyLXByb2Nlc3NpbmdcXHNlcnZpY2VzXFxyZWZ1bmQuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVEREOiBSZWZ1bmQgJiBSZXR1cm4gU2VydmljZSBUZXN0c1xuICpcbiAqIFRlc3RpbmcgcmVmdW5kIHJlcXVlc3RzLCByZXR1cm4gcHJvY2Vzc2luZywgYW5kIHJlc3RvY2sgbG9naWNcbiAqL1xuXG5pbXBvcnQgeyBSZWZ1bmRTZXJ2aWNlLCBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvLCBSZWZ1bmRTdGF0dXMsIFJldHVyblJlYXNvbiB9IGZyb20gJy4vcmVmdW5kLnNlcnZpY2UnO1xuaW1wb3J0IHsgUmVmdW5kUmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcmllcy9yZWZ1bmQucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBPcmRlclJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMvb3JkZXIucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBJbnZlbnRvcnlSZXBvc2l0b3J5IH0gZnJvbSAnLi4vLi4vaW52ZW50b3J5L3JlcG9zaXRvcmllcy9pbnZlbnRvcnkucmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBQYXltZW50R2F0ZXdheVNlcnZpY2UgfSBmcm9tICcuL3BheW1lbnQtZ2F0ZXdheS5zZXJ2aWNlJztcbmltcG9ydCB7IFNoaXBwaW5nUHJvdmlkZXJTZXJ2aWNlIH0gZnJvbSAnLi9zaGlwcGluZy1wcm92aWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEJhZFJlcXVlc3RFcnJvciwgTm90Rm91bmRFcnJvciB9IGZyb20gJ0BsaWJzL2Vycm9ycyc7XG5pbXBvcnQgeyBPcmRlclN0YXR1cywgUGF5bWVudFN0YXR1cyB9IGZyb20gJy4uL2VudGl0aWVzL29yZGVyLmVudGl0eSc7XG5cbmRlc2NyaWJlKCdSZWZ1bmRTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgcmVmdW5kU2VydmljZTogUmVmdW5kU2VydmljZTtcbiAgbGV0IG1vY2tSZWZ1bmRSZXBvc2l0b3J5OiBqZXN0Lk1vY2tlZDxSZWZ1bmRSZXBvc2l0b3J5PjtcbiAgbGV0IG1vY2tPcmRlclJlcG9zaXRvcnk6IGplc3QuTW9ja2VkPE9yZGVyUmVwb3NpdG9yeT47XG4gIGxldCBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeTogamVzdC5Nb2NrZWQ8SW52ZW50b3J5UmVwb3NpdG9yeT47XG4gIGxldCBtb2NrUGF5bWVudEdhdGV3YXlTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxQYXltZW50R2F0ZXdheVNlcnZpY2U+O1xuICBsZXQgbW9ja1NoaXBwaW5nUHJvdmlkZXJTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxTaGlwcGluZ1Byb3ZpZGVyU2VydmljZT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkgPSB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlPcmRlcklkOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlVc2VySWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeVRyYWNraW5nTnVtYmVyOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVN0YXR1czogamVzdC5mbigpLFxuICAgICAgdXBkYXRlUmV0dXJuU3RhdHVzOiBqZXN0LmZuKCksXG4gICAgICBjb3VudEJ5U3RhdHVzOiBqZXN0LmZuKCksXG4gICAgICBnZXRUb3RhbFJlZnVuZGVkQW1vdW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBtb2NrT3JkZXJSZXBvc2l0b3J5ID0ge1xuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkgPSB7XG4gICAgICBmaW5kQnlQcm9kdWN0SWQ6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgcmVjb3JkQWRqdXN0bWVudDogamVzdC5mbigpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgbW9ja1BheW1lbnRHYXRld2F5U2VydmljZSA9IHtcbiAgICAgIHJlZnVuZFBheW1lbnQ6IGplc3QuZm4oKSxcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tTaGlwcGluZ1Byb3ZpZGVyU2VydmljZSA9IHtcbiAgICAgIGNyZWF0ZVJldHVybkxhYmVsOiBqZXN0LmZuKCksXG4gICAgICB0cmFja1NoaXBtZW50OiBqZXN0LmZuKCksXG4gICAgfSBhcyBhbnk7XG5cbiAgICByZWZ1bmRTZXJ2aWNlID0gbmV3IFJlZnVuZFNlcnZpY2UoXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeSxcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnksXG4gICAgICBtb2NrSW52ZW50b3J5UmVwb3NpdG9yeSxcbiAgICAgIG1vY2tQYXltZW50R2F0ZXdheVNlcnZpY2UsXG4gICAgICBtb2NrU2hpcHBpbmdQcm92aWRlclNlcnZpY2VcbiAgICApO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUmVmdW5kUmVxdWVzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIHJlZnVuZCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVmdW5kRHRvOiBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvID0ge1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkRFRkVDVElWRSxcbiAgICAgICAgZGVzY3JpcHRpb246ICdQcm9kdWN0IHdhcyBkYW1hZ2VkJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHBob3RvczogWydwaG90bzEuanBnJ10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHVzZXJJZDogJ3VzZXItMScsXG4gICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuREVMSVZFUkVELFxuICAgICAgICBwYXltZW50U3RhdHVzOiBQYXltZW50U3RhdHVzLlBBSUQsXG4gICAgICAgIHRvdGFsOiAxMDAsXG4gICAgICAgIGRlbGl2ZXJlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogMTAwLCBzdWJ0b3RhbDogMTAwIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgLi4ucmVmdW5kRHRvLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDEwMCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShSZWZ1bmRTdGF0dXMuUEVORElORyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnVuZEFtb3VudCkudG9CZSgxMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgcmVmdW5kIHJlcXVlc3QgZm9yIG5vbi1leGlzdGVudCBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ2ludmFsaWQnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5ERUZFQ1RJVkUsXG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1JlamVjdGVkVmFsdWUobmV3IE5vdEZvdW5kRXJyb3IoJ09yZGVyIG5vdCBmb3VuZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZWZ1bmQgcmVxdWVzdCBmb3IgdW5wYWlkIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVmdW5kRHRvOiBDcmVhdGVSZWZ1bmRSZXF1ZXN0RHRvID0ge1xuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHJlYXNvbjogUmV0dXJuUmVhc29uLkNIQU5HRURfTUlORCxcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBwYXltZW50U3RhdHVzOiBQYXltZW50U3RhdHVzLlBFTkRJTkcsXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coJ09yZGVyIG11c3QgYmUgcGFpZCB0byByZXF1ZXN0IGEgcmVmdW5kJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCByZWZ1bmQgcmVxdWVzdCBhZnRlciByZXR1cm4gd2luZG93IGV4cGlyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uQ0hBTkdFRF9NSU5ELFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzaXh0eURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgICAgc2l4dHlEYXlzQWdvLnNldERhdGUoc2l4dHlEYXlzQWdvLmdldERhdGUoKSAtIDYwKTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLkRFTElWRVJFRCxcbiAgICAgICAgcGF5bWVudFN0YXR1czogUGF5bWVudFN0YXR1cy5QQUlELFxuICAgICAgICBkZWxpdmVyZWRBdDogc2l4dHlEYXlzQWdvLFxuICAgICAgfTtcblxuICAgICAgbW9ja09yZGVyUmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrT3JkZXIgYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICAgIGF3YWl0IGV4cGVjdChyZWZ1bmRTZXJ2aWNlLmNyZWF0ZVJlZnVuZFJlcXVlc3QocmVmdW5kRHRvKSkucmVqZWN0cy50b1Rocm93KCdSZXR1cm4gd2luZG93IG9mIDMwIGRheXMgaGFzIGV4cGlyZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHBhcnRpYWwgcmVmdW5kIGFtb3VudCBmb3IgcGFydGlhbCByZXR1cm4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWZ1bmREdG86IENyZWF0ZVJlZnVuZFJlcXVlc3REdG8gPSB7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfSxcbiAgICAgICAgXSxcbiAgICAgICAgcGhvdG9zOiBbJ3Bob3RvMS5qcGcnXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgdXNlcklkOiAndXNlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgdG90YWw6IDIwMCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiA1MCwgc3VidG90YWw6IDUwIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiAxNTAsIHN1YnRvdGFsOiAxNTAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDUwLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlKDUwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBwaG90b3MgZm9yIGRlZmVjdGl2ZSBpdGVtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlZnVuZER0bzogQ3JlYXRlUmVmdW5kUmVxdWVzdER0byA9IHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICByZWFzb246IFJldHVyblJlYXNvbi5ERUZFQ1RJVkUsXG4gICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgICAgcGhvdG9zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5jcmVhdGVSZWZ1bmRSZXF1ZXN0KHJlZnVuZER0bykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXJyb3IpO1xuICAgICAgYXdhaXQgZXhwZWN0KHJlZnVuZFNlcnZpY2UuY3JlYXRlUmVmdW5kUmVxdWVzdChyZWZ1bmREdG8pKS5yZWplY3RzLnRvVGhyb3coJ1Bob3RvcyBhcmUgcmVxdWlyZWQgZm9yIGRlZmVjdGl2ZSBvciBkYW1hZ2VkIGl0ZW1zJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhcHByb3ZlUmVmdW5kJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYXBwcm92ZSBhIHJlZnVuZCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiAxMDAsXG4gICAgICAgIGl0ZW1zOiBbeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSB9XSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmFwcHJvdmVSZWZ1bmQoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFJlZnVuZFN0YXR1cy5BUFBST1ZFRCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFwcHJvdmUgcGFydGlhbCByZWZ1bmQgd2l0aCBhZGp1c3RlZCBhbW91bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUEVORElORyxcbiAgICAgICAgcmVmdW5kQW1vdW50OiA3NSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmFwcHJvdmVSZWZ1bmQoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFJlZnVuZFN0YXR1cy5BUFBST1ZFRCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnVuZEFtb3VudCkudG9CZSg3NSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWplY3RSZWZ1bmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYSByZWZ1bmQgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdXBkYXRlZFJlZnVuZCA9IHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuUkVKRUNURUQsXG4gICAgICAgIHJlamVjdGlvblJlYXNvbjogJ091dHNpZGUgcmV0dXJuIHdpbmRvdycsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS5maW5kQnlJZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tSZWZ1bmQgYXMgYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHVwZGF0ZWRSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkUmVmdW5kIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UucmVqZWN0UmVmdW5kKCdyZWZ1bmQtMScsICdPdXRzaWRlIHJldHVybiB3aW5kb3cnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoUmVmdW5kU3RhdHVzLlJFSkVDVEVEKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVqZWN0aW9uUmVhc29uKS50b0JlKCdPdXRzaWRlIHJldHVybiB3aW5kb3cnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Byb2Nlc3NSZWZ1bmQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm9jZXNzIGFwcHJvdmVkIHJlZnVuZCBhbmQgaXNzdWUgcGF5bWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgICByZWZ1bmRBbW91bnQ6IDEwMCxcbiAgICAgICAgcmVzdG9ja0l0ZW1zOiBmYWxzZSxcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29tcGxldGVkUmVmdW5kID0ge1xuICAgICAgICAuLi5tb2NrUmVmdW5kLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5DT01QTEVURUQsXG4gICAgICAgIHByb2Nlc3NlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrUmVmdW5kIGFzIGFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShjb21wbGV0ZWRSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZVN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tSZWZ1bmQsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLlBST0NFU1NJTkcsXG4gICAgICB9IGFzIGFueSk7XG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdvcmRlci0xJyB9IGFzIGFueSk7XG4gICAgICBtb2NrUGF5bWVudEdhdGV3YXlTZXJ2aWNlLnJlZnVuZFBheW1lbnQubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlLCByZWZ1bmRJZDogJ3JlZi0xMjMnIH0gYXMgYW55KTtcbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjb21wbGV0ZWRSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5wcm9jZXNzUmVmdW5kKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShSZWZ1bmRTdGF0dXMuQ09NUExFVEVEKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucHJvY2Vzc2VkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBwcm9jZXNzIHJlZnVuZCB0aGF0IGlzIG5vdCBhcHByb3ZlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBzdGF0dXM6IFJlZnVuZFN0YXR1cy5QRU5ESU5HLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocmVmdW5kU2VydmljZS5wcm9jZXNzUmVmdW5kKCdyZWZ1bmQtMScpKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Jlc3RvY2tJdGVtcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc3RvY2sgcmV0dXJuZWQgaXRlbXMgdG8gaW52ZW50b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBSZWZ1bmRTdGF0dXMuQVBQUk9WRUQsXG4gICAgICAgIHJlc3RvY2tJdGVtczogdHJ1ZSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAyIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMSB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkuZmluZEJ5UHJvZHVjdElkLm1vY2tSZXNvbHZlZFZhbHVlKHsgcXVhbnRpdHk6IDEwIH0gYXMgYW55KTtcbiAgICAgIG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgICAgbW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVjb3JkQWRqdXN0bWVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCByZWZ1bmRTZXJ2aWNlLnJlc3RvY2tJdGVtcygncmVmdW5kLTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tJbnZlbnRvcnlSZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Byb2QtMScsIHtcbiAgICAgICAgcXVhbnRpdHk6IDEyLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja0ludmVudG9yeVJlcG9zaXRvcnkucmVjb3JkQWRqdXN0bWVudCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmVzdG9jayBkZWZlY3RpdmUgaXRlbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVmdW5kID0ge1xuICAgICAgICBpZDogJ3JlZnVuZC0xJyxcbiAgICAgICAgcmVhc29uOiBSZXR1cm5SZWFzb24uREVGRUNUSVZFLFxuICAgICAgICByZXN0b2NrSXRlbXM6IGZhbHNlLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcblxuICAgICAgYXdhaXQgcmVmdW5kU2VydmljZS5yZXN0b2NrSXRlbXMoJ3JlZnVuZC0xJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW52ZW50b3J5UmVwb3NpdG9yeS51cGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgZGVzY3JpYmUoJ2dldFVzZXJSZWZ1bmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFsbCByZWZ1bmQgcmVxdWVzdHMgZm9yIGEgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmRzID0gW1xuICAgICAgICB7IGlkOiAnMScsIHVzZXJJZDogJ3VzZXItMScsIHN0YXR1czogUmVmdW5kU3RhdHVzLkNPTVBMRVRFRCB9LFxuICAgICAgICB7IGlkOiAnMicsIHVzZXJJZDogJ3VzZXItMScsIHN0YXR1czogUmVmdW5kU3RhdHVzLlBFTkRJTkcgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVmdW5kcyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmdldFVzZXJSZWZ1bmRzKCd1c2VyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuICB9KTtcblxuXG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVSZWZ1bmRBbW91bnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgZnVsbCByZWZ1bmQgYW1vdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMTUwLFxuICAgICAgICB0YXhBbW91bnQ6IDE1LFxuICAgICAgICBzaGlwcGluZ0Nvc3Q6IDEwLFxuICAgICAgICBzdWJ0b3RhbDogMTI1LFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogMTI1IH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNhbGN1bGF0ZVJlZnVuZEFtb3VudCh7XG4gICAgICAgIG9yZGVySWQ6ICdvcmRlci0xJyxcbiAgICAgICAgaXRlbXM6IFt7IHByb2R1Y3RJZDogJ3Byb2QtMScsIHF1YW50aXR5OiAxIH1dLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBwYXJ0aWFsIHJlZnVuZCBmb3Igc3Vic2V0IG9mIGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICB0b3RhbDogMjUwLFxuICAgICAgICBzdWJ0b3RhbDogMjI1LFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogMTAwIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTInLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiAxMjUgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuY2FsY3VsYXRlUmVmdW5kQW1vdW50KHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfV0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kQW1vdW50KS50b0JlTGVzc1RoYW4obW9ja09yZGVyLnRvdGFsKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGluY2x1ZGUgc2hpcHBpbmcgaW4gcGFydGlhbCByZWZ1bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiAnb3JkZXItMScsXG4gICAgICAgIHRvdGFsOiAxNTAsXG4gICAgICAgIHN1YnRvdGFsOiAxMDAsXG4gICAgICAgIHNoaXBwaW5nQ29zdDogMTAsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6ICdwcm9kLTEnLCBxdWFudGl0eTogMSwgdW5pdFByaWNlOiA1MCB9LFxuICAgICAgICAgIHsgcHJvZHVjdElkOiAncHJvZC0yJywgcXVhbnRpdHk6IDEsIHVuaXRQcmljZTogNTAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UuY2FsY3VsYXRlUmVmdW5kQW1vdW50KHtcbiAgICAgICAgb3JkZXJJZDogJ29yZGVyLTEnLFxuICAgICAgICBpdGVtczogW3sgcHJvZHVjdElkOiAncHJvZC0xJywgcXVhbnRpdHk6IDEgfV0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWZ1bmRBbW91bnQpLnRvQmUoNTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVSZXR1cm5MYWJlbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHJldHVybiBzaGlwcGluZyBsYWJlbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICBvcmRlcklkOiAnb3JkZXItMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja09yZGVyID0ge1xuICAgICAgICBpZDogJ29yZGVyLTEnLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICBzdHJlZXQ6ICcxMjMgTWFpbiBTdCcsXG4gICAgICAgICAgY2l0eTogJ0NpdHknLFxuICAgICAgICAgIHN0YXRlOiAnU1QnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICcxMjM0NScsXG4gICAgICAgICAgY291bnRyeTogJ1VTJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tMYWJlbCA9IHtcbiAgICAgICAgbGFiZWxVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2xhYmVsLnBkZicsXG4gICAgICAgIHRyYWNraW5nTnVtYmVyOiAnMVo5OTlBQTEwMTIzNDU2Nzg0JyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tSZWZ1bmRSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWZ1bmQgYXMgYW55KTtcbiAgICAgIG1vY2tPcmRlclJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyIGFzIGFueSk7XG4gICAgICBtb2NrU2hpcHBpbmdQcm92aWRlclNlcnZpY2UuY3JlYXRlUmV0dXJuTGFiZWwubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xhYmVsIGFzIGFueSk7XG4gICAgICBtb2NrUmVmdW5kUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5nZW5lcmF0ZVJldHVybkxhYmVsKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmxhYmVsVXJsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50cmFja2luZ051bWJlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RyYWNrUmV0dXJuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcmV0dXJuIHNoaXBtZW50IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRyYWNraW5nTnVtYmVyID0gJzFaOTk5QUExMDEyMzQ1Njc4NCc7XG5cbiAgICAgIGNvbnN0IG1vY2tSZWZ1bmQgPSB7XG4gICAgICAgIGlkOiAncmVmdW5kLTEnLFxuICAgICAgICByZXR1cm5UcmFja2luZ051bWJlcjogdHJhY2tpbmdOdW1iZXIsXG4gICAgICAgIHJldHVyblN0YXR1czogJ0xBQkVMX0dFTkVSQVRFRCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrVHJhY2tpbmdJbmZvID0ge1xuICAgICAgICBzdGF0dXM6ICdpbl90cmFuc2l0JyxcbiAgICAgICAgZXZlbnRzOiBbXG4gICAgICAgICAgeyB0aW1lc3RhbXA6IG5ldyBEYXRlKCksIHN0YXR1czogJ3BpY2tlZF91cCcsIGxvY2F0aW9uOiAnT3JpZ2luJyB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5VHJhY2tpbmdOdW1iZXIubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1NoaXBwaW5nUHJvdmlkZXJTZXJ2aWNlLnRyYWNrU2hpcG1lbnQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1RyYWNraW5nSW5mbyBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZnVuZFNlcnZpY2UudHJhY2tSZXR1cm4odHJhY2tpbmdOdW1iZXIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmdW5kSWQpLnRvQmUoJ3JlZnVuZC0xJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrUmV0dXJuQXNSZWNlaXZlZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgcmV0dXJuIGFzIHJlY2VpdmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlZnVuZCA9IHtcbiAgICAgICAgaWQ6ICdyZWZ1bmQtMScsXG4gICAgICAgIHN0YXR1czogUmVmdW5kU3RhdHVzLkFQUFJPVkVELFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnVuZCBhcyBhbnkpO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1JlZnVuZCxcbiAgICAgICAgcmV0dXJuU3RhdHVzOiAncmVjZWl2ZWQnLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCByZWZ1bmRTZXJ2aWNlLm1hcmtSZXR1cm5Bc1JlY2VpdmVkKCdyZWZ1bmQtMScpO1xuXG4gICAgICBleHBlY3QobW9ja1JlZnVuZFJlcG9zaXRvcnkudXBkYXRlUmV0dXJuU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRSZWZ1bmRTdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHJlZnVuZCBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuZ2V0VG90YWxSZWZ1bmRlZEFtb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgxNTApO1xuICAgICAgbW9ja1JlZnVuZFJlcG9zaXRvcnkuY291bnRCeVN0YXR1cy5tb2NrSW1wbGVtZW50YXRpb24oKHN0YXR1cykgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSBSZWZ1bmRTdGF0dXMuUEVORElORykgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgxKTtcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gUmVmdW5kU3RhdHVzLkFQUFJPVkVEKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDApO1xuICAgICAgICBpZiAoc3RhdHVzID09PSBSZWZ1bmRTdGF0dXMuUkVKRUNURUQpIHJldHVybiBQcm9taXNlLnJlc29sdmUoMCk7XG4gICAgICAgIGlmIChzdGF0dXMgPT09IFJlZnVuZFN0YXR1cy5DT01QTEVURUQpIHJldHVybiBQcm9taXNlLnJlc29sdmUoMik7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMCk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmdW5kU2VydmljZS5nZXRSZWZ1bmRTdGF0aXN0aWNzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxSZWZ1bmRlZCkudG9CZSgxNTApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wZW5kaW5nKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wbGV0ZWQpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja0VsaWdpYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2hlY2sgaWYgb3JkZXIgaXMgZWxpZ2libGUgZm9yIHJlZnVuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNoZWNrRWxpZ2liaWxpdHkoJ29yZGVyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbGlnaWJsZSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGZvciBvcmRlciBvdXRzaWRlIHJldHVybiB3aW5kb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nQWdvID0gbmV3IERhdGUoKTtcbiAgICAgIGxvbmdBZ28uc2V0RGF0ZShsb25nQWdvLmdldERhdGUoKSAtIDEwMCk7XG5cbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IHtcbiAgICAgICAgaWQ6ICdvcmRlci0xJyxcbiAgICAgICAgc3RhdHVzOiBPcmRlclN0YXR1cy5ERUxJVkVSRUQsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFBheW1lbnRTdGF0dXMuUEFJRCxcbiAgICAgICAgZGVsaXZlcmVkQXQ6IGxvbmdBZ28sXG4gICAgICB9O1xuXG4gICAgICBtb2NrT3JkZXJSZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlciBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZ1bmRTZXJ2aWNlLmNoZWNrRWxpZ2liaWxpdHkoJ29yZGVyLTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbGlnaWJsZSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmlzc3Vlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==