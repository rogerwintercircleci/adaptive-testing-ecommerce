{"file":"C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\refund.service.spec.ts","mappings":"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","names":[],"sources":["C:\\Adaptive_Testing\\src\\services\\order-processing\\services\\refund.service.spec.ts"],"sourcesContent":["/**\n * TDD: Refund & Return Service Tests\n *\n * Testing refund requests, return processing, and restock logic\n */\n\nimport { RefundService, CreateRefundRequestDto, RefundStatus, ReturnReason } from './refund.service';\nimport { RefundRepository } from '../repositories/refund.repository';\nimport { OrderRepository } from '../repositories/order.repository';\nimport { InventoryRepository } from '../../inventory/repositories/inventory.repository';\nimport { PaymentGatewayService } from './payment-gateway.service';\nimport { ShippingProviderService } from './shipping-provider.service';\nimport { BadRequestError, NotFoundError } from '@libs/errors';\nimport { OrderStatus, PaymentStatus } from '../entities/order.entity';\n\ndescribe('RefundService', () => {\n  let refundService: RefundService;\n  let mockRefundRepository: jest.Mocked<RefundRepository>;\n  let mockOrderRepository: jest.Mocked<OrderRepository>;\n  let mockInventoryRepository: jest.Mocked<InventoryRepository>;\n  let mockPaymentGatewayService: jest.Mocked<PaymentGatewayService>;\n  let mockShippingProviderService: jest.Mocked<ShippingProviderService>;\n\n  beforeEach(() => {\n    mockRefundRepository = {\n      create: jest.fn(),\n      findById: jest.fn(),\n      findByOrderId: jest.fn(),\n      findByUserId: jest.fn(),\n      findByTrackingNumber: jest.fn(),\n      update: jest.fn(),\n      updateStatus: jest.fn(),\n      updateReturnStatus: jest.fn(),\n      countByStatus: jest.fn(),\n      getTotalRefundedAmount: jest.fn(),\n    } as any;\n\n    mockOrderRepository = {\n      findById: jest.fn(),\n      update: jest.fn(),\n    } as any;\n\n    mockInventoryRepository = {\n      findByProductId: jest.fn(),\n      update: jest.fn(),\n      recordAdjustment: jest.fn(),\n    } as any;\n\n    mockPaymentGatewayService = {\n      refundPayment: jest.fn(),\n    } as any;\n\n    mockShippingProviderService = {\n      createReturnLabel: jest.fn(),\n      trackShipment: jest.fn(),\n    } as any;\n\n    refundService = new RefundService(\n      mockRefundRepository,\n      mockOrderRepository,\n      mockInventoryRepository,\n      mockPaymentGatewayService,\n      mockShippingProviderService\n    );\n  });\n\n  describe('createRefundRequest', () => {\n    it('should create a refund request', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'order-1',\n        reason: ReturnReason.DEFECTIVE,\n        description: 'Product was damaged',\n        items: [\n          { productId: 'prod-1', quantity: 1 },\n        ],\n        photos: ['photo1.jpg'],\n      };\n\n      const mockOrder = {\n        id: 'order-1',\n        userId: 'user-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        total: 100,\n        deliveredAt: new Date(),\n        items: [\n          { productId: 'prod-1', quantity: 1, unitPrice: 100, subtotal: 100 },\n        ],\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const mockRefund = {\n        id: 'refund-1',\n        ...refundDto,\n        status: RefundStatus.PENDING,\n        refundAmount: 100,\n      };\n\n      mockRefundRepository.create.mockResolvedValue(mockRefund as any);\n\n      const result = await refundService.createRefundRequest(refundDto);\n\n      expect(result.status).toBe(RefundStatus.PENDING);\n      expect(result.refundAmount).toBe(100);\n    });\n\n    it('should reject refund request for non-existent order', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'invalid',\n        reason: ReturnReason.DEFECTIVE,\n        items: [],\n      };\n\n      mockOrderRepository.findById.mockRejectedValue(new NotFoundError('Order not found'));\n\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(NotFoundError);\n    });\n\n    it('should reject refund request for unpaid order', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'order-1',\n        reason: ReturnReason.CHANGED_MIND,\n        items: [],\n      };\n\n      const mockOrder = {\n        id: 'order-1',\n        paymentStatus: PaymentStatus.PENDING,\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(BadRequestError);\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Order must be paid to request a refund');\n    });\n\n    it('should reject refund request after return window expired', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'order-1',\n        reason: ReturnReason.CHANGED_MIND,\n        items: [],\n      };\n\n      const sixtyDaysAgo = new Date();\n      sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);\n\n      const mockOrder = {\n        id: 'order-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        deliveredAt: sixtyDaysAgo,\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(BadRequestError);\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Return window of 30 days has expired');\n    });\n\n    it('should calculate partial refund amount for partial return', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'order-1',\n        reason: ReturnReason.DEFECTIVE,\n        items: [\n          { productId: 'prod-1', quantity: 1 },\n        ],\n        photos: ['photo1.jpg'],\n      };\n\n      const mockOrder = {\n        id: 'order-1',\n        userId: 'user-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        total: 200,\n        deliveredAt: new Date(),\n        items: [\n          { productId: 'prod-1', quantity: 1, unitPrice: 50, subtotal: 50 },\n          { productId: 'prod-2', quantity: 1, unitPrice: 150, subtotal: 150 },\n        ],\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const mockRefund = {\n        id: 'refund-1',\n        refundAmount: 50,\n      };\n\n      mockRefundRepository.create.mockResolvedValue(mockRefund as any);\n\n      const result = await refundService.createRefundRequest(refundDto);\n\n      expect(result.refundAmount).toBe(50);\n    });\n\n    it('should require photos for defective items', async () => {\n      const refundDto: CreateRefundRequestDto = {\n        orderId: 'order-1',\n        reason: ReturnReason.DEFECTIVE,\n        items: [{ productId: 'prod-1', quantity: 1 }],\n        photos: [],\n      };\n\n      const mockOrder = {\n        id: 'order-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        deliveredAt: new Date(),\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow(BadRequestError);\n      await expect(refundService.createRefundRequest(refundDto)).rejects.toThrow('Photos are required for defective or damaged items');\n    });\n  });\n\n  describe('approveRefund', () => {\n    it('should approve a refund request', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        orderId: 'order-1',\n        status: RefundStatus.PENDING,\n        refundAmount: 100,\n        items: [{ productId: 'prod-1', quantity: 1 }],\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n      mockRefundRepository.updateStatus.mockResolvedValue({\n        ...mockRefund,\n        status: RefundStatus.APPROVED,\n      } as any);\n\n      const result = await refundService.approveRefund('refund-1');\n\n      expect(result.status).toBe(RefundStatus.APPROVED);\n    });\n\n    it('should approve partial refund with adjusted amount', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        status: RefundStatus.PENDING,\n        refundAmount: 75,\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n      mockRefundRepository.updateStatus.mockResolvedValue({\n        ...mockRefund,\n        status: RefundStatus.APPROVED,\n      } as any);\n\n      const result = await refundService.approveRefund('refund-1');\n\n      expect(result.status).toBe(RefundStatus.APPROVED);\n      expect(result.refundAmount).toBe(75);\n    });\n  });\n\n  describe('rejectRefund', () => {\n    it('should reject a refund request', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        status: RefundStatus.PENDING,\n      };\n\n      const updatedRefund = {\n        ...mockRefund,\n        status: RefundStatus.REJECTED,\n        rejectionReason: 'Outside return window',\n      };\n\n      mockRefundRepository.findById\n        .mockResolvedValueOnce(mockRefund as any)\n        .mockResolvedValueOnce(updatedRefund as any);\n      mockRefundRepository.update.mockResolvedValue(updatedRefund as any);\n\n      const result = await refundService.rejectRefund('refund-1', 'Outside return window');\n\n      expect(result.status).toBe(RefundStatus.REJECTED);\n      expect(result.rejectionReason).toBe('Outside return window');\n    });\n  });\n\n  describe('processRefund', () => {\n    it('should process approved refund and issue payment', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        orderId: 'order-1',\n        status: RefundStatus.APPROVED,\n        refundAmount: 100,\n        restockItems: false,\n        items: [],\n      };\n\n      const completedRefund = {\n        ...mockRefund,\n        status: RefundStatus.COMPLETED,\n        processedAt: new Date(),\n      };\n\n      mockRefundRepository.findById\n        .mockResolvedValueOnce(mockRefund as any)\n        .mockResolvedValueOnce(completedRefund as any);\n      mockRefundRepository.updateStatus.mockResolvedValue({\n        ...mockRefund,\n        status: RefundStatus.PROCESSING,\n      } as any);\n      mockOrderRepository.findById.mockResolvedValue({ id: 'order-1' } as any);\n      mockPaymentGatewayService.refundPayment.mockResolvedValue({ success: true, refundId: 'ref-123' } as any);\n      mockRefundRepository.update.mockResolvedValue(completedRefund as any);\n\n      const result = await refundService.processRefund('refund-1');\n\n      expect(result.status).toBe(RefundStatus.COMPLETED);\n      expect(result.processedAt).toBeDefined();\n    });\n\n    it('should not process refund that is not approved', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        status: RefundStatus.PENDING,\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n\n      await expect(refundService.processRefund('refund-1')).rejects.toThrow(BadRequestError);\n    });\n  });\n\n  describe('restockItems', () => {\n    it('should restock returned items to inventory', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        orderId: 'order-1',\n        status: RefundStatus.APPROVED,\n        restockItems: true,\n        items: [\n          { productId: 'prod-1', quantity: 2 },\n          { productId: 'prod-2', quantity: 1 },\n        ],\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n      mockInventoryRepository.findByProductId.mockResolvedValue({ quantity: 10 } as any);\n      mockInventoryRepository.update.mockResolvedValue({} as any);\n      mockInventoryRepository.recordAdjustment.mockResolvedValue(undefined);\n\n      await refundService.restockItems('refund-1');\n\n      expect(mockInventoryRepository.update).toHaveBeenCalledTimes(2);\n      expect(mockInventoryRepository.update).toHaveBeenCalledWith('prod-1', {\n        quantity: 12,\n      });\n      expect(mockInventoryRepository.recordAdjustment).toHaveBeenCalledTimes(2);\n    });\n\n    it('should not restock defective items', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        reason: ReturnReason.DEFECTIVE,\n        restockItems: false,\n        items: [\n          { productId: 'prod-1', quantity: 1 },\n        ],\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n\n      await refundService.restockItems('refund-1');\n\n      expect(mockInventoryRepository.update).not.toHaveBeenCalled();\n    });\n  });\n\n\n  describe('getUserRefunds', () => {\n    it('should get all refund requests for a user', async () => {\n      const mockRefunds = [\n        { id: '1', userId: 'user-1', status: RefundStatus.COMPLETED },\n        { id: '2', userId: 'user-1', status: RefundStatus.PENDING },\n      ];\n\n      mockRefundRepository.findByUserId.mockResolvedValue(mockRefunds as any);\n\n      const result = await refundService.getUserRefunds('user-1');\n\n      expect(result).toHaveLength(2);\n    });\n  });\n\n\n  describe('calculateRefundAmount', () => {\n    it('should calculate full refund amount', async () => {\n      const mockOrder = {\n        id: 'order-1',\n        total: 150,\n        taxAmount: 15,\n        shippingCost: 10,\n        subtotal: 125,\n        items: [\n          { productId: 'prod-1', quantity: 1, unitPrice: 125 },\n        ],\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const result = await refundService.calculateRefundAmount({\n        orderId: 'order-1',\n        items: [{ productId: 'prod-1', quantity: 1 }],\n      });\n\n      expect(result.refundAmount).toBeGreaterThan(0);\n    });\n\n    it('should calculate partial refund for subset of items', async () => {\n      const mockOrder = {\n        id: 'order-1',\n        total: 250,\n        subtotal: 225,\n        items: [\n          { productId: 'prod-1', quantity: 1, unitPrice: 100 },\n          { productId: 'prod-2', quantity: 1, unitPrice: 125 },\n        ],\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const result = await refundService.calculateRefundAmount({\n        orderId: 'order-1',\n        items: [{ productId: 'prod-1', quantity: 1 }],\n      });\n\n      expect(result.refundAmount).toBe(100);\n      expect(result.refundAmount).toBeLessThan(mockOrder.total);\n    });\n\n    it('should not include shipping in partial refund', async () => {\n      const mockOrder = {\n        id: 'order-1',\n        total: 150,\n        subtotal: 100,\n        shippingCost: 10,\n        items: [\n          { productId: 'prod-1', quantity: 1, unitPrice: 50 },\n          { productId: 'prod-2', quantity: 1, unitPrice: 50 },\n        ],\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const result = await refundService.calculateRefundAmount({\n        orderId: 'order-1',\n        items: [{ productId: 'prod-1', quantity: 1 }],\n      });\n\n      expect(result.refundAmount).toBe(50);\n    });\n  });\n\n  describe('generateReturnLabel', () => {\n    it('should generate return shipping label', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        orderId: 'order-1',\n        status: RefundStatus.APPROVED,\n      };\n\n      const mockOrder = {\n        id: 'order-1',\n        shippingAddress: {\n          street: '123 Main St',\n          city: 'City',\n          state: 'ST',\n          postalCode: '12345',\n          country: 'US',\n        },\n      };\n\n      const mockLabel = {\n        labelUrl: 'https://example.com/label.pdf',\n        trackingNumber: '1Z999AA10123456784',\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n      mockShippingProviderService.createReturnLabel.mockResolvedValue(mockLabel as any);\n      mockRefundRepository.update.mockResolvedValue({} as any);\n\n      const result = await refundService.generateReturnLabel('refund-1');\n\n      expect(result.labelUrl).toBeDefined();\n      expect(result.trackingNumber).toBeDefined();\n    });\n  });\n\n  describe('trackReturn', () => {\n    it('should track return shipment status', async () => {\n      const trackingNumber = '1Z999AA10123456784';\n\n      const mockRefund = {\n        id: 'refund-1',\n        returnTrackingNumber: trackingNumber,\n        returnStatus: 'LABEL_GENERATED',\n      };\n\n      const mockTrackingInfo = {\n        status: 'in_transit',\n        events: [\n          { timestamp: new Date(), status: 'picked_up', location: 'Origin' },\n        ],\n      };\n\n      mockRefundRepository.findByTrackingNumber.mockResolvedValue(mockRefund as any);\n      mockShippingProviderService.trackShipment.mockResolvedValue(mockTrackingInfo as any);\n      mockRefundRepository.updateReturnStatus.mockResolvedValue({} as any);\n\n      const result = await refundService.trackReturn(trackingNumber);\n\n      expect(result.status).toBeDefined();\n      expect(result.refundId).toBe('refund-1');\n    });\n  });\n\n  describe('markReturnAsReceived', () => {\n    it('should mark return as received', async () => {\n      const mockRefund = {\n        id: 'refund-1',\n        status: RefundStatus.APPROVED,\n      };\n\n      mockRefundRepository.findById.mockResolvedValue(mockRefund as any);\n      mockRefundRepository.updateReturnStatus.mockResolvedValue({\n        ...mockRefund,\n        returnStatus: 'received',\n      } as any);\n\n      await refundService.markReturnAsReceived('refund-1');\n\n      expect(mockRefundRepository.updateReturnStatus).toHaveBeenCalled();\n    });\n  });\n\n  describe('getRefundStatistics', () => {\n    it('should get refund statistics', async () => {\n      mockRefundRepository.getTotalRefundedAmount.mockResolvedValue(150);\n      mockRefundRepository.countByStatus.mockImplementation((status) => {\n        if (status === RefundStatus.PENDING) return Promise.resolve(1);\n        if (status === RefundStatus.APPROVED) return Promise.resolve(0);\n        if (status === RefundStatus.REJECTED) return Promise.resolve(0);\n        if (status === RefundStatus.COMPLETED) return Promise.resolve(2);\n        return Promise.resolve(0);\n      });\n\n      const result = await refundService.getRefundStatistics();\n\n      expect(result.totalRefunded).toBe(150);\n      expect(result.pending).toBe(1);\n      expect(result.completed).toBe(2);\n    });\n  });\n\n  describe('checkEligibility', () => {\n    it('should check if order is eligible for refund', async () => {\n      const mockOrder = {\n        id: 'order-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        deliveredAt: new Date(),\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const result = await refundService.checkEligibility('order-1');\n\n      expect(result.eligible).toBe(true);\n    });\n\n    it('should return false for order outside return window', async () => {\n      const longAgo = new Date();\n      longAgo.setDate(longAgo.getDate() - 100);\n\n      const mockOrder = {\n        id: 'order-1',\n        status: OrderStatus.DELIVERED,\n        paymentStatus: PaymentStatus.PAID,\n        deliveredAt: longAgo,\n      };\n\n      mockOrderRepository.findById.mockResolvedValue(mockOrder as any);\n\n      const result = await refundService.checkEligibility('order-1');\n\n      expect(result.eligible).toBe(false);\n      expect(result.issues.length).toBeGreaterThan(0);\n    });\n  });\n});\n"],"version":3}