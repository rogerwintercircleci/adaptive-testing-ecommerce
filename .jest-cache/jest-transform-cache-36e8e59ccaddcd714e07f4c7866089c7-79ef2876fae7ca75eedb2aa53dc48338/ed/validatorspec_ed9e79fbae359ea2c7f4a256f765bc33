c4607a7aa4cd390b305169a38353584f
"use strict";
/**
 * Unit Tests: Validation Utilities
 *
 * Testing Zod-based validation helpers
 */
Object.defineProperty(exports, "__esModule", { value: true });
const zod_1 = require("zod");
const validator_1 = require("./validator");
const errors_1 = require("../errors");
describe('Validation Utilities', () => {
    describe('commonSchemas', () => {
        describe('email', () => {
            it('should validate correct email', () => {
                const result = validator_1.commonSchemas.email.safeParse('test@example.com');
                expect(result.success).toBe(true);
            });
            it('should reject invalid email', () => {
                const result = validator_1.commonSchemas.email.safeParse('invalid-email');
                expect(result.success).toBe(false);
            });
            it('should reject email without domain', () => {
                const result = validator_1.commonSchemas.email.safeParse('test@');
                expect(result.success).toBe(false);
            });
            it('should reject email without @', () => {
                const result = validator_1.commonSchemas.email.safeParse('testexample.com');
                expect(result.success).toBe(false);
            });
        });
        describe('uuid', () => {
            it('should validate correct UUID', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('123e4567-e89b-12d3-a456-426614174000');
                expect(result.success).toBe(true);
            });
            it('should reject invalid UUID', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('not-a-uuid');
                expect(result.success).toBe(false);
            });
            it('should reject UUID with wrong format', () => {
                const result = validator_1.commonSchemas.uuid.safeParse('123-456-789');
                expect(result.success).toBe(false);
            });
        });
        describe('password', () => {
            it('should validate strong password', () => {
                const result = validator_1.commonSchemas.password.safeParse('StrongPass123!');
                expect(result.success).toBe(true);
            });
            it('should reject short password', () => {
                const result = validator_1.commonSchemas.password.safeParse('Short1!');
                expect(result.success).toBe(false);
            });
            it('should reject password without uppercase', () => {
                const result = validator_1.commonSchemas.password.safeParse('lowercase123!');
                expect(result.success).toBe(false);
            });
            it('should reject password without lowercase', () => {
                const result = validator_1.commonSchemas.password.safeParse('UPPERCASE123!');
                expect(result.success).toBe(false);
            });
            it('should reject password without number', () => {
                const result = validator_1.commonSchemas.password.safeParse('NoNumbers!');
                expect(result.success).toBe(false);
            });
            it('should reject password without special character', () => {
                const result = validator_1.commonSchemas.password.safeParse('NoSpecial123');
                expect(result.success).toBe(false);
            });
        });
        describe('pagination', () => {
            it('should parse valid pagination params', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '2', limit: '10' });
                expect(result.success).toBe(true);
                if (result.success) {
                    expect(result.data.page).toBe(2);
                    expect(result.data.limit).toBe(10);
                }
            });
            it('should use default values', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({});
                expect(result.success).toBe(true);
                if (result.success) {
                    expect(result.data.page).toBe(1);
                    expect(result.data.limit).toBe(20);
                }
            });
            it('should reject negative page', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '-1' });
                expect(result.success).toBe(false);
            });
            it('should reject zero page', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ page: '0' });
                expect(result.success).toBe(false);
            });
            it('should reject limit over 100', () => {
                const result = validator_1.commonSchemas.pagination.safeParse({ limit: '101' });
                expect(result.success).toBe(false);
            });
        });
        describe('dateRange', () => {
            it('should parse valid date range', () => {
                const result = validator_1.commonSchemas.dateRange.safeParse({
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                });
                expect(result.success).toBe(true);
            });
            it('should reject invalid date format', () => {
                const result = validator_1.commonSchemas.dateRange.safeParse({
                    startDate: 'invalid-date',
                    endDate: '2024-12-31',
                });
                expect(result.success).toBe(false);
            });
        });
        describe('search', () => {
            it('should validate search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: 'search term' });
                expect(result.success).toBe(true);
            });
            it('should reject empty search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: '' });
                expect(result.success).toBe(false);
            });
            it('should reject too long search query', () => {
                const result = validator_1.commonSchemas.search.safeParse({ q: 'a'.repeat(101) });
                expect(result.success).toBe(false);
            });
        });
    });
    describe('validate middleware', () => {
        const testSchema = zod_1.z.object({
            name: zod_1.z.string().min(1),
            age: zod_1.z.number().positive(),
        });
        it('should validate request body and call next', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: 'John', age: 25 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
            expect(req.body).toEqual({ name: 'John', age: 25 });
        });
        it('should validate query params', () => {
            // Query params come as strings from URL, so use coerce for numbers
            const querySchema = zod_1.z.object({
                name: zod_1.z.string().min(1),
                age: zod_1.z.coerce.number().positive(),
            });
            const middleware = (0, validator_1.validate)(querySchema, 'query');
            const req = { query: { name: 'John', age: '25' } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
        });
        it('should validate route params', () => {
            // Route params come as strings from URL, so use coerce for numbers
            const paramsSchema = zod_1.z.object({
                name: zod_1.z.string().min(1),
                age: zod_1.z.coerce.number().positive(),
            });
            const middleware = (0, validator_1.validate)(paramsSchema, 'params');
            const req = { params: { name: 'John', age: '25' } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith();
        });
        it('should call next with ValidationError for invalid data', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: '', age: -1 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            expect(next).toHaveBeenCalledWith(expect.any(errors_1.ValidationError));
        });
        it('should include error details in ValidationError', () => {
            const middleware = (0, validator_1.validate)(testSchema, 'body');
            const req = { body: { name: '', age: -1 } };
            const res = {};
            const next = jest.fn();
            middleware(req, res, next);
            const error = next.mock.calls[0][0];
            expect(error.errors).toBeDefined();
            expect(Object.keys(error.errors).length).toBeGreaterThan(0);
        });
    });
    describe('validateData', () => {
        const testSchema = zod_1.z.object({
            email: zod_1.z.string().email(),
            count: zod_1.z.number().int(),
        });
        it('should validate and return data', () => {
            const data = { email: 'test@example.com', count: 5 };
            const result = (0, validator_1.validateData)(testSchema, data);
            expect(result).toEqual(data);
        });
        it('should throw ValidationError for invalid data', () => {
            const data = { email: 'invalid', count: 'not-a-number' };
            expect(() => (0, validator_1.validateData)(testSchema, data)).toThrow(errors_1.ValidationError);
        });
        it('should include field errors', () => {
            const data = { email: 'invalid', count: 'not-a-number' };
            try {
                (0, validator_1.validateData)(testSchema, data);
            }
            catch (error) {
                expect(error).toBeInstanceOf(errors_1.ValidationError);
                const validationError = error;
                expect(validationError.errors).toBeDefined();
            }
        });
    });
    describe('safeParse', () => {
        const testSchema = zod_1.z.object({
            value: zod_1.z.string(),
        });
        it('should return success result for valid data', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 'test' });
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.value).toBe('test');
            }
        });
        it('should return error result for invalid data', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 123 });
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.errors).toBeDefined();
            }
        });
        it('should include error details in failure result', () => {
            const result = (0, validator_1.safeParse)(testSchema, { value: 123 });
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(Object.keys(result.errors).length).toBeGreaterThan(0);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcbGlic1xcdmFsaWRhdGlvblxcdmFsaWRhdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsNkJBQXdCO0FBQ3hCLDJDQUErRTtBQUUvRSxzQ0FBNEM7QUFFNUMsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtZQUNyQixFQUFFLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO2dCQUN2QyxNQUFNLE1BQU0sR0FBRyx5QkFBYSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDakUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO2dCQUNyQyxNQUFNLE1BQU0sR0FBRyx5QkFBYSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQzlELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtnQkFDNUMsTUFBTSxNQUFNLEdBQUcseUJBQWEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN0RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyQyxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7Z0JBQ3ZDLE1BQU0sTUFBTSxHQUFHLHlCQUFhLENBQUMs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QUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxBZGFwdGl2ZV9UZXN0aW5nXFxzcmNcXGxpYnNcXHZhbGlkYXRpb25cXHZhbGlkYXRvci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdCBUZXN0czogVmFsaWRhdGlvbiBVdGlsaXRpZXNcbiAqXG4gKiBUZXN0aW5nIFpvZC1iYXNlZCB2YWxpZGF0aW9uIGhlbHBlcnNcbiAqL1xuXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IHZhbGlkYXRlLCB2YWxpZGF0ZURhdGEsIHNhZmVQYXJzZSwgY29tbW9uU2NoZW1hcyB9IGZyb20gJy4vdmFsaWRhdG9yJztcbmltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4uL2Vycm9ycyc7XG5cbmRlc2NyaWJlKCdWYWxpZGF0aW9uIFV0aWxpdGllcycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2NvbW1vblNjaGVtYXMnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2VtYWlsJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBjb3JyZWN0IGVtYWlsJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLmVtYWlsLnNhZmVQYXJzZSgndGVzdEBleGFtcGxlLmNvbScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBlbWFpbCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5lbWFpbC5zYWZlUGFyc2UoJ2ludmFsaWQtZW1haWwnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBlbWFpbCB3aXRob3V0IGRvbWFpbicsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5lbWFpbC5zYWZlUGFyc2UoJ3Rlc3RAJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgZW1haWwgd2l0aG91dCBAJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLmVtYWlsLnNhZmVQYXJzZSgndGVzdGV4YW1wbGUuY29tJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd1dWlkJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBjb3JyZWN0IFVVSUQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMudXVpZC5zYWZlUGFyc2UoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBVVUlEJywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnV1aWQuc2FmZVBhcnNlKCdub3QtYS11dWlkJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgVVVJRCB3aXRoIHdyb25nIGZvcm1hdCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy51dWlkLnNhZmVQYXJzZSgnMTIzLTQ1Ni03ODknKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3Bhc3N3b3JkJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBzdHJvbmcgcGFzc3dvcmQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdTdHJvbmdQYXNzMTIzIScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3Qgc2hvcnQgcGFzc3dvcmQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdTaG9ydDEhJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmQgd2l0aG91dCB1cHBlcmNhc2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdsb3dlcmNhc2UxMjMhJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmQgd2l0aG91dCBsb3dlcmNhc2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdVUFBFUkNBU0UxMjMhJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmQgd2l0aG91dCBudW1iZXInLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFzc3dvcmQuc2FmZVBhcnNlKCdOb051bWJlcnMhJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGFzc3dvcmQgd2l0aG91dCBzcGVjaWFsIGNoYXJhY3RlcicsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5wYXNzd29yZC5zYWZlUGFyc2UoJ05vU3BlY2lhbDEyMycpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncGFnaW5hdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcGFyc2UgdmFsaWQgcGFnaW5hdGlvbiBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFnaW5hdGlvbi5zYWZlUGFyc2UoeyBwYWdlOiAnMicsIGxpbWl0OiAnMTAnIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5wYWdlKS50b0JlKDIpO1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5saW1pdCkudG9CZSgxMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHZhbHVlcycsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5wYWdpbmF0aW9uLnNhZmVQYXJzZSh7fSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLnBhZ2UpLnRvQmUoMSk7XG4gICAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLmxpbWl0KS50b0JlKDIwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IG5lZ2F0aXZlIHBhZ2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbW1vblNjaGVtYXMucGFnaW5hdGlvbi5zYWZlUGFyc2UoeyBwYWdlOiAnLTEnIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHplcm8gcGFnZScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5wYWdpbmF0aW9uLnNhZmVQYXJzZSh7IHBhZ2U6ICcwJyB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBsaW1pdCBvdmVyIDEwMCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5wYWdpbmF0aW9uLnNhZmVQYXJzZSh7IGxpbWl0OiAnMTAxJyB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2RhdGVSYW5nZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcGFyc2UgdmFsaWQgZGF0ZSByYW5nZScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5kYXRlUmFuZ2Uuc2FmZVBhcnNlKHtcbiAgICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgICBlbmREYXRlOiAnMjAyNC0xMi0zMScsXG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBkYXRlIGZvcm1hdCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5kYXRlUmFuZ2Uuc2FmZVBhcnNlKHtcbiAgICAgICAgICBzdGFydERhdGU6ICdpbnZhbGlkLWRhdGUnLFxuICAgICAgICAgIGVuZERhdGU6ICcyMDI0LTEyLTMxJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzZWFyY2gnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHNlYXJjaCBxdWVyeScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5zZWFyY2guc2FmZVBhcnNlKHsgcTogJ3NlYXJjaCB0ZXJtJyB9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGVtcHR5IHNlYXJjaCBxdWVyeScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tbW9uU2NoZW1hcy5zZWFyY2guc2FmZVBhcnNlKHsgcTogJycgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgdG9vIGxvbmcgc2VhcmNoIHF1ZXJ5JywgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21tb25TY2hlbWFzLnNlYXJjaC5zYWZlUGFyc2UoeyBxOiAnYScucmVwZWF0KDEwMSkgfSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlIG1pZGRsZXdhcmUnLCAoKSA9PiB7XG4gICAgY29uc3QgdGVzdFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLFxuICAgICAgYWdlOiB6Lm51bWJlcigpLnBvc2l0aXZlKCksXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHJlcXVlc3QgYm9keSBhbmQgY2FsbCBuZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHRlc3RTY2hlbWEsICdib2R5Jyk7XG4gICAgICBjb25zdCByZXEgPSB7IGJvZHk6IHsgbmFtZTogJ0pvaG4nLCBhZ2U6IDI1IH0gfSBhcyBSZXF1ZXN0O1xuICAgICAgY29uc3QgcmVzID0ge30gYXMgUmVzcG9uc2U7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpIGFzIE5leHRGdW5jdGlvbjtcblxuICAgICAgbWlkZGxld2FyZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgpO1xuICAgICAgZXhwZWN0KHJlcS5ib2R5KS50b0VxdWFsKHsgbmFtZTogJ0pvaG4nLCBhZ2U6IDI1IH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBxdWVyeSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICAvLyBRdWVyeSBwYXJhbXMgY29tZSBhcyBzdHJpbmdzIGZyb20gVVJMLCBzbyB1c2UgY29lcmNlIGZvciBudW1iZXJzXG4gICAgICBjb25zdCBxdWVyeVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKS5taW4oMSksXG4gICAgICAgIGFnZTogei5jb2VyY2UubnVtYmVyKCkucG9zaXRpdmUoKSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHF1ZXJ5U2NoZW1hLCAncXVlcnknKTtcbiAgICAgIGNvbnN0IHJlcSA9IHsgcXVlcnk6IHsgbmFtZTogJ0pvaG4nLCBhZ2U6ICcyNScgfSB9IGFzIHVua25vd24gYXMgUmVxdWVzdDtcbiAgICAgIGNvbnN0IHJlcyA9IHt9IGFzIFJlc3BvbnNlO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKSBhcyBOZXh0RnVuY3Rpb247XG5cbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcm91dGUgcGFyYW1zJywgKCkgPT4ge1xuICAgICAgLy8gUm91dGUgcGFyYW1zIGNvbWUgYXMgc3RyaW5ncyBmcm9tIFVSTCwgc28gdXNlIGNvZXJjZSBmb3IgbnVtYmVyc1xuICAgICAgY29uc3QgcGFyYW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICBuYW1lOiB6LnN0cmluZygpLm1pbigxKSxcbiAgICAgICAgYWdlOiB6LmNvZXJjZS5udW1iZXIoKS5wb3NpdGl2ZSgpLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBtaWRkbGV3YXJlID0gdmFsaWRhdGUocGFyYW1zU2NoZW1hLCAncGFyYW1zJyk7XG4gICAgICBjb25zdCByZXEgPSB7IHBhcmFtczogeyBuYW1lOiAnSm9obicsIGFnZTogJzI1JyB9IH0gYXMgdW5rbm93biBhcyBSZXF1ZXN0O1xuICAgICAgY29uc3QgcmVzID0ge30gYXMgUmVzcG9uc2U7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpIGFzIE5leHRGdW5jdGlvbjtcblxuICAgICAgbWlkZGxld2FyZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxsIG5leHQgd2l0aCBWYWxpZGF0aW9uRXJyb3IgZm9yIGludmFsaWQgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB2YWxpZGF0ZSh0ZXN0U2NoZW1hLCAnYm9keScpO1xuICAgICAgY29uc3QgcmVxID0geyBib2R5OiB7IG5hbWU6ICcnLCBhZ2U6IC0xIH0gfSBhcyBSZXF1ZXN0O1xuICAgICAgY29uc3QgcmVzID0ge30gYXMgUmVzcG9uc2U7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpIGFzIE5leHRGdW5jdGlvbjtcblxuICAgICAgbWlkZGxld2FyZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFZhbGlkYXRpb25FcnJvcikpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIGVycm9yIGRldGFpbHMgaW4gVmFsaWRhdGlvbkVycm9yJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHZhbGlkYXRlKHRlc3RTY2hlbWEsICdib2R5Jyk7XG4gICAgICBjb25zdCByZXEgPSB7IGJvZHk6IHsgbmFtZTogJycsIGFnZTogLTEgfSB9IGFzIFJlcXVlc3Q7XG4gICAgICBjb25zdCByZXMgPSB7fSBhcyBSZXNwb25zZTtcbiAgICAgIGNvbnN0IG5leHQgPSBqZXN0LmZuKCk7XG5cbiAgICAgIG1pZGRsZXdhcmUocmVxLCByZXMsIG5leHQgYXMgTmV4dEZ1bmN0aW9uKTtcblxuICAgICAgY29uc3QgZXJyb3IgPSAobmV4dCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF0gYXMgVmFsaWRhdGlvbkVycm9yO1xuICAgICAgZXhwZWN0KGVycm9yLmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChPYmplY3Qua2V5cyhlcnJvci5lcnJvcnMpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVEYXRhJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxuICAgICAgY291bnQ6IHoubnVtYmVyKCkuaW50KCksXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCByZXR1cm4gZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSB7IGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsIGNvdW50OiA1IH07XG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZURhdGEodGVzdFNjaGVtYSwgZGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZGF0YSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IFZhbGlkYXRpb25FcnJvciBmb3IgaW52YWxpZCBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHsgZW1haWw6ICdpbnZhbGlkJywgY291bnQ6ICdub3QtYS1udW1iZXInIH07XG5cbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZURhdGEodGVzdFNjaGVtYSwgZGF0YSkpLnRvVGhyb3coVmFsaWRhdGlvbkVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBmaWVsZCBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0geyBlbWFpbDogJ2ludmFsaWQnLCBjb3VudDogJ25vdC1hLW51bWJlcicgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFsaWRhdGVEYXRhKHRlc3RTY2hlbWEsIGRhdGEpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihWYWxpZGF0aW9uRXJyb3IpO1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3IgPSBlcnJvciBhcyBWYWxpZGF0aW9uRXJyb3I7XG4gICAgICAgIGV4cGVjdCh2YWxpZGF0aW9uRXJyb3IuZXJyb3JzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2FmZVBhcnNlJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgICB2YWx1ZTogei5zdHJpbmcoKSxcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHN1Y2Nlc3MgcmVzdWx0IGZvciB2YWxpZCBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FmZVBhcnNlKHRlc3RTY2hlbWEsIHsgdmFsdWU6ICd0ZXN0JyB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS52YWx1ZSkudG9CZSgndGVzdCcpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3IgcmVzdWx0IGZvciBpbnZhbGlkIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBzYWZlUGFyc2UodGVzdFNjaGVtYSwgeyB2YWx1ZTogMTIzIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBlcnJvciBkZXRhaWxzIGluIGZhaWx1cmUgcmVzdWx0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FmZVBhcnNlKHRlc3RTY2hlbWEsIHsgdmFsdWU6IDEyMyB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KE9iamVjdC5rZXlzKHJlc3VsdC5lcnJvcnMpLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9