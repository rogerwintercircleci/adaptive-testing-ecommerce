380b36b45ca603a45a267ee89bbd317b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.safeParse = exports.validateData = exports.validate = exports.commonSchemas = void 0;
const zod_1 = require("zod");
const errors_1 = require("../errors");
/**
 * Common validation schemas
 */
exports.commonSchemas = {
    // Email validation
    email: zod_1.z.string().email('Invalid email format'),
    // UUID validation
    uuid: zod_1.z.string().uuid('Invalid UUID format'),
    // Password validation (matches password.utils requirements)
    password: zod_1.z
        .string()
        .min(8, 'Password must be at least 8 characters')
        .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')
        .regex(/[a-z]/, 'Password must contain at least one lowercase letter')
        .regex(/[0-9]/, 'Password must contain at least one number')
        .regex(/[!@#$%^&*(),.?":{}|<>]/, 'Password must contain at least one special character'),
    // Pagination
    pagination: zod_1.z.object({
        page: zod_1.z.coerce.number().int().positive().default(1),
        limit: zod_1.z.coerce.number().int().positive().max(100).default(20),
    }),
    // Date range
    dateRange: zod_1.z.object({
        startDate: zod_1.z.coerce.date(),
        endDate: zod_1.z.coerce.date(),
    }),
    // Search query
    search: zod_1.z.object({
        q: zod_1.z.string().min(1).max(100),
    }),
};
/**
 * Middleware factory for validating request data
 */
const validate = (schema, source = 'body') => {
    return (req, _res, next) => {
        try {
            const data = req[source];
            const validated = schema.parse(data);
            // Replace request data with validated data (includes defaults and transformations)
            req[source] = validated;
            next();
        }
        catch (error) {
            if (error instanceof zod_1.ZodError) {
                const errors = {};
                error.errors.forEach((err) => {
                    const path = err.path.join('.');
                    if (!errors[path]) {
                        errors[path] = [];
                    }
                    errors[path].push(err.message);
                });
                next(new errors_1.ValidationError('Validation failed', errors));
            }
            else {
                next(error);
            }
        }
    };
};
exports.validate = validate;
/**
 * Validate data programmatically (not as middleware)
 */
const validateData = (schema, data) => {
    try {
        return schema.parse(data);
    }
    catch (error) {
        if (error instanceof zod_1.ZodError) {
            const errors = {};
            error.errors.forEach((err) => {
                const path = err.path.join('.');
                if (!errors[path]) {
                    errors[path] = [];
                }
                errors[path].push(err.message);
            });
            throw new errors_1.ValidationError('Validation failed', errors);
        }
        throw error;
    }
};
exports.validateData = validateData;
/**
 * Safe parse - returns result without throwing
 */
const safeParse = (schema, data) => {
    try {
        const result = schema.parse(data);
        return { success: true, data: result };
    }
    catch (error) {
        if (error instanceof zod_1.ZodError) {
            const errors = {};
            error.errors.forEach((err) => {
                const path = err.path.join('.');
                if (!errors[path]) {
                    errors[path] = [];
                }
                errors[path].push(err.message);
            });
            return { success: false, errors };
        }
        return { success: false, errors: { _general: ['Unknown validation error'] } };
    }
};
exports.safeParse = safeParse;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEFkYXB0aXZlX1Rlc3RpbmdcXHNyY1xcbGlic1xcdmFsaWRhdGlvblxcdmFsaWRhdG9yLnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLDZCQUE2QztBQUM3QyxzQ0FBcUU7QUFFckU7O0dBRUc7QUFDVSxRQUFBLGFBQWEsR0FBRztJQUMzQixtQkFBbUI7SUFDbkIsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUM7SUFFL0Msa0JBQWtCO0lBQ2xCLElBQUksRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDO0lBRTVDLDREQUE0RDtJQUM1RCxRQUFRLEVBQUUsT0FBQztTQUNSLE1BQU0sRUFBRTtTQUNSLEdBQUcsQ0FBQyxDQUFDLEVBQUUsd0NBQXdDLENBQUM7U0FDaEQsS0FBSyxDQUFDLE9BQU8sRUFBRSxxREFBcUQsQ0FBQztTQUNyRSxLQUFLLENBQUMsT0FBTyxFQUFFLHFEQUFxRCxDQUFDO1NBQ3JFLEtBQUssQ0FBQyxPQUFPLEVBQUUsMkNBQTJDLENBQUM7U0FDM0QsS0FBSyxDQUFDLHdCQUF3QixFQUFFLHNEQUFzRCxDQUFDO0lBRTFGLGFBQWE7SUFDYixVQUFVLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNuQixJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ25ELEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO0tBQy9ELENBQUM7SUFFRixhQUFhO0lBQ2IsU0FBUyxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUM7UUFDbEIsU0FBUyxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsSUFB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bUJ2QjtBQUVGOztHQUVHO0FBQ0ksTUFBTSxTQUFTLEdBQUcsQ0FDdkIsTUFBb0IsRUFDcEIsSUFBYSxFQUNzRSxFQUFFO0lBQ3JGLElBQUksQ0FBQztRQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsSUFBSSxLQUFLLFlBQVksY0FBUSxFQUFFLENBQUM7WUFDOUIsTUFBTSxNQUFNLEdBQTZCLEVBQUUsQ0FBQztZQUU1QyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUMzQixNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO29CQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNwQixDQUFDO2dCQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUM7UUFDcEMsQ0FBQztRQUNELE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLDBCQUEwQixDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ2hGLENBQUM7QUFDSCxDQUFDLENBQUM7QUF2QlcsUUFBQSxTQUFTLGFBdUJwQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcQWRhcHRpdmVfVGVzdGluZ1xcc3JjXFxsaWJzXFx2YWxpZGF0aW9uXFx2YWxpZGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgeiwgWm9kRXJyb3IsIFpvZFNjaGVtYSB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IgYXMgQ3VzdG9tVmFsaWRhdGlvbkVycm9yIH0gZnJvbSAnLi4vZXJyb3JzJztcblxuLyoqXG4gKiBDb21tb24gdmFsaWRhdGlvbiBzY2hlbWFzXG4gKi9cbmV4cG9ydCBjb25zdCBjb21tb25TY2hlbWFzID0ge1xuICAvLyBFbWFpbCB2YWxpZGF0aW9uXG4gIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCdJbnZhbGlkIGVtYWlsIGZvcm1hdCcpLFxuXG4gIC8vIFVVSUQgdmFsaWRhdGlvblxuICB1dWlkOiB6LnN0cmluZygpLnV1aWQoJ0ludmFsaWQgVVVJRCBmb3JtYXQnKSxcblxuICAvLyBQYXNzd29yZCB2YWxpZGF0aW9uIChtYXRjaGVzIHBhc3N3b3JkLnV0aWxzIHJlcXVpcmVtZW50cylcbiAgcGFzc3dvcmQ6IHpcbiAgICAuc3RyaW5nKClcbiAgICAubWluKDgsICdQYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycycpXG4gICAgLnJlZ2V4KC9bQS1aXS8sICdQYXNzd29yZCBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIHVwcGVyY2FzZSBsZXR0ZXInKVxuICAgIC5yZWdleCgvW2Etel0vLCAnUGFzc3dvcmQgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSBsb3dlcmNhc2UgbGV0dGVyJylcbiAgICAucmVnZXgoL1swLTldLywgJ1Bhc3N3b3JkIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgbnVtYmVyJylcbiAgICAucmVnZXgoL1shQCMkJV4mKigpLC4/XCI6e318PD5dLywgJ1Bhc3N3b3JkIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgc3BlY2lhbCBjaGFyYWN0ZXInKSxcblxuICAvLyBQYWdpbmF0aW9uXG4gIHBhZ2luYXRpb246IHoub2JqZWN0KHtcbiAgICBwYWdlOiB6LmNvZXJjZS5udW1iZXIoKS5pbnQoKS5wb3NpdGl2ZSgpLmRlZmF1bHQoMSksXG4gICAgbGltaXQ6IHouY29lcmNlLm51bWJlcigpLmludCgpLnBvc2l0aXZlKCkubWF4KDEwMCkuZGVmYXVsdCgyMCksXG4gIH0pLFxuXG4gIC8vIERhdGUgcmFuZ2VcbiAgZGF0ZVJhbmdlOiB6Lm9iamVjdCh7XG4gICAgc3RhcnREYXRlOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kRGF0ZTogei5jb2VyY2UuZGF0ZSgpLFxuICB9KSxcblxuICAvLyBTZWFyY2ggcXVlcnlcbiAgc2VhcmNoOiB6Lm9iamVjdCh7XG4gICAgcTogei5zdHJpbmcoKS5taW4oMSkubWF4KDEwMCksXG4gIH0pLFxufTtcblxuLyoqXG4gKiBNaWRkbGV3YXJlIGZhY3RvcnkgZm9yIHZhbGlkYXRpbmcgcmVxdWVzdCBkYXRhXG4gKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZSA9IChzY2hlbWE6IFpvZFNjaGVtYSwgc291cmNlOiAnYm9keScgfCAncXVlcnknIHwgJ3BhcmFtcycgPSAnYm9keScpID0+IHtcbiAgcmV0dXJuIChyZXE6IFJlcXVlc3QsIF9yZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiB2b2lkID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IHJlcVtzb3VyY2VdO1xuICAgICAgY29uc3QgdmFsaWRhdGVkID0gc2NoZW1hLnBhcnNlKGRhdGEpO1xuXG4gICAgICAvLyBSZXBsYWNlIHJlcXVlc3QgZGF0YSB3aXRoIHZhbGlkYXRlZCBkYXRhIChpbmNsdWRlcyBkZWZhdWx0cyBhbmQgdHJhbnNmb3JtYXRpb25zKVxuICAgICAgcmVxW3NvdXJjZV0gPSB2YWxpZGF0ZWQ7XG5cbiAgICAgIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgWm9kRXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7fTtcblxuICAgICAgICBlcnJvci5lcnJvcnMuZm9yRWFjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGF0aCA9IGVyci5wYXRoLmpvaW4oJy4nKTtcbiAgICAgICAgICBpZiAoIWVycm9yc1twYXRoXSkge1xuICAgICAgICAgICAgZXJyb3JzW3BhdGhdID0gW107XG4gICAgICAgICAgfVxuICAgICAgICAgIGVycm9yc1twYXRoXS5wdXNoKGVyci5tZXNzYWdlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV4dChuZXcgQ3VzdG9tVmFsaWRhdGlvbkVycm9yKCdWYWxpZGF0aW9uIGZhaWxlZCcsIGVycm9ycykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dChlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9O1xufTtcblxuLyoqXG4gKiBWYWxpZGF0ZSBkYXRhIHByb2dyYW1tYXRpY2FsbHkgKG5vdCBhcyBtaWRkbGV3YXJlKVxuICovXG5leHBvcnQgY29uc3QgdmFsaWRhdGVEYXRhID0gPFQ+KHNjaGVtYTogWm9kU2NoZW1hPFQ+LCBkYXRhOiB1bmtub3duKTogVCA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHNjaGVtYS5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBab2RFcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7fTtcblxuICAgICAgZXJyb3IuZXJyb3JzLmZvckVhY2goKGVycikgPT4ge1xuICAgICAgICBjb25zdCBwYXRoID0gZXJyLnBhdGguam9pbignLicpO1xuICAgICAgICBpZiAoIWVycm9yc1twYXRoXSkge1xuICAgICAgICAgIGVycm9yc1twYXRoXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVycm9yc1twYXRoXS5wdXNoKGVyci5tZXNzYWdlKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aHJvdyBuZXcgQ3VzdG9tVmFsaWRhdGlvbkVycm9yKCdWYWxpZGF0aW9uIGZhaWxlZCcsIGVycm9ycyk7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG4vKipcbiAqIFNhZmUgcGFyc2UgLSByZXR1cm5zIHJlc3VsdCB3aXRob3V0IHRocm93aW5nXG4gKi9cbmV4cG9ydCBjb25zdCBzYWZlUGFyc2UgPSA8VD4oXG4gIHNjaGVtYTogWm9kU2NoZW1hPFQ+LFxuICBkYXRhOiB1bmtub3duXG4pOiB7IHN1Y2Nlc3M6IHRydWU7IGRhdGE6IFQgfSB8IHsgc3VjY2VzczogZmFsc2U7IGVycm9yczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+IH0gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHNjaGVtYS5wYXJzZShkYXRhKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBab2RFcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7fTtcblxuICAgICAgZXJyb3IuZXJyb3JzLmZvckVhY2goKGVycikgPT4ge1xuICAgICAgICBjb25zdCBwYXRoID0gZXJyLnBhdGguam9pbignLicpO1xuICAgICAgICBpZiAoIWVycm9yc1twYXRoXSkge1xuICAgICAgICAgIGVycm9yc1twYXRoXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVycm9yc1twYXRoXS5wdXNoKGVyci5tZXNzYWdlKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3JzIH07XG4gICAgfVxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcnM6IHsgX2dlbmVyYWw6IFsnVW5rbm93biB2YWxpZGF0aW9uIGVycm9yJ10gfSB9O1xuICB9XG59O1xuIl0sInZlcnNpb24iOjN9